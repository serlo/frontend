{"version":3,"file":"edtr-io.cjs.production.min.js","sources":["../src/csrf-context.ts","../src/deserialize.ts","../src/plugins/types/common.tsx","../src/plugins/types/helpers/settings.tsx","../src/plugins/types/applet.tsx","../src/plugins/types/article.tsx","../src/plugins/types/course.tsx","../src/plugins/types/course-page.tsx","../src/plugins/types/event.tsx","../src/plugins/types/math-puzzle.tsx","../src/plugins/types/page.tsx","../src/plugins/types/taxonomy.tsx","../src/plugins/types/text-exercise.tsx","../src/plugins/helpers/semantic-section.tsx","../src/plugins/types/text-exercise-group.tsx","../src/plugins/types/text-solution.tsx","../src/plugins/types/user.tsx","../src/plugins/types/video.tsx","../src/plugins/helpers/hovering-overlay.tsx","../src/plugins/helpers/inline-settings.tsx","../src/plugins/helpers/inline-settings-input.tsx","../src/plugins/helpers/inline-input.tsx","../src/plugins/article.tsx","../src/plugins/equations/sign.tsx","../src/plugins/error/index.tsx","../src/plugins/equations/renderer.tsx","../src/plugins/equations/editor.tsx","../src/plugins/equations/index.ts","../src/plugins/exercise.tsx","../src/plugins/image.tsx","../src/plugins/important.tsx","../src/plugins/injection.tsx","../src/plugins/layout/editor.tsx","../src/plugins/layout/index.ts","../src/plugins/separator.tsx","../src/plugins/solution.tsx","../src/plugins/table.tsx","../src/plugins/deprecated/index.tsx","../src/plugins.tsx","../src/editor.tsx","../src/renderer.tsx","../src/clean-state.tsx"],"sourcesContent":["/**\n * This file is part of Serlo.org.\n *\n * Copyright (c) 2013-2021 Serlo Education e.V.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\")\n * you may not use this file except in compliance with the License\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * @copyright Copyright (c) 2013-2021 Serlo Education e.V.\n * @license   http://www.apache.org/licenses/LICENSE-2.0 Apache License 2.0\n * @link      https://github.com/serlo-org/serlo.org for the canonical source repository\n */\nimport React from 'react'\n\nexport const CsrfContext = React.createContext<() => string>(() => '')\n","/**\n * This file is part of Serlo.org.\n *\n * Copyright (c) 2013-2021 Serlo Education e.V.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\")\n * you may not use this file except in compliance with the License\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * @copyright Copyright (c) 2013-2021 Serlo Education e.V.\n * @license   http://www.apache.org/licenses/LICENSE-2.0 Apache License 2.0\n * @link      https://github.com/serlo-org/serlo.org for the canonical source repository\n */\nimport { StateType, StateTypeSerializedType } from '@edtr-io/plugin'\nimport { InputExercisePluginState } from '@edtr-io/plugin-input-exercise'\nimport { ScMcExercisePluginState } from '@edtr-io/plugin-sc-mc-exercise'\nimport {\n  convert,\n  isEdtr,\n  Edtr,\n  Legacy,\n  RowsPlugin,\n  OtherPlugin,\n  Splish,\n} from '@serlo/legacy-editor-to-editor'\nimport * as R from 'ramda'\n\nimport { appletTypeState } from './plugins/types/applet'\nimport { articleTypeState } from './plugins/types/article'\nimport { courseTypeState } from './plugins/types/course'\nimport { coursePageTypeState } from './plugins/types/course-page'\nimport { eventTypeState } from './plugins/types/event'\nimport { mathPuzzleTypeState } from './plugins/types/math-puzzle'\nimport { pageTypeState } from './plugins/types/page'\nimport { taxonomyTypeState } from './plugins/types/taxonomy'\nimport { textExerciseTypeState } from './plugins/types/text-exercise'\nimport { textExerciseGroupTypeState } from './plugins/types/text-exercise-group'\nimport { textSolutionTypeState } from './plugins/types/text-solution'\nimport { userTypeState } from './plugins/types/user'\nimport { videoTypeState } from './plugins/types/video'\nimport { Entity, License, Uuid } from './plugins/types/common'\nimport { EditorProps } from './editor'\n\nconst empty: RowsPlugin = { plugin: 'rows', state: [] }\n\nexport function deserialize({\n  initialState,\n  type,\n  onError,\n}: Pick<EditorProps, 'initialState' | 'type' | 'onError'>): DeserializeResult {\n  const stack: { id: number; type: string }[] = []\n  const config: Record<\n    string,\n    { deserialize: (state: any) => DeserializedState<StateType> }\n  > = {\n    applet: { deserialize: deserializeApplet },\n    article: { deserialize: deserializeArticle },\n    course: { deserialize: deserializeCourse },\n    'course-page': { deserialize: deserializeCoursePage },\n    event: { deserialize: deserializeEvent },\n    'math-puzzle': { deserialize: deserializeMathPuzzle },\n    page: { deserialize: deserializePage },\n    'grouped-text-exercise': { deserialize: deserializeTextExercise },\n    'text-exercise': { deserialize: deserializeTextExercise },\n    'text-exercise-group': { deserialize: deserializeTextExerciseGroup },\n    'text-solution': { deserialize: deserializeTextSolution },\n    user: { deserialize: deserializeUser },\n    video: { deserialize: deserializeVideo },\n    taxonomy: { deserialize: deserializeTaxonomy },\n  }\n  try {\n    if (config[type] === undefined) {\n      return {\n        error: 'type-unsupported',\n      }\n    }\n    const { deserialize } = config[type]\n    return succeed(deserialize(initialState))\n  } catch (e) {\n    const error = e as Error\n    if (typeof onError === 'function') {\n      onError(error, {\n        stack: JSON.stringify(stack),\n      })\n    }\n    return {\n      error: 'failure',\n    }\n  }\n\n  function succeed(\n    deserialized: DeserializedState<StateType>\n  ): DeserializeSuccess {\n    return {\n      success: true,\n      ...deserialized,\n    }\n  }\n\n  function deserializeApplet(\n    state: AppletSerializedState\n  ): DeserializedState<typeof appletTypeState> {\n    stack.push({ id: state.id, type: 'applet' })\n    return {\n      initialState: {\n        plugin: 'type-applet',\n        state: {\n          ...state,\n          changes: '',\n          title: state.title || '',\n          url: state.url || '',\n          content: serializeEditorState(\n            toEdtr(deserializeEditorState(state.content))\n          ),\n          reasoning: serializeEditorState(\n            toEdtr(deserializeEditorState(state.reasoning))\n          ),\n          meta_title: state.meta_title || '',\n          meta_description: state.meta_description || '',\n        },\n      },\n      converted: !isEdtr(deserializeEditorState(state.content) || empty),\n    }\n  }\n\n  function deserializeArticle(\n    state: ArticleSerializedState\n  ): DeserializedState<typeof articleTypeState> {\n    stack.push({ id: state.id, type: 'article' })\n\n    return {\n      initialState: {\n        plugin: 'type-article',\n        state: {\n          ...state,\n          changes: '',\n          title: state.title || '',\n          content: getContent(),\n          reasoning: serializeEditorState(\n            toEdtr(deserializeEditorState(state.reasoning))\n          ),\n          meta_title: state.meta_title || '',\n          meta_description: state.meta_description || '',\n        },\n      },\n      converted: !isEdtr(deserializeEditorState(state.content) || empty),\n    }\n\n    function getContent() {\n      const deserializedContent = deserializeEditorState(state.content)\n\n      const convertedContent = toEdtr(deserializedContent) as\n        | RowsPlugin\n        | OtherPlugin\n\n      if (\n        deserializedContent !== undefined &&\n        isEdtr(deserializedContent) &&\n        convertedContent.plugin === 'article'\n      ) {\n        return serializeEditorState(convertedContent)\n      }\n\n      return serializeEditorState({\n        plugin: 'article',\n        state: {\n          introduction: { plugin: 'articleIntroduction' },\n          content: convertedContent,\n          exercises: [],\n          exerciseFolder: { id: '', title: '' },\n          relatedContent: {\n            articles: [],\n            courses: [],\n            videos: [],\n          },\n          sources: [],\n        },\n      })\n    }\n  }\n\n  function deserializeCourse(\n    state: CourseSerializedState\n  ): DeserializedState<typeof courseTypeState> {\n    stack.push({ id: state.id, type: 'course' })\n    return {\n      initialState: {\n        plugin: 'type-course',\n        state: {\n          ...state,\n          changes: '',\n          title: state.title || '',\n          description: serializeEditorState(\n            toEdtr(deserializeEditorState(state.description))\n          ),\n          reasoning: serializeEditorState(\n            toEdtr(deserializeEditorState(state.reasoning))\n          ),\n          meta_description: state.meta_description || '',\n          'course-page': (state['course-page'] || []).map(\n            (s) => deserializeCoursePage(s).initialState.state\n          ),\n        },\n      },\n      converted: !isEdtr(deserializeEditorState(state.description) || empty),\n    }\n  }\n\n  function deserializeCoursePage(\n    state: CoursePageSerializedState\n  ): DeserializedState<typeof coursePageTypeState> {\n    stack.push({ id: state.id, type: 'course-page' })\n    return {\n      initialState: {\n        plugin: 'type-course-page',\n        state: {\n          ...state,\n          changes: '',\n          title: state.title || '',\n          icon: state.icon || 'explanation',\n          content: serializeEditorState(\n            toEdtr(deserializeEditorState(state.content))\n          ),\n        },\n      },\n      converted: !isEdtr(deserializeEditorState(state.content) || empty),\n    }\n  }\n\n  function deserializeEvent(\n    state: EventSerializedState\n  ): DeserializedState<typeof eventTypeState> {\n    stack.push({ id: state.id, type: 'event' })\n    return {\n      initialState: {\n        plugin: 'type-event',\n        state: {\n          ...state,\n          changes: '',\n          title: state.title || '',\n          content: serializeEditorState(\n            toEdtr(deserializeEditorState(state.content))\n          ),\n          meta_title: state.meta_title || '',\n          meta_description: state.meta_description || '',\n        },\n      },\n      converted: !isEdtr(deserializeEditorState(state.content) || empty),\n    }\n  }\n\n  function deserializeMathPuzzle(\n    state: MathPuzzleSerializedState\n  ): DeserializedState<typeof mathPuzzleTypeState> {\n    stack.push({ id: state.id, type: 'math-puzzle' })\n    return {\n      initialState: {\n        plugin: 'type-math-puzzle',\n        state: {\n          ...state,\n          changes: '',\n          content: serializeEditorState(\n            toEdtr(deserializeEditorState(state.content))\n          ),\n          source: state.source || '',\n        },\n      },\n      converted: !isEdtr(deserializeEditorState(state.content) || empty),\n    }\n  }\n\n  function deserializePage(\n    state: PageSerializedState\n  ): DeserializedState<typeof pageTypeState> {\n    stack.push({ id: state.id, type: 'page' })\n    return {\n      initialState: {\n        plugin: 'type-page',\n        state: {\n          ...state,\n          title: state.title || '',\n          content: serializeEditorState(\n            toEdtr(deserializeEditorState(state.content))\n          ),\n        },\n      },\n      converted: !isEdtr(deserializeEditorState(state.content) || empty),\n    }\n  }\n\n  function deserializeTaxonomy(\n    state: TaxonomySerializedState\n  ): DeserializedState<typeof taxonomyTypeState> {\n    stack.push({ id: state.id, type: 'taxonomy' })\n    return {\n      initialState: {\n        plugin: 'type-taxonomy',\n        state: {\n          ...state,\n          term: state.term,\n          description: serializeEditorState(\n            toEdtr(deserializeEditorState(state.description))\n          ),\n        },\n      },\n      converted: false, // no legacy editor for taxonomies\n    }\n  }\n\n  function deserializeTextExercise({\n    content,\n    'text-solution': textSolution,\n    'single-choice-right-answer': singleChoiceRightAnswer,\n    'single-choice-wrong-answer': singleChoiceWrongAnswer,\n    'multiple-choice-right-answer': multipleChoiceRightAnswer,\n    'multiple-choice-wrong-answer': multipleChoiceWrongAnswer,\n    'input-expression-equal-match-challenge': inputExpressionEqualMatchChallenge,\n    'input-number-exact-match-challenge': inputNumberExactMatchChallenge,\n    'input-string-normalized-match-challenge': inputStringNormalizedMatchChallenge,\n    ...state\n  }: TextExerciseSerializedState): DeserializedState<\n    typeof textExerciseTypeState\n  > {\n    stack.push({ id: state.id, type: 'text-exercise' })\n    const deserialized = deserializeEditorState(content)\n\n    const scMcExercise =\n      deserialized && !isEdtr(deserialized)\n        ? deserializeScMcExercise()\n        : undefined\n\n    const inputExercise =\n      deserialized && !isEdtr(deserialized)\n        ? deserializeInputExercise()\n        : undefined\n\n    return {\n      initialState: {\n        plugin: 'type-text-exercise',\n        state: {\n          ...state,\n          changes: '',\n          'text-solution': textSolution\n            ? deserializeTextSolution(textSolution).initialState.state\n            : '',\n          content: getContent(),\n        },\n      },\n      converted: !isEdtr(deserialized || empty),\n    }\n\n    function getContent() {\n      const deserializedContent = deserializeEditorState(content)\n      if (deserializedContent !== undefined && isEdtr(deserializedContent)) {\n        return serializeEditorState(toEdtr(deserializedContent))\n      }\n\n      const convertedContent = toEdtr(deserializedContent) as RowsPlugin\n      const interactive = scMcExercise || inputExercise\n\n      return serializeEditorState({\n        plugin: 'exercise',\n        state: {\n          content: {\n            plugin: 'rows',\n            state: convertedContent.state,\n          },\n          interactive,\n        },\n      })\n    }\n\n    function deserializeScMcExercise():\n      | {\n          plugin: 'scMcExercise'\n          state: StateTypeSerializedType<ScMcExercisePluginState>\n        }\n      | undefined {\n      stack.push({ id: state.id, type: 'sc-mc-exercise' })\n      if (\n        singleChoiceWrongAnswer ||\n        singleChoiceRightAnswer ||\n        multipleChoiceWrongAnswer ||\n        multipleChoiceRightAnswer\n      ) {\n        const convertedSCRightAnswers =\n          singleChoiceRightAnswer && singleChoiceRightAnswer.content\n            ? [\n                {\n                  content: extractChildFromRows(\n                    convert(\n                      deserializeEditorState(singleChoiceRightAnswer.content)\n                    )\n                  ),\n                  isCorrect: true,\n                  feedback: extractChildFromRows(\n                    convert(\n                      deserializeEditorState(singleChoiceRightAnswer.feedback)\n                    )\n                  ),\n                },\n              ]\n            : []\n        const convertedSCWrongAnswers = singleChoiceWrongAnswer\n          ? singleChoiceWrongAnswer\n              .filter((answer) => {\n                return answer.content\n              })\n              .map((answer) => {\n                return {\n                  content: extractChildFromRows(\n                    convert(deserializeEditorState(answer.content))\n                  ),\n                  isCorrect: false,\n                  feedback: extractChildFromRows(\n                    convert(deserializeEditorState(answer.feedback))\n                  ),\n                }\n              })\n          : []\n\n        const convertedMCRightAnswers = multipleChoiceRightAnswer\n          ? multipleChoiceRightAnswer\n              .filter((answer) => {\n                return answer.content\n              })\n              .map((answer) => {\n                return {\n                  content: extractChildFromRows(\n                    convert(deserializeEditorState(answer.content))\n                  ),\n                  isCorrect: true,\n                  feedback: {\n                    plugin: 'text',\n                  },\n                }\n              })\n          : []\n\n        const convertedMCWrongAnswers = multipleChoiceWrongAnswer\n          ? multipleChoiceWrongAnswer\n              .filter((answer) => {\n                return answer.content\n              })\n              .map((answer) => {\n                return {\n                  content: extractChildFromRows(\n                    convert(deserializeEditorState(answer.content))\n                  ),\n                  isCorrect: false,\n                  feedback: extractChildFromRows(\n                    convert(deserializeEditorState(answer.feedback))\n                  ),\n                }\n              })\n          : []\n        const isSingleChoice = !(\n          convertedMCRightAnswers.length || convertedMCWrongAnswers.length\n        )\n        return {\n          plugin: 'scMcExercise',\n          state: {\n            isSingleChoice: isSingleChoice,\n            answers: [\n              ...(isSingleChoice ? convertedSCRightAnswers : []),\n              ...(isSingleChoice ? convertedSCWrongAnswers : []),\n              ...(!isSingleChoice ? convertedMCRightAnswers : []),\n              ...(!isSingleChoice ? convertedMCWrongAnswers : []),\n            ],\n          },\n        }\n      }\n    }\n\n    function deserializeInputExercise():\n      | {\n          plugin: 'inputExercise'\n          state: StateTypeSerializedType<InputExercisePluginState>\n        }\n      | undefined {\n      if (\n        inputStringNormalizedMatchChallenge ||\n        inputNumberExactMatchChallenge ||\n        inputExpressionEqualMatchChallenge\n      ) {\n        const type = inputStringNormalizedMatchChallenge\n          ? 'input-string-normalized-match-challenge'\n          : inputNumberExactMatchChallenge\n          ? 'input-number-exact-match-challenge'\n          : 'input-expression-equal-match-challenge'\n\n        const inputExercises = filterDefined([\n          inputStringNormalizedMatchChallenge,\n          inputNumberExactMatchChallenge,\n          inputExpressionEqualMatchChallenge,\n        ])\n\n        return {\n          plugin: 'inputExercise',\n          state: {\n            type,\n            answers: extractInputAnswers(inputExercises, true),\n            unit: '',\n          },\n        }\n      }\n\n      function extractInputAnswers(\n        inputExercises: InputType[],\n        isCorrect: boolean\n      ): {\n        value: string\n        isCorrect: boolean\n        feedback: { plugin: string; state?: unknown }\n      }[] {\n        if (inputExercises.length === 0) return []\n\n        const answers = inputExercises.map((exercise) => {\n          return {\n            value: exercise.solution,\n            feedback: extractChildFromRows(\n              convert(deserializeEditorState(exercise.feedback))\n            ),\n            isCorrect,\n          }\n        })\n\n        const children = R.flatten(\n          inputExercises.map((exercise) => {\n            return filterDefined([\n              exercise['input-string-normalized-match-challenge'],\n              exercise['input-number-exact-match-challenge'],\n              exercise['input-expression-equal-match-challenge'],\n            ])\n          })\n        )\n\n        return R.concat(answers, extractInputAnswers(children, false))\n      }\n\n      function filterDefined<T>(array: (T | undefined)[]): T[] {\n        return array.filter((el) => typeof el !== 'undefined') as T[]\n      }\n    }\n  }\n\n  function extractChildFromRows(plugin: RowsPlugin) {\n    return plugin.state.length ? plugin.state[0] : { plugin: 'text' }\n  }\n\n  function deserializeTextExerciseGroup(\n    state: TextExerciseGroupSerializedState\n  ): DeserializedState<typeof textExerciseGroupTypeState> {\n    stack.push({ id: state.id, type: 'text-exercise-group' })\n    return {\n      initialState: {\n        plugin: 'type-text-exercise-group',\n        state: {\n          ...state,\n          changes: '',\n          content: serializeEditorState(\n            toEdtr(deserializeEditorState(state.content))\n          ),\n          cohesive: state.cohesive === 'true',\n          'grouped-text-exercise': (state['grouped-text-exercise'] || []).map(\n            (s) => deserializeTextExercise(s).initialState.state\n          ),\n        },\n      },\n      converted: !isEdtr(deserializeEditorState(state.content) || empty),\n    }\n  }\n\n  function deserializeTextSolution(\n    state: TextSolutionSerializedState\n  ): DeserializedState<typeof textSolutionTypeState> {\n    stack.push({ id: state.id, type: 'text-solution' })\n\n    return {\n      initialState: {\n        plugin: 'type-text-solution',\n        state: {\n          ...state,\n          changes: '',\n          content: getContent(),\n        },\n      },\n      converted: !isEdtr(deserializeEditorState(state.content) || empty),\n    }\n\n    function getContent() {\n      const deserializedContent = deserializeEditorState(state.content)\n      if (deserializedContent !== undefined && isEdtr(deserializedContent)) {\n        return serializeEditorState(toEdtr(deserializedContent))\n      }\n\n      const convertedContent = toEdtr(deserializedContent) as RowsPlugin\n\n      return serializeEditorState({\n        plugin: 'solution',\n        state: {\n          prerequisite: undefined,\n          strategy: { plugin: 'text' },\n          steps: convertedContent,\n        },\n      })\n    }\n  }\n\n  function deserializeUser(\n    state: UserSerializedState\n  ): DeserializedState<typeof userTypeState> {\n    stack.push({ id: state.id, type: 'user' })\n    return {\n      initialState: {\n        plugin: 'type-user',\n        state: {\n          ...state,\n          description: serializeEditorState(\n            toEdtr(deserializeEditorState(state.description))\n          ),\n        },\n      },\n      converted: false, // no legacy-editor for users\n    }\n  }\n\n  function deserializeVideo(\n    state: VideoSerializedState\n  ): DeserializedState<typeof videoTypeState> {\n    stack.push({ id: state.id, type: 'video' })\n    return {\n      initialState: {\n        plugin: 'type-video',\n        state: {\n          ...state,\n          changes: '',\n          title: state.title || '',\n          description: serializeEditorState(\n            toEdtr(deserializeEditorState(state.description))\n          ),\n          content: state.content || '',\n          reasoning: serializeEditorState(\n            toEdtr(deserializeEditorState(state.reasoning))\n          ),\n        },\n      },\n      converted: !isEdtr(deserializeEditorState(state.description) || empty),\n    }\n  }\n\n  interface AppletSerializedState extends Entity {\n    title?: string\n    url?: string\n    content: SerializedEditorState\n    reasoning: SerializedEditorState\n    meta_title?: string\n    meta_description?: string\n  }\n\n  interface ArticleSerializedState extends Entity {\n    title?: string\n    content: SerializedEditorState\n    reasoning: SerializedEditorState\n    meta_title?: string\n    meta_description?: string\n  }\n\n  interface CourseSerializedState extends Entity {\n    title?: string\n    description: SerializedEditorState\n    reasoning: SerializedEditorState\n    meta_description?: string\n    'course-page'?: CoursePageSerializedState[]\n  }\n\n  interface CoursePageSerializedState extends Entity {\n    title?: string\n    icon?: 'explanation' | 'play' | 'question'\n    content: SerializedEditorState\n  }\n\n  interface EventSerializedState extends Entity {\n    title?: string\n    content: SerializedEditorState\n    meta_title?: string\n    meta_description?: string\n  }\n\n  interface MathPuzzleSerializedState extends Entity {\n    content: SerializedEditorState\n    source?: string\n  }\n\n  interface PageSerializedState extends Uuid, License {\n    title?: string\n    content: SerializedEditorState\n  }\n\n  interface TaxonomySerializedState extends Uuid {\n    term: {\n      name: string\n    }\n    description: SerializedEditorState\n    taxonomy: number\n    parent: number\n    position: number\n  }\n\n  interface TextExerciseSerializedState extends Entity {\n    content: SerializedEditorState\n    'text-solution'?: TextSolutionSerializedState\n    'single-choice-right-answer'?: {\n      content: SerializedLegacyEditorState\n      feedback: SerializedLegacyEditorState\n    }\n    'single-choice-wrong-answer'?: {\n      content: SerializedLegacyEditorState\n      feedback: SerializedLegacyEditorState\n    }[]\n    'multiple-choice-right-answer'?: { content: SerializedLegacyEditorState }[]\n    'multiple-choice-wrong-answer'?: {\n      content: SerializedLegacyEditorState\n      feedback: SerializedLegacyEditorState\n    }[]\n    'input-expression-equal-match-challenge'?: InputType\n    'input-number-exact-match-challenge'?: InputType\n    'input-string-normalized-match-challenge': InputType\n  }\n\n  interface InputType {\n    solution: string\n    feedback: SerializedLegacyEditorState\n    'input-expression-equal-match-challenge'?: InputType[]\n    'input-number-exact-match-challenge'?: InputType[]\n    'input-string-normalized-match-challenge'?: InputType[]\n  }\n\n  interface TextExerciseGroupSerializedState extends Entity {\n    cohesive?: string\n    content: SerializedEditorState\n    'grouped-text-exercise'?: TextExerciseSerializedState[]\n  }\n\n  interface TextSolutionSerializedState extends Entity {\n    content: SerializedEditorState\n  }\n\n  interface UserSerializedState extends Uuid {\n    description: SerializedEditorState\n  }\n\n  interface VideoSerializedState extends Entity {\n    title?: string\n    description: SerializedEditorState\n    content?: string\n    reasoning: SerializedEditorState\n  }\n}\n\nexport interface DeserializedState<T extends StateType> {\n  initialState: {\n    plugin: string\n    state?: StateTypeSerializedType<T>\n  }\n  converted: boolean\n}\n\nexport function isError(result: DeserializeResult): result is DeserializeError {\n  return !!(result as DeserializeError).error\n}\n\nexport type DeserializeResult = DeserializeSuccess | DeserializeError\nexport interface DeserializeSuccess\n  extends DeserializedState<StateType<unknown>> {\n  success: true\n}\nexport type DeserializeError =\n  | { error: 'type-unsupported' }\n  | { error: 'failure' }\n\nfunction toEdtr(content: EditorState): Edtr {\n  if (!content)\n    return { plugin: 'rows', state: [{ plugin: 'text', state: undefined }] }\n  if (isEdtr(content)) return content\n  return convert(content)\n}\n\nfunction serializeEditorState(content: Legacy): SerializedLegacyEditorState\nfunction serializeEditorState(content: EditorState): SerializedEditorState\nfunction serializeEditorState(\n  content: EditorState\n): SerializedEditorState | SerializedLegacyEditorState {\n  if (typeof content === 'string') return content as SerializedLegacyEditorState\n  return content ? (JSON.stringify(content) as any) : undefined\n}\n\nfunction deserializeEditorState(content: SerializedLegacyEditorState): Legacy\nfunction deserializeEditorState(content: SerializedEditorState): EditorState\nfunction deserializeEditorState(\n  content: SerializedLegacyEditorState | SerializedEditorState\n): EditorState {\n  try {\n    return content ? JSON.parse(content) : undefined\n  } catch {\n    // No valid JSON, so this is interpreted as Markdown\n    return content as Legacy\n  }\n}\n\ntype EditorState = Legacy | Splish | Edtr | undefined\n\n// Fake `__type` property is just here to let TypeScript distinguish between the types\ntype SerializedEditorState = (string | undefined) & {\n  __type: 'serialized-editor-state'\n}\ntype SerializedLegacyEditorState = (string | undefined) & {\n  __type: 'serialized-legacy-editor-state'\n}\n","/**\n * This file is part of Serlo.org.\n *\n * Copyright (c) 2013-2021 Serlo Education e.V.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\")\n * you may not use this file except in compliance with the License\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * @copyright Copyright (c) 2013-2021 Serlo Education e.V.\n * @license   http://www.apache.org/licenses/LICENSE-2.0 Apache License 2.0\n * @link      https://github.com/serlo-org/serlo.org for the canonical source repository\n */\nimport {\n  useScopedDispatch,\n  useScopedSelector,\n  useScopedStore,\n  PluginToolbarButton,\n} from '@edtr-io/core'\nimport {\n  StateType,\n  StateTypesSerializedType,\n  StateTypeSerializedType,\n  StateTypesValueType,\n  StateTypeValueType,\n  StateTypesReturnType,\n  StateTypeReturnType,\n  StateUpdater,\n  child,\n  number,\n  object,\n  string,\n} from '@edtr-io/plugin'\nimport {\n  getDocument,\n  redo,\n  serializeRootDocument,\n  undo,\n  hasRedoActions,\n  hasUndoActions,\n  getPendingChanges,\n} from '@edtr-io/store'\nimport { Icon, faTrashAlt, styled } from '@edtr-io/ui'\nimport { useI18n } from '@serlo/i18n'\nimport * as R from 'ramda'\nimport * as React from 'react'\nimport BSAlert from 'react-bootstrap/lib/Alert'\nimport BSModal from 'react-bootstrap/lib/Modal'\nimport BSButton from 'react-bootstrap/lib/Button'\nimport BSCheckbox from 'react-bootstrap/lib/Checkbox'\nimport BSFormGroup from 'react-bootstrap/lib/FormGroup'\nimport BSControlLabel from 'react-bootstrap/lib/ControlLabel'\nimport BSFormControl from 'react-bootstrap/lib/FormControl'\nimport { createPortal } from 'react-dom'\n\nimport { CsrfContext } from '../../csrf-context'\nimport { SaveContext, storeState } from '../../editor'\n\nexport const licenseState = object({\n  id: number(),\n  title: string(),\n  url: string(),\n  agreement: string(),\n  iconHref: string(),\n})\n\nexport const uuid = {\n  id: number(),\n}\n\nexport const license = {\n  license: licenseState,\n}\n\nexport const entity = {\n  ...uuid,\n  ...license,\n  revision: number(),\n  changes: string(),\n}\n\nexport type Uuid = StateTypesSerializedType<typeof uuid>\n\nexport type License = StateTypesSerializedType<typeof license>\n\nexport type Entity = Uuid & License & { revision: number; changes?: string }\n\nexport const HeaderInput = styled.input({\n  border: 'none',\n  width: '100%',\n  borderBottom: '2px solid transparent',\n  '&:focus': {\n    outline: 'none',\n    borderColor: '#007ec1',\n  },\n})\n\nexport function Controls(props: OwnProps) {\n  const i18n = useI18n()\n  const store = useScopedStore()\n  const dispatch = useScopedDispatch()\n  const undoable = useScopedSelector(hasUndoActions())\n  const redoable = useScopedSelector(hasRedoActions())\n  const pendingChanges = useScopedSelector(getPendingChanges())\n  const hasPendingChanges = pendingChanges !== 0\n  const getCsrfToken = React.useContext(CsrfContext)\n\n  const [visible, setVisibility] = React.useState(false)\n  const [pending, setPending] = React.useState(false)\n  const [hasError, setHasError] = React.useState(false)\n  const [savedToLocalstorage, setSavedToLocalstorage] = React.useState(false)\n  const { onSave, mayCheckout } = React.useContext(SaveContext)\n  const [agreement, setAgreement] = React.useState(false)\n  const [emailSubscription, setEmailSubscription] = React.useState(true)\n  const [\n    notificationSubscription,\n    setNotificationSubscription,\n  ] = React.useState(true)\n  const [autoCheckout, setAutoCheckout] = React.useState(false)\n\n  React.useEffect(() => {\n    if (visible) {\n      // Reset license agreement\n      setPending(false)\n      setHasError(false)\n      setSavedToLocalstorage(false)\n      setAgreement(false)\n    }\n  }, [visible])\n\n  React.useEffect(() => {\n    window.onbeforeunload = hasPendingChanges && !pending ? () => '' : null\n  }, [hasPendingChanges, pending])\n\n  return (\n    <React.Fragment>\n      {createPortal(\n        <div className=\"btn-group btn-group-community\">\n          <button\n            className=\"btn btn-default\"\n            onClick={() => {\n              dispatch(undo())\n            }}\n            disabled={!undoable}\n          >\n            <span className=\"fa fa-undo\" />\n          </button>\n          <button\n            className=\"btn btn-default\"\n            onClick={() => {\n              dispatch(redo())\n            }}\n            disabled={!redoable}\n          >\n            <span className=\"fa fa-repeat\" />\n          </button>\n          {renderSaveButton()}\n        </div>,\n        document.getElementsByClassName('controls')[0]\n      )}\n      <BSModal\n        show={visible}\n        onHide={() => {\n          setVisibility(false)\n        }}\n      >\n        <BSModal.Header closeButton>\n          <BSModal.Title>{i18n.t('edtr-io::Save')}</BSModal.Title>\n        </BSModal.Header>\n        <BSModal.Body>\n          {renderAlert()}\n          {renderChanges()}\n          {renderLicense()}\n          {renderSubscription()}\n          {renderCheckout()}\n        </BSModal.Body>\n        <BSModal.Footer>\n          <BSButton\n            onClick={() => {\n              setVisibility(false)\n            }}\n          >\n            {i18n.t('edtr-io::Cancel')}\n          </BSButton>\n          <BSButton\n            onClick={() => {\n              handleSave()\n            }}\n            bsStyle=\"success\"\n            disabled={!maySave() || pending}\n            title={getSaveHint()}\n          >\n            {pending ? i18n.t('edtr-io::Saving…') : i18n.t('edtr-io::Save')}\n          </BSButton>\n        </BSModal.Footer>\n      </BSModal>\n    </React.Fragment>\n  )\n\n  function renderSaveButton() {\n    const useOverlay = props.changes || props.license || props.subscriptions\n    const buttonProps = useOverlay\n      ? {\n          onClick() {\n            setVisibility(true)\n          },\n          disabled: !hasPendingChanges,\n          children: <span className=\"fa fa-save\" />,\n        }\n      : {\n          onClick() {\n            handleSave()\n          },\n          disabled: !hasPendingChanges || !maySave() || pending,\n          children: pending ? (\n            <span className=\"fa fa-spinner fa-spin\" />\n          ) : (\n            <span className=\"fa fa-save\" />\n          ),\n        }\n\n    return <button className=\"btn btn-success\" {...buttonProps} />\n  }\n\n  function licenseAccepted() {\n    return !props.license || agreement\n  }\n  function changesFilledIn() {\n    return !props.changes || props.changes.value\n  }\n  function maySave() {\n    return licenseAccepted() && changesFilledIn()\n  }\n\n  function getSaveHint() {\n    if (maySave()) return undefined\n    if (licenseAccepted() && !changesFilledIn()) {\n      return i18n.t('edtr-io::You need to fill out the changes you made')\n    } else if (!licenseAccepted() && changesFilledIn()) {\n      return i18n.t('edtr-io::You need to accept the license terms')\n    } else {\n      return i18n.t(\n        'edtr-io::You need to fill out the changes you made and accept the license terms'\n      )\n    }\n  }\n\n  function handleSave() {\n    if (!maySave()) return\n    const serializedRoot = serializeRootDocument()(store.getState())\n    const serialized = R.has('state', serializedRoot)\n      ? serializedRoot.state\n      : null\n\n    if (\n      serialized !== null &&\n      serializedRoot?.plugin === 'type-text-exercise-group' &&\n      R.has('cohesive', serialized)\n    ) {\n      // legacy server can only handle string attributes\n      serialized.cohesive = String(serialized.cohesive)\n    }\n\n    setPending(true)\n    onSave({\n      ...serialized,\n      csrf: getCsrfToken(),\n      controls: {\n        ...(props.subscriptions\n          ? {\n              subscription: {\n                subscribe: notificationSubscription ? 1 : 0,\n                mailman: emailSubscription ? 1 : 0,\n              },\n            }\n          : {}),\n        ...(mayCheckout\n          ? {\n              checkout: autoCheckout,\n            }\n          : {}),\n      },\n    })\n      .then(() => {\n        storeState(undefined)\n        setPending(false)\n        setHasError(false)\n      })\n      .catch(() => {\n        setPending(false)\n        setHasError(true)\n      })\n  }\n\n  function renderAlert() {\n    if (!hasError) return null\n    return (\n      <React.Fragment>\n        <BSAlert\n          bsStyle=\"danger\"\n          onDismiss={() => {\n            setHasError(false)\n          }}\n        >\n          {i18n.t('edtr-io::An error occurred during saving.')}\n          <br />\n          {i18n.t(\n            'edtr-io::You can store the revision locally, refresh the page and try to save again.'\n          )}\n        </BSAlert>\n        <BSModal.Footer>\n          <BSButton\n            bsStyle=\"success\"\n            onClick={() => {\n              const serializedRoot = serializeRootDocument()(store.getState())\n              storeState(serializedRoot)\n              setSavedToLocalstorage(true)\n            }}\n          >\n            {savedToLocalstorage\n              ? i18n.t('edtr-io::Revision saved')\n              : i18n.t('edtr-io::Save revision')}\n          </BSButton>\n        </BSModal.Footer>\n      </React.Fragment>\n    )\n  }\n\n  function renderChanges() {\n    const { changes } = props\n    if (!changes) return null\n    return (\n      <BSFormGroup controlId=\"changes\">\n        <BSControlLabel>{i18n.t('edtr-io::Changes')}</BSControlLabel>\n        <BSFormControl\n          componentClass=\"textarea\"\n          value={changes.value}\n          onChange={(e) => {\n            const { value } = e.target as HTMLTextAreaElement\n            changes.set(value)\n          }}\n        />\n      </BSFormGroup>\n    )\n  }\n\n  function renderCheckout() {\n    if (!mayCheckout) return null\n    return (\n      <BSCheckbox\n        checked={autoCheckout}\n        onChange={(e) => {\n          const { checked } = e.target as HTMLInputElement\n          setAutoCheckout(checked)\n        }}\n      >\n        {i18n.t('edtr-io::Skip peer review (not recommended)')}\n      </BSCheckbox>\n    )\n  }\n\n  function renderLicense() {\n    const { license } = props\n    if (!license) return null\n    return (\n      <BSCheckbox\n        checked={agreement}\n        onChange={(e) => {\n          const { checked } = e.target as HTMLInputElement\n          setAgreement(checked)\n        }}\n      >\n        <span dangerouslySetInnerHTML={{ __html: license.agreement.value }} />\n      </BSCheckbox>\n    )\n  }\n\n  function renderSubscription() {\n    const { subscriptions } = props\n    if (!subscriptions) return null\n    return (\n      <React.Fragment>\n        <BSCheckbox\n          checked={notificationSubscription}\n          onChange={(e) => {\n            const { checked } = e.target as HTMLInputElement\n            setNotificationSubscription(checked)\n          }}\n        >\n          {i18n.t('edtr-io::Enable serlo.org notifications')}\n        </BSCheckbox>\n        <BSCheckbox\n          checked={emailSubscription}\n          onChange={(e) => {\n            const { checked } = e.target as HTMLInputElement\n            setEmailSubscription(checked)\n          }}\n        >\n          {i18n.t('edtr-io::Enable notifications via e-mail')}\n        </BSCheckbox>\n      </React.Fragment>\n    )\n  }\n}\n\nexport function entityType<\n  Ds extends Record<string, StateType>,\n  Childs extends Record<string, StateType>\n>(\n  ownTypes: Ds,\n  children: Childs,\n  getFocusableChildren?: (\n    children: { [K in keyof Ds]: { id: string }[] }\n  ) => { id: string }[]\n): StateType<\n  StateTypesSerializedType<Ds & Childs>,\n  StateTypesValueType<Ds & Childs>,\n  StateTypesReturnType<Ds & Childs> & {\n    replaceOwnState: (newValue: StateTypesSerializedType<Ds>) => void\n  }\n> {\n  const objectType = object<Ds & Childs>(\n    { ...ownTypes, ...children },\n    getFocusableChildren\n  )\n  return {\n    ...objectType,\n    init(state, onChange) {\n      const initialisedObject = objectType.init(state, onChange)\n      return {\n        ...initialisedObject,\n        replaceOwnState(newValue) {\n          onChange((previousState, helpers) => {\n            return R.mapObjIndexed((_value, key) => {\n              if (key in ownTypes) {\n                return ownTypes[key].deserialize(newValue[key], helpers)\n              } else {\n                return previousState[key]\n              }\n            }, previousState) as StateTypesValueType<Ds & Childs>\n          })\n        },\n      }\n    },\n  }\n}\n\nexport function serialized<S extends StateType>(type: S) {\n  return {\n    ...type,\n    serialize(...args: Parameters<typeof type.serialize>) {\n      return JSON.stringify(type.serialize(...args))\n    },\n    deserialize(\n      serialized: string,\n      helpers: Parameters<typeof type.deserialize>[1]\n    ) {\n      return type.deserialize(JSON.parse(serialized), helpers)\n    },\n  }\n}\n\nexport function editorContent(\n  plugin: string = 'rows'\n): StateType<\n  string,\n  StateTypeValueType<ReturnType<typeof child>>,\n  StateTypeReturnType<ReturnType<typeof child>>\n> {\n  const originalChild = child<string>({ plugin })\n  return {\n    ...originalChild,\n    serialize(...args: Parameters<typeof originalChild.serialize>) {\n      return JSON.stringify(originalChild.serialize(...args))\n    },\n    deserialize(\n      serialized: string,\n      helpers: Parameters<typeof originalChild.deserialize>[1]\n    ) {\n      return originalChild.deserialize(JSON.parse(serialized), helpers)\n    },\n  }\n}\n\nexport function serializedChild(\n  plugin: string\n): StateType<\n  unknown,\n  StateTypeValueType<ReturnType<typeof child>>,\n  StateTypeReturnType<ReturnType<typeof child>>\n> {\n  const originalChild = child({ plugin, config: { skipControls: true } })\n  return {\n    ...originalChild,\n    serialize(...args: Parameters<typeof originalChild.serialize>) {\n      return originalChild.serialize(...args).state\n    },\n    deserialize(\n      serialized: string,\n      helpers: Parameters<typeof originalChild.deserialize>[1]\n    ) {\n      return originalChild.deserialize(\n        {\n          plugin,\n          state: serialized,\n        },\n        helpers\n      )\n    },\n  }\n}\n\nexport function optionalSerializedChild(\n  plugin: string\n): StateType<\n  StateTypeSerializedType<ReturnType<typeof serializedChild>> | null,\n  StateTypeValueType<ReturnType<typeof serializedChild>> | null,\n  StateTypeReturnType<ReturnType<typeof serializedChild>> & {\n    create: (state?: unknown) => void\n    remove: () => void\n  }\n> {\n  const child = serializedChild(plugin)\n  return {\n    ...child,\n    init(\n      state: string,\n      onChange: (updater: StateUpdater<string | null>) => void\n    ) {\n      return {\n        ...child.init(state, (updater) => {\n          onChange((oldId, helpers) => {\n            return updater(oldId || '', helpers)\n          })\n        }),\n        create(state?: unknown) {\n          onChange((_oldId, helpers) => {\n            if (typeof state !== 'undefined') {\n              return child.deserialize(state, helpers)\n            }\n            return child.createInitialState(helpers)\n          })\n        },\n        remove() {\n          onChange(() => null)\n        },\n      }\n    },\n    serialize(\n      deserialized: string | null,\n      helpers: Parameters<typeof child.serialize>[1]\n    ) {\n      if (!deserialized) return null\n      return child.serialize(deserialized, helpers)\n    },\n    deserialize(\n      serialized: string | null,\n      helpers: Parameters<typeof child.deserialize>[1]\n    ) {\n      if (!serialized) return null\n      return child.deserialize(serialized, helpers)\n    },\n    createInitialState() {\n      return null\n    },\n    getFocusableChildren(child) {\n      return child ? [{ id: child }] : []\n    },\n  }\n}\n\nexport function OptionalChild(props: {\n  removeLabel: string\n  state: StateTypeReturnType<ReturnType<typeof serializedChild>>\n  onRemove: () => void\n}) {\n  const expectedStateType = object(entity)\n  const document = useScopedSelector(getDocument(props.state.id)) as {\n    state: StateTypeValueType<typeof expectedStateType>\n  }\n  const children = props.state.render({\n    renderToolbar(children) {\n      if (document.state.id !== 0) return children\n\n      return (\n        <React.Fragment>\n          <PluginToolbarButton\n            icon={<Icon icon={faTrashAlt} />}\n            label={props.removeLabel}\n            onClick={() => {\n              props.onRemove()\n            }}\n          />\n          {children}\n        </React.Fragment>\n      )\n    },\n  })\n  return (\n    <React.Fragment>\n      <hr />\n      {children}\n    </React.Fragment>\n  )\n}\n\ninterface OwnProps {\n  changes?: StateTypeReturnType<typeof entity['changes']>\n  license?: StateTypeReturnType<typeof entity['license']>\n  subscriptions?: boolean\n}\n","/**\n * This file is part of Serlo.org.\n *\n * Copyright (c) 2013-2021 Serlo Education e.V.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\")\n * you may not use this file except in compliance with the License\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * @copyright Copyright (c) 2013-2021 Serlo Education e.V.\n * @license   http://www.apache.org/licenses/LICENSE-2.0 Apache License 2.0\n * @link      https://github.com/serlo-org/serlo.org for the canonical source repository\n */\nimport { faHistory } from '@fortawesome/free-solid-svg-icons/faHistory'\nimport { StateTypeReturnType, string } from '@edtr-io/plugin'\nimport { Icon, faCheck, styled } from '@edtr-io/ui'\nimport { PluginToolbarButton } from '@edtr-io/core'\nimport { useI18n } from '@serlo/i18n'\nimport moment from 'moment'\nimport * as React from 'react'\nimport BSButton from 'react-bootstrap/lib/Button'\nimport BSFormControl from 'react-bootstrap/lib/FormControl'\nimport BSControlLabel from 'react-bootstrap/lib/ControlLabel'\nimport BSFormGroup from 'react-bootstrap/lib/FormGroup'\nimport BSModal from 'react-bootstrap/lib/Modal'\nimport BSTable from 'react-bootstrap/lib/Table'\nimport fetch from 'unfetch'\n\nimport { deserialize, isError } from '../../../deserialize'\n\nconst StyledTR = styled.tr<{ selected: boolean }>((props) => {\n  return props.selected\n    ? {\n        border: '3px solid rgb(0,100,0)',\n      }\n    : {\n        cursor: 'pointer',\n      }\n})\n\ninterface RevisionData {\n  id: number\n  timestamp: string\n  author: string\n  changes: string\n  active: boolean\n}\n\nexport function RevisionHistory<T>(\n  props: React.PropsWithChildren<{\n    id: number\n    currentRevision: number\n    onSwitchRevision: (data: T) => void\n  }>\n) {\n  const [availableRevisions, setAvailableRevisions] = React.useState<\n    RevisionData[]\n  >([])\n  const i18n = useI18n()\n\n  const [showRevisions, setShowRevisions] = React.useState(false)\n  React.useEffect(() => {\n    if (props.id !== 0) {\n      fetch(`/entity/repository/get-revisions/${props.id}`)\n        .then((response) => response.json())\n        .then((data: RevisionData[]) => {\n          setAvailableRevisions(data)\n        })\n    }\n  }, [props.id])\n\n  return (\n    <div>\n      <span\n        onClick={() => {\n          if (availableRevisions.length) {\n            setShowRevisions(true)\n          }\n        }}\n      >\n        <PluginToolbarButton\n          icon={<Icon icon={faHistory} size=\"lg\" />}\n          label={i18n.t('edtr-io::Switch to another revision')}\n        />\n      </span>\n      <BSModal\n        show={showRevisions}\n        onHide={() => {\n          setShowRevisions(false)\n        }}\n        bsSize=\"lg\"\n      >\n        <BSModal.Header closeButton>\n          <BSModal.Title>\n            {i18n.t('edtr-io::Switch to another revision')}\n          </BSModal.Title>\n        </BSModal.Header>\n        <BSModal.Body>\n          <BSTable striped hover>\n            <thead>\n              <tr>\n                <th>#</th>\n                <th>{i18n.t('edtr-io::Current')}</th>\n                <th>{i18n.t('edtr-io::Changes')}</th>\n                <th>{i18n.t('edtr-io::Author')}</th>\n                <th>{i18n.t('edtr-io::Created at')}</th>\n              </tr>\n            </thead>\n            <tbody>\n              {availableRevisions.map((revisionData) => {\n                const selected = props.currentRevision\n                  ? props.currentRevision === revisionData.id\n                  : revisionData.active\n\n                const dateTime = moment.utc(revisionData.timestamp).local()\n                return (\n                  <StyledTR\n                    selected={selected}\n                    onClick={() => {\n                      // don't select the current selected\n                      if (selected) return\n\n                      fetch(\n                        `/entity/repository/get-revision-data/${props.id}/${revisionData.id}`\n                      )\n                        .then((response) => response.json())\n                        .then((data: { state: unknown; type: string }) => {\n                          const deserialized = deserialize({\n                            initialState: data.state,\n                            type: data.type,\n                          })\n                          if (isError(deserialized)) {\n                            alert(deserialized.error)\n                          } else {\n                            props.onSwitchRevision(\n                              deserialized.initialState.state as T\n                            )\n                            setShowRevisions(false)\n                          }\n                        })\n                    }}\n                    key={revisionData.id}\n                  >\n                    <td>{revisionData.id}</td>\n                    <td>\n                      {revisionData.active ? <Icon icon={faCheck} /> : null}\n                    </td>\n                    <th>{revisionData.changes}</th>\n                    <td>{revisionData.author}</td>\n                    <td title={dateTime.format('LL, LTS')}>\n                      {dateTime.fromNow()}\n                    </td>\n                  </StyledTR>\n                )\n              })}\n            </tbody>\n          </BSTable>\n        </BSModal.Body>\n        <BSModal.Footer>\n          <BSButton\n            onClick={() => {\n              setShowRevisions(false)\n            }}\n          >\n            Schließen\n          </BSButton>\n        </BSModal.Footer>\n      </BSModal>\n    </div>\n  )\n}\n\nexport function Settings(props: React.PropsWithChildren<{}>) {\n  return <React.Fragment>{props.children}</React.Fragment>\n}\n\nSettings.Textarea = function SettingsTextarea({\n  label,\n  state,\n}: {\n  label: string\n  state: StateTypeReturnType<ReturnType<typeof string>>\n}) {\n  return (\n    <BSFormGroup>\n      <BSControlLabel>{label}</BSControlLabel>\n      <BSFormControl\n        componentClass=\"textarea\"\n        value={state.value}\n        onChange={(e) => {\n          const { value } = e.target as HTMLTextAreaElement\n          state.set(value)\n        }}\n      />\n    </BSFormGroup>\n  )\n}\n\nSettings.Select = function SettingsSelect({\n  label,\n  state,\n  options,\n}: {\n  label: string\n  state: StateTypeReturnType<ReturnType<typeof string>>\n  options: { label: string; value: string }[]\n}) {\n  return (\n    <BSFormGroup controlId=\"formControlsSelect\">\n      <BSControlLabel>{label}</BSControlLabel>\n      <BSFormControl\n        componentClass=\"select\"\n        placeholder=\"select\"\n        value={state.value}\n        onChange={(e) => {\n          const { value } = e.target as HTMLSelectElement\n          state.set(value)\n        }}\n      >\n        {options.map((option) => {\n          return (\n            <option key={option.value} value={option.value}>\n              {option.label}\n            </option>\n          )\n        })}\n      </BSFormControl>\n    </BSFormGroup>\n  )\n}\n","/**\n * This file is part of Serlo.org.\n *\n * Copyright (c) 2013-2021 Serlo Education e.V.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\")\n * you may not use this file except in compliance with the License\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * @copyright Copyright (c) 2013-2021 Serlo Education e.V.\n * @license   http://www.apache.org/licenses/LICENSE-2.0 Apache License 2.0\n * @link      https://github.com/serlo-org/serlo.org for the canonical source repository\n */\nimport { EditorPlugin, EditorPluginProps, string } from '@edtr-io/plugin'\nimport { useI18n } from '@serlo/i18n'\nimport * as React from 'react'\n\nimport {\n  entity,\n  Controls,\n  editorContent,\n  serializedChild,\n  HeaderInput,\n  entityType,\n} from './common'\nimport { Settings, RevisionHistory } from './helpers/settings'\n\nexport const appletTypeState = entityType(\n  {\n    ...entity,\n    title: string(),\n    content: editorContent(),\n    reasoning: editorContent(),\n    meta_title: string(),\n    meta_description: string(),\n    url: serializedChild('geogebra'),\n  },\n  {}\n)\n\nexport const appletTypePlugin: EditorPlugin<typeof appletTypeState> = {\n  Component: AppletTypeEditor,\n  state: appletTypeState,\n  config: {},\n}\n\nfunction AppletTypeEditor(props: EditorPluginProps<typeof appletTypeState>) {\n  const { title, url, content, meta_title, meta_description } = props.state\n  const i18n = useI18n()\n\n  return (\n    <div>\n      <div className=\"page-header\">\n        {props.renderIntoToolbar(\n          <RevisionHistory\n            id={props.state.id.value}\n            currentRevision={props.state.revision.value}\n            onSwitchRevision={props.state.replaceOwnState}\n          />\n        )}\n        {props.renderIntoSettings(\n          <Settings>\n            <Settings.Textarea\n              label={i18n.t('applet::Title for search engines')}\n              state={meta_title}\n            />\n            <Settings.Textarea\n              label={i18n.t('applet::Description for search engines')}\n              state={meta_description}\n            />\n          </Settings>\n        )}\n        <h1>\n          {props.editable ? (\n            <HeaderInput\n              placeholder={i18n.t('applet::Title')}\n              value={title.value}\n              onChange={(e: React.ChangeEvent<HTMLInputElement>) => {\n                title.set(e.target.value)\n              }}\n            />\n          ) : (\n            <span itemProp=\"name\">{title.value}</span>\n          )}\n        </h1>\n      </div>\n      <article>\n        {url.render()}\n        {content.render()}\n      </article>\n      <Controls subscriptions {...props.state} />\n    </div>\n  )\n}\n","/**\n * This file is part of Serlo.org.\n *\n * Copyright (c) 2013-2021 Serlo Education e.V.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\")\n * you may not use this file except in compliance with the License\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * @copyright Copyright (c) 2013-2021 Serlo Education e.V.\n * @license   http://www.apache.org/licenses/LICENSE-2.0 Apache License 2.0\n * @link      https://github.com/serlo-org/serlo.org for the canonical source repository\n */\nimport * as React from 'react'\nimport { EditorPlugin, EditorPluginProps, string } from '@edtr-io/plugin'\nimport { useI18n } from '@serlo/i18n'\n\nimport {\n  Controls,\n  editorContent,\n  entity,\n  HeaderInput,\n  entityType,\n} from './common'\nimport { RevisionHistory, Settings } from './helpers/settings'\n\nexport const articleTypeState = entityType(\n  {\n    ...entity,\n    title: string(),\n    content: editorContent('article'),\n    reasoning: editorContent(),\n    meta_title: string(),\n    meta_description: string(),\n  },\n  {}\n)\n\nexport const articleTypePlugin: EditorPlugin<typeof articleTypeState> = {\n  Component: ArticleTypeEditor,\n  state: articleTypeState,\n  config: {},\n}\n\nfunction ArticleTypeEditor(props: EditorPluginProps<typeof articleTypeState>) {\n  const { title, content, meta_title, meta_description } = props.state\n  const i18n = useI18n()\n\n  return (\n    <React.Fragment>\n      <div className=\"page-header\">\n        {props.renderIntoToolbar(\n          <RevisionHistory\n            id={props.state.id.value}\n            currentRevision={props.state.revision.value}\n            onSwitchRevision={props.state.replaceOwnState}\n          />\n        )}\n        {props.renderIntoSettings(\n          <Settings>\n            <Settings.Textarea\n              label={i18n.t('article::Title for search engines')}\n              state={meta_title}\n            />\n            <Settings.Textarea\n              label={i18n.t('article::Description for search engines')}\n              state={meta_description}\n            />\n          </Settings>\n        )}\n        <h1>\n          {props.editable ? (\n            <HeaderInput\n              placeholder={i18n.t('article::Title')}\n              value={title.value}\n              onChange={(e: React.ChangeEvent<HTMLInputElement>) => {\n                title.set(e.target.value)\n              }}\n            />\n          ) : (\n            <span itemProp=\"name\">{title.value}</span>\n          )}\n        </h1>\n      </div>\n      <div itemProp=\"articleBody\">{content.render()}</div>\n      <Controls subscriptions {...props.state} />\n    </React.Fragment>\n  )\n}\n","/**\n * This file is part of Serlo.org.\n *\n * Copyright (c) 2013-2021 Serlo Education e.V.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\")\n * you may not use this file except in compliance with the License\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * @copyright Copyright (c) 2013-2021 Serlo Education e.V.\n * @license   http://www.apache.org/licenses/LICENSE-2.0 Apache License 2.0\n * @link      https://github.com/serlo-org/serlo.org for the canonical source repository\n */\nimport * as React from 'react'\nimport { AddButton } from '@edtr-io/editor-ui/internal'\nimport { EditorPlugin, EditorPluginProps, list, string } from '@edtr-io/plugin'\nimport { useI18n } from '@serlo/i18n'\n\nimport {\n  editorContent,\n  entity,\n  Controls,\n  serializedChild,\n  HeaderInput,\n  OptionalChild,\n  entityType,\n} from './common'\nimport { RevisionHistory, Settings } from './helpers/settings'\n\nexport const courseTypeState = entityType(\n  {\n    ...entity,\n    title: string(),\n    description: editorContent(),\n    reasoning: editorContent(),\n    meta_description: string(),\n  },\n  {\n    'course-page': list(serializedChild('type-course-page')),\n  }\n)\n\nexport const courseTypePlugin: EditorPlugin<typeof courseTypeState> = {\n  Component: CourseTypeEditor,\n  state: courseTypeState,\n  config: {},\n}\n\nfunction CourseTypeEditor(props: EditorPluginProps<typeof courseTypeState>) {\n  const { title, meta_description, 'course-page': children } = props.state\n  const i18n = useI18n()\n\n  return (\n    <article>\n      {props.renderIntoToolbar(\n        <RevisionHistory\n          id={props.state.id.value}\n          currentRevision={props.state.revision.value}\n          onSwitchRevision={props.state.replaceOwnState}\n        />\n      )}\n      {props.renderIntoSettings(\n        <Settings>\n          <Settings.Textarea\n            label={i18n.t('course::Description for search engines')}\n            state={meta_description}\n          />\n        </Settings>\n      )}\n      <h1>\n        {props.editable ? (\n          <HeaderInput\n            placeholder={i18n.t('course::Title')}\n            value={title.value}\n            onChange={(e: React.ChangeEvent<HTMLInputElement>) => {\n              title.set(e.target.value)\n            }}\n          />\n        ) : (\n          <span itemProp=\"name\">{title.value}</span>\n        )}\n      </h1>\n      {children.map((child, index) => {\n        return (\n          <OptionalChild\n            state={child}\n            key={child.id}\n            removeLabel={i18n.t('course::Remove course page')}\n            onRemove={() => {\n              children.remove(index)\n            }}\n          />\n        )\n      })}\n      <hr />\n      <AddButton onClick={() => children.insert()}>\n        {i18n.t('course::Add course page')}\n      </AddButton>\n      <Controls subscriptions {...props.state} />\n    </article>\n  )\n}\n","/**\n * This file is part of Serlo.org.\n *\n * Copyright (c) 2013-2021 Serlo Education e.V.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\")\n * you may not use this file except in compliance with the License\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * @copyright Copyright (c) 2013-2021 Serlo Education e.V.\n * @license   http://www.apache.org/licenses/LICENSE-2.0 Apache License 2.0\n * @link      https://github.com/serlo-org/serlo.org for the canonical source repository\n */\nimport { EditorPlugin, EditorPluginProps, string } from '@edtr-io/plugin'\nimport { useI18n } from '@serlo/i18n'\nimport * as React from 'react'\n\nimport {\n  entity,\n  Controls,\n  editorContent,\n  HeaderInput,\n  entityType,\n} from './common'\nimport { RevisionHistory, Settings } from './helpers/settings'\n\nexport const coursePageTypeState = entityType(\n  {\n    ...entity,\n    icon: string('explanation'),\n    title: string(''),\n    content: editorContent(),\n  },\n  {}\n)\n\nexport const coursePageTypePlugin: EditorPlugin<\n  typeof coursePageTypeState,\n  { skipControls: boolean }\n> = {\n  Component: CoursePageTypeEditor,\n  state: coursePageTypeState,\n  config: {\n    skipControls: false,\n  },\n}\n\nfunction CoursePageTypeEditor(\n  props: EditorPluginProps<\n    typeof coursePageTypeState,\n    { skipControls: boolean }\n  >\n) {\n  const { title, icon, content } = props.state\n  const i18n = useI18n()\n\n  React.useEffect(() => {\n    if (!['explanation', 'play', 'question'].includes(icon.value)) {\n      icon.set('explanation')\n    }\n  }, [icon.value])\n  return (\n    <article>\n      {props.renderIntoToolbar(\n        <RevisionHistory\n          id={props.state.id.value}\n          currentRevision={props.state.revision.value}\n          onSwitchRevision={props.state.replaceOwnState}\n        />\n      )}\n      {props.renderIntoSettings(\n        <Settings>\n          <Settings.Select\n            label=\"Icon\"\n            state={icon}\n            options={[\n              {\n                label: i18n.t('coursePage::Explanation'),\n                value: 'explanation',\n              },\n              {\n                label: i18n.t('coursePage::Video'),\n                value: 'play',\n              },\n              {\n                label: i18n.t('coursePage::Question'),\n                value: 'question',\n              },\n            ]}\n          />\n        </Settings>\n      )}\n      <h1>\n        {props.editable ? (\n          <HeaderInput\n            placeholder={i18n.t('coursePage::Title')}\n            value={title.value}\n            onChange={(e: React.ChangeEvent<HTMLInputElement>) => {\n              title.set(e.target.value)\n            }}\n          />\n        ) : (\n          <span itemProp=\"name\">{title.value}</span>\n        )}\n      </h1>\n      {content.render()}\n      {props.config.skipControls ? null : (\n        <Controls subscriptions {...props.state} />\n      )}\n    </article>\n  )\n}\n","/**\n * This file is part of Serlo.org.\n *\n * Copyright (c) 2013-2021 Serlo Education e.V.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\")\n * you may not use this file except in compliance with the License\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * @copyright Copyright (c) 2013-2021 Serlo Education e.V.\n * @license   http://www.apache.org/licenses/LICENSE-2.0 Apache License 2.0\n * @link      https://github.com/serlo-org/serlo.org for the canonical source repository\n */\nimport { EditorPlugin, EditorPluginProps, string } from '@edtr-io/plugin'\nimport { useI18n } from '@serlo/i18n'\nimport * as React from 'react'\n\nimport {\n  editorContent,\n  entity,\n  Controls,\n  HeaderInput,\n  entityType,\n} from './common'\nimport { RevisionHistory, Settings } from './helpers/settings'\n\nexport const eventTypeState = entityType(\n  {\n    ...entity,\n    title: string(),\n    content: editorContent(),\n    meta_title: string(),\n    meta_description: string(),\n  },\n  {}\n)\n\nexport const eventTypePlugin: EditorPlugin<typeof eventTypeState> = {\n  Component: EventTypeEditor,\n  state: eventTypeState,\n  config: {},\n}\n\nfunction EventTypeEditor(props: EditorPluginProps<typeof eventTypeState>) {\n  const { content, title, meta_title, meta_description } = props.state\n  const i18n = useI18n()\n\n  return (\n    <React.Fragment>\n      <div className=\"page-header\">\n        {props.renderIntoToolbar(\n          <RevisionHistory\n            id={props.state.id.value}\n            currentRevision={props.state.revision.value}\n            onSwitchRevision={props.state.replaceOwnState}\n          />\n        )}\n        {props.renderIntoSettings(\n          <Settings>\n            <Settings.Textarea\n              label={i18n.t('event::Title for search engines')}\n              state={meta_title}\n            />\n            <Settings.Textarea\n              label={i18n.t('event::Description for search engines')}\n              state={meta_description}\n            />\n          </Settings>\n        )}\n        <h1>\n          {props.editable ? (\n            <HeaderInput\n              placeholder={i18n.t('event::Title')}\n              value={title.value}\n              onChange={(e: React.ChangeEvent<HTMLInputElement>) => {\n                title.set(e.target.value)\n              }}\n            />\n          ) : (\n            <span itemProp=\"name\">{title.value}</span>\n          )}\n        </h1>\n      </div>\n      <article>{content.render()}</article>\n      <Controls subscriptions {...props.state} />\n    </React.Fragment>\n  )\n}\n","/**\n * This file is part of Serlo.org.\n *\n * Copyright (c) 2013-2021 Serlo Education e.V.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\")\n * you may not use this file except in compliance with the License\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * @copyright Copyright (c) 2013-2021 Serlo Education e.V.\n * @license   http://www.apache.org/licenses/LICENSE-2.0 Apache License 2.0\n * @link      https://github.com/serlo-org/serlo.org for the canonical source repository\n */\nimport { EditorPlugin, EditorPluginProps, string } from '@edtr-io/plugin'\nimport { useI18n } from '@serlo/i18n'\nimport * as React from 'react'\n\nimport { entity, Controls, editorContent, entityType } from './common'\nimport { RevisionHistory, Settings } from './helpers/settings'\n\nexport const mathPuzzleTypeState = entityType(\n  {\n    ...entity,\n    source: string(),\n    content: editorContent(),\n  },\n  {}\n)\n\nexport const mathPuzzleTypePlugin: EditorPlugin<typeof mathPuzzleTypeState> = {\n  Component: MathPuzzleTypeEditor,\n  state: mathPuzzleTypeState,\n  config: {},\n}\n\nfunction MathPuzzleTypeEditor(\n  props: EditorPluginProps<typeof mathPuzzleTypeState>\n) {\n  const { source, content } = props.state\n  const i18n = useI18n()\n\n  return (\n    <React.Fragment>\n      {props.renderIntoToolbar(\n        <RevisionHistory\n          id={props.state.id.value}\n          currentRevision={props.state.revision.value}\n          onSwitchRevision={props.state.replaceOwnState}\n        />\n      )}\n      {props.renderIntoSettings(\n        <Settings>\n          <Settings.Textarea\n            label={i18n.t('mathPuzzle::Source code')}\n            state={source}\n          />\n        </Settings>\n      )}\n      <div className=\"math-puzzle\" data-source={source.value}>\n        {content.render()}\n      </div>\n      <Controls subscriptions {...props.state} />\n    </React.Fragment>\n  )\n}\n","/**\n * This file is part of Serlo.org.\n *\n * Copyright (c) 2013-2021 Serlo Education e.V.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\")\n * you may not use this file except in compliance with the License\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * @copyright Copyright (c) 2013-2021 Serlo Education e.V.\n * @license   http://www.apache.org/licenses/LICENSE-2.0 Apache License 2.0\n * @link      https://github.com/serlo-org/serlo.org for the canonical source repository\n */\nimport {\n  EditorPlugin,\n  EditorPluginProps,\n  object,\n  string,\n} from '@edtr-io/plugin'\nimport { useI18n } from '@serlo/i18n'\nimport * as React from 'react'\n\nimport { Controls, editorContent, HeaderInput, license, uuid } from './common'\n\nexport const pageTypeState = object({\n  ...uuid,\n  ...license,\n  title: string(),\n  content: editorContent(),\n})\n\nexport const pageTypePlugin: EditorPlugin<typeof pageTypeState> = {\n  Component: PageTypeEditor,\n  state: pageTypeState,\n  config: {},\n}\n\nfunction PageTypeEditor(props: EditorPluginProps<typeof pageTypeState>) {\n  const { title, content } = props.state\n  const i18n = useI18n()\n\n  return (\n    <article>\n      <header>\n        <div className=\"page-header\">\n          <h1>\n            {props.editable ? (\n              <HeaderInput\n                placeholder={i18n.t('page::Title')}\n                value={title.value}\n                onChange={(e: React.ChangeEvent<HTMLInputElement>) => {\n                  title.set(e.target.value)\n                }}\n              />\n            ) : (\n              <span itemProp=\"name\">{title.value}</span>\n            )}\n          </h1>\n        </div>\n      </header>\n      <section itemProp=\"articleBody\">{content.render()}</section>\n      <Controls {...props.state} />\n    </article>\n  )\n}\n","/**\n * This file is part of Serlo.org.\n *\n * Copyright (c) 2013-2021 Serlo Education e.V.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\")\n * you may not use this file except in compliance with the License\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * @copyright Copyright (c) 2013-2021 Serlo Education e.V.\n * @license   http://www.apache.org/licenses/LICENSE-2.0 Apache License 2.0\n * @link      https://github.com/serlo-org/serlo.org for the canonical source repository\n */\nimport {\n  EditorPlugin,\n  EditorPluginProps,\n  object,\n  string,\n  number,\n} from '@edtr-io/plugin'\nimport { useI18n } from '@serlo/i18n'\nimport * as React from 'react'\n\nimport { Controls, editorContent, HeaderInput, uuid } from './common'\n\nexport const taxonomyTypeState = object({\n  ...uuid,\n  term: object({\n    name: string(),\n  }),\n  taxonomy: number(),\n  parent: number(),\n  position: number(),\n  description: editorContent(),\n})\n\nexport const taxonomyTypePlugin: EditorPlugin<typeof taxonomyTypeState> = {\n  Component: TaxonomyTypeEditor,\n  state: taxonomyTypeState,\n  config: {},\n}\n\nfunction TaxonomyTypeEditor(\n  props: EditorPluginProps<typeof taxonomyTypeState>\n) {\n  const { term, description } = props.state\n  const i18n = useI18n()\n\n  return (\n    <article>\n      <header>\n        <div className=\"page-header\">\n          <h1>\n            {props.editable ? (\n              <HeaderInput\n                placeholder={i18n.t('taxonomy::Title')}\n                value={term.name.value}\n                onChange={(e: React.ChangeEvent<HTMLInputElement>) => {\n                  term.name.set(e.target.value)\n                }}\n              />\n            ) : (\n              <span itemProp=\"name\">{term.name.value}</span>\n            )}\n          </h1>\n        </div>\n      </header>\n      <section itemProp=\"articleBody\">{description.render()}</section>\n      <Controls />\n    </article>\n  )\n}\n","/**\n * This file is part of Serlo.org.\n *\n * Copyright (c) 2013-2021 Serlo Education e.V.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\")\n * you may not use this file except in compliance with the License\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * @copyright Copyright (c) 2013-2021 Serlo Education e.V.\n * @license   http://www.apache.org/licenses/LICENSE-2.0 Apache License 2.0\n * @link      https://github.com/serlo-org/serlo.org for the canonical source repository\n */\nimport { AddButton } from '@edtr-io/editor-ui/internal'\nimport { EditorPlugin, EditorPluginProps } from '@edtr-io/plugin'\nimport { useI18n } from '@serlo/i18n'\nimport * as React from 'react'\n\nimport {\n  editorContent,\n  entity,\n  Controls,\n  optionalSerializedChild,\n  OptionalChild,\n  entityType,\n} from './common'\n\nimport { RevisionHistory } from './helpers/settings'\n\nexport const textExerciseTypeState = entityType(\n  {\n    ...entity,\n    content: editorContent('exercise'),\n  },\n  {\n    'text-solution': optionalSerializedChild('type-text-solution'),\n  }\n)\n\nexport const textExerciseTypePlugin: EditorPlugin<\n  typeof textExerciseTypeState,\n  { skipControls: boolean }\n> = {\n  Component: TextExerciseTypeEditor,\n  state: textExerciseTypeState,\n  config: {\n    skipControls: false,\n  },\n}\n\nexport function TextExerciseTypeEditor(\n  props: EditorPluginProps<\n    typeof textExerciseTypeState,\n    { skipControls: boolean }\n  >\n) {\n  const { content, 'text-solution': textSolution } = props.state\n  const i18n = useI18n()\n\n  return (\n    <article className=\"text-exercise\">\n      {props.renderIntoToolbar(\n        <RevisionHistory\n          id={props.state.id.value}\n          currentRevision={props.state.revision.value}\n          onSwitchRevision={props.state.replaceOwnState}\n        />\n      )}\n      {content.render()}\n      {textSolution.id ? (\n        <OptionalChild\n          state={textSolution}\n          removeLabel={i18n.t('textExercise::Remove solution')}\n          onRemove={() => {\n            textSolution.remove()\n          }}\n        />\n      ) : (\n        <AddButton\n          onClick={() => {\n            textSolution.create()\n          }}\n        >\n          {i18n.t('textExercise::Create solution')}\n        </AddButton>\n      )}\n      {props.config.skipControls ? null : (\n        <Controls subscriptions {...props.state} />\n      )}\n    </article>\n  )\n}\n","/**\n * This file is part of Serlo.org.\n *\n * Copyright (c) 2013-2021 Serlo Education e.V.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\")\n * you may not use this file except in compliance with the License\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * @copyright Copyright (c) 2013-2021 Serlo Education e.V.\n * @license   http://www.apache.org/licenses/LICENSE-2.0 Apache License 2.0\n * @link      https://github.com/serlo-org/serlo.org for the canonical source repository\n */\nimport { Icon, styled } from '@edtr-io/ui'\nimport * as React from 'react'\nimport { FontAwesomeIconProps } from '@fortawesome/react-fontawesome'\n\nconst Container = styled.div({\n  boxShadow: '0 1px 3px 0 rgba(0,0,0,0.2)',\n  marginTop: '10px',\n  padding: '10px',\n  minHeight: '70px',\n  position: 'relative',\n})\n\nconst BackgroundIcon = styled.div({\n  position: 'absolute',\n  top: 0,\n  right: 0,\n  color: 'rgba(0,0,0,0.1)',\n  transform: 'translate(-15px, 10px)',\n  zIndex: 0,\n})\n\nexport function SemanticSection(props: SemanticSectionProps) {\n  const { children, editable } = props\n  if (!editable) return <React.Fragment>{children}</React.Fragment>\n\n  return <Container>{props.children}</Container>\n}\n\nexport interface SemanticSectionProps {\n  children: React.ReactNode\n  editable?: boolean\n}\n","/**\n * This file is part of Serlo.org.\n *\n * Copyright (c) 2013-2021 Serlo Education e.V.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\")\n * you may not use this file except in compliance with the License\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * @copyright Copyright (c) 2013-2021 Serlo Education e.V.\n * @license   http://www.apache.org/licenses/LICENSE-2.0 Apache License 2.0\n * @link      https://github.com/serlo-org/serlo.org for the canonical source repository\n */\nimport { AddButton } from '@edtr-io/editor-ui/internal'\nimport { boolean, EditorPlugin, EditorPluginProps, list } from '@edtr-io/plugin'\nimport { useI18n } from '@serlo/i18n'\nimport * as React from 'react'\n\nimport {\n  editorContent,\n  entity,\n  Controls,\n  serializedChild,\n  OptionalChild,\n  entityType,\n} from './common'\nimport { RevisionHistory } from './helpers/settings'\nimport { SemanticSection } from '../helpers/semantic-section'\nimport { useVirtual } from 'react-virtual'\n\nexport const textExerciseGroupTypeState = entityType(\n  {\n    ...entity,\n    content: editorContent(),\n    cohesive: boolean(false),\n  },\n  {\n    'grouped-text-exercise': list(serializedChild('type-text-exercise')),\n  }\n)\n\nexport const textExerciseGroupTypePlugin: EditorPlugin<\n  typeof textExerciseGroupTypeState\n> = {\n  Component: TextExerciseGroupTypeEditor,\n  state: textExerciseGroupTypeState,\n  config: {},\n}\n\nfunction TextExerciseGroupTypeEditor(\n  props: EditorPluginProps<typeof textExerciseGroupTypeState>\n) {\n  const { cohesive, content, 'grouped-text-exercise': children } = props.state\n  const i18n = useI18n()\n  const isCohesive = cohesive.value ?? false\n\n  const virtualParent = React.useRef(null)\n\n  const virtualizer = useVirtual({\n    size: children.length,\n    parentRef: virtualParent,\n    estimateSize: React.useCallback(() => 35, []),\n  })\n\n  const contentRendered = content.render({\n    renderSettings(children) {\n      return (\n        <React.Fragment>\n          {children}\n          {getSettings()}\n        </React.Fragment>\n      )\n    },\n  })\n\n  return (\n    <article className=\"exercisegroup\">\n      {props.renderIntoToolbar(\n        <RevisionHistory\n          id={props.state.id.value}\n          currentRevision={props.state.revision.value}\n          onSwitchRevision={props.state.replaceOwnState}\n        />\n      )}\n      <section className=\"row\">\n        <SemanticSection editable={props.editable}>\n          {contentRendered}\n        </SemanticSection>\n      </section>\n      <div\n        ref={virtualParent}\n        style={{\n          height: '100%',\n          overflow: 'auto',\n        }}\n      >\n        <div\n          style={{\n            height: `${virtualizer.totalSize}px`,\n            width: '100%',\n            position: 'relative',\n          }}\n        >\n          {virtualizer.virtualItems.map((virtualRow) => {\n            const child = children[virtualRow.index]\n            return (\n              <div\n                key={virtualRow.index}\n                ref={virtualRow.measureRef}\n                style={{\n                  position: 'absolute',\n                  top: 0,\n                  left: 0,\n                  width: '100%',\n                  transform: `translateY(${virtualRow.start}px)`,\n                }}\n              >\n                <section className=\"row\" key={child.id}>\n                  <div className=\"col-sm-1 hidden-xs\">\n                    <em>{getExerciseIndex(virtualRow.index)})</em>\n                  </div>\n                  <div className=\"col-sm-11 col-xs-12\">\n                    <OptionalChild\n                      state={child}\n                      removeLabel={i18n.t('textExerciseGroup::Remove exercise')}\n                      onRemove={() => children.remove(virtualRow.index)}\n                    />\n                  </div>\n                </section>\n              </div>\n            )\n          })}\n        </div>\n      </div>\n      <AddButton onClick={() => children.insert()}>\n        {i18n.t('textExerciseGroup::Add exercise')}\n      </AddButton>\n      <Controls subscriptions {...props.state} />\n    </article>\n  )\n\n  function getSettings() {\n    return (\n      <div>\n        <label htmlFor=\"cohesiveSelect\">\n          {i18n.t('textExerciseGroup::Kind of exercise group')}:\n        </label>{' '}\n        <select\n          id=\"cohesiveSelect\"\n          value={isCohesive ? 'cohesive' : 'non-cohesive'}\n          onChange={(e) => cohesive.set(e.target.value === 'cohesive')}\n        >\n          <option value=\"non-cohesive\">\n            {i18n.t('textExerciseGroup::not cohesive')}\n          </option>\n          <option value=\"cohesive\">\n            {i18n.t('textExerciseGroup::cohesive')}\n          </option>\n        </select>\n      </div>\n    )\n  }\n\n  function getExerciseIndex(index: number) {\n    return isCohesive ? index + 1 : String.fromCharCode(97 + index)\n  }\n}\n","/**\n * This file is part of Serlo.org.\n *\n * Copyright (c) 2013-2021 Serlo Education e.V.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\")\n * you may not use this file except in compliance with the License\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * @copyright Copyright (c) 2013-2021 Serlo Education e.V.\n * @license   http://www.apache.org/licenses/LICENSE-2.0 Apache License 2.0\n * @link      https://github.com/serlo-org/serlo.org for the canonical source repository\n */\nimport { EditorPlugin, EditorPluginProps } from '@edtr-io/plugin'\nimport { ExpandableBox } from '@edtr-io/renderer-ui'\nimport { ThemeProvider } from '@edtr-io/ui'\nimport { useI18n } from '@serlo/i18n'\nimport * as React from 'react'\n\nimport { Controls, editorContent, entity, entityType } from './common'\nimport { RevisionHistory } from './helpers/settings'\n\nexport const textSolutionTypeState = entityType(\n  {\n    ...entity,\n    content: editorContent('solution'),\n  },\n  {}\n)\nexport type TextSolutionTypeProps = EditorPluginProps<\n  typeof textSolutionTypeState,\n  { skipControls: boolean }\n>\n\nexport const textSolutionTypePlugin: EditorPlugin<\n  typeof textSolutionTypeState,\n  { skipControls: boolean }\n> = {\n  Component: TextSolutionTypeEditor,\n  state: textSolutionTypeState,\n  config: {\n    skipControls: false,\n  },\n}\n\nconst solutionTheme = {\n  rendererUi: {\n    expandableBox: {\n      toggleBackgroundColor: '#d9edf7',\n      containerBorderColor: '#d9edf7',\n    },\n  },\n}\n\nfunction TextSolutionTypeEditor(props: TextSolutionTypeProps) {\n  const i18n = useI18n()\n  const renderTitle = React.useCallback((collapsed: boolean) => {\n    return (\n      <React.Fragment>\n        {collapsed\n          ? i18n.t('solution::Show solution')\n          : i18n.t('solution::Hide solution')}\n      </React.Fragment>\n    )\n  }, [])\n\n  return (\n    <React.Fragment>\n      {props.renderIntoToolbar(\n        <RevisionHistory\n          id={props.state.id.value}\n          currentRevision={props.state.revision.value}\n          onSwitchRevision={props.state.replaceOwnState}\n        />\n      )}\n      <ThemeProvider theme={solutionTheme}>\n        <ExpandableBox renderTitle={renderTitle} editable={props.editable}>\n          {props.state.content.render()}\n        </ExpandableBox>\n      </ThemeProvider>\n      {props.config.skipControls ? null : (\n        <Controls subscriptions {...props.state} />\n      )}\n    </React.Fragment>\n  )\n}\n","/**\n * This file is part of Serlo.org.\n *\n * Copyright (c) 2013-2021 Serlo Education e.V.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\")\n * you may not use this file except in compliance with the License\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * @copyright Copyright (c) 2013-2021 Serlo Education e.V.\n * @license   http://www.apache.org/licenses/LICENSE-2.0 Apache License 2.0\n * @link      https://github.com/serlo-org/serlo.org for the canonical source repository\n */\nimport { EditorPlugin, EditorPluginProps, object } from '@edtr-io/plugin'\nimport * as React from 'react'\n\nimport { Controls, editorContent } from './common'\n\nexport const userTypeState = object({\n  description: editorContent(),\n})\n\nexport const userTypePlugin: EditorPlugin<typeof userTypeState> = {\n  Component: UserTypeEditor,\n  state: userTypeState,\n  config: {},\n}\n\nfunction UserTypeEditor(props: EditorPluginProps<typeof userTypeState>) {\n  const { description } = props.state\n\n  return (\n    <React.Fragment>\n      {description.render()}\n      <Controls />\n    </React.Fragment>\n  )\n}\n","/**\n * This file is part of Serlo.org.\n *\n * Copyright (c) 2013-2021 Serlo Education e.V.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\")\n * you may not use this file except in compliance with the License\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * @copyright Copyright (c) 2013-2021 Serlo Education e.V.\n * @license   http://www.apache.org/licenses/LICENSE-2.0 Apache License 2.0\n * @link      https://github.com/serlo-org/serlo.org for the canonical source repository\n */\nimport { EditorPlugin, EditorPluginProps, string } from '@edtr-io/plugin'\nimport { createVideoPlugin } from '@edtr-io/plugin-video'\nimport { useI18n } from '@serlo/i18n'\nimport * as React from 'react'\n\nimport {\n  entity,\n  Controls,\n  editorContent,\n  HeaderInput,\n  entityType,\n} from './common'\nimport { RevisionHistory } from './helpers/settings'\n\nexport const videoTypeState = entityType(\n  {\n    ...entity,\n    content: string(),\n    title: string(),\n    description: editorContent(),\n    reasoning: editorContent(),\n  },\n  {}\n)\n\nconst videoPlugin = createVideoPlugin()\n\nexport const videoTypePlugin: EditorPlugin<typeof videoTypeState> = {\n  Component: VideoTypeEditor,\n  state: videoTypeState,\n  config: {},\n}\n\nfunction VideoTypeEditor(props: EditorPluginProps<typeof videoTypeState>) {\n  const { title, description } = props.state\n  const i18n = useI18n()\n\n  return (\n    <section>\n      {props.renderIntoToolbar(\n        <RevisionHistory\n          id={props.state.id.value}\n          currentRevision={props.state.revision.value}\n          onSwitchRevision={props.state.replaceOwnState}\n        />\n      )}\n      <div className=\"page-header\">\n        <h1>\n          {props.editable ? (\n            <HeaderInput\n              placeholder={i18n.t('video::Title')}\n              value={title.value}\n              onChange={(e: React.ChangeEvent<HTMLInputElement>) => {\n                title.set(e.target.value)\n              }}\n            />\n          ) : (\n            <span itemProp=\"name\">{title.value}</span>\n          )}\n        </h1>\n      </div>\n      <article>\n        <section>\n          <videoPlugin.Component\n            {...props}\n            state={{\n              src: props.state.content,\n              alt: props.state.title,\n            }}\n            config={{\n              i18n: {\n                src: {\n                  label: i18n.t('video::URL'),\n                },\n                alt: {\n                  label: i18n.t('video::Title for search engines'),\n                },\n              },\n            }}\n          />\n        </section>\n        <section>{description.render()}</section>\n      </article>\n      <Controls subscriptions {...props.state} />\n    </section>\n  )\n}\n","/**\n * This file is part of Serlo.org.\n *\n * Copyright (c) 2013-2021 Serlo Education e.V.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\")\n * you may not use this file except in compliance with the License\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * @copyright Copyright (c) 2013-2021 Serlo Education e.V.\n * @license   http://www.apache.org/licenses/LICENSE-2.0 Apache License 2.0\n * @link      https://github.com/serlo-org/serlo.org for the canonical source repository\n */\nimport { styled } from '@edtr-io/ui'\nimport * as React from 'react'\n\nconst OverlayTriangle = styled.div<{ positionAbove: boolean }>((props) => {\n  const borderPosition = props.positionAbove ? 'borderTop' : 'borderBottom'\n  return {\n    position: 'relative',\n    width: 0,\n    height: 0,\n    borderLeft: '5px solid transparent',\n    borderRight: '5px solid transparent',\n    [borderPosition]: '10px solid rgba(51,51,51,0.95)',\n  }\n})\n\nconst InlineOverlayWrapper = styled.div({\n  position: 'absolute',\n  top: '-10000px',\n  left: '-10000px',\n  opacity: 0,\n  transition: 'opacity 0.5s',\n  zIndex: 95,\n  whiteSpace: 'nowrap',\n})\n\nconst InlineOverlayContentWrapper = styled.div({\n  boxShadow: '0 2px 4px 0 rgba(0,0,0,0.50)',\n  backgroundColor: 'rgba(51,51,51,0.95)',\n  color: '#ffffff',\n  borderRadius: '4px',\n  '& a': {\n    color: '#ffffff',\n    '&:hover': {\n      color: 'rgb(70, 155, 255)',\n    },\n  },\n})\n\nexport type HoverPosition = 'above' | 'below'\n\nexport function HoveringOverlay(props: {\n  children: React.ReactNode\n  position: HoverPosition\n  anchor?: React.RefObject<HTMLElement>\n  allowSelectionOverflow?: boolean\n}) {\n  const overlay = React.createRef<HTMLDivElement>()\n  const triangle = React.createRef<HTMLDivElement>()\n  const [positionAbove, setPositionAbove] = React.useState(\n    props.position === 'above'\n  )\n\n  React.useLayoutEffect(() => {\n    if (!overlay.current || !triangle.current) return\n    const menu = overlay.current\n    let rect = undefined\n    if (props.anchor && props.anchor.current !== null) {\n      rect = props.anchor.current.getBoundingClientRect()\n    } else {\n      const native = window.getSelection()\n      if (native && native.rangeCount > 0) {\n        const range = native.getRangeAt(0)\n        rect = range.getBoundingClientRect()\n      }\n    }\n    if (!rect) return\n    if (rect.height === 0) return\n    // menu is set to display:none, shouldn't ever happen\n    if (!menu.offsetParent) return\n    const parentRect = menu.offsetParent.getBoundingClientRect()\n    menu.style.opacity = '1'\n    const aboveValue = rect.top - menu.offsetHeight - 6\n    // if top becomes negative, place menu below\n    setPositionAbove(props.position == 'above' && aboveValue >= 0)\n    menu.style.top =\n      (positionAbove ? aboveValue : rect.bottom + 6) - parentRect.top + 'px'\n\n    menu.style.left = `${Math.min(\n      Math.max(\n        rect.left - parentRect.left - menu.offsetWidth / 2 + rect.width / 2,\n        0\n      ),\n      parentRect.width - menu.offsetWidth - 5\n    )}px`\n    triangle.current.style.left = `${\n      rect.left -\n      menu.offsetLeft -\n      parentRect.left -\n      triangle.current.offsetWidth / 2 +\n      rect.width / 2\n    }px`\n  }, [\n    overlay,\n    triangle,\n    props.position,\n    props.anchor,\n    positionAbove,\n    props.allowSelectionOverflow,\n  ])\n\n  return (\n    <InlineOverlayWrapper ref={overlay}>\n      {!positionAbove && (\n        <OverlayTriangle positionAbove={false} ref={triangle} />\n      )}\n      <InlineOverlayContentWrapper>\n        {props.children}\n      </InlineOverlayContentWrapper>\n      {positionAbove && <OverlayTriangle positionAbove ref={triangle} />}\n    </InlineOverlayWrapper>\n  )\n}\n","/**\n * This file is part of Serlo.org.\n *\n * Copyright (c) 2013-2021 Serlo Education e.V.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\")\n * you may not use this file except in compliance with the License\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * @copyright Copyright (c) 2013-2021 Serlo Education e.V.\n * @license   http://www.apache.org/licenses/LICENSE-2.0 Apache License 2.0\n * @link      https://github.com/serlo-org/serlo.org for the canonical source repository\n */\nimport { faTrashAlt, Icon, styled } from '@edtr-io/ui'\nimport * as React from 'react'\n\nimport { HoveringOverlay, HoverPosition } from './hovering-overlay'\n\nconst InlinePreview = styled.span({\n  padding: '0px 8px',\n})\nconst ChangeButton = styled.div({\n  padding: '5px 5px 5px 10px',\n  display: 'inline-block',\n  borderLeft: '2px solid rgba(51,51,51,0.95)',\n  cursor: 'pointer',\n  margin: '2px',\n  '&:hover': {\n    color: 'rgb(70, 155, 255)',\n  },\n})\n\nexport function InlineSettings({\n  position = 'below',\n  ...props\n}: {\n  children: React.ReactNode\n  onDelete: React.MouseEventHandler\n  position: HoverPosition\n  anchor?: React.RefObject<HTMLElement>\n}) {\n  return (\n    <HoveringOverlay position={position} anchor={props.anchor}>\n      <InlinePreview>{props.children}</InlinePreview>\n      <ChangeButton onClick={props.onDelete}>\n        <Icon icon={faTrashAlt} />\n      </ChangeButton>\n    </HoveringOverlay>\n  )\n}\n","/**\n * This file is part of Serlo.org.\n *\n * Copyright (c) 2013-2021 Serlo Education e.V.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\")\n * you may not use this file except in compliance with the License\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * @copyright Copyright (c) 2013-2021 Serlo Education e.V.\n * @license   http://www.apache.org/licenses/LICENSE-2.0 Apache License 2.0\n * @link      https://github.com/serlo-org/serlo.org for the canonical source repository\n */\nimport { styled } from '@edtr-io/ui'\nimport * as React from 'react'\n\nconst InlineInputInner = styled.input({\n  backgroundColor: 'transparent',\n  border: 'none',\n  borderBottom: '2px solid #ffffff',\n  color: '#ffffff',\n  '&:focus': {\n    outline: 'none',\n    borderBottom: '2px solid rgb(70, 155, 255)',\n  },\n})\n\nconst InlineInputRefForward: React.RefForwardingComponent<\n  HTMLInputElement,\n  InputProps\n> = (props, ref) => {\n  return <InlineInputInner {...props} ref={ref} />\n}\nexport const InlineSettingsInput = React.forwardRef(InlineInputRefForward)\n\nexport interface InputProps\n  extends React.DetailedHTMLProps<\n    React.InputHTMLAttributes<HTMLInputElement>,\n    HTMLInputElement\n  > {\n  label?: string\n  textfieldWidth?: string\n  editorInputWidth?: string\n}\n","/**\n * This file is part of Serlo.org.\n *\n * Copyright (c) 2013-2021 Serlo Education e.V.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\")\n * you may not use this file except in compliance with the License\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * @copyright Copyright (c) 2013-2021 Serlo Education e.V.\n * @license   http://www.apache.org/licenses/LICENSE-2.0 Apache License 2.0\n * @link      https://github.com/serlo-org/serlo.org for the canonical source repository\n */\nimport * as React from 'react'\n// @ts-ignore\nimport Plain from 'slate-plain-serializer'\n// @ts-ignore\nimport { Editor } from 'slate-react'\n\nexport function InlineInput(props: {\n  onChange: (value: string) => void\n  onFocus?: () => void\n  value: string\n  placeholder: string\n}) {\n  const { onChange, value, placeholder } = props\n  const [state, setState] = React.useState(Plain.deserialize(value))\n  React.useEffect(() => {\n    if (Plain.serialize(state) !== value) {\n      setState(Plain.deserialize(value))\n    }\n  }, [value])\n\n  return (\n    <Editor\n      placeholder={placeholder}\n      value={state}\n      onFocus={(event: any, editor: any, next: () => void) => {\n        setTimeout(() => {\n          if (typeof props.onFocus === 'function') {\n            props.onFocus()\n          }\n        })\n        next()\n      }}\n      onChange={({ value }: any) => {\n        setState(value)\n        onChange(Plain.serialize(value))\n      }}\n    />\n  )\n}\n","/**\n * This file is part of Serlo.org.\n *\n * Copyright (c) 2013-2021 Serlo Education e.V.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\")\n * you may not use this file except in compliance with the License\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * @copyright Copyright (c) 2013-2021 Serlo Education e.V.\n * @license   http://www.apache.org/licenses/LICENSE-2.0 Apache License 2.0\n * @link      https://github.com/serlo-org/serlo.org for the canonical source repository\n */\nimport { AddButton } from '@edtr-io/editor-ui/internal'\nimport {\n  child,\n  EditorPlugin,\n  EditorPluginProps,\n  list,\n  object,\n  string,\n} from '@edtr-io/plugin'\nimport * as R from 'ramda'\nimport * as React from 'react'\nimport { DragDropContext, Draggable, Droppable } from 'react-beautiful-dnd'\n\nimport { SemanticSection } from './helpers/semantic-section'\nimport { PluginToolbarButton } from '@edtr-io/core'\nimport {\n  edtrDragHandle,\n  EdtrIcon,\n  faExternalLinkAlt,\n  faTrashAlt,\n  Icon,\n  styled,\n} from '@edtr-io/ui'\nimport { InlineSettings } from './helpers/inline-settings'\nimport { InlineSettingsInput } from './helpers/inline-settings-input'\nimport { InlineInput } from './helpers/inline-input'\nimport { ExpandableBox } from '@edtr-io/renderer-ui'\nimport { ThemeProvider } from 'styled-components'\nimport { useI18n } from '@serlo/i18n'\nimport { faGraduationCap } from '@fortawesome/free-solid-svg-icons/faGraduationCap'\nimport { faNewspaper } from '@fortawesome/free-solid-svg-icons'\nimport { faPlayCircle } from '@fortawesome/free-solid-svg-icons/faPlayCircle'\n\nconst relatedContentItemState = object({ id: string(), title: string() })\n\nconst articleState = object({\n  introduction: child({ plugin: 'articleIntroduction' }),\n  content: child({ plugin: 'rows' }),\n  exercises: list(child({ plugin: 'injection' })),\n  exerciseFolder: relatedContentItemState,\n  relatedContent: object({\n    articles: list(relatedContentItemState),\n    courses: list(relatedContentItemState),\n    videos: list(relatedContentItemState),\n  }),\n  sources: list(\n    object({\n      href: string(),\n      title: string(),\n    })\n  ),\n})\n\nexport type ArticlePluginState = typeof articleState\nexport type ArticleProps = EditorPluginProps<ArticlePluginState>\n\nexport const articlePlugin: EditorPlugin<ArticlePluginState> = {\n  Component: ArticleEditor,\n  state: articleState,\n  config: {},\n}\n\nconst OpenInNewTab = styled.span({ margin: '0 0 0 10px' })\n\nconst BasePluginToolbarButton = styled.button({\n  background: 'none',\n  border: 'none',\n})\n\nconst MinWidthIcon = styled.div({\n  width: '24px',\n})\n\nconst PluginToolbarButtonIcon = styled.div({\n  height: '24px',\n  width: '24px',\n  opacity: 0.8,\n  cursor: 'pointer',\n  color: 'rgba(51, 51, 51, 0.95)',\n\n  '&:hover': {\n    color: '#469bff',\n  },\n})\n\nconst spoilerTheme = {\n  rendererUi: {\n    expandableBox: {\n      toggleBackgroundColor: '#f5f5f5',\n      toggleColor: '#333',\n      containerBorderColor: '#f5f5f5',\n    },\n  },\n}\n\nfunction ArticleEditor(props: ArticleProps) {\n  const { editable, state } = props\n  const {\n    introduction,\n    content,\n    exercises,\n    exerciseFolder,\n    relatedContent,\n    sources,\n  } = state\n\n  const i18n = useI18n()\n  const [focusedInlineSetting, setFocusedInlineSetting] = React.useState<{\n    id: string\n    index?: number\n  } | null>(null)\n\n  function isFocused(id: string, index?: number) {\n    return (\n      focusedInlineSetting &&\n      focusedInlineSetting.id === id &&\n      (focusedInlineSetting.index === undefined ||\n        focusedInlineSetting.index === index)\n    )\n  }\n\n  return (\n    <React.Fragment>\n      <SemanticSection editable={editable}>\n        {introduction.render()}\n      </SemanticSection>\n      <SemanticSection editable={editable}>{content.render()}</SemanticSection>\n      <SemanticSection editable={editable}>{renderExercises()}</SemanticSection>\n      <SemanticSection editable={editable}>\n        {renderRelatedContent()}\n      </SemanticSection>\n      <SemanticSection editable={editable}>{renderSources()}</SemanticSection>\n    </React.Fragment>\n  )\n\n  function renderExercises() {\n    const header = <h2>{i18n.t('article::Exercises')}</h2>\n    const folderHeader = (\n      <p>\n        {i18n.t('article::You can find more exercises in the following folder')}\n        :\n      </p>\n    )\n\n    if (!editable) {\n      if (exercises.length === 0 || !exerciseFolder.id.value) return null\n\n      return (\n        <>\n          {header}\n          {exercises.map((exercise) => {\n            return (\n              <React.Fragment key={exercise.id}>\n                {exercise.render()}\n              </React.Fragment>\n            )\n          })}\n          {exerciseFolder.id.value ? (\n            <>\n              {folderHeader}\n              <div>\n                <a href={`/${exerciseFolder.id.value}`}>\n                  {exerciseFolder.title.value}\n                </a>\n              </div>\n            </>\n          ) : null}\n        </>\n      )\n    }\n\n    return (\n      <>\n        {header}\n        <DragDropContext\n          onDragEnd={(result) => {\n            const { source, destination } = result\n            if (!destination) return\n            exercises.move(source.index, destination.index)\n          }}\n        >\n          <Droppable droppableId=\"default\">\n            {(provided: any) => {\n              return (\n                <div ref={provided.innerRef} {...provided.droppableProps}>\n                  {exercises.map((exercise, index) => {\n                    return (\n                      <Draggable\n                        key={exercise.id}\n                        draggableId={exercise.id}\n                        index={index}\n                      >\n                        {(provided: any) => {\n                          return (\n                            <div\n                              ref={provided.innerRef}\n                              {...provided.draggableProps}\n                            >\n                              {exercise.render({\n                                renderToolbar() {\n                                  return (\n                                    <React.Fragment>\n                                      <div>\n                                        <BasePluginToolbarButton\n                                          icon={<Icon icon={faTrashAlt} />}\n                                          title={i18n.t(\n                                            'article::Drag the exercise'\n                                          )}\n                                          {...provided.dragHandleProps}\n                                        >\n                                          <PluginToolbarButtonIcon>\n                                            <EdtrIcon icon={edtrDragHandle} />\n                                          </PluginToolbarButtonIcon>\n                                        </BasePluginToolbarButton>\n                                      </div>\n                                      <PluginToolbarButton\n                                        icon={\n                                          <MinWidthIcon>\n                                            <Icon icon={faTrashAlt} />\n                                          </MinWidthIcon>\n                                        }\n                                        label={i18n.t(\n                                          'article::Remove exercise'\n                                        )}\n                                        onClick={() => {\n                                          exercises.remove(index)\n                                        }}\n                                      />\n                                    </React.Fragment>\n                                  )\n                                },\n                              })}\n                            </div>\n                          )\n                        }}\n                      </Draggable>\n                    )\n                  })}\n                  {provided.placeholder}\n                </div>\n              )\n            }}\n          </Droppable>\n        </DragDropContext>\n        <AddButton\n          onClick={() => {\n            exercises.insert(exercises.length)\n          }}\n        >\n          {i18n.t('article::Add optional exercise')}\n        </AddButton>\n        {folderHeader}\n        {isFocused('exerciseFolder') ? (\n          <InlineSettings\n            onDelete={() => {\n              exerciseFolder.title.set('')\n              exerciseFolder.id.set('')\n            }}\n            position=\"below\"\n          >\n            <InlineSettingsInput\n              value={\n                exerciseFolder.id.value !== ''\n                  ? `/${exerciseFolder.id.value}`\n                  : ''\n              }\n              placeholder={i18n.t(\n                'article::ID of an exercise folder, e.g. 30560'\n              )}\n              onChange={(event) => {\n                const newValue = event.target.value.replace(/[^0-9]/g, '')\n                exerciseFolder.id.set(newValue)\n              }}\n            />\n            <a\n              target=\"_blank\"\n              href={\n                exerciseFolder.id.value !== ''\n                  ? `/${exerciseFolder.id.value}`\n                  : ''\n              }\n              rel=\"noopener noreferrer\"\n            >\n              <OpenInNewTab\n                title={i18n.t(\n                  'article::Open the exercise folder in a new tab:'\n                )}\n              >\n                <Icon icon={faExternalLinkAlt} />\n              </OpenInNewTab>\n            </a>\n          </InlineSettings>\n        ) : null}\n        <a>\n          <InlineInput\n            value={exerciseFolder.title.value}\n            onFocus={() => {\n              setFocusedInlineSetting({\n                id: 'exerciseFolder',\n              })\n            }}\n            onChange={(value) => {\n              exerciseFolder.title.set(value)\n            }}\n            placeholder={i18n.t('article::Title of the link')}\n          />\n        </a>\n      </>\n    )\n  }\n\n  function renderRelatedContent() {\n    const header = (\n      <React.Fragment>\n        <h2>{i18n.t('article::Still want more?')}</h2>\n        <p>\n          {i18n.t('article::You can find more content on this topic here')}:\n        </p>\n      </React.Fragment>\n    )\n\n    const types: {\n      section: 'articles' | 'courses' | 'videos'\n      label: string\n      addLabel: string\n      idPlaceholder: string\n      openLinkInNewTabPlaceholder: string\n      dragLabel: string\n      icon: React.ReactNode\n    }[] = [\n      {\n        icon: <Icon icon={faNewspaper} fixedWidth />,\n        section: 'articles',\n        label: i18n.t('article::Articles'),\n        addLabel: i18n.t('article::Add article'),\n        idPlaceholder: i18n.t('article::ID of an article, e.g. 1855'),\n        openLinkInNewTabPlaceholder: i18n.t(\n          'article::Open the article in a new tab:'\n        ),\n        dragLabel: i18n.t('article::Drag the article'),\n      },\n      {\n        icon: <Icon icon={faGraduationCap} fixedWidth />,\n        section: 'courses',\n        label: i18n.t('article::Courses'),\n        addLabel: i18n.t('article::Add course'),\n        idPlaceholder: i18n.t('article::ID of a course, e.g. 51979'),\n        openLinkInNewTabPlaceholder: i18n.t(\n          'article::Open the course in a new tab:'\n        ),\n        dragLabel: i18n.t('article::Drag the course'),\n      },\n      {\n        icon: <Icon icon={faPlayCircle} fixedWidth />,\n        section: 'videos',\n        label: i18n.t('article::Videos'),\n        addLabel: i18n.t('article::Add video'),\n        idPlaceholder: i18n.t('article::ID of a video, e.g. 40744'),\n        openLinkInNewTabPlaceholder: i18n.t(\n          'article::Open the video in a new tab:'\n        ),\n        dragLabel: i18n.t('article::Drag the video'),\n      },\n    ]\n\n    const allItems = R.flatten(R.values(relatedContent))\n    if (!editable && allItems.length === 0) return null\n\n    return (\n      <React.Fragment>\n        {header}\n        {types.map((type) => {\n          return (\n            <React.Fragment key={type.section}>\n              {renderRelatedContentSection(type)}\n            </React.Fragment>\n          )\n        })}\n      </React.Fragment>\n    )\n  }\n\n  function renderRelatedContentSection(type: {\n    section: 'articles' | 'courses' | 'videos'\n    label: string\n    addLabel: string\n    idPlaceholder: string\n    openLinkInNewTabPlaceholder: string\n    dragLabel: string\n    icon: React.ReactNode\n  }) {\n    const header = (\n      <>\n        {type.icon} {type.label}\n      </>\n    )\n\n    if (!editable) {\n      if (relatedContent[type.section].length === 0) return null\n\n      return (\n        <>\n          {header}\n          {relatedContent[type.section].map((item, index) => {\n            return (\n              <div key={index}>\n                <a href={`/${item.id.value}`}>{item.title.value}</a>\n              </div>\n            )\n          })}\n        </>\n      )\n    }\n\n    return (\n      <>\n        {header}\n        <DragDropContext\n          onDragEnd={(result) => {\n            const { source, destination } = result\n            if (!destination) return\n            relatedContent[type.section].move(source.index, destination.index)\n          }}\n        >\n          <Droppable droppableId=\"default\">\n            {(provided: any) => {\n              return (\n                <div ref={provided.innerRef} {...provided.droppableProps}>\n                  {relatedContent[type.section].map((item, index) => {\n                    return (\n                      <Draggable\n                        key={index}\n                        draggableId={`${type.section}-${index}`}\n                        index={index}\n                      >\n                        {(provided: any) => {\n                          return (\n                            <div\n                              ref={provided.innerRef}\n                              {...provided.draggableProps}\n                            >\n                              <div\n                                style={{\n                                  display: 'flex',\n                                }}\n                              >\n                                <div\n                                  style={{\n                                    flexGrow: 1,\n                                  }}\n                                >\n                                  {isFocused(type.section, index) ? (\n                                    <InlineSettings\n                                      onDelete={() => {\n                                        relatedContent[type.section].remove(\n                                          index\n                                        )\n                                      }}\n                                      position=\"below\"\n                                    >\n                                      <InlineSettingsInput\n                                        value={\n                                          item.id.value !== ''\n                                            ? `/${item.id.value}`\n                                            : ''\n                                        }\n                                        placeholder={type.idPlaceholder}\n                                        onChange={(event) => {\n                                          const newValue = event.target.value.replace(\n                                            /[^0-9]/g,\n                                            ''\n                                          )\n                                          item.id.set(newValue)\n                                        }}\n                                      />\n                                      <a\n                                        target=\"_blank\"\n                                        href={\n                                          item.id.value !== ''\n                                            ? `/${item.id.value}`\n                                            : ''\n                                        }\n                                        rel=\"noopener noreferrer\"\n                                      >\n                                        <OpenInNewTab\n                                          title={\n                                            type.openLinkInNewTabPlaceholder\n                                          }\n                                        >\n                                          <Icon icon={faExternalLinkAlt} />\n                                        </OpenInNewTab>\n                                      </a>\n                                    </InlineSettings>\n                                  ) : null}\n                                  <a>\n                                    <InlineInput\n                                      value={item.title.value}\n                                      onFocus={() => {\n                                        setFocusedInlineSetting({\n                                          id: type.section,\n                                          index,\n                                        })\n                                      }}\n                                      onChange={(value) => {\n                                        item.title.set(value)\n                                      }}\n                                      placeholder={i18n.t(\n                                        'article::Title of the link'\n                                      )}\n                                    />\n                                  </a>\n                                </div>\n                                <div>\n                                  <BasePluginToolbarButton\n                                    icon={<Icon icon={faTrashAlt} />}\n                                    title={i18n.t('article::Drag the exercise')}\n                                    {...provided.dragHandleProps}\n                                  >\n                                    <PluginToolbarButtonIcon>\n                                      <EdtrIcon icon={edtrDragHandle} />\n                                    </PluginToolbarButtonIcon>\n                                  </BasePluginToolbarButton>\n                                </div>\n                              </div>\n                            </div>\n                          )\n                        }}\n                      </Draggable>\n                    )\n                  })}\n                  {provided.placeholder}\n                  {editable ? (\n                    <AddButton\n                      onClick={() => {\n                        relatedContent[type.section].insert(\n                          relatedContent[type.section].length\n                        )\n                      }}\n                    >\n                      {type.addLabel}\n                    </AddButton>\n                  ) : null}\n                </div>\n              )\n            }}\n          </Droppable>\n        </DragDropContext>\n      </>\n    )\n  }\n\n  function renderSources() {\n    if (!editable) {\n      if (sources.length === 0) return null\n\n      return (\n        <ThemeProvider theme={spoilerTheme}>\n          <ExpandableBox\n            renderTitle={() => i18n.t('article::Sources')}\n            editable={editable}\n            alwaysVisible\n          >\n            <ul>\n              {sources.map((source, index) => {\n                return (\n                  <li key={index}>\n                    <a href={source.href.value}>{source.title.value}</a>\n                  </li>\n                )\n              })}\n            </ul>\n          </ExpandableBox>\n        </ThemeProvider>\n      )\n    }\n\n    return (\n      <ThemeProvider theme={spoilerTheme}>\n        <ExpandableBox\n          renderTitle={() => i18n.t('article::Sources')}\n          editable={editable}\n          alwaysVisible\n        >\n          <DragDropContext\n            onDragEnd={(result) => {\n              const { source, destination } = result\n              if (!destination) return\n              sources.move(source.index, destination.index)\n            }}\n          >\n            <Droppable droppableId=\"default\">\n              {(provided: any) => {\n                return (\n                  <ul ref={provided.innerRef} {...provided.droppableProps}>\n                    {sources.map((source, index) => {\n                      return (\n                        <Draggable\n                          key={index}\n                          draggableId={`${index}`}\n                          index={index}\n                        >\n                          {(provided: any) => {\n                            return (\n                              <li\n                                ref={provided.innerRef}\n                                {...provided.draggableProps}\n                              >\n                                <div\n                                  style={{\n                                    display: 'flex',\n                                  }}\n                                >\n                                  <div\n                                    style={{\n                                      flexGrow: 1,\n                                    }}\n                                  >\n                                    <span>\n                                      {isFocused('source', index) ? (\n                                        <InlineSettings\n                                          onDelete={() => {\n                                            sources.remove(index)\n                                          }}\n                                          position=\"below\"\n                                        >\n                                          <InlineSettingsInput\n                                            value={source.href.value}\n                                            placeholder={i18n.t(\n                                              'article::URL of the link'\n                                            )}\n                                            onChange={(event) => {\n                                              source.href.set(\n                                                event.target.value\n                                              )\n                                            }}\n                                          />\n                                          <a\n                                            target=\"_blank\"\n                                            href={source.href.value}\n                                            rel=\"noopener noreferrer\"\n                                          >\n                                            <OpenInNewTab\n                                              title={i18n.t(\n                                                'article::Open the link in a new tab:'\n                                              )}\n                                            >\n                                              <Icon icon={faExternalLinkAlt} />\n                                            </OpenInNewTab>\n                                          </a>\n                                        </InlineSettings>\n                                      ) : null}\n                                      <a>\n                                        <InlineInput\n                                          value={source.title.value}\n                                          onFocus={() => {\n                                            setFocusedInlineSetting({\n                                              id: 'source',\n                                              index,\n                                            })\n                                          }}\n                                          onChange={(value) => {\n                                            source.title.set(value)\n                                          }}\n                                          placeholder={i18n.t(\n                                            'article::Title of the link'\n                                          )}\n                                        />\n                                      </a>\n                                    </span>\n                                  </div>\n                                  <div>\n                                    <BasePluginToolbarButton\n                                      icon={<Icon icon={faTrashAlt} />}\n                                      title={i18n.t('article::Drag the source')}\n                                      {...provided.dragHandleProps}\n                                    >\n                                      <PluginToolbarButtonIcon>\n                                        <EdtrIcon icon={edtrDragHandle} />\n                                      </PluginToolbarButtonIcon>\n                                    </BasePluginToolbarButton>\n                                  </div>\n                                </div>\n                              </li>\n                            )\n                          }}\n                        </Draggable>\n                      )\n                    })}\n                    {provided.placeholder}\n                  </ul>\n                )\n              }}\n            </Droppable>\n          </DragDropContext>\n          {editable ? (\n            <AddButton\n              onClick={() => {\n                sources.insert(sources.length)\n              }}\n            >\n              {i18n.t('article::Add source')}\n            </AddButton>\n          ) : null}\n        </ExpandableBox>\n      </ThemeProvider>\n    )\n  }\n}\n","/**\n * This file is part of Serlo.org.\n *\n * Copyright (c) 2013-2021 Serlo Education e.V.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\")\n * you may not use this file except in compliance with the License\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * @copyright Copyright (c) 2013-2021 Serlo Education e.V.\n * @license   http://www.apache.org/licenses/LICENSE-2.0 Apache License 2.0\n * @link      https://github.com/serlo-org/serlo.org for the canonical source repository\n */\nexport enum Sign {\n  Equals = 'equals',\n  GreaterThan = 'greater-than',\n  GreaterThanOrEqual = 'greater-than-or-equal',\n  LessThan = 'less-than',\n  LessThanOrEqual = 'less-than-or-equal',\n  AlmostEqualTo = 'almost-equal-to',\n  Estimates = 'estimates',\n}\n\nexport function renderSignToString(sign: Sign): string {\n  switch (sign) {\n    case Sign.Equals:\n      return '='\n    case Sign.GreaterThan:\n      return '>'\n    case Sign.GreaterThanOrEqual:\n      return '≥'\n    case Sign.LessThan:\n      return '<'\n    case Sign.LessThanOrEqual:\n      return '≤'\n    case Sign.AlmostEqualTo:\n      return '≈'\n    case Sign.Estimates:\n      return '≙'\n  }\n}\n","/**\n * This file is part of Serlo.org.\n *\n * Copyright (c) 2013-2021 Serlo Education e.V.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\")\n * you may not use this file except in compliance with the License\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * @copyright Copyright (c) 2013-2021 Serlo Education e.V.\n * @license   http://www.apache.org/licenses/LICENSE-2.0 Apache License 2.0\n * @link      https://github.com/serlo-org/serlo.org for the canonical source repository\n */\nimport {\n  EditorPlugin,\n  EditorPluginProps,\n  object,\n  scalar,\n  string,\n} from '@edtr-io/plugin'\nimport { useI18n } from '@serlo/i18n'\nimport * as React from 'react'\n\nexport const errorState = object({\n  plugin: string(),\n  state: scalar<unknown>({}),\n})\n\nexport type ErrorPluginState = typeof errorState\n\nexport const ErrorRenderer: React.FunctionComponent<\n  EditorPluginProps<ErrorPluginState>\n> = (props) => {\n  const i18n = useI18n()\n\n  return (\n    <div className=\"panel panel-danger\">\n      <div className=\"panel-heading\">\n        {i18n.t('error::This part of the document could not be converted.')}\n      </div>\n      <div className=\"panel-body\">\n        <pre>\n          {JSON.stringify(\n            {\n              plugin: props.state.plugin.value,\n              state: props.state.state.value,\n            },\n            undefined,\n            2\n          )}\n        </pre>\n      </div>\n    </div>\n  )\n}\n\nexport const errorPlugin: EditorPlugin<typeof errorState> = {\n  Component: ErrorRenderer,\n  state: errorState,\n  config: {},\n}\n","/**\n * This file is part of Serlo.org.\n *\n * Copyright (c) 2013-2021 Serlo Education e.V.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\")\n * you may not use this file except in compliance with the License\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * @copyright Copyright (c) 2013-2021 Serlo Education e.V.\n * @license   http://www.apache.org/licenses/LICENSE-2.0 Apache License 2.0\n * @link      https://github.com/serlo-org/serlo.org for the canonical source repository\n */\nimport { MathRenderer } from '@edtr-io/math'\nimport { styled } from '@edtr-io/ui'\nimport * as React from 'react'\n\nimport { EquationsProps } from '.'\nimport { renderSignToString, Sign } from './sign'\nimport { useScopedStore } from '@edtr-io/core'\nimport { isEmpty } from '@edtr-io/store'\n\nexport const TableWrapper = styled.div({\n  overflowX: 'scroll',\n  padding: '10px 0',\n})\n\nexport const Table = styled.table({\n  whiteSpace: 'nowrap',\n})\n\nexport const MathTd = styled.td({ verticalAlign: 'baseline' })\n\nexport const LeftTd = styled(MathTd)({\n  textAlign: 'right',\n})\n\nexport const SignTd = styled.td({\n  padding: '0 3px',\n  textAlign: 'center',\n  verticalAlign: 'baseline',\n})\n\nexport const TransformTd = styled(MathTd)({\n  paddingLeft: '5px',\n})\n\nexport const ExplanationTr = styled.tr({\n  color: '#007ec1',\n  div: {\n    margin: 0,\n  },\n})\n\nexport function EquationsRenderer({ state }: EquationsProps) {\n  const store = useScopedStore()\n\n  return (\n    <TableWrapper>\n      <Table>\n        <tbody>\n          {renderFirstExplanation()}\n          {state.steps.map((step, index) => {\n            return (\n              <React.Fragment key={index}>\n                <tr>\n                  <LeftTd>\n                    {step.left.value ? (\n                      <MathRenderer inline state={step.left.value} />\n                    ) : null}\n                  </LeftTd>\n                  <SignTd>\n                    <MathRenderer\n                      inline\n                      state={renderSignToString(step.sign.value as Sign)}\n                    />\n                  </SignTd>\n                  <MathTd>\n                    {step.right.value ? (\n                      <MathRenderer inline state={step.right.value} />\n                    ) : null}\n                  </MathTd>\n                  <TransformTd>\n                    {step.transform.value ? (\n                      <>\n                        |\n                        <MathRenderer inline state={step.transform.value} />\n                      </>\n                    ) : null}\n                  </TransformTd>\n                </tr>\n                {isEmpty(step.explanation.id)(store.getState()) ? null : (\n                  <ExplanationTr>\n                    <td />\n                    {renderDownArrow()}\n                    <td colSpan={2}>{step.explanation.render()}</td>\n                  </ExplanationTr>\n                )}\n              </React.Fragment>\n            )\n          })}\n        </tbody>\n      </Table>\n    </TableWrapper>\n  )\n\n  function renderFirstExplanation() {\n    if (isEmpty(state.firstExplanation.id)(store.getState())) return\n\n    return (\n      <>\n        <ExplanationTr>\n          <td colSpan={3} style={{ textAlign: 'center' }}>\n            {state.firstExplanation.render()}\n          </td>\n        </ExplanationTr>\n        <tr style={{ height: '30px' }}>\n          <td />\n          {renderDownArrow()}\n        </tr>\n      </>\n    )\n  }\n}\n\nexport function renderDownArrow() {\n  const downArrow = `\n    <svg xmlns=\"http://www.w3.org/2000/svg\">\n      <defs>\n        <marker\n          id=\"arrow\"\n          markerWidth=\"10\"\n          markerHeight=\"10\"\n          orient=\"auto\"\n          markerUnits=\"strokeWidth\"\n          refX=\"10\"\n          refY=\"5\"\n          viewBox=\"0 0 20 10\"\n        >\n          <path\n            d=\"M 0,0 l 10,5 l -10,5\"\n            stroke=\"#007ec1\"\n            stroke-width=\"2\"\n            fill=\"none\"\n            vector-effect=\"non-scaling-size\"\n          />\n        </marker>\n      </defs>\n\n      <line\n        x1=\"10\"\n        y1=\"0%\"\n        x2=\"10\"\n        y2=\"99%\"\n        stroke=\"#007ec1\"\n        stroke-width=\"2\"\n        marker-end=\"url(#arrow)\"\n        vector-effect=\"non-scaling-stroke\"\n      />\n    </svg>`\n  const downArrowBase64 = Buffer.from(downArrow).toString('base64')\n\n  return (\n    <td\n      style={{\n        backgroundImage: `url('data:image/svg+xml;base64,${downArrowBase64}')`,\n        backgroundSize: '20px calc(100% - 10px)',\n        backgroundRepeat: 'no-repeat',\n        backgroundPosition: 'center 5px',\n      }}\n    />\n  )\n}\n","/**\n * This file is part of Serlo.org.\n *\n * Copyright (c) 2013-2021 Serlo Education e.V.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\")\n * you may not use this file except in compliance with the License\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * @copyright Copyright (c) 2013-2021 Serlo Education e.V.\n * @license   http://www.apache.org/licenses/LICENSE-2.0 Apache License 2.0\n * @link      https://github.com/serlo-org/serlo.org for the canonical source repository\n */\nimport { HotKeys, useScopedSelector, useScopedStore } from '@edtr-io/core'\nimport { AddButton } from '@edtr-io/editor-ui/internal'\nimport { PreferenceContext, setDefaultPreference } from '@edtr-io/core/beta'\nimport { MathEditor } from '@edtr-io/math'\nimport { StateTypeReturnType, StringStateType } from '@edtr-io/plugin'\nimport { edtrDragHandle, EdtrIcon, faTimes, Icon, styled } from '@edtr-io/ui'\nimport { useI18n } from '@serlo/i18n'\nimport * as R from 'ramda'\nimport * as React from 'react'\nimport { DragDropContext, Draggable, Droppable } from 'react-beautiful-dnd'\n\nimport {\n  EquationsRenderer,\n  ExplanationTr,\n  LeftTd,\n  MathTd,\n  renderDownArrow,\n  SignTd,\n  Table,\n  TableWrapper,\n  TransformTd,\n} from './renderer'\nimport {\n  focus,\n  focusNext,\n  focusPrevious,\n  getFocused,\n  isEmpty,\n} from '@edtr-io/store'\nimport { renderSignToString, Sign } from './sign'\nimport { EquationsProps, stepProps } from '.'\n\nenum StepSegment {\n  Left = 0,\n  Right = 1,\n  Transform = 2,\n  Explanation = 3,\n}\n\nconst preferenceKey = 'katex:usevisualmath'\n\nsetDefaultPreference(preferenceKey, true)\n\nconst RemoveButton = styled.button({\n  outline: 'none',\n  width: '35px',\n  border: 'none',\n  background: 'transparent',\n})\nconst DragButton = styled.span({\n  cursor: 'grab',\n  paddingRight: '5px',\n})\n\nexport function EquationsEditor(props: EquationsProps) {\n  const i18n = useI18n()\n\n  const { focused, state } = props\n\n  const store = useScopedStore()\n  const focusedElement = useScopedSelector(getFocused())\n  const nestedFocus =\n    focused ||\n    R.includes(\n      focusedElement,\n      props.state.steps.map((step) => step.explanation.id)\n    ) ||\n    focusedElement === state.firstExplanation.id\n\n  const gridFocus = useGridFocus({\n    rows: state.steps.length,\n    columns: 4,\n    focusNext: () => store.dispatch(focusNext()),\n    focusPrevious: () => store.dispatch(focusPrevious()),\n    onFocusChanged: (state) => {\n      if (state === 'firstExplanation') {\n        store.dispatch(focus(props.state.firstExplanation.id))\n      } else if (state.column === StepSegment.Explanation) {\n        store.dispatch(focus(props.state.steps[state.row].explanation.id))\n      } else {\n        store.dispatch(focus(props.id))\n      }\n    },\n  })\n\n  React.useEffect(() => {\n    if (nestedFocus) {\n      gridFocus.setFocus({ row: 0, column: 0 })\n      store.dispatch(focus(props.id))\n    }\n  }, [nestedFocus])\n\n  if (!nestedFocus) return <EquationsRenderer {...props} />\n\n  return (\n    <HotKeys\n      allowChanges\n      keyMap={{\n        FOCUS_NEXT_OR_INSERT: 'tab',\n        FOCUS_PREVIOUS: 'shift+tab',\n        INSERT: 'return',\n      }}\n      handlers={{\n        FOCUS_NEXT_OR_INSERT: (e) => {\n          handleKeyDown(e, () => {\n            if (\n              gridFocus.isFocused({\n                row: state.steps.length - 1,\n                column: StepSegment.Transform,\n              })\n            ) {\n              const index = state.steps.length\n              insertNewEquationAt(index)\n              gridFocus.setFocus({\n                row: index - 1,\n                column: StepSegment.Explanation,\n              })\n            } else {\n              gridFocus.moveRight()\n            }\n          })\n        },\n        FOCUS_PREVIOUS: (e) => {\n          handleKeyDown(e, () => gridFocus.moveLeft())\n        },\n        INSERT: (e) => {\n          handleKeyDown(e, () => {\n            if (!gridFocus.focus || gridFocus.focus === 'firstExplanation')\n              return\n            insertNewEquationWithFocus(gridFocus.focus.row + 1)\n          })\n        },\n      }}\n    >\n      <TableWrapper>\n        <DragDropContext\n          onDragEnd={(result) => {\n            const { source, destination } = result\n            if (!destination) return\n            state.steps.move(source.index, destination.index)\n          }}\n        >\n          <Droppable droppableId=\"default\">\n            {(provided: any) => {\n              return (\n                <Table ref={provided.innerRef} {...provided.droppableProps}>\n                  {renderFirstExplanation()}\n                  {state.steps.map((step, row) => {\n                    return (\n                      <Draggable\n                        key={step.explanation.id}\n                        draggableId={step.explanation.id}\n                        index={row}\n                      >\n                        {(provided: any) => {\n                          return (\n                            <tbody\n                              ref={provided.innerRef}\n                              {...provided.draggableProps}\n                            >\n                              <tr>\n                                <td>\n                                  <DragButton\n                                    {...provided.dragHandleProps}\n                                    tabIndex={-1}\n                                  >\n                                    <EdtrIcon icon={edtrDragHandle} />\n                                  </DragButton>\n                                </td>\n                                <StepEditor\n                                  gridFocus={gridFocus}\n                                  row={row}\n                                  state={step}\n                                />\n                                <td>\n                                  <RemoveButton\n                                    tabIndex={-1}\n                                    onClick={() => state.steps.remove(row)}\n                                  >\n                                    <Icon icon={faTimes} />\n                                  </RemoveButton>\n                                </td>\n                              </tr>\n                              {renderExplantionTr()}\n                            </tbody>\n                          )\n                        }}\n                      </Draggable>\n                    )\n\n                    function renderExplantionTr() {\n                      if (row === state.steps.length - 1) return null\n\n                      return (\n                        <ExplanationTr\n                          onFocus={() =>\n                            gridFocus.setFocus({\n                              row,\n                              column: StepSegment.Explanation,\n                            })\n                          }\n                        >\n                          <td />\n                          <td />\n                          {!isEmpty(step.explanation.id)(store.getState()) ? (\n                            renderDownArrow()\n                          ) : (\n                            <td />\n                          )}\n                          <td colSpan={2}>\n                            {step.explanation.render({\n                              config: {\n                                placeholder: i18n.t('equations::explanation'),\n                              },\n                            })}\n                          </td>\n                        </ExplanationTr>\n                      )\n                    }\n                  })}\n                  {provided.placeholder}\n                </Table>\n              )\n            }}\n          </Droppable>\n        </DragDropContext>\n        {renderAddButton()}\n      </TableWrapper>\n    </HotKeys>\n  )\n\n  function renderFirstExplanation() {\n    return (\n      <tbody onFocus={() => gridFocus.setFocus('firstExplanation')}>\n        <ExplanationTr>\n          <td />\n          <td colSpan={3} style={{ textAlign: 'center' }}>\n            {state.firstExplanation.render({\n              config: {\n                placeholder: i18n.t('equations::frist-explanation'),\n              },\n            })}\n          </td>\n        </ExplanationTr>\n        <tr style={{ height: '30px' }}>\n          <td />\n          <td />\n          {!isEmpty(state.firstExplanation.id)(store.getState())\n            ? renderDownArrow()\n            : null}\n        </tr>\n      </tbody>\n    )\n  }\n\n  function handleKeyDown(e: KeyboardEvent | undefined, next: () => void) {\n    e && e.preventDefault()\n    next()\n  }\n\n  function insertNewEquationAt(index: number) {\n    state.steps.insert(index, {\n      left: '',\n      sign: state.steps[index - 1].sign.value,\n      right: '',\n      transform: '',\n      explanation: { plugin: 'text' },\n    })\n  }\n\n  function insertNewEquationWithFocus(index: number) {\n    insertNewEquationAt(index)\n    gridFocus.setFocus({ row: index, column: StepSegment.Left })\n  }\n\n  function renderAddButton() {\n    if (!nestedFocus) return\n\n    return (\n      <AddButton onClick={() => insertNewEquationWithFocus(state.steps.length)}>\n        {i18n.t('equations::add new equation')}\n      </AddButton>\n    )\n  }\n}\n\nconst DropDown = styled.select({\n  height: '30px',\n  width: '35px',\n  marginLeft: '15px',\n  marginRight: '10px',\n  backgroundColor: 'lightgrey',\n  border: '1px solid lightgrey',\n  borderRadius: '5px',\n})\n\ninterface StepEditorProps {\n  gridFocus: GridFocus\n  row: number\n  state: StateTypeReturnType<typeof stepProps>\n}\n\nfunction StepEditor(props: StepEditorProps) {\n  const i18n = useI18n()\n  const { gridFocus, row, state } = props\n\n  return (\n    <>\n      <LeftTd\n        onClick={() => gridFocus.setFocus({ row, column: StepSegment.Left })}\n      >\n        <InlineMath\n          focused={gridFocus.isFocused({ row, column: StepSegment.Left })}\n          placeholder={\n            row === 0 ? '3x+1' : `[${i18n.t('equations::left-hand side')}]`\n          }\n          state={state.left}\n          onChange={(src) => state.left.set(src)}\n          onFocusNext={() => gridFocus.moveRight()}\n          onFocusPrevious={() => gridFocus.moveLeft()}\n        />\n      </LeftTd>\n      <SignTd>\n        <DropDown\n          tabIndex={-1}\n          onChange={(e: React.ChangeEvent<HTMLSelectElement>) => {\n            state.sign.set(e.target.value)\n          }}\n          value={state.sign.value}\n        >\n          {[\n            Sign.Equals,\n            Sign.GreaterThan,\n            Sign.LessThan,\n            Sign.GreaterThanOrEqual,\n            Sign.LessThanOrEqual,\n            Sign.AlmostEqualTo,\n            Sign.Estimates,\n          ].map((sign) => {\n            return (\n              <option key={sign} value={sign}>\n                {renderSignToString(sign)}\n              </option>\n            )\n          })}\n        </DropDown>\n      </SignTd>\n      <MathTd\n        onClick={() => gridFocus.setFocus({ row, column: StepSegment.Right })}\n      >\n        <InlineMath\n          focused={gridFocus.isFocused({ row, column: StepSegment.Right })}\n          placeholder={\n            row === 0 ? '7x' : `[${i18n.t('equations::right-hand side')}]`\n          }\n          state={state.right}\n          onChange={(src) => state.right.set(src)}\n          onFocusNext={() => gridFocus.moveRight()}\n          onFocusPrevious={() => gridFocus.moveLeft()}\n        />\n      </MathTd>\n      <TransformTd\n        onClick={() =>\n          gridFocus.setFocus({ row, column: StepSegment.Transform })\n        }\n      >\n        |{' '}\n        <InlineMath\n          focused={gridFocus.isFocused({ row, column: StepSegment.Transform })}\n          placeholder={\n            row === 0 ? '-3x' : `[${i18n.t('equations::transformation')}]`\n          }\n          state={state.transform}\n          onChange={(src) => state.transform.set(src)}\n          onFocusNext={() => gridFocus.moveRight()}\n          onFocusPrevious={() => gridFocus.moveLeft()}\n        />\n      </TransformTd>\n    </>\n  )\n}\n\ninterface InlineMathProps {\n  state: StateTypeReturnType<StringStateType>\n  placeholder: string\n  onChange: (state: string) => void\n  onFocusNext: () => void\n  onFocusPrevious: () => void\n  focused?: boolean\n  prefix?: string\n  suffix?: string\n}\n\nfunction InlineMath(props: InlineMathProps) {\n  const {\n    focused,\n    onFocusNext,\n    onFocusPrevious,\n    onChange,\n    state,\n    prefix = '',\n    suffix = '',\n  } = props\n\n  const preferences = React.useContext(PreferenceContext)\n\n  return (\n    <MathEditor\n      readOnly={!focused}\n      state={`${prefix}${state.value}${suffix}`}\n      config={{ i18n: { placeholder: props.placeholder } }}\n      inline\n      disableBlock\n      visual={preferences.getKey(preferenceKey) === true}\n      onEditorChange={(visual) => {\n        preferences.setKey(preferenceKey, visual)\n      }}\n      onInlineChange={() => {}}\n      onChange={onChange}\n      onMoveOutRight={onFocusNext}\n      onMoveOutLeft={onFocusPrevious}\n    />\n  )\n}\n\ntype GridFocusState =\n  | {\n      row: number\n      column: number\n    }\n  | 'firstExplanation'\n\ninterface GridFocus {\n  focus: GridFocusState | null\n  isFocused: (cell: GridFocusState) => boolean\n  setFocus: (cell: GridFocusState) => void\n  moveRight: () => void\n  moveLeft: () => void\n}\n\nfunction useGridFocus({\n  rows,\n  columns,\n  focusNext,\n  focusPrevious,\n  onFocusChanged,\n}: {\n  rows: number\n  columns: number\n  focusNext: () => void\n  focusPrevious: () => void\n  onFocusChanged: (args: GridFocusState) => void\n}): GridFocus {\n  const [focus, setFocusState] = React.useState<GridFocusState | null>(null)\n  const setFocus = (state: GridFocusState) => {\n    onFocusChanged(state)\n    setFocusState(state)\n  }\n\n  return {\n    focus,\n    isFocused(state) {\n      if (focus === null) return false\n      if (focus === 'firstExplanation') return state === focus\n\n      return (\n        state !== 'firstExplanation' &&\n        focus.row === state.row &&\n        focus.column === state.column\n      )\n    },\n    setFocus,\n    moveRight() {\n      if (focus === null) return\n      if (focus === 'firstExplanation') {\n        setFocus({ row: 0, column: 0 })\n        return\n      }\n      // Last column\n      if (focus.column === columns - 1) {\n        // Last row\n        if (focus.row === rows - 1) {\n          focusNext()\n        } else {\n          setFocus({ row: focus.row + 1, column: 0 })\n        }\n      } else {\n        setFocus({ row: focus.row, column: focus.column + 1 })\n      }\n    },\n    moveLeft() {\n      if (focus === null) return\n      if (focus === 'firstExplanation') {\n        focusPrevious()\n        return\n      }\n\n      // First column\n      if (focus.column === 0) {\n        // First row\n        if (focus.row === 0) {\n          setFocus('firstExplanation')\n        } else {\n          setFocus({ row: focus.row - 1, column: columns - 1 })\n        }\n      } else {\n        setFocus({ row: focus.row, column: focus.column - 1 })\n      }\n    },\n  }\n}\n","/**\n * This file is part of Serlo.org.\n *\n * Copyright (c) 2013-2021 Serlo Education e.V.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\")\n * you may not use this file except in compliance with the License\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * @copyright Copyright (c) 2013-2021 Serlo Education e.V.\n * @license   http://www.apache.org/licenses/LICENSE-2.0 Apache License 2.0\n * @link      https://github.com/serlo-org/serlo.org for the canonical source repository\n */\nimport {\n  child,\n  list,\n  object,\n  EditorPlugin,\n  EditorPluginProps,\n  string,\n} from '@edtr-io/plugin'\n\nimport { EquationsEditor } from './editor'\nimport { Sign } from './sign'\n\nexport const stepProps = object({\n  left: string(''),\n  sign: string(Sign.Equals),\n  right: string(''),\n  transform: string(''),\n  explanation: child({ plugin: 'text' }),\n})\n\nconst equationsState = object({\n  steps: list(stepProps, 2),\n  firstExplanation: child({ plugin: 'text' }),\n})\n\nexport type EquationsPluginState = typeof equationsState\nexport type EquationsProps = EditorPluginProps<EquationsPluginState>\n\nexport const equationsPlugin: EditorPlugin<EquationsPluginState> = {\n  Component: EquationsEditor,\n  config: {},\n  state: equationsState,\n}\n","/**\n * This file is part of Serlo.org.\n *\n * Copyright (c) 2013-2021 Serlo Education e.V.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\")\n * you may not use this file except in compliance with the License\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * @copyright Copyright (c) 2013-2021 Serlo Education e.V.\n * @license   http://www.apache.org/licenses/LICENSE-2.0 Apache License 2.0\n * @link      https://github.com/serlo-org/serlo.org for the canonical source repository\n */\nimport { PluginToolbarButton, useScopedStore } from '@edtr-io/core'\nimport { styled } from '@edtr-io/editor-ui'\nimport { AddButton } from '@edtr-io/editor-ui/internal'\nimport {\n  EditorPlugin,\n  EditorPluginProps,\n  child,\n  object,\n  optional,\n} from '@edtr-io/plugin'\nimport { getDocument } from '@edtr-io/store'\nimport { Icon, faRandom, faTrashAlt } from '@edtr-io/ui'\nimport { useI18n, I18n } from '@serlo/i18n'\nimport * as React from 'react'\n\nimport { SemanticSection } from './helpers/semantic-section'\n\nconst exerciseState = object({\n  content: child({ plugin: 'rows' }),\n  interactive: optional(\n    child<'scMcExercise' | 'inputExercise'>({ plugin: 'scMcExercise' })\n  ),\n})\n\nexport type ExercisePluginState = typeof exerciseState\nexport type ExerciseProps = EditorPluginProps<ExercisePluginState>\n\nexport const exercisePlugin: EditorPlugin<ExercisePluginState> = {\n  Component: ExerciseEditor,\n  state: exerciseState,\n  config: {},\n}\n\nconst ButtonContainer = styled.div({\n  display: 'flex',\n})\n\nconst interactivePlugins: {\n  name: 'scMcExercise' | 'inputExercise'\n  addLabel: (i18n: I18n) => string\n  title: (i18n: I18n) => string\n}[] = [\n  {\n    name: 'scMcExercise',\n    addLabel(i18n) {\n      return i18n.t('exercise::Add choice exercise')\n    },\n    title(i18n) {\n      return i18n.t('exercise::Choice exercise')\n    },\n  },\n  {\n    name: 'inputExercise',\n    addLabel(i18n) {\n      return i18n.t('exercise::Add input exercise')\n    },\n    title(i18n) {\n      return i18n.t('exercise::Input exercise')\n    },\n  },\n]\n\nconst InlineOptionsWrapper = styled.div({\n  position: 'absolute',\n  top: '-30px',\n  right: '0',\n  padding: '30px',\n  zIndex: 95,\n  whiteSpace: 'nowrap',\n})\n\nconst InlineOptionsContentWrapper = styled.div({\n  boxShadow: '0 2px 4px 0 rgba(0,0,0,0.50)',\n  backgroundColor: 'rgba(255, 255, 255, 0.95)',\n  borderRadius: '4px',\n})\n\nfunction InlineOptions(props: React.PropsWithChildren<{}>) {\n  return (\n    <InlineOptionsWrapper>\n      <InlineOptionsContentWrapper>\n        {props.children}\n      </InlineOptionsContentWrapper>\n    </InlineOptionsWrapper>\n  )\n}\nconst Option = styled.div({\n  padding: '5px 10px',\n  cursor: 'pointer',\n  width: '100%',\n  minWidth: '150px',\n  '&:hover': {\n    color: 'rgb(70, 155, 255)',\n  },\n})\n\nfunction ExerciseEditor({ editable, state }: ExerciseProps) {\n  const i18n = useI18n()\n  const store = useScopedStore()\n  const { content, interactive } = state\n  const [showOptions, setShowOptions] = React.useState(false)\n\n  return (\n    <React.Fragment>\n      <SemanticSection editable={editable}>{content.render()}</SemanticSection>\n      <SemanticSection editable={editable}>\n        {renderInteractive()}\n      </SemanticSection>\n    </React.Fragment>\n  )\n\n  function renderInteractive() {\n    if (interactive.defined) {\n      return interactive.render({\n        renderToolbar(children) {\n          return (\n            <React.Fragment>\n              <div\n                style={{ position: 'relative' }}\n                onMouseLeave={() => {\n                  setShowOptions(false)\n                }}\n              >\n                <PluginToolbarButton\n                  icon={<Icon icon={faRandom} />}\n                  // TODO: i18n\n                  label=\"Interaktives Element ändern\"\n                  onClick={() => {\n                    setShowOptions(true)\n                  }}\n                />\n                <PluginToolbarButton\n                  icon={<Icon icon={faTrashAlt} />}\n                  // TODO: i18n\n                  label=\"Interaktives Element entfernen\"\n                  onClick={() => {\n                    interactive.remove()\n                  }}\n                />\n                {showOptions ? (\n                  <InlineOptions>\n                    {interactivePlugins\n                      .filter(\n                        (plugin) =>\n                          !interactive ||\n                          plugin.name !== getCurrentInteractivePlugin()\n                      )\n                      .map((plugin) => {\n                        return (\n                          <Option\n                            key={plugin.name}\n                            onClick={() => {\n                              interactive.replace(plugin.name)\n                              setShowOptions(false)\n                            }}\n                          >\n                            {plugin.title(i18n)}\n                          </Option>\n                        )\n                      })}\n                  </InlineOptions>\n                ) : null}\n              </div>\n              {children}\n            </React.Fragment>\n          )\n        },\n      })\n    }\n\n    if (editable) {\n      return (\n        <React.Fragment>\n          <p>\n            <em>{i18n.t('exercise::Add an optional interactive exercise:')}</em>\n          </p>\n          <ButtonContainer>\n            {interactivePlugins.map((plugin) => {\n              return (\n                <AddButton\n                  key={plugin.name}\n                  onClick={() => {\n                    interactive.create({\n                      plugin: plugin.name,\n                    })\n                  }}\n                >\n                  {plugin.addLabel(i18n)}\n                </AddButton>\n              )\n            })}\n          </ButtonContainer>\n        </React.Fragment>\n      )\n    }\n\n    return null\n  }\n\n  function getCurrentInteractivePlugin() {\n    if (!interactive.defined) return null\n    const doc = getDocument(interactive.id)(store.getState())\n    return doc && doc.plugin\n  }\n}\n","/**\n * This file is part of Serlo.org.\n *\n * Copyright (c) 2013-2021 Serlo Education e.V.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\")\n * you may not use this file except in compliance with the License\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * @copyright Copyright (c) 2013-2021 Serlo Education e.V.\n * @license   http://www.apache.org/licenses/LICENSE-2.0 Apache License 2.0\n * @link      https://github.com/serlo-org/serlo.org for the canonical source repository\n */\nimport { LoadedFile, UploadValidator } from '@edtr-io/plugin'\nimport { createImagePlugin as createCoreImagePlugin } from '@edtr-io/plugin-image'\nimport fetch from 'unfetch'\n\nconst MAX_FILE_SIZE = 2 * 1024 * 1024\nconst ALLOWED_EXTENSIONS = ['gif', 'jpg', 'jpeg', 'png', 'svg']\n\nenum FileErrorCode {\n  TOO_MANY_FILES,\n  NO_FILE_SELECTED,\n  BAD_EXTENSION,\n  FILE_TOO_BIG,\n  UPLOAD_FAILED,\n}\n\nexport interface FileError {\n  errorCode: FileErrorCode\n  message: string\n}\n\nfunction matchesAllowedExtensions(fileName: string) {\n  const extension = fileName.toLowerCase().slice(fileName.lastIndexOf('.') + 1)\n  return ALLOWED_EXTENSIONS.indexOf(extension) >= 0\n}\n\nfunction handleErrors(errors: FileErrorCode[]): FileError[] {\n  return errors.map((error) => ({\n    errorCode: error,\n    message: errorCodeToMessage(error),\n  }))\n}\n\nfunction onError(errors: FileError[]): void {\n  alert(errors.map((error) => error.message).join('\\n'))\n}\n\nfunction errorCodeToMessage(error: FileErrorCode) {\n  switch (error) {\n    case FileErrorCode.TOO_MANY_FILES:\n      return 'You can only upload one file'\n    case FileErrorCode.NO_FILE_SELECTED:\n      return 'No file selected'\n    case FileErrorCode.BAD_EXTENSION:\n      return 'Not an accepted file type'\n    case FileErrorCode.FILE_TOO_BIG:\n      return 'Filesize is too big'\n    case FileErrorCode.UPLOAD_FAILED:\n      return 'Error while uploading'\n  }\n}\n\nexport const validateFile: UploadValidator<FileError[]> = (file) => {\n  let uploadErrors: FileErrorCode[] = []\n\n  if (!file) {\n    uploadErrors = [...uploadErrors, FileErrorCode.NO_FILE_SELECTED]\n  } else if (!matchesAllowedExtensions(file.name)) {\n    uploadErrors = [...uploadErrors, FileErrorCode.BAD_EXTENSION]\n  } else if (file.size > MAX_FILE_SIZE) {\n    uploadErrors = [...uploadErrors, FileErrorCode.FILE_TOO_BIG]\n  } else {\n    return {\n      valid: true,\n    }\n  }\n\n  return {\n    valid: false,\n    errors: handleErrors(uploadErrors),\n  }\n}\n\nexport function createUploadImageHandler(getCsrfToken: () => string) {\n  const readFile = createReadFile(getCsrfToken)\n  return function uploadImageHandler(file: File): Promise<string> {\n    const validation = validateFile(file)\n    if (!validation.valid) {\n      onError(validation.errors)\n      return Promise.reject(validation.errors)\n    }\n\n    return readFile(file).then((loaded) => {\n      return loaded.dataUrl\n    })\n  }\n}\n\nexport function createReadFile(getCsrfToken: () => string) {\n  return function readFile(file: File): Promise<LoadedFile> {\n    return new Promise((resolve, reject) => {\n      const reader = new FileReader()\n\n      reader.onload = function (e: ProgressEvent) {\n        if (!e.target) return\n        const formData = new FormData()\n        formData.append('attachment[file]', file)\n        formData.append('type', 'file')\n        formData.append('csrf', getCsrfToken())\n\n        fetch('/attachment/upload', {\n          method: 'POST',\n          body: formData,\n        })\n          .then((response) => response.json())\n          .then((data) => {\n            if (!data['success']) reject()\n            resolve({\n              file,\n              dataUrl: data.files[0].location,\n            })\n          })\n          .catch(() => {\n            reject()\n          })\n      }\n\n      reader.readAsDataURL(file)\n    })\n  }\n}\n\nexport function createImagePlugin(getCsrfToken: () => string) {\n  return createCoreImagePlugin({\n    upload: createUploadImageHandler(getCsrfToken),\n    validate: validateFile,\n    secondInput: 'description',\n  })\n}\n","/**\n * This file is part of Serlo.org.\n *\n * Copyright (c) 2013-2021 Serlo Education e.V.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\")\n * you may not use this file except in compliance with the License\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * @copyright Copyright (c) 2013-2021 Serlo Education e.V.\n * @license   http://www.apache.org/licenses/LICENSE-2.0 Apache License 2.0\n * @link      https://github.com/serlo-org/serlo.org for the canonical source repository\n */\nimport { child, EditorPlugin, EditorPluginProps } from '@edtr-io/plugin'\nimport { styled } from '@edtr-io/renderer-ui'\nimport * as React from 'react'\n\nexport const importantState = child({ plugin: 'text' })\nexport type ImportantPluginState = typeof importantState\nexport type ImportantProps = EditorPluginProps<ImportantPluginState>\n\nexport function createImportantPlugin(): EditorPlugin<ImportantPluginState> {\n  return {\n    Component: ImportantRenderer,\n    config: {},\n    state: importantState,\n  }\n}\n\nconst Box = styled.div({\n  borderLeft: '#bedfed solid 5px',\n  paddingLeft: '15px',\n})\n\nfunction ImportantRenderer(props: ImportantProps) {\n  return <Box>{props.state.render()}</Box>\n}\n","/**\n * This file is part of Serlo.org.\n *\n * Copyright (c) 2013-2021 Serlo Education e.V.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\")\n * you may not use this file except in compliance with the License\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * @copyright Copyright (c) 2013-2021 Serlo Education e.V.\n * @license   http://www.apache.org/licenses/LICENSE-2.0 Apache License 2.0\n * @link      https://github.com/serlo-org/serlo.org for the canonical source repository\n */\nimport { OverlayInput } from '@edtr-io/core'\nimport { EditorInlineSettings, EditorInput, styled } from '@edtr-io/editor-ui'\nimport { PreviewOverlay } from '@edtr-io/editor-ui/internal'\nimport { EditorPluginProps, string, EditorPlugin } from '@edtr-io/plugin'\nimport { Icon, faNewspaper } from '@edtr-io/ui'\nimport { useI18n } from '@serlo/i18n'\nimport * as React from 'react'\nimport fetch from 'unfetch'\n\n/* global */\ndeclare const Common: {\n  trigger: (type: string, context?: HTMLDivElement | null) => void\n}\n\nexport const injectionState = string()\n\nexport type InjectionPluginState = typeof injectionState\n\nexport const injectionPlugin: EditorPlugin<InjectionPluginState> = {\n  Component: InjectionEditor,\n  state: injectionState,\n  config: {},\n}\n\nexport function InjectionRenderer(props: { src: string }) {\n  const [loaded, setLoaded] = React.useState('')\n  const ref = React.useRef<HTMLDivElement>(null)\n  const i18n = useI18n()\n\n  React.useEffect(() => {\n    const src = createURL(props.src)\n\n    fetch(src, {\n      headers: {\n        'X-Requested-With': 'XMLHttpRequest',\n        'X-From': 'legacy-serlo.org',\n      },\n    })\n      .then((response) => response.json())\n      .then((data: { response: string }) => {\n        setLoaded(data.response)\n        setTimeout(() => {\n          if (ref.current) {\n            Common.trigger('new context', ref.current)\n          }\n        })\n      })\n      .catch(() => {\n        setLoaded(\n          `<div class=\"alert alert-info\">${i18n.t(\n            'injection::Illegal injection found'\n          )}</div>`\n        )\n      })\n  }, [props.src])\n\n  if (loaded) {\n    return (\n      <div className=\"panel panel-default\">\n        <div\n          className=\"panel-body\"\n          ref={ref}\n          dangerouslySetInnerHTML={{ __html: loaded }}\n        />\n      </div>\n    )\n  }\n\n  const src = createURL(props.src)\n  return (\n    <div>\n      <a href={src}>{i18n.t('injection::Serlo entity {{src}}', { src })}</a>\n    </div>\n  )\n}\n\nfunction createURL(id: string) {\n  if (id.startsWith('/') || id.startsWith('\\\\')) {\n    return '/' + id.substring(1, id.length)\n  }\n  const match = id.match(/^https?:\\/\\/[^./]+\\.serlo\\.[^./]+\\/(.+)$/g)\n  if (match) {\n    return '/' + match[1]\n  }\n  return '/' + id\n}\n\nconst PlaceholderWrapper = styled.div({\n  position: 'relative',\n  width: '100%',\n  textAlign: 'center',\n})\n\nfunction InjectionEditor(props: EditorPluginProps<typeof injectionState>) {\n  const [cache, setCache] = React.useState(props.state.value)\n  const [preview, setPreview] = React.useState(false)\n  const i18n = useI18n()\n\n  React.useEffect(() => {\n    const timeout = setTimeout(() => {\n      setCache(props.state.value)\n    }, 2000)\n    return () => {\n      clearTimeout(timeout)\n    }\n  }, [props.focused, props.state.value])\n\n  if (!props.editable) {\n    return <InjectionRenderer src={props.state.value} />\n  }\n\n  return (\n    <React.Fragment>\n      {cache ? (\n        <PreviewOverlay\n          focused={props.focused || false}\n          onChange={(nextActive) => {\n            setPreview(nextActive)\n            if (nextActive) {\n              setCache(props.state.value)\n            }\n          }}\n        >\n          <InjectionRenderer src={cache} />\n        </PreviewOverlay>\n      ) : (\n        <PlaceholderWrapper>\n          <Icon icon={faNewspaper} size=\"5x\" />\n        </PlaceholderWrapper>\n      )}\n      {props.focused && !preview ? (\n        <EditorInlineSettings>\n          <EditorInput\n            label={i18n.t('injection::Serlo ID:')}\n            placeholder=\"123456\"\n            value={props.state.value}\n            onChange={(e) => {\n              props.state.set(e.target.value)\n            }}\n            width=\"30%\"\n            inputWidth=\"100%\"\n            ref={props.autofocusRef}\n          />\n        </EditorInlineSettings>\n      ) : null}\n      {props.renderIntoSettings(\n        <React.Fragment>\n          <OverlayInput\n            label={i18n.t('injection::Serlo ID:')}\n            placeholder=\"123456\"\n            value={props.state.value}\n            onChange={(e) => {\n              props.state.set(e.target.value)\n            }}\n          />\n        </React.Fragment>\n      )}\n    </React.Fragment>\n  )\n}\n","/**\n * This file is part of Serlo.org.\n *\n * Copyright (c) 2013-2021 Serlo Education e.V.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\")\n * you may not use this file except in compliance with the License\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * @copyright Copyright (c) 2013-2021 Serlo Education e.V.\n * @license   http://www.apache.org/licenses/LICENSE-2.0 Apache License 2.0\n * @link      https://github.com/serlo-org/serlo.org for the canonical source repository\n */\nimport { useScopedStore } from '@edtr-io/core'\nimport { EditorPluginProps, StateTypeReturnType } from '@edtr-io/plugin'\nimport { styled } from '@edtr-io/renderer-ui'\nimport { DocumentState, replace, serializeDocument } from '@edtr-io/store'\nimport { RowsPlugin } from '@serlo/legacy-editor-to-editor'\nimport { useI18n } from '@serlo/i18n'\nimport * as React from 'react'\n\nimport { layoutState } from '.'\n\nconst LayoutContainer = styled.div({\n  display: 'flex',\n  flexDirection: 'row',\n  flexWrap: 'wrap',\n  alignItems: 'flex-start',\n})\n\nconst ChildContainer = styled.div<{ width: number }>(({ width }) => {\n  return {\n    width: `${(width / 12) * 100}%`,\n    '@media (max-width: 480px)': {\n      width: '100%',\n    },\n  }\n})\nconst ConvertInfo = styled.div({\n  padding: '5px',\n  backgroundColor: '#f2dede',\n  color: '#a94442',\n  border: '1px solid #ebccd1',\n  textAlign: 'center',\n})\n\nconst ButtonContainer = styled.div({ display: 'flex', flexDirection: 'row' })\n\nconst ConvertButton = styled.button({\n  borderRadius: '5px',\n  margin: '5px',\n  border: 'none',\n  outline: 'none',\n  backgroundColor: 'white',\n  '&:hover': { backgroundColor: '#ebccd1' },\n})\n\nexport const LayoutRenderer: React.FunctionComponent<\n  EditorPluginProps<typeof layoutState> & {\n    insert?: (options?: DocumentState) => void\n    remove?: () => void\n  }\n> = (props) => {\n  const store = useScopedStore()\n  const i18n = useI18n()\n\n  return (\n    <React.Fragment>\n      {props.editable ? (\n        <ConvertInfo>\n          {i18n.t(\n            'layout::To make the content draggable, convert them for the new editor:'\n          )}\n          <ButtonContainer>\n            <ConvertButton onClick={convertToRow}>\n              {i18n.t('layout::One-column layout')}\n            </ConvertButton>\n            {canConvertToMultimediaExplanation() ? (\n              <ConvertButton onClick={convertToMultimediaExplanation}>\n                {i18n.t('layout::Multimedia content associated with text')}\n              </ConvertButton>\n            ) : null}\n          </ButtonContainer>\n        </ConvertInfo>\n      ) : null}\n      <LayoutContainer>\n        {props.state.map((item, index) => {\n          return (\n            <ChildContainer key={index} width={item.width.value}>\n              {item.child.render()}\n            </ChildContainer>\n          )\n        })}\n      </LayoutContainer>\n    </React.Fragment>\n  )\n\n  function convertToRow() {\n    const documents: DocumentState[] = []\n\n    props.state.forEach((item) => {\n      const element = serializeDocument(item.child.id)(store.getState())\n\n      if (!element) return\n      if (element.plugin === 'rows') {\n        ;(element as RowsPlugin).state.forEach((rowsItem) => {\n          documents.push(rowsItem)\n        })\n      } else {\n        documents.push(element)\n      }\n    })\n\n    store.dispatch(\n      replace({\n        id: props.id,\n        plugin: 'rows',\n        state: documents,\n      })\n    )\n  }\n\n  function canConvertToMultimediaExplanation() {\n    const columns = props.state\n    return (\n      columns.length === 2 &&\n      (isMultimediaColumn(columns[0]) || isMultimediaColumn(columns[1]))\n    )\n  }\n\n  function convertToMultimediaExplanation() {\n    if (!canConvertToMultimediaExplanation()) return\n    const columns = props.state\n    if (isMultimediaColumn(columns[0])) {\n      replaceWithMultimediaExplanation({\n        explanationColumn: columns[1],\n        multimediaColumn: columns[0],\n      })\n    } else {\n      replaceWithMultimediaExplanation({\n        explanationColumn: columns[0],\n        multimediaColumn: columns[1],\n      })\n    }\n\n    function replaceWithMultimediaExplanation({\n      explanationColumn,\n      multimediaColumn,\n    }: {\n      explanationColumn: Column\n      multimediaColumn: Column\n    }) {\n      const explanation = serializeDocument(explanationColumn.child.id)(\n        store.getState()\n      )\n      const multimedia = serializeDocument(multimediaColumn.child.id)(\n        store.getState()\n      )\n      if (!explanation || !multimedia) return\n      store.dispatch(\n        replace({\n          id: props.id,\n          plugin: 'multimedia',\n          state: {\n            explanation,\n            multimedia: multimedia.state[0],\n            illustrating: true,\n            width: 50,\n          },\n        })\n      )\n    }\n  }\n\n  function isMultimediaColumn(column: Column) {\n    const columnDocument = serializeDocument(column.child.id)(store.getState())\n    if (!columnDocument) return false\n    const children: string[] = columnDocument.state.map(\n      (child: DocumentState) => child.plugin\n    )\n    return children.length === 1 && isMultimediaPlugin(children[0])\n  }\n\n  function isMultimediaPlugin(plugin: string) {\n    return plugin === 'image' || plugin === 'geogebra' || plugin === 'video'\n  }\n}\n\ntype Column = StateTypeReturnType<typeof layoutState>[0]\n","/**\n * This file is part of Serlo.org.\n *\n * Copyright (c) 2013-2021 Serlo Education e.V.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\")\n * you may not use this file except in compliance with the License\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * @copyright Copyright (c) 2013-2021 Serlo Education e.V.\n * @license   http://www.apache.org/licenses/LICENSE-2.0 Apache License 2.0\n * @link      https://github.com/serlo-org/serlo.org for the canonical source repository\n */\nimport { EditorPlugin, child, list, number, object } from '@edtr-io/plugin'\n\nimport { LayoutRenderer } from './editor'\n\nexport const layoutState = list(\n  object({ child: child({ plugin: 'text' }), width: number() })\n)\n\nexport type LayoutPluginState = typeof layoutState\n\nexport const layoutPlugin: EditorPlugin<LayoutPluginState> = {\n  Component: LayoutRenderer,\n  state: layoutState,\n  config: {},\n}\n","/**\n * This file is part of Serlo.org.\n *\n * Copyright (c) 2013-2021 Serlo Education e.V.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\")\n * you may not use this file except in compliance with the License\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * @copyright Copyright (c) 2013-2021 Serlo Education e.V.\n * @license   http://www.apache.org/licenses/LICENSE-2.0 Apache License 2.0\n * @link      https://github.com/serlo-org/serlo.org for the canonical source repository\n */\nimport { EditorPlugin, EditorPluginProps, scalar } from '@edtr-io/plugin'\nimport * as React from 'react'\nimport styled from 'styled-components'\n\nconst separatorState = scalar(undefined)\n\nexport type SeparatorPluginState = typeof separatorState\nexport type SeparatorProps = EditorPluginProps<SeparatorPluginState>\n\nexport const separatorPlugin: EditorPlugin<SeparatorPluginState> = {\n  Component: SeparatorEditor,\n  state: separatorState,\n  config: {},\n}\n\nconst Container = styled.div({\n  paddingTop: '10px',\n  paddingBottom: '10px',\n})\n\nconst Separator = styled.hr({\n  marginTop: 0,\n  marginBottom: 0,\n})\n\nfunction SeparatorEditor(props: SeparatorProps) {\n  if (!props.editable) return null\n  return (\n    <Container>\n      <Separator />\n    </Container>\n  )\n}\n","/**\n * This file is part of Serlo.org.\n *\n * Copyright (c) 2013-2021 Serlo Education e.V.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\")\n * you may not use this file except in compliance with the License\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * @copyright Copyright (c) 2013-2021 Serlo Education e.V.\n * @license   http://www.apache.org/licenses/LICENSE-2.0 Apache License 2.0\n * @link      https://github.com/serlo-org/serlo.org for the canonical source repository\n */\nimport {\n  EditorPlugin,\n  EditorPluginProps,\n  child,\n  object,\n  string,\n  optional,\n} from '@edtr-io/plugin'\nimport * as React from 'react'\nimport { useScopedSelector } from '@edtr-io/core'\nimport { isEmpty } from '@edtr-io/store'\nimport { Icon, faExternalLinkAlt, styled } from '@edtr-io/ui'\nimport { useI18n } from '@serlo/i18n'\n\nimport { SemanticSection } from './helpers/semantic-section'\nimport { InlineInput } from './helpers/inline-input'\nimport { InlineSettings } from './helpers/inline-settings'\nimport { InlineSettingsInput } from './helpers/inline-settings-input'\n\nconst solutionState = object({\n  prerequisite: optional(\n    object({\n      id: string(),\n      title: string(),\n    })\n  ),\n  strategy: child({\n    plugin: 'text',\n  }),\n  steps: child({ plugin: 'rows' }),\n})\n\nexport type SolutionPluginState = typeof solutionState\nexport type SolutionProps = EditorPluginProps<SolutionPluginState>\n\nexport const solutionPlugin: EditorPlugin<SolutionPluginState> = {\n  Component: SolutionEditor,\n  state: solutionState,\n  config: {},\n}\n\nconst OpenInNewTab = styled.span({ margin: '0 0 0 10px' })\n\nfunction SolutionEditor({ editable, state, focused }: SolutionProps) {\n  const { prerequisite, strategy } = state\n  const i18n = useI18n()\n\n  const hasStrategy = !useScopedSelector(isEmpty(strategy.id))\n\n  return (\n    <React.Fragment>\n      {renderPrerequisite()}\n      {hasStrategy || editable ? (\n        <SemanticSection editable={editable}>\n          {strategy.render({\n            config: {\n              placeholder: i18n.t(\n                'solution::Optionally explain the solution strategy here'\n              ),\n            },\n          })}\n        </SemanticSection>\n      ) : null}\n      <SemanticSection editable={editable}>\n        {state.steps.render()}\n      </SemanticSection>\n    </React.Fragment>\n  )\n\n  function renderPrerequisite() {\n    return (\n      <SemanticSection editable={editable}>{renderContent()}</SemanticSection>\n    )\n\n    function renderContent() {\n      if (editable) {\n        return (\n          <div>\n            {i18n.t(\n              'solution::For this exercise, you need the following fundamentals:'\n            )}{' '}\n            {focused ? (\n              <InlineSettings\n                onDelete={() => {\n                  if (prerequisite.defined) {\n                    prerequisite.remove()\n                  }\n                }}\n                position={'below'}\n              >\n                <InlineSettingsInput\n                  value={\n                    prerequisite.defined && prerequisite.id.value !== ''\n                      ? `/${prerequisite.id.value}`\n                      : ''\n                  }\n                  placeholder={i18n.t('solution::ID of an article, e.g. 1855')}\n                  onChange={(event) => {\n                    const newValue = event.target.value.replace(/[^0-9]/g, '')\n                    if (prerequisite.defined) {\n                      prerequisite.id.set(newValue)\n                    } else {\n                      prerequisite.create({\n                        id: newValue,\n                        title: '',\n                      })\n                    }\n                  }}\n                />\n                <a\n                  target=\"_blank\"\n                  href={\n                    prerequisite.defined && prerequisite.id.value !== ''\n                      ? `/${prerequisite.id.value}`\n                      : ''\n                  }\n                  rel=\"noopener noreferrer\"\n                >\n                  <OpenInNewTab\n                    title={i18n.t('solution::Open the article in a new tab:')}\n                  >\n                    <Icon icon={faExternalLinkAlt} />\n                  </OpenInNewTab>\n                </a>\n              </InlineSettings>\n            ) : null}\n            <a>\n              <InlineInput\n                value={prerequisite.defined ? prerequisite.title.value : ''}\n                onChange={(value) => {\n                  if (prerequisite.defined) {\n                    prerequisite.title.set(value)\n                  } else {\n                    prerequisite.create({ id: '', title: value })\n                  }\n                }}\n                placeholder={i18n.t('solution::Title of the link')}\n              />\n            </a>\n          </div>\n        )\n      }\n\n      if (\n        prerequisite.defined &&\n        prerequisite.id.value &&\n        prerequisite.title.value\n      ) {\n        return (\n          <p>\n            {i18n.t(\n              'solution::For this exercise, you need the following fundamentals:'\n            )}{' '}\n            <a href={`/${prerequisite.id.value}`}>{prerequisite.title.value}</a>\n          </p>\n        )\n      }\n\n      return null\n    }\n  }\n}\n","/**\n * This file is part of Serlo.org.\n *\n * Copyright (c) 2013-2021 Serlo Education e.V.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\")\n * you may not use this file except in compliance with the License\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * @copyright Copyright (c) 2013-2021 Serlo Education e.V.\n * @license   http://www.apache.org/licenses/LICENSE-2.0 Apache License 2.0\n * @link      https://github.com/serlo-org/serlo.org for the canonical source repository\n */\nimport { EditorPlugin, EditorPluginProps } from '@edtr-io/plugin'\nimport {\n  createTablePlugin,\n  TableProps,\n  TablePluginState,\n  TablePluginConfig,\n} from '@edtr-io/plugin-table'\nimport { converter } from '@serlo/markdown'\nimport { initMathJax, typeset } from '@serlo/mathjax'\nimport * as React from 'react'\n\nconst edtrTablePlugin = createTablePlugin({\n  MarkdownRenderer,\n})\n\nfunction MarkdownRenderer(props: { markdown: string }) {\n  const html = converter.makeHtml(props.markdown)\n  return (\n    <div\n      className=\"requires-mathjax\"\n      dangerouslySetInnerHTML={{ __html: html }}\n    />\n  )\n}\n\nexport const tablePlugin: EditorPlugin<TablePluginState, TablePluginConfig> = {\n  ...edtrTablePlugin,\n  Component: TableEditor,\n}\n\nfunction TableEditor(props: TableProps) {\n  const ref = React.useRef<HTMLDivElement>(null)\n  React.useEffect(() => {\n    initMathJax()\n    const timeout = setTimeout(typesetMathjax, 1000)\n    return () => {\n      if (timeout) {\n        clearTimeout(timeout)\n      }\n    }\n  })\n  return (\n    <div ref={ref}>\n      <edtrTablePlugin.Component {...props} />\n    </div>\n  )\n\n  function typesetMathjax() {\n    if (!ref.current) return\n    typeset(ref.current)\n  }\n}\n","/**\n * This file is part of Serlo.org.\n *\n * Copyright (c) 2013-2021 Serlo Education e.V.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\")\n * you may not use this file except in compliance with the License\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * @copyright Copyright (c) 2013-2021 Serlo Education e.V.\n * @license   http://www.apache.org/licenses/LICENSE-2.0 Apache License 2.0\n * @link      https://github.com/serlo-org/serlo.org for the canonical source repository\n */\nimport {\n  EditorPlugin,\n  EditorPluginProps,\n  object,\n  scalar,\n  string,\n} from '@edtr-io/plugin'\nimport { useI18n } from '@serlo/i18n'\nimport * as React from 'react'\n\nexport const deprecatedState = object({\n  plugin: string(),\n  state: scalar<unknown>({}),\n})\n\nexport type DeprecatedPluginState = typeof deprecatedState\n\nexport const DeprecatedRenderer: React.FunctionComponent<\n  EditorPluginProps<DeprecatedPluginState>\n> = (props) => {\n  const i18n = useI18n()\n\n  return (\n    <div className=\"panel panel-danger\">\n      <div className=\"panel-heading\">\n        {i18n.t(\n          'deprecated::This part of the document contains features that are no longer supported.'\n        )}\n      </div>\n      <div className=\"panel-body\">\n        <pre>\n          {JSON.stringify(\n            {\n              plugin: props.state.plugin.value,\n              state: props.state.state.value,\n            },\n            undefined,\n            2\n          )}\n        </pre>\n      </div>\n    </div>\n  )\n}\n\nexport const deprecatedPlugin: EditorPlugin<typeof deprecatedState> = {\n  Component: DeprecatedRenderer,\n  state: deprecatedState,\n  config: {},\n}\n","/**\n * This file is part of Serlo.org.\n *\n * Copyright (c) 2013-2021 Serlo Education e.V.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\")\n * you may not use this file except in compliance with the License\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * @copyright Copyright (c) 2013-2021 Serlo Education e.V.\n * @license   http://www.apache.org/licenses/LICENSE-2.0 Apache License 2.0\n * @link      https://github.com/serlo-org/serlo.org for the canonical source repository\n */\nimport { EditorPlugin } from '@edtr-io/plugin'\nimport { createTextPlugin } from '@edtr-io/plugin-text'\nimport { createAnchorPlugin } from '@edtr-io/plugin-anchor'\nimport { createBlockquotePlugin } from '@edtr-io/plugin-blockquote'\nimport { createGeogebraPlugin } from '@edtr-io/plugin-geogebra'\nimport { createHighlightPlugin } from '@edtr-io/plugin-highlight'\nimport {\n  createInputExercisePlugin,\n  InputExerciseType,\n} from '@edtr-io/plugin-input-exercise'\nimport { createMultimediaExplanationPlugin } from '@edtr-io/plugin-multimedia-explanation'\nimport { createRowsPlugin, RowsConfig } from '@edtr-io/plugin-rows'\nimport { createScMcExercisePlugin } from '@edtr-io/plugin-sc-mc-exercise'\nimport { createSpoilerPlugin } from '@edtr-io/plugin-spoiler'\nimport { createVideoPlugin } from '@edtr-io/plugin-video'\nimport { i18n } from 'i18next'\nimport * as React from 'react'\n\nimport { appletTypePlugin } from './plugins/types/applet'\nimport { articleTypePlugin } from './plugins/types/article'\nimport { courseTypePlugin } from './plugins/types/course'\nimport { coursePageTypePlugin } from './plugins/types/course-page'\nimport { eventTypePlugin } from './plugins/types/event'\nimport { mathPuzzleTypePlugin } from './plugins/types/math-puzzle'\nimport { pageTypePlugin } from './plugins/types/page'\nimport { taxonomyTypePlugin } from './plugins/types/taxonomy'\nimport { textExerciseTypePlugin } from './plugins/types/text-exercise'\nimport { textExerciseGroupTypePlugin } from './plugins/types/text-exercise-group'\nimport { textSolutionTypePlugin } from './plugins/types/text-solution'\nimport { userTypePlugin } from './plugins/types/user'\nimport { videoTypePlugin } from './plugins/types/video'\nimport { articlePlugin } from './plugins/article'\nimport { errorPlugin } from './plugins/error'\nimport { equationsPlugin } from './plugins/equations'\nimport { exercisePlugin } from './plugins/exercise'\nimport { createImagePlugin } from './plugins/image'\nimport { createImportantPlugin } from './plugins/important'\nimport { injectionPlugin } from './plugins/injection'\nimport { layoutPlugin } from './plugins/layout'\nimport { separatorPlugin } from './plugins/separator'\nimport { solutionPlugin } from './plugins/solution'\nimport { tablePlugin } from './plugins/table'\nimport { deprecatedPlugin } from './plugins/deprecated'\nimport { SerializedDocument } from './serialized-document'\n\ntype PluginType =\n  | SerializedDocument['plugin']\n  | 'type-applet'\n  | 'type-article'\n  | 'type-course'\n  | 'type-course-page'\n  | 'type-event'\n  | 'type-math-puzzle'\n  | 'type-page'\n  | 'type-taxonomy'\n  | 'type-text-exercise'\n  | 'type-text-exercise-group'\n  | 'type-text-solution'\n  | 'type-user'\n  | 'type-video'\n\nexport function createPlugins({\n  getCsrfToken,\n  i18n,\n  registry,\n}: {\n  getCsrfToken: () => string\n  i18n: i18n\n  registry: RowsConfig['plugins']\n}): Record<string, EditorPlugin<any, any>> &\n  Record<PluginType, EditorPlugin<any, any>> {\n  return {\n    anchor: createAnchorPlugin({\n      i18n: {\n        label: i18n.t('anchor::Identifier'),\n        placeholder: i18n.t('anchor::ID of the anchor'),\n      },\n    }),\n    article: articlePlugin,\n    articleIntroduction: createMultimediaExplanationPlugin({\n      explanation: {\n        plugin: 'text',\n        config: {\n          placeholder: i18n.t('article::Write a short introduction'),\n        },\n      },\n      plugins: [\n        {\n          name: 'image',\n          title: i18n.t('multimedia::Image'),\n        },\n      ],\n      i18n: {\n        changeMultimediaType: i18n.t('multimedia::Change the multimedia type'),\n        illustrating: {\n          label: i18n.t('multimedia::How important is the multimedia content?'),\n          values: {\n            illustrating: i18n.t('multimedia::It is illustrating'),\n            explaining: i18n.t('multimedia::It is essential'),\n          },\n        },\n      },\n    }),\n    blockquote: createBlockquotePlugin({\n      content: {\n        plugin: 'text',\n      },\n    }),\n    error: errorPlugin,\n    deprecated: deprecatedPlugin,\n    equations: equationsPlugin,\n    exercise: exercisePlugin,\n    geogebra: createGeogebraPlugin({\n      i18n: {\n        label: i18n.t('geogebra::GeoGebra URL or ID'),\n      },\n    }),\n    highlight: createHighlightPlugin({\n      i18n: {\n        code: {\n          label: i18n.t('highlight::Click here and enter your source code…'),\n          placeholder: i18n.t('highlight::Enter your source code here'),\n        },\n        language: {\n          label: i18n.t('highlight::Language'),\n          placeholder: i18n.t('highlight::Enter language'),\n        },\n        showLineNumbers: {\n          label: i18n.t('highlight::Show line numbers'),\n        },\n      },\n    }),\n    image: createImagePlugin(getCsrfToken),\n    important: createImportantPlugin(),\n    injection: injectionPlugin,\n    inputExercise: createInputExercisePlugin({\n      feedback: {\n        plugin: 'text',\n      },\n      i18n: {\n        types: {\n          [InputExerciseType.InputStringNormalizedMatchChallenge]: i18n.t(\n            'inputExercise::Text'\n          ),\n          [InputExerciseType.InputNumberExactMatchChallenge]: i18n.t(\n            'inputExercise::Number'\n          ),\n          [InputExerciseType.InputExpressionEqualMatchChallenge]: i18n.t(\n            'inputExercise::Mathematical expression'\n          ),\n        },\n        type: {\n          label: i18n.t('inputExercise::Choose the exercise type'),\n        },\n        unit: {\n          label: i18n.t('inputExercise::Unit'),\n        },\n        answer: {\n          addLabel: i18n.t('inputExercise::Add answer'),\n          value: {\n            placeholder: i18n.t('inputExercise::Enter the value'),\n          },\n        },\n        inputPlaceholder: i18n.t('inputExercise::Your solution'),\n        fallbackFeedback: {\n          correct: i18n.t('inputExercise::Correct'),\n          wrong: i18n.t('inputExercise::Wrong'),\n        },\n      },\n    }),\n    layout: layoutPlugin,\n    multimedia: createMultimediaExplanationPlugin({\n      explanation: { plugin: 'rows' },\n      plugins: [\n        {\n          name: 'image',\n          title: i18n.t('multimedia::Image'),\n        },\n        {\n          name: 'video',\n          title: i18n.t('multimedia::Video'),\n        },\n        {\n          name: 'geogebra',\n          title: i18n.t('multimedia::GeoGebra Applet'),\n        },\n      ],\n      i18n: {\n        changeMultimediaType: i18n.t('multimedia::Change the multimedia type'),\n        illustrating: {\n          label: i18n.t('multimedia::How important is the multimedia content?'),\n          values: {\n            illustrating: i18n.t('multimedia::It is illustrating'),\n            explaining: i18n.t('multimedia::It is essential'),\n          },\n        },\n      },\n    }),\n    rows: createRowsPlugin({\n      content: { plugin: 'text' },\n      plugins: registry,\n      i18n: {\n        menu: {\n          searchPlaceholder: i18n.t('rows::Search for tools…'),\n        },\n        settings: {\n          duplicateLabel: i18n.t('rows::Duplicate'),\n          removeLabel: i18n.t('rows::Remove'),\n          closeLabel: i18n.t('rows::Close'),\n        },\n        toolbar: {\n          dragLabel: i18n.t('rows::Drag the element within the document'),\n        },\n        addLabel: i18n.t('rows::Add an element'),\n      },\n    }),\n    scMcExercise: createScMcExercisePlugin({\n      content: { plugin: 'text' },\n      feedback: { plugin: 'text' },\n      i18n: {\n        types: {\n          singleChoice: i18n.t('scMcExercise::Single-choice'),\n          multipleChoice: i18n.t('scMcExercise::Multiple-choice'),\n        },\n        isSingleChoice: {\n          label: i18n.t('scMcExercise::Choose the exercise type'),\n        },\n        answer: {\n          addLabel: i18n.t('scMcExercise::Add answer'),\n          fallbackFeedback: {\n            wrong: i18n.t('scMcExercise::Wrong'),\n          },\n        },\n        globalFeedback: {\n          missingCorrectAnswers: i18n.t(\n            'scMcExercise::Almost! You missed at least one correct answer'\n          ),\n          correct: i18n.t('scMcExercise::Correct'),\n          wrong: i18n.t('scMcExercise::Wrong'),\n        },\n      },\n    }),\n    separator: separatorPlugin,\n    solution: solutionPlugin,\n    spoiler: createSpoilerPlugin({\n      content: { plugin: 'rows' },\n      i18n: {\n        title: {\n          placeholder: i18n.t('spoiler::Enter a title'),\n        },\n      },\n    }),\n    table: tablePlugin,\n    text: createTextPlugin({\n      registry,\n      blockquote: 'blockquote',\n      i18n: {\n        blockquote: {\n          toggleTitle: i18n.t('text::Quote'),\n        },\n        colors: {\n          setColorTitle: i18n.t('text::Set color'),\n          resetColorTitle: i18n.t('text::Reset color'),\n          openMenuTitle: i18n.t('text::Colors'),\n          closeMenuTitle: i18n.t('text::Close sub menu'),\n        },\n        headings: {\n          setHeadingTitle(level: number) {\n            return `${i18n.t('text::Heading')} ${level}`\n          },\n          openMenuTitle: i18n.t('text::Headings'),\n          closeMenuTitle: i18n.t('text::Close sub menu'),\n        },\n        link: {\n          toggleTitle: i18n.t('text::Link (Strg + K)'),\n          placeholder: i18n.t('text::Enter URL'),\n          openInNewTabTitle: i18n.t('text::Open in new tab'),\n        },\n        list: {\n          toggleOrderedList: i18n.t('text::Ordered list'),\n          toggleUnorderedList: i18n.t('text::Unordered list'),\n          openMenuTitle: i18n.t('text::Lists'),\n          closeMenuTitle: i18n.t('text::Close sub menu'),\n        },\n        math: {\n          toggleTitle: i18n.t('text::Math formula (Strg + M)'),\n          displayBlockLabel: i18n.t('text::Display as block'),\n          placeholder: i18n.t('text::[formula]'),\n          editors: {\n            visual: i18n.t('text::visual'),\n            latex: i18n.t('text::LaTeX'),\n            noVisualEditorAvailableMessage: i18n.t(\n              'text::Only LaTeX editor available'\n            ),\n          },\n          helpText(\n            KeySpan: React.ComponentType<{ children: React.ReactNode }>\n          ) {\n            return (\n              <>\n                {i18n.t('text::Shortcuts')}:\n                <br />\n                <br />\n                <p>\n                  {i18n.t('text::Fraction')}: <KeySpan>/</KeySpan>\n                </p>\n                <p>\n                  {i18n.t('text::Superscript')}: <KeySpan>↑</KeySpan>{' '}\n                  {i18n.t('text::or')} <KeySpan>^</KeySpan>\n                </p>\n                <p>\n                  {i18n.t('text::Subscript')}: <KeySpan>↓</KeySpan>{' '}\n                  {i18n.t('text::or')} <KeySpan>_</KeySpan>\n                </p>\n                <p>\n                  π, α, β, γ: <KeySpan>pi</KeySpan>, <KeySpan>alpha</KeySpan>,{' '}\n                  <KeySpan>beta</KeySpan>,<KeySpan>gamma</KeySpan>\n                </p>\n                <p>\n                  ≤, ≥: <KeySpan>{'<='}</KeySpan>, <KeySpan>{'>='}</KeySpan>\n                </p>\n                <p>\n                  {i18n.t('text::Root')}: <KeySpan>\\sqrt</KeySpan>,{' '}\n                  <KeySpan>\\nthroot</KeySpan>\n                </p>\n                <p>\n                  {i18n.t('text::Math symbols')}:{' '}\n                  <KeySpan>{'\\\\<NAME>'}</KeySpan>, {i18n.t('text::e.g.')}{' '}\n                  <KeySpan>\\neq</KeySpan> (≠), <KeySpan>\\pm</KeySpan> (±), ...\n                </p>\n                <p>\n                  {i18n.t('text::Functions')}: <KeySpan>sin</KeySpan>,{' '}\n                  <KeySpan>cos</KeySpan>, <KeySpan>ln</KeySpan>, ...\n                </p>\n              </>\n            )\n          },\n        },\n        richText: {\n          toggleStrongTitle: i18n.t('text::Bold (Strg + B)'),\n          toggleEmphasizeTitle: i18n.t('text::Italic (Strg + I)'),\n        },\n        suggestions: {\n          noResultsMessage: i18n.t('text::No items found'),\n        },\n      },\n    }),\n    video: createVideoPlugin({\n      i18n: {\n        src: {\n          label: i18n.t('video::Video URL'),\n        },\n        alt: {\n          label: i18n.t('video::Description'),\n        },\n      },\n    }),\n\n    // Internal plugins for our content types\n    'type-applet': appletTypePlugin,\n    'type-article': articleTypePlugin,\n    'type-course': courseTypePlugin,\n    'type-course-page': coursePageTypePlugin,\n    'type-event': eventTypePlugin,\n    'type-math-puzzle': mathPuzzleTypePlugin,\n    'type-page': pageTypePlugin,\n    'type-taxonomy': taxonomyTypePlugin,\n    'type-text-exercise': textExerciseTypePlugin,\n    'type-text-exercise-group': textExerciseGroupTypePlugin,\n    'type-text-solution': textSolutionTypePlugin,\n    'type-user': userTypePlugin,\n    'type-video': videoTypePlugin,\n  }\n}\n","/**\n * This file is part of Serlo.org.\n *\n * Copyright (c) 2013-2021 Serlo Education e.V.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\")\n * you may not use this file except in compliance with the License\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * @copyright Copyright (c) 2013-2021 Serlo Education e.V.\n * @license   http://www.apache.org/licenses/LICENSE-2.0 Apache License 2.0\n * @link      https://github.com/serlo-org/serlo.org for the canonical source repository\n */\nimport { Editor as Core } from '@edtr-io/core/beta'\nimport { createDefaultDocumentEditor } from '@edtr-io/default-document-editor/beta'\nimport { RowsConfig } from '@edtr-io/plugin-rows'\nimport {\n  createIcon,\n  faAnchor,\n  faCaretSquareDown,\n  faCode,\n  faCubes,\n  faFilm,\n  faImages,\n  faNewspaper,\n  faParagraph,\n  faPhotoVideo,\n  faQuoteRight,\n} from '@edtr-io/ui'\nimport { useI18n } from '@serlo/i18n'\nimport * as React from 'react'\n\nimport { CsrfContext } from './csrf-context'\nimport { deserialize, isError } from './deserialize'\nimport { createPlugins } from './plugins'\n\nexport interface EditorProps {\n  getCsrfToken(): string\n\n  children?: React.ReactNode\n  mayCheckout: boolean\n  onSave: (data: unknown) => Promise<void>\n  onError?: (error: Error, context: Record<string, string>) => void\n  initialState: unknown\n  type: string\n}\n\nexport const SaveContext = React.createContext<{\n  onSave: EditorProps['onSave']\n  mayCheckout: boolean\n}>({\n  onSave: () => {\n    return Promise.reject()\n  },\n  mayCheckout: false,\n})\n\nexport function Editor(props: EditorProps) {\n  const i18n = useI18n()\n\n  let result = deserialize(props)\n  const plugins = createPlugins({\n    getCsrfToken: props.getCsrfToken,\n    registry: getRegistry(),\n    i18n,\n  })\n\n  const DocumentEditor = createDefaultDocumentEditor({\n    i18n: {\n      settings: {\n        buttonLabel: i18n.t('edtr-io::Settings'),\n        modalTitle: i18n.t('edtr-io::Extended Settings'),\n        modalCloseLabel: i18n.t('edtr-io::Close'),\n      },\n    },\n  })\n\n  const legacyUrl = window.location.pathname\n    .replace('add-revision', 'add-revision-old')\n    .replace('create', 'create-old')\n  if (isError(result)) {\n    switch (result.error) {\n      case 'type-unsupported':\n        return (\n          <div className=\"alert alert-danger\" role=\"alert\">\n            {i18n.t(\n              \"edtr-io::This content type isn't supported by the new editor, yet.\"\n            )}{' '}\n            <a href={legacyUrl}>\n              {i18n.t('edtr-io::Edit the content in the old editor.')}\n            </a>\n          </div>\n        )\n      case 'failure':\n        return (\n          <div className=\"alert alert-danger\" role=\"alert\">\n            {i18n.t('edtr-io::An error occurred during the conversion.')}{' '}\n            <a href={legacyUrl}>\n              {i18n.t('edtr-io::Edit the content in the old editor.')}\n            </a>\n          </div>\n        )\n    }\n  }\n  const stored = getStored()\n  if (\n    stored &&\n    confirm(\n      i18n.t(\n        'edtr-io::We found an old revision created by you. Do you want to restore it?'\n      )\n    )\n  ) {\n    result = {\n      success: true,\n      initialState: stored,\n      converted: false,\n    }\n  }\n\n  return (\n    <CsrfContext.Provider value={props.getCsrfToken}>\n      <SaveContext.Provider\n        value={{ onSave: props.onSave, mayCheckout: props.mayCheckout }}\n      >\n        {result.converted ? (\n          <div className=\"alert alert-warning\" role=\"alert\">\n            {i18n.t(\n              \"edtr-io::This entity hasn't been converted to the new editor, yet.\"\n            )}{' '}\n            <a href={legacyUrl}>\n              {i18n.t('edtr-io::Edit the content in the old editor.')}\n            </a>\n          </div>\n        ) : null}\n        <Core\n          DocumentEditor={DocumentEditor}\n          onError={props.onError}\n          plugins={plugins}\n          initialState={result.initialState}\n          editable\n        >\n          {props.children}\n        </Core>\n      </SaveContext.Provider>\n    </CsrfContext.Provider>\n  )\n\n  function getRegistry(): RowsConfig['plugins'] {\n    const isExercise = [\n      'grouped-text-exercise',\n      'text-exercise',\n      'text-exercise-group',\n    ].includes(props.type)\n    return [\n      {\n        name: 'text',\n        title: i18n.t('edtr-io::Text'),\n        description: i18n.t(\n          'edtr-io::Compose content using rich text and math formulas.'\n        ),\n        icon: createIcon(faParagraph),\n      },\n      {\n        name: 'blockquote',\n        title: i18n.t('edtr-io::Quotation'),\n        description: i18n.t('edtr-io::Create indented text for quotations.'),\n        icon: createIcon(faQuoteRight),\n      },\n      {\n        name: 'geogebra',\n        title: i18n.t('edtr-io::GeoGebra Applet'),\n        description: i18n.t(\n          'edtr-io::Embed GeoGebra Materials applets via URL or ID.'\n        ),\n        icon: createIcon(faCubes),\n      },\n      {\n        name: 'highlight',\n        title: i18n.t('edtr-io::Source Code'),\n        description: i18n.t('edtr-io::Highlight the syntax of source code.'),\n        icon: createIcon(faCode),\n      },\n      {\n        name: 'anchor',\n        title: i18n.t('edtr-io::Anchor'),\n        description: i18n.t('edtr-io::Insert an anchor.'),\n        icon: createIcon(faAnchor),\n      },\n      {\n        name: 'equations',\n        title: i18n.t('edtr-io::Equations'),\n        description: i18n.t(\n          'edtr-io::Create mathematical equations and terms.'\n        ),\n      },\n      {\n        name: 'image',\n        title: i18n.t('edtr-io::Image'),\n        description: i18n.t('edtr-io::Upload images.'),\n        icon: createIcon(faImages),\n      },\n      {\n        name: 'important',\n        title: i18n.t('edtr-io::Important Statement'),\n        description: i18n.t(\n          'edtr-io::A box to highlight important statements.'\n        ),\n      },\n      {\n        name: 'injection',\n        title: i18n.t('edtr-io::serlo.org Content'),\n        description: i18n.t('edtr-io::Embed serlo.org content via their ID.'),\n        icon: createIcon(faNewspaper),\n      },\n      {\n        name: 'multimedia',\n        title: i18n.t('edtr-io::Multimedia content associated with text'),\n        description: i18n.t(\n          'edtr-io::Create an illustrating or explaining multimedia content associated with text.'\n        ),\n        icon: createIcon(faPhotoVideo),\n      },\n      {\n        name: 'spoiler',\n        title: i18n.t('edtr-io::Spoiler'),\n        description: i18n.t('edtr-io::A collapsible box.'),\n        icon: createIcon(faCaretSquareDown),\n      },\n      {\n        name: 'table',\n        title: i18n.t('edtr-io::Table'),\n        description: i18n.t('edtr-io::Create tables using Markdown.'),\n      },\n      {\n        name: 'video',\n        title: i18n.t('edtr-io::Video'),\n        description: i18n.t(\n          'edtr-io::Embed YouTube, Vimeo, Wikimedia Commons or BR videos.'\n        ),\n        icon: createIcon(faFilm),\n      },\n      ...(isExercise\n        ? [\n            {\n              name: 'separator',\n              title: i18n.t('edtr-io::Solution Separator'),\n              description: i18n.t(\n                'edtr-io::Divide the solution into individual steps.'\n              ),\n            },\n          ]\n        : []),\n    ]\n  }\n}\n\nfunction getStored(): { plugin: string; state?: unknown } | undefined {\n  const edtr = localStorage.getItem('edtr')\n  if (!edtr) return\n\n  const state = JSON.parse(edtr)\n  return state[window.location.pathname]\n}\n\nexport function storeState(state: unknown) {\n  const currentValue = localStorage.getItem('edtr')\n  const edtr = currentValue ? JSON.parse(currentValue) : {}\n\n  edtr[window.location.pathname] = state\n\n  localStorage.setItem('edtr', JSON.stringify(edtr))\n}\n","/**\n * This file is part of Serlo.org.\n *\n * Copyright (c) 2013-2021 Serlo Education e.V.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\")\n * you may not use this file except in compliance with the License\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * @copyright Copyright (c) 2013-2021 Serlo Education e.V.\n * @license   http://www.apache.org/licenses/LICENSE-2.0 Apache License 2.0\n * @link      https://github.com/serlo-org/serlo.org for the canonical source repository\n */\nimport { useI18n } from '@serlo/i18n'\nimport { Renderer as Core, RendererProps } from '@edtr-io/renderer'\nimport * as React from 'react'\n\nimport { createPlugins } from './plugins'\n\nexport function Renderer({ state }: { state: RendererProps['state'] }) {\n  const i18n = useI18n()\n  const plugins = createPlugins({\n    getCsrfToken: () => '',\n    registry: [],\n    i18n: i18n,\n  })\n  return <Core plugins={plugins} state={state || { plugin: 'text' }} />\n}\n","/**\n * This file is part of Serlo.org.\n *\n * Copyright (c) 2013-2021 Serlo Education e.V.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\")\n * you may not use this file except in compliance with the License\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * @copyright Copyright (c) 2013-2021 Serlo Education e.V.\n * @license   http://www.apache.org/licenses/LICENSE-2.0 Apache License 2.0\n * @link      https://github.com/serlo-org/serlo.org for the canonical source repository\n */\nimport { serializer, slateValueToHtml } from '@edtr-io/plugin-text/internal'\nimport { Edtr } from '@serlo/legacy-editor-to-editor'\nimport * as R from 'ramda'\nimport { Value } from 'slate'\n\nexport function cleanEdtrState(state: Edtr) {\n  return cleanJson(state)\n\n  /* eslint-disable @typescript-eslint/no-explicit-any */\n  function cleanJson(jsonObj: any): any {\n    if (jsonObj !== null && typeof jsonObj === 'object') {\n      return R.map((value: any) => {\n        if (value.plugin === 'text' && value.state) {\n          const slateValue = Value.fromJSON(serializer.deserialize(value.state))\n          return {\n            ...value,\n            state: slateValueToHtml(slateValue),\n          }\n        }\n        return cleanJson(value)\n      }, jsonObj)\n    } else {\n      // jsonObj is a number or string\n      return jsonObj\n    }\n  }\n  /* eslint-enable @typescript-eslint/no-explicit-any */\n}\n"],"names":["CsrfContext","React","createContext","empty","plugin","state","deserialize","initialState","type","onError","stack","config","applet","push","id","changes","title","url","content","serializeEditorState","toEdtr","deserializeEditorState","reasoning","meta_title","meta_description","converted","isEdtr","article","deserializedContent","convertedContent","undefined","introduction","exercises","exerciseFolder","relatedContent","articles","courses","videos","sources","course","description","map","s","deserializeCoursePage","event","source","page","deserializeTextExercise","cohesive","deserializeTextSolution","user","video","taxonomy","term","error","success","e","JSON","stringify","icon","textSolution","singleChoiceRightAnswer","singleChoiceWrongAnswer","multipleChoiceRightAnswer","multipleChoiceWrongAnswer","inputExpressionEqualMatchChallenge","inputNumberExactMatchChallenge","inputStringNormalizedMatchChallenge","deserialized","scMcExercise","convertedSCRightAnswers","extractChildFromRows","convert","isCorrect","feedback","convertedSCWrongAnswers","filter","answer","convertedMCRightAnswers","convertedMCWrongAnswers","isSingleChoice","length","answers","deserializeScMcExercise","inputExercise","extractInputAnswers","inputExercises","exercise","value","solution","children","R","filterDefined","unit","array","el","deserializeInputExercise","interactive","prerequisite","strategy","steps","isError","result","parse","licenseState","object","number","string","agreement","iconHref","uuid","license","entity","revision","HeaderInput","styled","input","border","width","borderBottom","outline","borderColor","Controls","props","buttonProps","i18n","useI18n","store","useScopedStore","dispatch","useScopedDispatch","undoable","useScopedSelector","hasUndoActions","redoable","hasRedoActions","hasPendingChanges","getPendingChanges","getCsrfToken","visible","setVisibility","pending","setPending","hasError","setHasError","savedToLocalstorage","setSavedToLocalstorage","SaveContext","onSave","mayCheckout","setAgreement","emailSubscription","setEmailSubscription","notificationSubscription","setNotificationSubscription","autoCheckout","setAutoCheckout","window","onbeforeunload","createPortal","className","onClick","undo","disabled","redo","subscriptions","handleSave","maySave","document","getElementsByClassName","BSModal","show","onHide","Header","closeButton","Title","t","Body","BSAlert","bsStyle","onDismiss","Footer","BSButton","storeState","serializeRootDocument","getState","BSFormGroup","controlId","BSControlLabel","BSFormControl","componentClass","onChange","set","target","BSCheckbox","checked","dangerouslySetInnerHTML","__html","renderLicense","licenseAccepted","changesFilledIn","getSaveHint","serializedRoot","serialized","String","csrf","controls","subscription","subscribe","mailman","checkout","then","entityType","ownTypes","getFocusableChildren","objectType","init","replaceOwnState","newValue","previousState","helpers","_value","key","editorContent","originalChild","child","serialize","serializedChild","skipControls","optionalSerializedChild","updater","oldId","create","_oldId","createInitialState","remove","OptionalChild","getDocument","render","renderToolbar","PluginToolbarButton","Icon","faTrashAlt","label","removeLabel","onRemove","StyledTR","tr","selected","cursor","RevisionHistory","availableRevisions","setAvailableRevisions","showRevisions","setShowRevisions","fetch","response","json","data","faHistory","size","bsSize","BSTable","striped","hover","revisionData","currentRevision","active","dateTime","moment","utc","timestamp","local","alert","onSwitchRevision","faCheck","author","format","fromNow","Settings","Textarea","Select","options","placeholder","option","appletTypePlugin","Component","renderIntoToolbar","renderIntoSettings","editable","itemProp","articleTypePlugin","courseTypePlugin","index","AddButton","insert","list","coursePageTypePlugin","includes","eventTypePlugin","mathPuzzleTypePlugin","pageTypePlugin","taxonomyTypePlugin","name","parent","position","textExerciseTypePlugin","Container","div","boxShadow","marginTop","padding","minHeight","SemanticSection","textExerciseGroupTypePlugin","isCohesive","virtualParent","virtualizer","useVirtual","parentRef","estimateSize","contentRendered","renderSettings","htmlFor","ref","style","height","overflow","totalSize","virtualItems","virtualRow","measureRef","top","left","transform","start","fromCharCode","boolean","textSolutionTypePlugin","renderTitle","collapsed","ThemeProvider","theme","solutionTheme","ExpandableBox","rendererUi","expandableBox","toggleBackgroundColor","containerBorderColor","userTypePlugin","videoTypeState","videoPlugin","createVideoPlugin","videoTypePlugin","src","alt","OverlayTriangle","borderLeft","borderRight","positionAbove","InlineOverlayWrapper","opacity","transition","zIndex","whiteSpace","InlineOverlayContentWrapper","backgroundColor","color","borderRadius","HoveringOverlay","overlay","triangle","setPositionAbove","current","menu","rect","anchor","getBoundingClientRect","native","getSelection","rangeCount","getRangeAt","offsetParent","parentRect","aboveValue","offsetHeight","bottom","Math","min","max","offsetWidth","offsetLeft","allowSelectionOverflow","InlinePreview","span","ChangeButton","display","margin","InlineSettings","onDelete","InlineInputInner","InlineInputRefForward","InlineSettingsInput","InlineInput","Plain","setState","Editor","onFocus","editor","next","setTimeout","Sign","relatedContentItemState","articlePlugin","header","types","allItems","focusedInlineSetting","setFocusedInlineSetting","isFocused","folderHeader","DragDropContext","onDragEnd","destination","move","Droppable","droppableId","provided","innerRef","droppableProps","Draggable","draggableId","draggableProps","BasePluginToolbarButton","dragHandleProps","PluginToolbarButtonIcon","EdtrIcon","edtrDragHandle","MinWidthIcon","replace","href","rel","OpenInNewTab","faExternalLinkAlt","renderExercises","faNewspaper","fixedWidth","section","addLabel","idPlaceholder","openLinkInNewTabPlaceholder","dragLabel","faGraduationCap","faPlayCircle","item","flexGrow","renderRelatedContentSection","spoilerTheme","alwaysVisible","button","background","toggleColor","errorPlugin","scalar","renderSignToString","sign","Equals","GreaterThan","GreaterThanOrEqual","LessThan","LessThanOrEqual","AlmostEqualTo","Estimates","StepSegment","TableWrapper","overflowX","Table","table","MathTd","td","verticalAlign","LeftTd","textAlign","SignTd","TransformTd","paddingLeft","ExplanationTr","EquationsRenderer","isEmpty","firstExplanation","colSpan","renderDownArrow","renderFirstExplanation","step","MathRenderer","inline","right","explanation","downArrowBase64","Buffer","from","toString","backgroundImage","backgroundSize","backgroundRepeat","backgroundPosition","setDefaultPreference","RemoveButton","DragButton","paddingRight","DropDown","select","marginLeft","marginRight","StepEditor","gridFocus","row","setFocus","column","Left","InlineMath","focused","onFocusNext","moveRight","onFocusPrevious","moveLeft","tabIndex","Right","Transform","prefix","suffix","preferences","PreferenceContext","MathEditor","readOnly","disableBlock","visual","getKey","onEditorChange","setKey","onInlineChange","onMoveOutRight","onMoveOutLeft","equationsPlugin","rows","columns","focusNext","focusPrevious","onFocusChanged","focus","setFocusState","focusedElement","getFocused","nestedFocus","Explanation","HotKeys","allowChanges","keyMap","FOCUS_NEXT_OR_INSERT","FOCUS_PREVIOUS","INSERT","handlers","handleKeyDown","insertNewEquationAt","insertNewEquationWithFocus","faTimes","renderAddButton","preventDefault","exercisePlugin","showOptions","setShowOptions","defined","onMouseLeave","faRandom","InlineOptions","interactivePlugins","doc","getCurrentInteractivePlugin","Option","ButtonContainer","optional","InlineOptionsWrapper","InlineOptionsContentWrapper","FileErrorCode","minWidth","ALLOWED_EXTENSIONS","errorCodeToMessage","TOO_MANY_FILES","NO_FILE_SELECTED","BAD_EXTENSION","FILE_TOO_BIG","UPLOAD_FAILED","validateFile","file","fileName","extension","errors","uploadErrors","toLowerCase","slice","lastIndexOf","indexOf","valid","errorCode","message","createUploadImageHandler","readFile","Promise","resolve","reject","reader","FileReader","onload","formData","FormData","append","method","body","dataUrl","files","location","readAsDataURL","createReadFile","validation","loaded","join","createImagePlugin","createCoreImagePlugin","upload","validate","secondInput","importantState","Box","ImportantRenderer","injectionPlugin","cache","setCache","preview","setPreview","timeout","clearTimeout","PreviewOverlay","nextActive","InjectionRenderer","PlaceholderWrapper","EditorInlineSettings","EditorInput","inputWidth","autofocusRef","OverlayInput","setLoaded","createURL","headers","Common","trigger","startsWith","substring","match","LayoutContainer","flexDirection","flexWrap","alignItems","ChildContainer","ConvertInfo","ConvertButton","layoutPlugin","documents","forEach","element","serializeDocument","rowsItem","canConvertToMultimediaExplanation","isMultimediaColumn","replaceWithMultimediaExplanation","explanationColumn","multimediaColumn","multimedia","illustrating","columnDocument","isMultimediaPlugin","separatorPlugin","Separator","paddingTop","paddingBottom","hr","marginBottom","solutionPlugin","hasStrategy","edtrTablePlugin","createTablePlugin","MarkdownRenderer","html","converter","makeHtml","markdown","tablePlugin","initMathJax","typesetMathjax","typeset","deprecatedPlugin","createPlugins","registry","createAnchorPlugin","articleIntroduction","createMultimediaExplanationPlugin","plugins","changeMultimediaType","values","explaining","blockquote","createBlockquotePlugin","deprecated","equations","geogebra","createGeogebraPlugin","highlight","createHighlightPlugin","code","language","showLineNumbers","image","important","injection","createInputExercisePlugin","InputExerciseType","InputStringNormalizedMatchChallenge","InputNumberExactMatchChallenge","InputExpressionEqualMatchChallenge","inputPlaceholder","fallbackFeedback","correct","wrong","layout","createRowsPlugin","searchPlaceholder","settings","duplicateLabel","closeLabel","toolbar","createScMcExercisePlugin","singleChoice","multipleChoice","globalFeedback","missingCorrectAnswers","separator","spoiler","createSpoilerPlugin","text","createTextPlugin","toggleTitle","colors","setColorTitle","resetColorTitle","openMenuTitle","closeMenuTitle","headings","setHeadingTitle","level","link","openInNewTabTitle","toggleOrderedList","toggleUnorderedList","math","displayBlockLabel","editors","latex","noVisualEditorAvailableMessage","helpText","KeySpan","richText","toggleStrongTitle","toggleEmphasizeTitle","suggestions","noResultsMessage","currentValue","localStorage","getItem","edtr","pathname","setItem","isExercise","createIcon","faParagraph","faQuoteRight","faCubes","faCode","faAnchor","faImages","faPhotoVideo","faCaretSquareDown","faFilm","DocumentEditor","createDefaultDocumentEditor","buttonLabel","modalTitle","modalCloseLabel","legacyUrl","role","stored","getStored","confirm","Provider","Core","cleanJson","jsonObj","slateValue","Value","fromJSON","serializer","slateValueToHtml"],"mappings":"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"}
{"version":3,"file":"edtr-io.esm.js","sources":["../src/csrf-context.ts","../src/deserialize.ts","../src/plugins/types/common.tsx","../src/plugins/types/helpers/settings.tsx","../src/plugins/types/applet.tsx","../src/plugins/types/article.tsx","../src/plugins/types/course.tsx","../src/plugins/types/course-page.tsx","../src/plugins/types/event.tsx","../src/plugins/types/math-puzzle.tsx","../src/plugins/types/page.tsx","../src/plugins/types/taxonomy.tsx","../src/plugins/types/text-exercise.tsx","../src/plugins/helpers/semantic-section.tsx","../src/plugins/types/text-exercise-group.tsx","../src/plugins/types/text-solution.tsx","../src/plugins/types/user.tsx","../src/plugins/types/video.tsx","../src/plugins/helpers/hovering-overlay.tsx","../src/plugins/helpers/inline-settings.tsx","../src/plugins/helpers/inline-settings-input.tsx","../src/plugins/helpers/inline-input.tsx","../src/plugins/article.tsx","../src/plugins/error/index.tsx","../src/plugins/equations/sign.tsx","../src/plugins/equations/renderer.tsx","../src/plugins/equations/editor.tsx","../src/plugins/equations/index.ts","../src/plugins/exercise.tsx","../src/plugins/image.tsx","../src/plugins/important.tsx","../src/plugins/injection.tsx","../src/plugins/layout/editor.tsx","../src/plugins/layout/index.ts","../src/plugins/separator.tsx","../src/plugins/solution.tsx","../src/plugins/table.tsx","../src/plugins/deprecated/index.tsx","../src/plugins.tsx","../src/editor.tsx","../src/renderer.tsx","../src/clean-state.tsx"],"sourcesContent":["/**\n * This file is part of Serlo.org.\n *\n * Copyright (c) 2013-2021 Serlo Education e.V.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\")\n * you may not use this file except in compliance with the License\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * @copyright Copyright (c) 2013-2021 Serlo Education e.V.\n * @license   http://www.apache.org/licenses/LICENSE-2.0 Apache License 2.0\n * @link      https://github.com/serlo-org/serlo.org for the canonical source repository\n */\nimport React from 'react'\n\nexport const CsrfContext = React.createContext<() => string>(() => '')\n","/**\n * This file is part of Serlo.org.\n *\n * Copyright (c) 2013-2021 Serlo Education e.V.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\")\n * you may not use this file except in compliance with the License\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * @copyright Copyright (c) 2013-2021 Serlo Education e.V.\n * @license   http://www.apache.org/licenses/LICENSE-2.0 Apache License 2.0\n * @link      https://github.com/serlo-org/serlo.org for the canonical source repository\n */\nimport { StateType, StateTypeSerializedType } from '@edtr-io/plugin'\nimport { InputExercisePluginState } from '@edtr-io/plugin-input-exercise'\nimport { ScMcExercisePluginState } from '@edtr-io/plugin-sc-mc-exercise'\nimport {\n  convert,\n  isEdtr,\n  Edtr,\n  Legacy,\n  RowsPlugin,\n  OtherPlugin,\n  Splish,\n} from '@serlo/legacy-editor-to-editor'\nimport * as R from 'ramda'\n\nimport { appletTypeState } from './plugins/types/applet'\nimport { articleTypeState } from './plugins/types/article'\nimport { courseTypeState } from './plugins/types/course'\nimport { coursePageTypeState } from './plugins/types/course-page'\nimport { eventTypeState } from './plugins/types/event'\nimport { mathPuzzleTypeState } from './plugins/types/math-puzzle'\nimport { pageTypeState } from './plugins/types/page'\nimport { taxonomyTypeState } from './plugins/types/taxonomy'\nimport { textExerciseTypeState } from './plugins/types/text-exercise'\nimport { textExerciseGroupTypeState } from './plugins/types/text-exercise-group'\nimport { textSolutionTypeState } from './plugins/types/text-solution'\nimport { userTypeState } from './plugins/types/user'\nimport { videoTypeState } from './plugins/types/video'\nimport { Entity, License, Uuid } from './plugins/types/common'\nimport { EditorProps } from './editor'\n\nconst empty: RowsPlugin = { plugin: 'rows', state: [] }\n\nexport function deserialize({\n  initialState,\n  type,\n  onError,\n}: Pick<EditorProps, 'initialState' | 'type' | 'onError'>): DeserializeResult {\n  const stack: { id: number; type: string }[] = []\n  const config: Record<\n    string,\n    { deserialize: (state: any) => DeserializedState<StateType> }\n  > = {\n    applet: { deserialize: deserializeApplet },\n    article: { deserialize: deserializeArticle },\n    course: { deserialize: deserializeCourse },\n    'course-page': { deserialize: deserializeCoursePage },\n    event: { deserialize: deserializeEvent },\n    'math-puzzle': { deserialize: deserializeMathPuzzle },\n    page: { deserialize: deserializePage },\n    'grouped-text-exercise': { deserialize: deserializeTextExercise },\n    'text-exercise': { deserialize: deserializeTextExercise },\n    'text-exercise-group': { deserialize: deserializeTextExerciseGroup },\n    'text-solution': { deserialize: deserializeTextSolution },\n    user: { deserialize: deserializeUser },\n    video: { deserialize: deserializeVideo },\n    taxonomy: { deserialize: deserializeTaxonomy },\n  }\n  try {\n    if (config[type] === undefined) {\n      return {\n        error: 'type-unsupported',\n      }\n    }\n    const { deserialize } = config[type]\n    return succeed(deserialize(initialState))\n  } catch (e) {\n    const error = e as Error\n    if (typeof onError === 'function') {\n      onError(error, {\n        stack: JSON.stringify(stack),\n      })\n    }\n    return {\n      error: 'failure',\n    }\n  }\n\n  function succeed(\n    deserialized: DeserializedState<StateType>\n  ): DeserializeSuccess {\n    return {\n      success: true,\n      ...deserialized,\n    }\n  }\n\n  function deserializeApplet(\n    state: AppletSerializedState\n  ): DeserializedState<typeof appletTypeState> {\n    stack.push({ id: state.id, type: 'applet' })\n    return {\n      initialState: {\n        plugin: 'type-applet',\n        state: {\n          ...state,\n          changes: '',\n          title: state.title || '',\n          url: state.url || '',\n          content: serializeEditorState(\n            toEdtr(deserializeEditorState(state.content))\n          ),\n          reasoning: serializeEditorState(\n            toEdtr(deserializeEditorState(state.reasoning))\n          ),\n          meta_title: state.meta_title || '',\n          meta_description: state.meta_description || '',\n        },\n      },\n      converted: !isEdtr(deserializeEditorState(state.content) || empty),\n    }\n  }\n\n  function deserializeArticle(\n    state: ArticleSerializedState\n  ): DeserializedState<typeof articleTypeState> {\n    stack.push({ id: state.id, type: 'article' })\n\n    return {\n      initialState: {\n        plugin: 'type-article',\n        state: {\n          ...state,\n          changes: '',\n          title: state.title || '',\n          content: getContent(),\n          reasoning: serializeEditorState(\n            toEdtr(deserializeEditorState(state.reasoning))\n          ),\n          meta_title: state.meta_title || '',\n          meta_description: state.meta_description || '',\n        },\n      },\n      converted: !isEdtr(deserializeEditorState(state.content) || empty),\n    }\n\n    function getContent() {\n      const deserializedContent = deserializeEditorState(state.content)\n\n      const convertedContent = toEdtr(deserializedContent) as\n        | RowsPlugin\n        | OtherPlugin\n\n      if (\n        deserializedContent !== undefined &&\n        isEdtr(deserializedContent) &&\n        convertedContent.plugin === 'article'\n      ) {\n        return serializeEditorState(convertedContent)\n      }\n\n      return serializeEditorState({\n        plugin: 'article',\n        state: {\n          introduction: { plugin: 'articleIntroduction' },\n          content: convertedContent,\n          exercises: [],\n          exerciseFolder: { id: '', title: '' },\n          relatedContent: {\n            articles: [],\n            courses: [],\n            videos: [],\n          },\n          sources: [],\n        },\n      })\n    }\n  }\n\n  function deserializeCourse(\n    state: CourseSerializedState\n  ): DeserializedState<typeof courseTypeState> {\n    stack.push({ id: state.id, type: 'course' })\n    return {\n      initialState: {\n        plugin: 'type-course',\n        state: {\n          ...state,\n          changes: '',\n          title: state.title || '',\n          description: serializeEditorState(\n            toEdtr(deserializeEditorState(state.description))\n          ),\n          reasoning: serializeEditorState(\n            toEdtr(deserializeEditorState(state.reasoning))\n          ),\n          meta_description: state.meta_description || '',\n          'course-page': (state['course-page'] || []).map(\n            (s) => deserializeCoursePage(s).initialState.state\n          ),\n        },\n      },\n      converted: !isEdtr(deserializeEditorState(state.description) || empty),\n    }\n  }\n\n  function deserializeCoursePage(\n    state: CoursePageSerializedState\n  ): DeserializedState<typeof coursePageTypeState> {\n    stack.push({ id: state.id, type: 'course-page' })\n    return {\n      initialState: {\n        plugin: 'type-course-page',\n        state: {\n          ...state,\n          changes: '',\n          title: state.title || '',\n          icon: state.icon || 'explanation',\n          content: serializeEditorState(\n            toEdtr(deserializeEditorState(state.content))\n          ),\n        },\n      },\n      converted: !isEdtr(deserializeEditorState(state.content) || empty),\n    }\n  }\n\n  function deserializeEvent(\n    state: EventSerializedState\n  ): DeserializedState<typeof eventTypeState> {\n    stack.push({ id: state.id, type: 'event' })\n    return {\n      initialState: {\n        plugin: 'type-event',\n        state: {\n          ...state,\n          changes: '',\n          title: state.title || '',\n          content: serializeEditorState(\n            toEdtr(deserializeEditorState(state.content))\n          ),\n          meta_title: state.meta_title || '',\n          meta_description: state.meta_description || '',\n        },\n      },\n      converted: !isEdtr(deserializeEditorState(state.content) || empty),\n    }\n  }\n\n  function deserializeMathPuzzle(\n    state: MathPuzzleSerializedState\n  ): DeserializedState<typeof mathPuzzleTypeState> {\n    stack.push({ id: state.id, type: 'math-puzzle' })\n    return {\n      initialState: {\n        plugin: 'type-math-puzzle',\n        state: {\n          ...state,\n          changes: '',\n          content: serializeEditorState(\n            toEdtr(deserializeEditorState(state.content))\n          ),\n          source: state.source || '',\n        },\n      },\n      converted: !isEdtr(deserializeEditorState(state.content) || empty),\n    }\n  }\n\n  function deserializePage(\n    state: PageSerializedState\n  ): DeserializedState<typeof pageTypeState> {\n    stack.push({ id: state.id, type: 'page' })\n    return {\n      initialState: {\n        plugin: 'type-page',\n        state: {\n          ...state,\n          title: state.title || '',\n          content: serializeEditorState(\n            toEdtr(deserializeEditorState(state.content))\n          ),\n        },\n      },\n      converted: !isEdtr(deserializeEditorState(state.content) || empty),\n    }\n  }\n\n  function deserializeTaxonomy(\n    state: TaxonomySerializedState\n  ): DeserializedState<typeof taxonomyTypeState> {\n    stack.push({ id: state.id, type: 'taxonomy' })\n    return {\n      initialState: {\n        plugin: 'type-taxonomy',\n        state: {\n          ...state,\n          term: state.term,\n          description: serializeEditorState(\n            toEdtr(deserializeEditorState(state.description))\n          ),\n        },\n      },\n      converted: false, // no legacy editor for taxonomies\n    }\n  }\n\n  function deserializeTextExercise({\n    content,\n    'text-solution': textSolution,\n    'single-choice-right-answer': singleChoiceRightAnswer,\n    'single-choice-wrong-answer': singleChoiceWrongAnswer,\n    'multiple-choice-right-answer': multipleChoiceRightAnswer,\n    'multiple-choice-wrong-answer': multipleChoiceWrongAnswer,\n    'input-expression-equal-match-challenge': inputExpressionEqualMatchChallenge,\n    'input-number-exact-match-challenge': inputNumberExactMatchChallenge,\n    'input-string-normalized-match-challenge': inputStringNormalizedMatchChallenge,\n    ...state\n  }: TextExerciseSerializedState): DeserializedState<\n    typeof textExerciseTypeState\n  > {\n    stack.push({ id: state.id, type: 'text-exercise' })\n    const deserialized = deserializeEditorState(content)\n\n    const scMcExercise =\n      deserialized && !isEdtr(deserialized)\n        ? deserializeScMcExercise()\n        : undefined\n\n    const inputExercise =\n      deserialized && !isEdtr(deserialized)\n        ? deserializeInputExercise()\n        : undefined\n\n    return {\n      initialState: {\n        plugin: 'type-text-exercise',\n        state: {\n          ...state,\n          changes: '',\n          'text-solution': textSolution\n            ? deserializeTextSolution(textSolution).initialState.state\n            : '',\n          content: getContent(),\n        },\n      },\n      converted: !isEdtr(deserialized || empty),\n    }\n\n    function getContent() {\n      const deserializedContent = deserializeEditorState(content)\n      if (deserializedContent !== undefined && isEdtr(deserializedContent)) {\n        return serializeEditorState(toEdtr(deserializedContent))\n      }\n\n      const convertedContent = toEdtr(deserializedContent) as RowsPlugin\n      const interactive = scMcExercise || inputExercise\n\n      return serializeEditorState({\n        plugin: 'exercise',\n        state: {\n          content: {\n            plugin: 'rows',\n            state: convertedContent.state,\n          },\n          interactive,\n        },\n      })\n    }\n\n    function deserializeScMcExercise():\n      | {\n          plugin: 'scMcExercise'\n          state: StateTypeSerializedType<ScMcExercisePluginState>\n        }\n      | undefined {\n      stack.push({ id: state.id, type: 'sc-mc-exercise' })\n      if (\n        singleChoiceWrongAnswer ||\n        singleChoiceRightAnswer ||\n        multipleChoiceWrongAnswer ||\n        multipleChoiceRightAnswer\n      ) {\n        const convertedSCRightAnswers =\n          singleChoiceRightAnswer && singleChoiceRightAnswer.content\n            ? [\n                {\n                  content: extractChildFromRows(\n                    convert(\n                      deserializeEditorState(singleChoiceRightAnswer.content)\n                    )\n                  ),\n                  isCorrect: true,\n                  feedback: extractChildFromRows(\n                    convert(\n                      deserializeEditorState(singleChoiceRightAnswer.feedback)\n                    )\n                  ),\n                },\n              ]\n            : []\n        const convertedSCWrongAnswers = singleChoiceWrongAnswer\n          ? singleChoiceWrongAnswer\n              .filter((answer) => {\n                return answer.content\n              })\n              .map((answer) => {\n                return {\n                  content: extractChildFromRows(\n                    convert(deserializeEditorState(answer.content))\n                  ),\n                  isCorrect: false,\n                  feedback: extractChildFromRows(\n                    convert(deserializeEditorState(answer.feedback))\n                  ),\n                }\n              })\n          : []\n\n        const convertedMCRightAnswers = multipleChoiceRightAnswer\n          ? multipleChoiceRightAnswer\n              .filter((answer) => {\n                return answer.content\n              })\n              .map((answer) => {\n                return {\n                  content: extractChildFromRows(\n                    convert(deserializeEditorState(answer.content))\n                  ),\n                  isCorrect: true,\n                  feedback: {\n                    plugin: 'text',\n                  },\n                }\n              })\n          : []\n\n        const convertedMCWrongAnswers = multipleChoiceWrongAnswer\n          ? multipleChoiceWrongAnswer\n              .filter((answer) => {\n                return answer.content\n              })\n              .map((answer) => {\n                return {\n                  content: extractChildFromRows(\n                    convert(deserializeEditorState(answer.content))\n                  ),\n                  isCorrect: false,\n                  feedback: extractChildFromRows(\n                    convert(deserializeEditorState(answer.feedback))\n                  ),\n                }\n              })\n          : []\n        const isSingleChoice = !(\n          convertedMCRightAnswers.length || convertedMCWrongAnswers.length\n        )\n        return {\n          plugin: 'scMcExercise',\n          state: {\n            isSingleChoice: isSingleChoice,\n            answers: [\n              ...(isSingleChoice ? convertedSCRightAnswers : []),\n              ...(isSingleChoice ? convertedSCWrongAnswers : []),\n              ...(!isSingleChoice ? convertedMCRightAnswers : []),\n              ...(!isSingleChoice ? convertedMCWrongAnswers : []),\n            ],\n          },\n        }\n      }\n    }\n\n    function deserializeInputExercise():\n      | {\n          plugin: 'inputExercise'\n          state: StateTypeSerializedType<InputExercisePluginState>\n        }\n      | undefined {\n      if (\n        inputStringNormalizedMatchChallenge ||\n        inputNumberExactMatchChallenge ||\n        inputExpressionEqualMatchChallenge\n      ) {\n        const type = inputStringNormalizedMatchChallenge\n          ? 'input-string-normalized-match-challenge'\n          : inputNumberExactMatchChallenge\n          ? 'input-number-exact-match-challenge'\n          : 'input-expression-equal-match-challenge'\n\n        const inputExercises = filterDefined([\n          inputStringNormalizedMatchChallenge,\n          inputNumberExactMatchChallenge,\n          inputExpressionEqualMatchChallenge,\n        ])\n\n        return {\n          plugin: 'inputExercise',\n          state: {\n            type,\n            answers: extractInputAnswers(inputExercises, true),\n            unit: '',\n          },\n        }\n      }\n\n      function extractInputAnswers(\n        inputExercises: InputType[],\n        isCorrect: boolean\n      ): {\n        value: string\n        isCorrect: boolean\n        feedback: { plugin: string; state?: unknown }\n      }[] {\n        if (inputExercises.length === 0) return []\n\n        const answers = inputExercises.map((exercise) => {\n          return {\n            value: exercise.solution,\n            feedback: extractChildFromRows(\n              convert(deserializeEditorState(exercise.feedback))\n            ),\n            isCorrect,\n          }\n        })\n\n        const children = R.flatten(\n          inputExercises.map((exercise) => {\n            return filterDefined([\n              exercise['input-string-normalized-match-challenge'],\n              exercise['input-number-exact-match-challenge'],\n              exercise['input-expression-equal-match-challenge'],\n            ])\n          })\n        )\n\n        return R.concat(answers, extractInputAnswers(children, false))\n      }\n\n      function filterDefined<T>(array: (T | undefined)[]): T[] {\n        return array.filter((el) => typeof el !== 'undefined') as T[]\n      }\n    }\n  }\n\n  function extractChildFromRows(plugin: RowsPlugin) {\n    return plugin.state.length ? plugin.state[0] : { plugin: 'text' }\n  }\n\n  function deserializeTextExerciseGroup(\n    state: TextExerciseGroupSerializedState\n  ): DeserializedState<typeof textExerciseGroupTypeState> {\n    stack.push({ id: state.id, type: 'text-exercise-group' })\n    return {\n      initialState: {\n        plugin: 'type-text-exercise-group',\n        state: {\n          ...state,\n          changes: '',\n          content: serializeEditorState(\n            toEdtr(deserializeEditorState(state.content))\n          ),\n          cohesive: state.cohesive === 'true',\n          'grouped-text-exercise': (state['grouped-text-exercise'] || []).map(\n            (s) => deserializeTextExercise(s).initialState.state\n          ),\n        },\n      },\n      converted: !isEdtr(deserializeEditorState(state.content) || empty),\n    }\n  }\n\n  function deserializeTextSolution(\n    state: TextSolutionSerializedState\n  ): DeserializedState<typeof textSolutionTypeState> {\n    stack.push({ id: state.id, type: 'text-solution' })\n\n    return {\n      initialState: {\n        plugin: 'type-text-solution',\n        state: {\n          ...state,\n          changes: '',\n          content: getContent(),\n        },\n      },\n      converted: !isEdtr(deserializeEditorState(state.content) || empty),\n    }\n\n    function getContent() {\n      const deserializedContent = deserializeEditorState(state.content)\n      if (deserializedContent !== undefined && isEdtr(deserializedContent)) {\n        return serializeEditorState(toEdtr(deserializedContent))\n      }\n\n      const convertedContent = toEdtr(deserializedContent) as RowsPlugin\n\n      return serializeEditorState({\n        plugin: 'solution',\n        state: {\n          prerequisite: undefined,\n          strategy: { plugin: 'text' },\n          steps: convertedContent,\n        },\n      })\n    }\n  }\n\n  function deserializeUser(\n    state: UserSerializedState\n  ): DeserializedState<typeof userTypeState> {\n    stack.push({ id: state.id, type: 'user' })\n    return {\n      initialState: {\n        plugin: 'type-user',\n        state: {\n          ...state,\n          description: serializeEditorState(\n            toEdtr(deserializeEditorState(state.description))\n          ),\n        },\n      },\n      converted: false, // no legacy-editor for users\n    }\n  }\n\n  function deserializeVideo(\n    state: VideoSerializedState\n  ): DeserializedState<typeof videoTypeState> {\n    stack.push({ id: state.id, type: 'video' })\n    return {\n      initialState: {\n        plugin: 'type-video',\n        state: {\n          ...state,\n          changes: '',\n          title: state.title || '',\n          description: serializeEditorState(\n            toEdtr(deserializeEditorState(state.description))\n          ),\n          content: state.content || '',\n          reasoning: serializeEditorState(\n            toEdtr(deserializeEditorState(state.reasoning))\n          ),\n        },\n      },\n      converted: !isEdtr(deserializeEditorState(state.description) || empty),\n    }\n  }\n\n  interface AppletSerializedState extends Entity {\n    title?: string\n    url?: string\n    content: SerializedEditorState\n    reasoning: SerializedEditorState\n    meta_title?: string\n    meta_description?: string\n  }\n\n  interface ArticleSerializedState extends Entity {\n    title?: string\n    content: SerializedEditorState\n    reasoning: SerializedEditorState\n    meta_title?: string\n    meta_description?: string\n  }\n\n  interface CourseSerializedState extends Entity {\n    title?: string\n    description: SerializedEditorState\n    reasoning: SerializedEditorState\n    meta_description?: string\n    'course-page'?: CoursePageSerializedState[]\n  }\n\n  interface CoursePageSerializedState extends Entity {\n    title?: string\n    icon?: 'explanation' | 'play' | 'question'\n    content: SerializedEditorState\n  }\n\n  interface EventSerializedState extends Entity {\n    title?: string\n    content: SerializedEditorState\n    meta_title?: string\n    meta_description?: string\n  }\n\n  interface MathPuzzleSerializedState extends Entity {\n    content: SerializedEditorState\n    source?: string\n  }\n\n  interface PageSerializedState extends Uuid, License {\n    title?: string\n    content: SerializedEditorState\n  }\n\n  interface TaxonomySerializedState extends Uuid {\n    term: {\n      name: string\n    }\n    description: SerializedEditorState\n    taxonomy: number\n    parent: number\n    position: number\n  }\n\n  interface TextExerciseSerializedState extends Entity {\n    content: SerializedEditorState\n    'text-solution'?: TextSolutionSerializedState\n    'single-choice-right-answer'?: {\n      content: SerializedLegacyEditorState\n      feedback: SerializedLegacyEditorState\n    }\n    'single-choice-wrong-answer'?: {\n      content: SerializedLegacyEditorState\n      feedback: SerializedLegacyEditorState\n    }[]\n    'multiple-choice-right-answer'?: { content: SerializedLegacyEditorState }[]\n    'multiple-choice-wrong-answer'?: {\n      content: SerializedLegacyEditorState\n      feedback: SerializedLegacyEditorState\n    }[]\n    'input-expression-equal-match-challenge'?: InputType\n    'input-number-exact-match-challenge'?: InputType\n    'input-string-normalized-match-challenge': InputType\n  }\n\n  interface InputType {\n    solution: string\n    feedback: SerializedLegacyEditorState\n    'input-expression-equal-match-challenge'?: InputType[]\n    'input-number-exact-match-challenge'?: InputType[]\n    'input-string-normalized-match-challenge'?: InputType[]\n  }\n\n  interface TextExerciseGroupSerializedState extends Entity {\n    cohesive?: string\n    content: SerializedEditorState\n    'grouped-text-exercise'?: TextExerciseSerializedState[]\n  }\n\n  interface TextSolutionSerializedState extends Entity {\n    content: SerializedEditorState\n  }\n\n  interface UserSerializedState extends Uuid {\n    description: SerializedEditorState\n  }\n\n  interface VideoSerializedState extends Entity {\n    title?: string\n    description: SerializedEditorState\n    content?: string\n    reasoning: SerializedEditorState\n  }\n}\n\nexport interface DeserializedState<T extends StateType> {\n  initialState: {\n    plugin: string\n    state?: StateTypeSerializedType<T>\n  }\n  converted: boolean\n}\n\nexport function isError(result: DeserializeResult): result is DeserializeError {\n  return !!(result as DeserializeError).error\n}\n\nexport type DeserializeResult = DeserializeSuccess | DeserializeError\nexport interface DeserializeSuccess\n  extends DeserializedState<StateType<unknown>> {\n  success: true\n}\nexport type DeserializeError =\n  | { error: 'type-unsupported' }\n  | { error: 'failure' }\n\nfunction toEdtr(content: EditorState): Edtr {\n  if (!content)\n    return { plugin: 'rows', state: [{ plugin: 'text', state: undefined }] }\n  if (isEdtr(content)) return content\n  return convert(content)\n}\n\nfunction serializeEditorState(content: Legacy): SerializedLegacyEditorState\nfunction serializeEditorState(content: EditorState): SerializedEditorState\nfunction serializeEditorState(\n  content: EditorState\n): SerializedEditorState | SerializedLegacyEditorState {\n  if (typeof content === 'string') return content as SerializedLegacyEditorState\n  return content ? (JSON.stringify(content) as any) : undefined\n}\n\nfunction deserializeEditorState(content: SerializedLegacyEditorState): Legacy\nfunction deserializeEditorState(content: SerializedEditorState): EditorState\nfunction deserializeEditorState(\n  content: SerializedLegacyEditorState | SerializedEditorState\n): EditorState {\n  try {\n    return content ? JSON.parse(content) : undefined\n  } catch {\n    // No valid JSON, so this is interpreted as Markdown\n    return content as Legacy\n  }\n}\n\ntype EditorState = Legacy | Splish | Edtr | undefined\n\n// Fake `__type` property is just here to let TypeScript distinguish between the types\ntype SerializedEditorState = (string | undefined) & {\n  __type: 'serialized-editor-state'\n}\ntype SerializedLegacyEditorState = (string | undefined) & {\n  __type: 'serialized-legacy-editor-state'\n}\n","/**\n * This file is part of Serlo.org.\n *\n * Copyright (c) 2013-2021 Serlo Education e.V.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\")\n * you may not use this file except in compliance with the License\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * @copyright Copyright (c) 2013-2021 Serlo Education e.V.\n * @license   http://www.apache.org/licenses/LICENSE-2.0 Apache License 2.0\n * @link      https://github.com/serlo-org/serlo.org for the canonical source repository\n */\nimport {\n  useScopedDispatch,\n  useScopedSelector,\n  useScopedStore,\n  PluginToolbarButton,\n} from '@edtr-io/core'\nimport {\n  StateType,\n  StateTypesSerializedType,\n  StateTypeSerializedType,\n  StateTypesValueType,\n  StateTypeValueType,\n  StateTypesReturnType,\n  StateTypeReturnType,\n  StateUpdater,\n  child,\n  number,\n  object,\n  string,\n} from '@edtr-io/plugin'\nimport {\n  getDocument,\n  redo,\n  serializeRootDocument,\n  undo,\n  hasRedoActions,\n  hasUndoActions,\n  getPendingChanges,\n} from '@edtr-io/store'\nimport { Icon, faTrashAlt, styled } from '@edtr-io/ui'\nimport { useI18n } from '@serlo/i18n'\nimport * as R from 'ramda'\nimport * as React from 'react'\nimport BSAlert from 'react-bootstrap/lib/Alert'\nimport BSModal from 'react-bootstrap/lib/Modal'\nimport BSButton from 'react-bootstrap/lib/Button'\nimport BSCheckbox from 'react-bootstrap/lib/Checkbox'\nimport BSFormGroup from 'react-bootstrap/lib/FormGroup'\nimport BSControlLabel from 'react-bootstrap/lib/ControlLabel'\nimport BSFormControl from 'react-bootstrap/lib/FormControl'\nimport { createPortal } from 'react-dom'\n\nimport { CsrfContext } from '../../csrf-context'\nimport { SaveContext, storeState } from '../../editor'\n\nexport const licenseState = object({\n  id: number(),\n  title: string(),\n  url: string(),\n  agreement: string(),\n  iconHref: string(),\n})\n\nexport const uuid = {\n  id: number(),\n}\n\nexport const license = {\n  license: licenseState,\n}\n\nexport const entity = {\n  ...uuid,\n  ...license,\n  revision: number(),\n  changes: string(),\n}\n\nexport type Uuid = StateTypesSerializedType<typeof uuid>\n\nexport type License = StateTypesSerializedType<typeof license>\n\nexport type Entity = Uuid & License & { revision: number; changes?: string }\n\nexport const HeaderInput = styled.input({\n  border: 'none',\n  width: '100%',\n  borderBottom: '2px solid transparent',\n  '&:focus': {\n    outline: 'none',\n    borderColor: '#007ec1',\n  },\n})\n\nexport function Controls(props: OwnProps) {\n  const i18n = useI18n()\n  const store = useScopedStore()\n  const dispatch = useScopedDispatch()\n  const undoable = useScopedSelector(hasUndoActions())\n  const redoable = useScopedSelector(hasRedoActions())\n  const pendingChanges = useScopedSelector(getPendingChanges())\n  const hasPendingChanges = pendingChanges !== 0\n  const getCsrfToken = React.useContext(CsrfContext)\n\n  const [visible, setVisibility] = React.useState(false)\n  const [pending, setPending] = React.useState(false)\n  const [hasError, setHasError] = React.useState(false)\n  const [savedToLocalstorage, setSavedToLocalstorage] = React.useState(false)\n  const { onSave, mayCheckout } = React.useContext(SaveContext)\n  const [agreement, setAgreement] = React.useState(false)\n  const [emailSubscription, setEmailSubscription] = React.useState(true)\n  const [\n    notificationSubscription,\n    setNotificationSubscription,\n  ] = React.useState(true)\n  const [autoCheckout, setAutoCheckout] = React.useState(false)\n\n  React.useEffect(() => {\n    if (visible) {\n      // Reset license agreement\n      setPending(false)\n      setHasError(false)\n      setSavedToLocalstorage(false)\n      setAgreement(false)\n    }\n  }, [visible])\n\n  React.useEffect(() => {\n    window.onbeforeunload = hasPendingChanges && !pending ? () => '' : null\n  }, [hasPendingChanges, pending])\n\n  return (\n    <React.Fragment>\n      {createPortal(\n        <div className=\"btn-group btn-group-community\">\n          <button\n            className=\"btn btn-default\"\n            onClick={() => {\n              dispatch(undo())\n            }}\n            disabled={!undoable}\n          >\n            <span className=\"fa fa-undo\" />\n          </button>\n          <button\n            className=\"btn btn-default\"\n            onClick={() => {\n              dispatch(redo())\n            }}\n            disabled={!redoable}\n          >\n            <span className=\"fa fa-repeat\" />\n          </button>\n          {renderSaveButton()}\n        </div>,\n        document.getElementsByClassName('controls')[0]\n      )}\n      <BSModal\n        show={visible}\n        onHide={() => {\n          setVisibility(false)\n        }}\n      >\n        <BSModal.Header closeButton>\n          <BSModal.Title>{i18n.t('edtr-io::Save')}</BSModal.Title>\n        </BSModal.Header>\n        <BSModal.Body>\n          {renderAlert()}\n          {renderChanges()}\n          {renderLicense()}\n          {renderSubscription()}\n          {renderCheckout()}\n        </BSModal.Body>\n        <BSModal.Footer>\n          <BSButton\n            onClick={() => {\n              setVisibility(false)\n            }}\n          >\n            {i18n.t('edtr-io::Cancel')}\n          </BSButton>\n          <BSButton\n            onClick={() => {\n              handleSave()\n            }}\n            bsStyle=\"success\"\n            disabled={!maySave() || pending}\n            title={getSaveHint()}\n          >\n            {pending ? i18n.t('edtr-io::Savingâ€¦') : i18n.t('edtr-io::Save')}\n          </BSButton>\n        </BSModal.Footer>\n      </BSModal>\n    </React.Fragment>\n  )\n\n  function renderSaveButton() {\n    const useOverlay = props.changes || props.license || props.subscriptions\n    const buttonProps = useOverlay\n      ? {\n          onClick() {\n            setVisibility(true)\n          },\n          disabled: !hasPendingChanges,\n          children: <span className=\"fa fa-save\" />,\n        }\n      : {\n          onClick() {\n            handleSave()\n          },\n          disabled: !hasPendingChanges || !maySave() || pending,\n          children: pending ? (\n            <span className=\"fa fa-spinner fa-spin\" />\n          ) : (\n            <span className=\"fa fa-save\" />\n          ),\n        }\n\n    return <button className=\"btn btn-success\" {...buttonProps} />\n  }\n\n  function licenseAccepted() {\n    return !props.license || agreement\n  }\n  function changesFilledIn() {\n    return !props.changes || props.changes.value\n  }\n  function maySave() {\n    return licenseAccepted() && changesFilledIn()\n  }\n\n  function getSaveHint() {\n    if (maySave()) return undefined\n    if (licenseAccepted() && !changesFilledIn()) {\n      return i18n.t('edtr-io::You need to fill out the changes you made')\n    } else if (!licenseAccepted() && changesFilledIn()) {\n      return i18n.t('edtr-io::You need to accept the license terms')\n    } else {\n      return i18n.t(\n        'edtr-io::You need to fill out the changes you made and accept the license terms'\n      )\n    }\n  }\n\n  function handleSave() {\n    if (!maySave()) return\n    const serializedRoot = serializeRootDocument()(store.getState())\n    const serialized = R.has('state', serializedRoot)\n      ? serializedRoot.state\n      : null\n\n    if (\n      serialized !== null &&\n      serializedRoot?.plugin === 'type-text-exercise-group' &&\n      R.has('cohesive', serialized)\n    ) {\n      // legacy server can only handle string attributes\n      serialized.cohesive = String(serialized.cohesive)\n    }\n\n    setPending(true)\n    onSave({\n      ...serialized,\n      csrf: getCsrfToken(),\n      controls: {\n        ...(props.subscriptions\n          ? {\n              subscription: {\n                subscribe: notificationSubscription ? 1 : 0,\n                mailman: emailSubscription ? 1 : 0,\n              },\n            }\n          : {}),\n        ...(mayCheckout\n          ? {\n              checkout: autoCheckout,\n            }\n          : {}),\n      },\n    })\n      .then(() => {\n        storeState(undefined)\n        setPending(false)\n        setHasError(false)\n      })\n      .catch(() => {\n        setPending(false)\n        setHasError(true)\n      })\n  }\n\n  function renderAlert() {\n    if (!hasError) return null\n    return (\n      <React.Fragment>\n        <BSAlert\n          bsStyle=\"danger\"\n          onDismiss={() => {\n            setHasError(false)\n          }}\n        >\n          {i18n.t('edtr-io::An error occurred during saving.')}\n          <br />\n          {i18n.t(\n            'edtr-io::You can store the revision locally, refresh the page and try to save again.'\n          )}\n        </BSAlert>\n        <BSModal.Footer>\n          <BSButton\n            bsStyle=\"success\"\n            onClick={() => {\n              const serializedRoot = serializeRootDocument()(store.getState())\n              storeState(serializedRoot)\n              setSavedToLocalstorage(true)\n            }}\n          >\n            {savedToLocalstorage\n              ? i18n.t('edtr-io::Revision saved')\n              : i18n.t('edtr-io::Save revision')}\n          </BSButton>\n        </BSModal.Footer>\n      </React.Fragment>\n    )\n  }\n\n  function renderChanges() {\n    const { changes } = props\n    if (!changes) return null\n    return (\n      <BSFormGroup controlId=\"changes\">\n        <BSControlLabel>{i18n.t('edtr-io::Changes')}</BSControlLabel>\n        <BSFormControl\n          componentClass=\"textarea\"\n          value={changes.value}\n          onChange={(e) => {\n            const { value } = e.target as HTMLTextAreaElement\n            changes.set(value)\n          }}\n        />\n      </BSFormGroup>\n    )\n  }\n\n  function renderCheckout() {\n    if (!mayCheckout) return null\n    return (\n      <BSCheckbox\n        checked={autoCheckout}\n        onChange={(e) => {\n          const { checked } = e.target as HTMLInputElement\n          setAutoCheckout(checked)\n        }}\n      >\n        {i18n.t('edtr-io::Skip peer review (not recommended)')}\n      </BSCheckbox>\n    )\n  }\n\n  function renderLicense() {\n    const { license } = props\n    if (!license) return null\n    return (\n      <BSCheckbox\n        checked={agreement}\n        onChange={(e) => {\n          const { checked } = e.target as HTMLInputElement\n          setAgreement(checked)\n        }}\n      >\n        <span dangerouslySetInnerHTML={{ __html: license.agreement.value }} />\n      </BSCheckbox>\n    )\n  }\n\n  function renderSubscription() {\n    const { subscriptions } = props\n    if (!subscriptions) return null\n    return (\n      <React.Fragment>\n        <BSCheckbox\n          checked={notificationSubscription}\n          onChange={(e) => {\n            const { checked } = e.target as HTMLInputElement\n            setNotificationSubscription(checked)\n          }}\n        >\n          {i18n.t('edtr-io::Enable serlo.org notifications')}\n        </BSCheckbox>\n        <BSCheckbox\n          checked={emailSubscription}\n          onChange={(e) => {\n            const { checked } = e.target as HTMLInputElement\n            setEmailSubscription(checked)\n          }}\n        >\n          {i18n.t('edtr-io::Enable notifications via e-mail')}\n        </BSCheckbox>\n      </React.Fragment>\n    )\n  }\n}\n\nexport function entityType<\n  Ds extends Record<string, StateType>,\n  Childs extends Record<string, StateType>\n>(\n  ownTypes: Ds,\n  children: Childs,\n  getFocusableChildren?: (\n    children: { [K in keyof Ds]: { id: string }[] }\n  ) => { id: string }[]\n): StateType<\n  StateTypesSerializedType<Ds & Childs>,\n  StateTypesValueType<Ds & Childs>,\n  StateTypesReturnType<Ds & Childs> & {\n    replaceOwnState: (newValue: StateTypesSerializedType<Ds>) => void\n  }\n> {\n  const objectType = object<Ds & Childs>(\n    { ...ownTypes, ...children },\n    getFocusableChildren\n  )\n  return {\n    ...objectType,\n    init(state, onChange) {\n      const initialisedObject = objectType.init(state, onChange)\n      return {\n        ...initialisedObject,\n        replaceOwnState(newValue) {\n          onChange((previousState, helpers) => {\n            return R.mapObjIndexed((_value, key) => {\n              if (key in ownTypes) {\n                return ownTypes[key].deserialize(newValue[key], helpers)\n              } else {\n                return previousState[key]\n              }\n            }, previousState) as StateTypesValueType<Ds & Childs>\n          })\n        },\n      }\n    },\n  }\n}\n\nexport function serialized<S extends StateType>(type: S) {\n  return {\n    ...type,\n    serialize(...args: Parameters<typeof type.serialize>) {\n      return JSON.stringify(type.serialize(...args))\n    },\n    deserialize(\n      serialized: string,\n      helpers: Parameters<typeof type.deserialize>[1]\n    ) {\n      return type.deserialize(JSON.parse(serialized), helpers)\n    },\n  }\n}\n\nexport function editorContent(\n  plugin: string = 'rows'\n): StateType<\n  string,\n  StateTypeValueType<ReturnType<typeof child>>,\n  StateTypeReturnType<ReturnType<typeof child>>\n> {\n  const originalChild = child<string>({ plugin })\n  return {\n    ...originalChild,\n    serialize(...args: Parameters<typeof originalChild.serialize>) {\n      return JSON.stringify(originalChild.serialize(...args))\n    },\n    deserialize(\n      serialized: string,\n      helpers: Parameters<typeof originalChild.deserialize>[1]\n    ) {\n      return originalChild.deserialize(JSON.parse(serialized), helpers)\n    },\n  }\n}\n\nexport function serializedChild(\n  plugin: string\n): StateType<\n  unknown,\n  StateTypeValueType<ReturnType<typeof child>>,\n  StateTypeReturnType<ReturnType<typeof child>>\n> {\n  const originalChild = child({ plugin, config: { skipControls: true } })\n  return {\n    ...originalChild,\n    serialize(...args: Parameters<typeof originalChild.serialize>) {\n      return originalChild.serialize(...args).state\n    },\n    deserialize(\n      serialized: string,\n      helpers: Parameters<typeof originalChild.deserialize>[1]\n    ) {\n      return originalChild.deserialize(\n        {\n          plugin,\n          state: serialized,\n        },\n        helpers\n      )\n    },\n  }\n}\n\nexport function optionalSerializedChild(\n  plugin: string\n): StateType<\n  StateTypeSerializedType<ReturnType<typeof serializedChild>> | null,\n  StateTypeValueType<ReturnType<typeof serializedChild>> | null,\n  StateTypeReturnType<ReturnType<typeof serializedChild>> & {\n    create: (state?: unknown) => void\n    remove: () => void\n  }\n> {\n  const child = serializedChild(plugin)\n  return {\n    ...child,\n    init(\n      state: string,\n      onChange: (updater: StateUpdater<string | null>) => void\n    ) {\n      return {\n        ...child.init(state, (updater) => {\n          onChange((oldId, helpers) => {\n            return updater(oldId || '', helpers)\n          })\n        }),\n        create(state?: unknown) {\n          onChange((_oldId, helpers) => {\n            if (typeof state !== 'undefined') {\n              return child.deserialize(state, helpers)\n            }\n            return child.createInitialState(helpers)\n          })\n        },\n        remove() {\n          onChange(() => null)\n        },\n      }\n    },\n    serialize(\n      deserialized: string | null,\n      helpers: Parameters<typeof child.serialize>[1]\n    ) {\n      if (!deserialized) return null\n      return child.serialize(deserialized, helpers)\n    },\n    deserialize(\n      serialized: string | null,\n      helpers: Parameters<typeof child.deserialize>[1]\n    ) {\n      if (!serialized) return null\n      return child.deserialize(serialized, helpers)\n    },\n    createInitialState() {\n      return null\n    },\n    getFocusableChildren(child) {\n      return child ? [{ id: child }] : []\n    },\n  }\n}\n\nexport function OptionalChild(props: {\n  removeLabel: string\n  state: StateTypeReturnType<ReturnType<typeof serializedChild>>\n  onRemove: () => void\n}) {\n  const expectedStateType = object(entity)\n  const document = useScopedSelector(getDocument(props.state.id)) as {\n    state: StateTypeValueType<typeof expectedStateType>\n  }\n  const children = props.state.render({\n    renderToolbar(children) {\n      if (document.state.id !== 0) return children\n\n      return (\n        <React.Fragment>\n          <PluginToolbarButton\n            icon={<Icon icon={faTrashAlt} />}\n            label={props.removeLabel}\n            onClick={() => {\n              props.onRemove()\n            }}\n          />\n          {children}\n        </React.Fragment>\n      )\n    },\n  })\n  return (\n    <React.Fragment>\n      <hr />\n      {children}\n    </React.Fragment>\n  )\n}\n\ninterface OwnProps {\n  changes?: StateTypeReturnType<typeof entity['changes']>\n  license?: StateTypeReturnType<typeof entity['license']>\n  subscriptions?: boolean\n}\n","/**\n * This file is part of Serlo.org.\n *\n * Copyright (c) 2013-2021 Serlo Education e.V.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\")\n * you may not use this file except in compliance with the License\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * @copyright Copyright (c) 2013-2021 Serlo Education e.V.\n * @license   http://www.apache.org/licenses/LICENSE-2.0 Apache License 2.0\n * @link      https://github.com/serlo-org/serlo.org for the canonical source repository\n */\nimport { faHistory } from '@fortawesome/free-solid-svg-icons/faHistory'\nimport { StateTypeReturnType, string } from '@edtr-io/plugin'\nimport { Icon, faCheck, styled } from '@edtr-io/ui'\nimport { PluginToolbarButton } from '@edtr-io/core'\nimport { useI18n } from '@serlo/i18n'\nimport moment from 'moment'\nimport * as React from 'react'\nimport BSButton from 'react-bootstrap/lib/Button'\nimport BSFormControl from 'react-bootstrap/lib/FormControl'\nimport BSControlLabel from 'react-bootstrap/lib/ControlLabel'\nimport BSFormGroup from 'react-bootstrap/lib/FormGroup'\nimport BSModal from 'react-bootstrap/lib/Modal'\nimport BSTable from 'react-bootstrap/lib/Table'\nimport fetch from 'unfetch'\n\nimport { deserialize, isError } from '../../../deserialize'\n\nconst StyledTR = styled.tr<{ selected: boolean }>((props) => {\n  return props.selected\n    ? {\n        border: '3px solid rgb(0,100,0)',\n      }\n    : {\n        cursor: 'pointer',\n      }\n})\n\ninterface RevisionData {\n  id: number\n  timestamp: string\n  author: string\n  changes: string\n  active: boolean\n}\n\nexport function RevisionHistory<T>(\n  props: React.PropsWithChildren<{\n    id: number\n    currentRevision: number\n    onSwitchRevision: (data: T) => void\n  }>\n) {\n  const [availableRevisions, setAvailableRevisions] = React.useState<\n    RevisionData[]\n  >([])\n  const i18n = useI18n()\n\n  const [showRevisions, setShowRevisions] = React.useState(false)\n  React.useEffect(() => {\n    if (props.id !== 0) {\n      fetch(`/entity/repository/get-revisions/${props.id}`)\n        .then((response) => response.json())\n        .then((data: RevisionData[]) => {\n          setAvailableRevisions(data)\n        })\n    }\n  }, [props.id])\n\n  return (\n    <div>\n      <span\n        onClick={() => {\n          if (availableRevisions.length) {\n            setShowRevisions(true)\n          }\n        }}\n      >\n        <PluginToolbarButton\n          icon={<Icon icon={faHistory} size=\"lg\" />}\n          label={i18n.t('edtr-io::Switch to another revision')}\n        />\n      </span>\n      <BSModal\n        show={showRevisions}\n        onHide={() => {\n          setShowRevisions(false)\n        }}\n        bsSize=\"lg\"\n      >\n        <BSModal.Header closeButton>\n          <BSModal.Title>\n            {i18n.t('edtr-io::Switch to another revision')}\n          </BSModal.Title>\n        </BSModal.Header>\n        <BSModal.Body>\n          <BSTable striped hover>\n            <thead>\n              <tr>\n                <th>#</th>\n                <th>{i18n.t('edtr-io::Current')}</th>\n                <th>{i18n.t('edtr-io::Changes')}</th>\n                <th>{i18n.t('edtr-io::Author')}</th>\n                <th>{i18n.t('edtr-io::Created at')}</th>\n              </tr>\n            </thead>\n            <tbody>\n              {availableRevisions.map((revisionData) => {\n                const selected = props.currentRevision\n                  ? props.currentRevision === revisionData.id\n                  : revisionData.active\n\n                const dateTime = moment.utc(revisionData.timestamp).local()\n                return (\n                  <StyledTR\n                    selected={selected}\n                    onClick={() => {\n                      // don't select the current selected\n                      if (selected) return\n\n                      fetch(\n                        `/entity/repository/get-revision-data/${props.id}/${revisionData.id}`\n                      )\n                        .then((response) => response.json())\n                        .then((data: { state: unknown; type: string }) => {\n                          const deserialized = deserialize({\n                            initialState: data.state,\n                            type: data.type,\n                          })\n                          if (isError(deserialized)) {\n                            alert(deserialized.error)\n                          } else {\n                            props.onSwitchRevision(\n                              deserialized.initialState.state as T\n                            )\n                            setShowRevisions(false)\n                          }\n                        })\n                    }}\n                    key={revisionData.id}\n                  >\n                    <td>{revisionData.id}</td>\n                    <td>\n                      {revisionData.active ? <Icon icon={faCheck} /> : null}\n                    </td>\n                    <th>{revisionData.changes}</th>\n                    <td>{revisionData.author}</td>\n                    <td title={dateTime.format('LL, LTS')}>\n                      {dateTime.fromNow()}\n                    </td>\n                  </StyledTR>\n                )\n              })}\n            </tbody>\n          </BSTable>\n        </BSModal.Body>\n        <BSModal.Footer>\n          <BSButton\n            onClick={() => {\n              setShowRevisions(false)\n            }}\n          >\n            SchlieÃŸen\n          </BSButton>\n        </BSModal.Footer>\n      </BSModal>\n    </div>\n  )\n}\n\nexport function Settings(props: React.PropsWithChildren<{}>) {\n  return <React.Fragment>{props.children}</React.Fragment>\n}\n\nSettings.Textarea = function SettingsTextarea({\n  label,\n  state,\n}: {\n  label: string\n  state: StateTypeReturnType<ReturnType<typeof string>>\n}) {\n  return (\n    <BSFormGroup>\n      <BSControlLabel>{label}</BSControlLabel>\n      <BSFormControl\n        componentClass=\"textarea\"\n        value={state.value}\n        onChange={(e) => {\n          const { value } = e.target as HTMLTextAreaElement\n          state.set(value)\n        }}\n      />\n    </BSFormGroup>\n  )\n}\n\nSettings.Select = function SettingsSelect({\n  label,\n  state,\n  options,\n}: {\n  label: string\n  state: StateTypeReturnType<ReturnType<typeof string>>\n  options: { label: string; value: string }[]\n}) {\n  return (\n    <BSFormGroup controlId=\"formControlsSelect\">\n      <BSControlLabel>{label}</BSControlLabel>\n      <BSFormControl\n        componentClass=\"select\"\n        placeholder=\"select\"\n        value={state.value}\n        onChange={(e) => {\n          const { value } = e.target as HTMLSelectElement\n          state.set(value)\n        }}\n      >\n        {options.map((option) => {\n          return (\n            <option key={option.value} value={option.value}>\n              {option.label}\n            </option>\n          )\n        })}\n      </BSFormControl>\n    </BSFormGroup>\n  )\n}\n","/**\n * This file is part of Serlo.org.\n *\n * Copyright (c) 2013-2021 Serlo Education e.V.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\")\n * you may not use this file except in compliance with the License\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * @copyright Copyright (c) 2013-2021 Serlo Education e.V.\n * @license   http://www.apache.org/licenses/LICENSE-2.0 Apache License 2.0\n * @link      https://github.com/serlo-org/serlo.org for the canonical source repository\n */\nimport { EditorPlugin, EditorPluginProps, string } from '@edtr-io/plugin'\nimport { useI18n } from '@serlo/i18n'\nimport * as React from 'react'\n\nimport {\n  entity,\n  Controls,\n  editorContent,\n  serializedChild,\n  HeaderInput,\n  entityType,\n} from './common'\nimport { Settings, RevisionHistory } from './helpers/settings'\n\nexport const appletTypeState = entityType(\n  {\n    ...entity,\n    title: string(),\n    content: editorContent(),\n    reasoning: editorContent(),\n    meta_title: string(),\n    meta_description: string(),\n    url: serializedChild('geogebra'),\n  },\n  {}\n)\n\nexport const appletTypePlugin: EditorPlugin<typeof appletTypeState> = {\n  Component: AppletTypeEditor,\n  state: appletTypeState,\n  config: {},\n}\n\nfunction AppletTypeEditor(props: EditorPluginProps<typeof appletTypeState>) {\n  const { title, url, content, meta_title, meta_description } = props.state\n  const i18n = useI18n()\n\n  return (\n    <div>\n      <div className=\"page-header\">\n        {props.renderIntoToolbar(\n          <RevisionHistory\n            id={props.state.id.value}\n            currentRevision={props.state.revision.value}\n            onSwitchRevision={props.state.replaceOwnState}\n          />\n        )}\n        {props.renderIntoSettings(\n          <Settings>\n            <Settings.Textarea\n              label={i18n.t('applet::Title for search engines')}\n              state={meta_title}\n            />\n            <Settings.Textarea\n              label={i18n.t('applet::Description for search engines')}\n              state={meta_description}\n            />\n          </Settings>\n        )}\n        <h1>\n          {props.editable ? (\n            <HeaderInput\n              placeholder={i18n.t('applet::Title')}\n              value={title.value}\n              onChange={(e: React.ChangeEvent<HTMLInputElement>) => {\n                title.set(e.target.value)\n              }}\n            />\n          ) : (\n            <span itemProp=\"name\">{title.value}</span>\n          )}\n        </h1>\n      </div>\n      <article>\n        {url.render()}\n        {content.render()}\n      </article>\n      <Controls subscriptions {...props.state} />\n    </div>\n  )\n}\n","/**\n * This file is part of Serlo.org.\n *\n * Copyright (c) 2013-2021 Serlo Education e.V.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\")\n * you may not use this file except in compliance with the License\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * @copyright Copyright (c) 2013-2021 Serlo Education e.V.\n * @license   http://www.apache.org/licenses/LICENSE-2.0 Apache License 2.0\n * @link      https://github.com/serlo-org/serlo.org for the canonical source repository\n */\nimport * as React from 'react'\nimport { EditorPlugin, EditorPluginProps, string } from '@edtr-io/plugin'\nimport { useI18n } from '@serlo/i18n'\n\nimport {\n  Controls,\n  editorContent,\n  entity,\n  HeaderInput,\n  entityType,\n} from './common'\nimport { RevisionHistory, Settings } from './helpers/settings'\n\nexport const articleTypeState = entityType(\n  {\n    ...entity,\n    title: string(),\n    content: editorContent('article'),\n    reasoning: editorContent(),\n    meta_title: string(),\n    meta_description: string(),\n  },\n  {}\n)\n\nexport const articleTypePlugin: EditorPlugin<typeof articleTypeState> = {\n  Component: ArticleTypeEditor,\n  state: articleTypeState,\n  config: {},\n}\n\nfunction ArticleTypeEditor(props: EditorPluginProps<typeof articleTypeState>) {\n  const { title, content, meta_title, meta_description } = props.state\n  const i18n = useI18n()\n\n  return (\n    <React.Fragment>\n      <div className=\"page-header\">\n        {props.renderIntoToolbar(\n          <RevisionHistory\n            id={props.state.id.value}\n            currentRevision={props.state.revision.value}\n            onSwitchRevision={props.state.replaceOwnState}\n          />\n        )}\n        {props.renderIntoSettings(\n          <Settings>\n            <Settings.Textarea\n              label={i18n.t('article::Title for search engines')}\n              state={meta_title}\n            />\n            <Settings.Textarea\n              label={i18n.t('article::Description for search engines')}\n              state={meta_description}\n            />\n          </Settings>\n        )}\n        <h1>\n          {props.editable ? (\n            <HeaderInput\n              placeholder={i18n.t('article::Title')}\n              value={title.value}\n              onChange={(e: React.ChangeEvent<HTMLInputElement>) => {\n                title.set(e.target.value)\n              }}\n            />\n          ) : (\n            <span itemProp=\"name\">{title.value}</span>\n          )}\n        </h1>\n      </div>\n      <div itemProp=\"articleBody\">{content.render()}</div>\n      <Controls subscriptions {...props.state} />\n    </React.Fragment>\n  )\n}\n","/**\n * This file is part of Serlo.org.\n *\n * Copyright (c) 2013-2021 Serlo Education e.V.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\")\n * you may not use this file except in compliance with the License\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * @copyright Copyright (c) 2013-2021 Serlo Education e.V.\n * @license   http://www.apache.org/licenses/LICENSE-2.0 Apache License 2.0\n * @link      https://github.com/serlo-org/serlo.org for the canonical source repository\n */\nimport * as React from 'react'\nimport { AddButton } from '@edtr-io/editor-ui/internal'\nimport { EditorPlugin, EditorPluginProps, list, string } from '@edtr-io/plugin'\nimport { useI18n } from '@serlo/i18n'\n\nimport {\n  editorContent,\n  entity,\n  Controls,\n  serializedChild,\n  HeaderInput,\n  OptionalChild,\n  entityType,\n} from './common'\nimport { RevisionHistory, Settings } from './helpers/settings'\n\nexport const courseTypeState = entityType(\n  {\n    ...entity,\n    title: string(),\n    description: editorContent(),\n    reasoning: editorContent(),\n    meta_description: string(),\n  },\n  {\n    'course-page': list(serializedChild('type-course-page')),\n  }\n)\n\nexport const courseTypePlugin: EditorPlugin<typeof courseTypeState> = {\n  Component: CourseTypeEditor,\n  state: courseTypeState,\n  config: {},\n}\n\nfunction CourseTypeEditor(props: EditorPluginProps<typeof courseTypeState>) {\n  const { title, meta_description, 'course-page': children } = props.state\n  const i18n = useI18n()\n\n  return (\n    <article>\n      {props.renderIntoToolbar(\n        <RevisionHistory\n          id={props.state.id.value}\n          currentRevision={props.state.revision.value}\n          onSwitchRevision={props.state.replaceOwnState}\n        />\n      )}\n      {props.renderIntoSettings(\n        <Settings>\n          <Settings.Textarea\n            label={i18n.t('course::Description for search engines')}\n            state={meta_description}\n          />\n        </Settings>\n      )}\n      <h1>\n        {props.editable ? (\n          <HeaderInput\n            placeholder={i18n.t('course::Title')}\n            value={title.value}\n            onChange={(e: React.ChangeEvent<HTMLInputElement>) => {\n              title.set(e.target.value)\n            }}\n          />\n        ) : (\n          <span itemProp=\"name\">{title.value}</span>\n        )}\n      </h1>\n      {children.map((child, index) => {\n        return (\n          <OptionalChild\n            state={child}\n            key={child.id}\n            removeLabel={i18n.t('course::Remove course page')}\n            onRemove={() => {\n              children.remove(index)\n            }}\n          />\n        )\n      })}\n      <hr />\n      <AddButton onClick={() => children.insert()}>\n        {i18n.t('course::Add course page')}\n      </AddButton>\n      <Controls subscriptions {...props.state} />\n    </article>\n  )\n}\n","/**\n * This file is part of Serlo.org.\n *\n * Copyright (c) 2013-2021 Serlo Education e.V.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\")\n * you may not use this file except in compliance with the License\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * @copyright Copyright (c) 2013-2021 Serlo Education e.V.\n * @license   http://www.apache.org/licenses/LICENSE-2.0 Apache License 2.0\n * @link      https://github.com/serlo-org/serlo.org for the canonical source repository\n */\nimport { EditorPlugin, EditorPluginProps, string } from '@edtr-io/plugin'\nimport { useI18n } from '@serlo/i18n'\nimport * as React from 'react'\n\nimport {\n  entity,\n  Controls,\n  editorContent,\n  HeaderInput,\n  entityType,\n} from './common'\nimport { RevisionHistory, Settings } from './helpers/settings'\n\nexport const coursePageTypeState = entityType(\n  {\n    ...entity,\n    icon: string('explanation'),\n    title: string(''),\n    content: editorContent(),\n  },\n  {}\n)\n\nexport const coursePageTypePlugin: EditorPlugin<\n  typeof coursePageTypeState,\n  { skipControls: boolean }\n> = {\n  Component: CoursePageTypeEditor,\n  state: coursePageTypeState,\n  config: {\n    skipControls: false,\n  },\n}\n\nfunction CoursePageTypeEditor(\n  props: EditorPluginProps<\n    typeof coursePageTypeState,\n    { skipControls: boolean }\n  >\n) {\n  const { title, icon, content } = props.state\n  const i18n = useI18n()\n\n  React.useEffect(() => {\n    if (!['explanation', 'play', 'question'].includes(icon.value)) {\n      icon.set('explanation')\n    }\n  }, [icon.value])\n  return (\n    <article>\n      {props.renderIntoToolbar(\n        <RevisionHistory\n          id={props.state.id.value}\n          currentRevision={props.state.revision.value}\n          onSwitchRevision={props.state.replaceOwnState}\n        />\n      )}\n      {props.renderIntoSettings(\n        <Settings>\n          <Settings.Select\n            label=\"Icon\"\n            state={icon}\n            options={[\n              {\n                label: i18n.t('coursePage::Explanation'),\n                value: 'explanation',\n              },\n              {\n                label: i18n.t('coursePage::Video'),\n                value: 'play',\n              },\n              {\n                label: i18n.t('coursePage::Question'),\n                value: 'question',\n              },\n            ]}\n          />\n        </Settings>\n      )}\n      <h1>\n        {props.editable ? (\n          <HeaderInput\n            placeholder={i18n.t('coursePage::Title')}\n            value={title.value}\n            onChange={(e: React.ChangeEvent<HTMLInputElement>) => {\n              title.set(e.target.value)\n            }}\n          />\n        ) : (\n          <span itemProp=\"name\">{title.value}</span>\n        )}\n      </h1>\n      {content.render()}\n      {props.config.skipControls ? null : (\n        <Controls subscriptions {...props.state} />\n      )}\n    </article>\n  )\n}\n","/**\n * This file is part of Serlo.org.\n *\n * Copyright (c) 2013-2021 Serlo Education e.V.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\")\n * you may not use this file except in compliance with the License\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * @copyright Copyright (c) 2013-2021 Serlo Education e.V.\n * @license   http://www.apache.org/licenses/LICENSE-2.0 Apache License 2.0\n * @link      https://github.com/serlo-org/serlo.org for the canonical source repository\n */\nimport { EditorPlugin, EditorPluginProps, string } from '@edtr-io/plugin'\nimport { useI18n } from '@serlo/i18n'\nimport * as React from 'react'\n\nimport {\n  editorContent,\n  entity,\n  Controls,\n  HeaderInput,\n  entityType,\n} from './common'\nimport { RevisionHistory, Settings } from './helpers/settings'\n\nexport const eventTypeState = entityType(\n  {\n    ...entity,\n    title: string(),\n    content: editorContent(),\n    meta_title: string(),\n    meta_description: string(),\n  },\n  {}\n)\n\nexport const eventTypePlugin: EditorPlugin<typeof eventTypeState> = {\n  Component: EventTypeEditor,\n  state: eventTypeState,\n  config: {},\n}\n\nfunction EventTypeEditor(props: EditorPluginProps<typeof eventTypeState>) {\n  const { content, title, meta_title, meta_description } = props.state\n  const i18n = useI18n()\n\n  return (\n    <React.Fragment>\n      <div className=\"page-header\">\n        {props.renderIntoToolbar(\n          <RevisionHistory\n            id={props.state.id.value}\n            currentRevision={props.state.revision.value}\n            onSwitchRevision={props.state.replaceOwnState}\n          />\n        )}\n        {props.renderIntoSettings(\n          <Settings>\n            <Settings.Textarea\n              label={i18n.t('event::Title for search engines')}\n              state={meta_title}\n            />\n            <Settings.Textarea\n              label={i18n.t('event::Description for search engines')}\n              state={meta_description}\n            />\n          </Settings>\n        )}\n        <h1>\n          {props.editable ? (\n            <HeaderInput\n              placeholder={i18n.t('event::Title')}\n              value={title.value}\n              onChange={(e: React.ChangeEvent<HTMLInputElement>) => {\n                title.set(e.target.value)\n              }}\n            />\n          ) : (\n            <span itemProp=\"name\">{title.value}</span>\n          )}\n        </h1>\n      </div>\n      <article>{content.render()}</article>\n      <Controls subscriptions {...props.state} />\n    </React.Fragment>\n  )\n}\n","/**\n * This file is part of Serlo.org.\n *\n * Copyright (c) 2013-2021 Serlo Education e.V.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\")\n * you may not use this file except in compliance with the License\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * @copyright Copyright (c) 2013-2021 Serlo Education e.V.\n * @license   http://www.apache.org/licenses/LICENSE-2.0 Apache License 2.0\n * @link      https://github.com/serlo-org/serlo.org for the canonical source repository\n */\nimport { EditorPlugin, EditorPluginProps, string } from '@edtr-io/plugin'\nimport { useI18n } from '@serlo/i18n'\nimport * as React from 'react'\n\nimport { entity, Controls, editorContent, entityType } from './common'\nimport { RevisionHistory, Settings } from './helpers/settings'\n\nexport const mathPuzzleTypeState = entityType(\n  {\n    ...entity,\n    source: string(),\n    content: editorContent(),\n  },\n  {}\n)\n\nexport const mathPuzzleTypePlugin: EditorPlugin<typeof mathPuzzleTypeState> = {\n  Component: MathPuzzleTypeEditor,\n  state: mathPuzzleTypeState,\n  config: {},\n}\n\nfunction MathPuzzleTypeEditor(\n  props: EditorPluginProps<typeof mathPuzzleTypeState>\n) {\n  const { source, content } = props.state\n  const i18n = useI18n()\n\n  return (\n    <React.Fragment>\n      {props.renderIntoToolbar(\n        <RevisionHistory\n          id={props.state.id.value}\n          currentRevision={props.state.revision.value}\n          onSwitchRevision={props.state.replaceOwnState}\n        />\n      )}\n      {props.renderIntoSettings(\n        <Settings>\n          <Settings.Textarea\n            label={i18n.t('mathPuzzle::Source code')}\n            state={source}\n          />\n        </Settings>\n      )}\n      <div className=\"math-puzzle\" data-source={source.value}>\n        {content.render()}\n      </div>\n      <Controls subscriptions {...props.state} />\n    </React.Fragment>\n  )\n}\n","/**\n * This file is part of Serlo.org.\n *\n * Copyright (c) 2013-2021 Serlo Education e.V.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\")\n * you may not use this file except in compliance with the License\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * @copyright Copyright (c) 2013-2021 Serlo Education e.V.\n * @license   http://www.apache.org/licenses/LICENSE-2.0 Apache License 2.0\n * @link      https://github.com/serlo-org/serlo.org for the canonical source repository\n */\nimport {\n  EditorPlugin,\n  EditorPluginProps,\n  object,\n  string,\n} from '@edtr-io/plugin'\nimport { useI18n } from '@serlo/i18n'\nimport * as React from 'react'\n\nimport { Controls, editorContent, HeaderInput, license, uuid } from './common'\n\nexport const pageTypeState = object({\n  ...uuid,\n  ...license,\n  title: string(),\n  content: editorContent(),\n})\n\nexport const pageTypePlugin: EditorPlugin<typeof pageTypeState> = {\n  Component: PageTypeEditor,\n  state: pageTypeState,\n  config: {},\n}\n\nfunction PageTypeEditor(props: EditorPluginProps<typeof pageTypeState>) {\n  const { title, content } = props.state\n  const i18n = useI18n()\n\n  return (\n    <article>\n      <header>\n        <div className=\"page-header\">\n          <h1>\n            {props.editable ? (\n              <HeaderInput\n                placeholder={i18n.t('page::Title')}\n                value={title.value}\n                onChange={(e: React.ChangeEvent<HTMLInputElement>) => {\n                  title.set(e.target.value)\n                }}\n              />\n            ) : (\n              <span itemProp=\"name\">{title.value}</span>\n            )}\n          </h1>\n        </div>\n      </header>\n      <section itemProp=\"articleBody\">{content.render()}</section>\n      <Controls {...props.state} />\n    </article>\n  )\n}\n","/**\n * This file is part of Serlo.org.\n *\n * Copyright (c) 2013-2021 Serlo Education e.V.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\")\n * you may not use this file except in compliance with the License\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * @copyright Copyright (c) 2013-2021 Serlo Education e.V.\n * @license   http://www.apache.org/licenses/LICENSE-2.0 Apache License 2.0\n * @link      https://github.com/serlo-org/serlo.org for the canonical source repository\n */\nimport {\n  EditorPlugin,\n  EditorPluginProps,\n  object,\n  string,\n  number,\n} from '@edtr-io/plugin'\nimport { useI18n } from '@serlo/i18n'\nimport * as React from 'react'\n\nimport { Controls, editorContent, HeaderInput, uuid } from './common'\n\nexport const taxonomyTypeState = object({\n  ...uuid,\n  term: object({\n    name: string(),\n  }),\n  taxonomy: number(),\n  parent: number(),\n  position: number(),\n  description: editorContent(),\n})\n\nexport const taxonomyTypePlugin: EditorPlugin<typeof taxonomyTypeState> = {\n  Component: TaxonomyTypeEditor,\n  state: taxonomyTypeState,\n  config: {},\n}\n\nfunction TaxonomyTypeEditor(\n  props: EditorPluginProps<typeof taxonomyTypeState>\n) {\n  const { term, description } = props.state\n  const i18n = useI18n()\n\n  return (\n    <article>\n      <header>\n        <div className=\"page-header\">\n          <h1>\n            {props.editable ? (\n              <HeaderInput\n                placeholder={i18n.t('taxonomy::Title')}\n                value={term.name.value}\n                onChange={(e: React.ChangeEvent<HTMLInputElement>) => {\n                  term.name.set(e.target.value)\n                }}\n              />\n            ) : (\n              <span itemProp=\"name\">{term.name.value}</span>\n            )}\n          </h1>\n        </div>\n      </header>\n      <section itemProp=\"articleBody\">{description.render()}</section>\n      <Controls />\n    </article>\n  )\n}\n","/**\n * This file is part of Serlo.org.\n *\n * Copyright (c) 2013-2021 Serlo Education e.V.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\")\n * you may not use this file except in compliance with the License\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * @copyright Copyright (c) 2013-2021 Serlo Education e.V.\n * @license   http://www.apache.org/licenses/LICENSE-2.0 Apache License 2.0\n * @link      https://github.com/serlo-org/serlo.org for the canonical source repository\n */\nimport { AddButton } from '@edtr-io/editor-ui/internal'\nimport { EditorPlugin, EditorPluginProps } from '@edtr-io/plugin'\nimport { useI18n } from '@serlo/i18n'\nimport * as React from 'react'\n\nimport {\n  editorContent,\n  entity,\n  Controls,\n  optionalSerializedChild,\n  OptionalChild,\n  entityType,\n} from './common'\n\nimport { RevisionHistory } from './helpers/settings'\n\nexport const textExerciseTypeState = entityType(\n  {\n    ...entity,\n    content: editorContent('exercise'),\n  },\n  {\n    'text-solution': optionalSerializedChild('type-text-solution'),\n  }\n)\n\nexport const textExerciseTypePlugin: EditorPlugin<\n  typeof textExerciseTypeState,\n  { skipControls: boolean }\n> = {\n  Component: TextExerciseTypeEditor,\n  state: textExerciseTypeState,\n  config: {\n    skipControls: false,\n  },\n}\n\nexport function TextExerciseTypeEditor(\n  props: EditorPluginProps<\n    typeof textExerciseTypeState,\n    { skipControls: boolean }\n  >\n) {\n  const { content, 'text-solution': textSolution } = props.state\n  const i18n = useI18n()\n\n  return (\n    <article className=\"text-exercise\">\n      {props.renderIntoToolbar(\n        <RevisionHistory\n          id={props.state.id.value}\n          currentRevision={props.state.revision.value}\n          onSwitchRevision={props.state.replaceOwnState}\n        />\n      )}\n      {content.render()}\n      {textSolution.id ? (\n        <OptionalChild\n          state={textSolution}\n          removeLabel={i18n.t('textExercise::Remove solution')}\n          onRemove={() => {\n            textSolution.remove()\n          }}\n        />\n      ) : (\n        <AddButton\n          onClick={() => {\n            textSolution.create()\n          }}\n        >\n          {i18n.t('textExercise::Create solution')}\n        </AddButton>\n      )}\n      {props.config.skipControls ? null : (\n        <Controls subscriptions {...props.state} />\n      )}\n    </article>\n  )\n}\n","/**\n * This file is part of Serlo.org.\n *\n * Copyright (c) 2013-2021 Serlo Education e.V.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\")\n * you may not use this file except in compliance with the License\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * @copyright Copyright (c) 2013-2021 Serlo Education e.V.\n * @license   http://www.apache.org/licenses/LICENSE-2.0 Apache License 2.0\n * @link      https://github.com/serlo-org/serlo.org for the canonical source repository\n */\nimport { Icon, styled } from '@edtr-io/ui'\nimport * as React from 'react'\nimport { FontAwesomeIconProps } from '@fortawesome/react-fontawesome'\n\nconst Container = styled.div({\n  boxShadow: '0 1px 3px 0 rgba(0,0,0,0.2)',\n  marginTop: '10px',\n  padding: '10px',\n  minHeight: '70px',\n  position: 'relative',\n})\n\nconst BackgroundIcon = styled.div({\n  position: 'absolute',\n  top: 0,\n  right: 0,\n  color: 'rgba(0,0,0,0.1)',\n  transform: 'translate(-15px, 10px)',\n  zIndex: 0,\n})\n\nexport function SemanticSection(props: SemanticSectionProps) {\n  const { children, editable } = props\n  if (!editable) return <React.Fragment>{children}</React.Fragment>\n\n  return <Container>{props.children}</Container>\n}\n\nexport interface SemanticSectionProps {\n  children: React.ReactNode\n  editable?: boolean\n}\n","/**\n * This file is part of Serlo.org.\n *\n * Copyright (c) 2013-2021 Serlo Education e.V.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\")\n * you may not use this file except in compliance with the License\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * @copyright Copyright (c) 2013-2021 Serlo Education e.V.\n * @license   http://www.apache.org/licenses/LICENSE-2.0 Apache License 2.0\n * @link      https://github.com/serlo-org/serlo.org for the canonical source repository\n */\nimport { AddButton } from '@edtr-io/editor-ui/internal'\nimport { boolean, EditorPlugin, EditorPluginProps, list } from '@edtr-io/plugin'\nimport { useI18n } from '@serlo/i18n'\nimport * as React from 'react'\n\nimport {\n  editorContent,\n  entity,\n  Controls,\n  serializedChild,\n  OptionalChild,\n  entityType,\n} from './common'\nimport { RevisionHistory } from './helpers/settings'\nimport { SemanticSection } from '../helpers/semantic-section'\nimport { useVirtual } from 'react-virtual'\n\nexport const textExerciseGroupTypeState = entityType(\n  {\n    ...entity,\n    content: editorContent(),\n    cohesive: boolean(false),\n  },\n  {\n    'grouped-text-exercise': list(serializedChild('type-text-exercise')),\n  }\n)\n\nexport const textExerciseGroupTypePlugin: EditorPlugin<\n  typeof textExerciseGroupTypeState\n> = {\n  Component: TextExerciseGroupTypeEditor,\n  state: textExerciseGroupTypeState,\n  config: {},\n}\n\nfunction TextExerciseGroupTypeEditor(\n  props: EditorPluginProps<typeof textExerciseGroupTypeState>\n) {\n  const { cohesive, content, 'grouped-text-exercise': children } = props.state\n  const i18n = useI18n()\n  const isCohesive = cohesive.value ?? false\n\n  const virtualParent = React.useRef(null)\n\n  const virtualizer = useVirtual({\n    size: children.length,\n    parentRef: virtualParent,\n    estimateSize: React.useCallback(() => 35, []),\n  })\n\n  const contentRendered = content.render({\n    renderSettings(children) {\n      return (\n        <React.Fragment>\n          {children}\n          {getSettings()}\n        </React.Fragment>\n      )\n    },\n  })\n\n  return (\n    <article className=\"exercisegroup\">\n      {props.renderIntoToolbar(\n        <RevisionHistory\n          id={props.state.id.value}\n          currentRevision={props.state.revision.value}\n          onSwitchRevision={props.state.replaceOwnState}\n        />\n      )}\n      <section className=\"row\">\n        <SemanticSection editable={props.editable}>\n          {contentRendered}\n        </SemanticSection>\n      </section>\n      <div\n        ref={virtualParent}\n        style={{\n          height: '100%',\n          overflow: 'auto',\n        }}\n      >\n        <div\n          style={{\n            height: `${virtualizer.totalSize}px`,\n            width: '100%',\n            position: 'relative',\n          }}\n        >\n          {virtualizer.virtualItems.map((virtualRow) => {\n            const child = children[virtualRow.index]\n            return (\n              <div\n                key={virtualRow.index}\n                ref={virtualRow.measureRef}\n                style={{\n                  position: 'absolute',\n                  top: 0,\n                  left: 0,\n                  width: '100%',\n                  transform: `translateY(${virtualRow.start}px)`,\n                }}\n              >\n                <section className=\"row\" key={child.id}>\n                  <div className=\"col-sm-1 hidden-xs\">\n                    <em>{getExerciseIndex(virtualRow.index)})</em>\n                  </div>\n                  <div className=\"col-sm-11 col-xs-12\">\n                    <OptionalChild\n                      state={child}\n                      removeLabel={i18n.t('textExerciseGroup::Remove exercise')}\n                      onRemove={() => children.remove(virtualRow.index)}\n                    />\n                  </div>\n                </section>\n              </div>\n            )\n          })}\n        </div>\n      </div>\n      <AddButton onClick={() => children.insert()}>\n        {i18n.t('textExerciseGroup::Add exercise')}\n      </AddButton>\n      <Controls subscriptions {...props.state} />\n    </article>\n  )\n\n  function getSettings() {\n    return (\n      <div>\n        <label htmlFor=\"cohesiveSelect\">\n          {i18n.t('textExerciseGroup::Kind of exercise group')}:\n        </label>{' '}\n        <select\n          id=\"cohesiveSelect\"\n          value={isCohesive ? 'cohesive' : 'non-cohesive'}\n          onChange={(e) => cohesive.set(e.target.value === 'cohesive')}\n        >\n          <option value=\"non-cohesive\">\n            {i18n.t('textExerciseGroup::not cohesive')}\n          </option>\n          <option value=\"cohesive\">\n            {i18n.t('textExerciseGroup::cohesive')}\n          </option>\n        </select>\n      </div>\n    )\n  }\n\n  function getExerciseIndex(index: number) {\n    return isCohesive ? index + 1 : String.fromCharCode(97 + index)\n  }\n}\n","/**\n * This file is part of Serlo.org.\n *\n * Copyright (c) 2013-2021 Serlo Education e.V.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\")\n * you may not use this file except in compliance with the License\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * @copyright Copyright (c) 2013-2021 Serlo Education e.V.\n * @license   http://www.apache.org/licenses/LICENSE-2.0 Apache License 2.0\n * @link      https://github.com/serlo-org/serlo.org for the canonical source repository\n */\nimport { EditorPlugin, EditorPluginProps } from '@edtr-io/plugin'\nimport { ExpandableBox } from '@edtr-io/renderer-ui'\nimport { ThemeProvider } from '@edtr-io/ui'\nimport { useI18n } from '@serlo/i18n'\nimport * as React from 'react'\n\nimport { Controls, editorContent, entity, entityType } from './common'\nimport { RevisionHistory } from './helpers/settings'\n\nexport const textSolutionTypeState = entityType(\n  {\n    ...entity,\n    content: editorContent('solution'),\n  },\n  {}\n)\nexport type TextSolutionTypeProps = EditorPluginProps<\n  typeof textSolutionTypeState,\n  { skipControls: boolean }\n>\n\nexport const textSolutionTypePlugin: EditorPlugin<\n  typeof textSolutionTypeState,\n  { skipControls: boolean }\n> = {\n  Component: TextSolutionTypeEditor,\n  state: textSolutionTypeState,\n  config: {\n    skipControls: false,\n  },\n}\n\nconst solutionTheme = {\n  rendererUi: {\n    expandableBox: {\n      toggleBackgroundColor: '#d9edf7',\n      containerBorderColor: '#d9edf7',\n    },\n  },\n}\n\nfunction TextSolutionTypeEditor(props: TextSolutionTypeProps) {\n  const i18n = useI18n()\n  const renderTitle = React.useCallback((collapsed: boolean) => {\n    return (\n      <React.Fragment>\n        {collapsed\n          ? i18n.t('solution::Show solution')\n          : i18n.t('solution::Hide solution')}\n      </React.Fragment>\n    )\n  }, [])\n\n  return (\n    <React.Fragment>\n      {props.renderIntoToolbar(\n        <RevisionHistory\n          id={props.state.id.value}\n          currentRevision={props.state.revision.value}\n          onSwitchRevision={props.state.replaceOwnState}\n        />\n      )}\n      <ThemeProvider theme={solutionTheme}>\n        <ExpandableBox renderTitle={renderTitle} editable={props.editable}>\n          {props.state.content.render()}\n        </ExpandableBox>\n      </ThemeProvider>\n      {props.config.skipControls ? null : (\n        <Controls subscriptions {...props.state} />\n      )}\n    </React.Fragment>\n  )\n}\n","/**\n * This file is part of Serlo.org.\n *\n * Copyright (c) 2013-2021 Serlo Education e.V.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\")\n * you may not use this file except in compliance with the License\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * @copyright Copyright (c) 2013-2021 Serlo Education e.V.\n * @license   http://www.apache.org/licenses/LICENSE-2.0 Apache License 2.0\n * @link      https://github.com/serlo-org/serlo.org for the canonical source repository\n */\nimport { EditorPlugin, EditorPluginProps, object } from '@edtr-io/plugin'\nimport * as React from 'react'\n\nimport { Controls, editorContent } from './common'\n\nexport const userTypeState = object({\n  description: editorContent(),\n})\n\nexport const userTypePlugin: EditorPlugin<typeof userTypeState> = {\n  Component: UserTypeEditor,\n  state: userTypeState,\n  config: {},\n}\n\nfunction UserTypeEditor(props: EditorPluginProps<typeof userTypeState>) {\n  const { description } = props.state\n\n  return (\n    <React.Fragment>\n      {description.render()}\n      <Controls />\n    </React.Fragment>\n  )\n}\n","/**\n * This file is part of Serlo.org.\n *\n * Copyright (c) 2013-2021 Serlo Education e.V.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\")\n * you may not use this file except in compliance with the License\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * @copyright Copyright (c) 2013-2021 Serlo Education e.V.\n * @license   http://www.apache.org/licenses/LICENSE-2.0 Apache License 2.0\n * @link      https://github.com/serlo-org/serlo.org for the canonical source repository\n */\nimport { EditorPlugin, EditorPluginProps, string } from '@edtr-io/plugin'\nimport { createVideoPlugin } from '@edtr-io/plugin-video'\nimport { useI18n } from '@serlo/i18n'\nimport * as React from 'react'\n\nimport {\n  entity,\n  Controls,\n  editorContent,\n  HeaderInput,\n  entityType,\n} from './common'\nimport { RevisionHistory } from './helpers/settings'\n\nexport const videoTypeState = entityType(\n  {\n    ...entity,\n    content: string(),\n    title: string(),\n    description: editorContent(),\n    reasoning: editorContent(),\n  },\n  {}\n)\n\nconst videoPlugin = createVideoPlugin()\n\nexport const videoTypePlugin: EditorPlugin<typeof videoTypeState> = {\n  Component: VideoTypeEditor,\n  state: videoTypeState,\n  config: {},\n}\n\nfunction VideoTypeEditor(props: EditorPluginProps<typeof videoTypeState>) {\n  const { title, description } = props.state\n  const i18n = useI18n()\n\n  return (\n    <section>\n      {props.renderIntoToolbar(\n        <RevisionHistory\n          id={props.state.id.value}\n          currentRevision={props.state.revision.value}\n          onSwitchRevision={props.state.replaceOwnState}\n        />\n      )}\n      <div className=\"page-header\">\n        <h1>\n          {props.editable ? (\n            <HeaderInput\n              placeholder={i18n.t('video::Title')}\n              value={title.value}\n              onChange={(e: React.ChangeEvent<HTMLInputElement>) => {\n                title.set(e.target.value)\n              }}\n            />\n          ) : (\n            <span itemProp=\"name\">{title.value}</span>\n          )}\n        </h1>\n      </div>\n      <article>\n        <section>\n          <videoPlugin.Component\n            {...props}\n            state={{\n              src: props.state.content,\n              alt: props.state.title,\n            }}\n            config={{\n              i18n: {\n                src: {\n                  label: i18n.t('video::URL'),\n                },\n                alt: {\n                  label: i18n.t('video::Title for search engines'),\n                },\n              },\n            }}\n          />\n        </section>\n        <section>{description.render()}</section>\n      </article>\n      <Controls subscriptions {...props.state} />\n    </section>\n  )\n}\n","/**\n * This file is part of Serlo.org.\n *\n * Copyright (c) 2013-2021 Serlo Education e.V.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\")\n * you may not use this file except in compliance with the License\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * @copyright Copyright (c) 2013-2021 Serlo Education e.V.\n * @license   http://www.apache.org/licenses/LICENSE-2.0 Apache License 2.0\n * @link      https://github.com/serlo-org/serlo.org for the canonical source repository\n */\nimport { styled } from '@edtr-io/ui'\nimport * as React from 'react'\n\nconst OverlayTriangle = styled.div<{ positionAbove: boolean }>((props) => {\n  const borderPosition = props.positionAbove ? 'borderTop' : 'borderBottom'\n  return {\n    position: 'relative',\n    width: 0,\n    height: 0,\n    borderLeft: '5px solid transparent',\n    borderRight: '5px solid transparent',\n    [borderPosition]: '10px solid rgba(51,51,51,0.95)',\n  }\n})\n\nconst InlineOverlayWrapper = styled.div({\n  position: 'absolute',\n  top: '-10000px',\n  left: '-10000px',\n  opacity: 0,\n  transition: 'opacity 0.5s',\n  zIndex: 95,\n  whiteSpace: 'nowrap',\n})\n\nconst InlineOverlayContentWrapper = styled.div({\n  boxShadow: '0 2px 4px 0 rgba(0,0,0,0.50)',\n  backgroundColor: 'rgba(51,51,51,0.95)',\n  color: '#ffffff',\n  borderRadius: '4px',\n  '& a': {\n    color: '#ffffff',\n    '&:hover': {\n      color: 'rgb(70, 155, 255)',\n    },\n  },\n})\n\nexport type HoverPosition = 'above' | 'below'\n\nexport function HoveringOverlay(props: {\n  children: React.ReactNode\n  position: HoverPosition\n  anchor?: React.RefObject<HTMLElement>\n  allowSelectionOverflow?: boolean\n}) {\n  const overlay = React.createRef<HTMLDivElement>()\n  const triangle = React.createRef<HTMLDivElement>()\n  const [positionAbove, setPositionAbove] = React.useState(\n    props.position === 'above'\n  )\n\n  React.useLayoutEffect(() => {\n    if (!overlay.current || !triangle.current) return\n    const menu = overlay.current\n    let rect = undefined\n    if (props.anchor && props.anchor.current !== null) {\n      rect = props.anchor.current.getBoundingClientRect()\n    } else {\n      const native = window.getSelection()\n      if (native && native.rangeCount > 0) {\n        const range = native.getRangeAt(0)\n        rect = range.getBoundingClientRect()\n      }\n    }\n    if (!rect) return\n    if (rect.height === 0) return\n    // menu is set to display:none, shouldn't ever happen\n    if (!menu.offsetParent) return\n    const parentRect = menu.offsetParent.getBoundingClientRect()\n    menu.style.opacity = '1'\n    const aboveValue = rect.top - menu.offsetHeight - 6\n    // if top becomes negative, place menu below\n    setPositionAbove(props.position == 'above' && aboveValue >= 0)\n    menu.style.top =\n      (positionAbove ? aboveValue : rect.bottom + 6) - parentRect.top + 'px'\n\n    menu.style.left = `${Math.min(\n      Math.max(\n        rect.left - parentRect.left - menu.offsetWidth / 2 + rect.width / 2,\n        0\n      ),\n      parentRect.width - menu.offsetWidth - 5\n    )}px`\n    triangle.current.style.left = `${\n      rect.left -\n      menu.offsetLeft -\n      parentRect.left -\n      triangle.current.offsetWidth / 2 +\n      rect.width / 2\n    }px`\n  }, [\n    overlay,\n    triangle,\n    props.position,\n    props.anchor,\n    positionAbove,\n    props.allowSelectionOverflow,\n  ])\n\n  return (\n    <InlineOverlayWrapper ref={overlay}>\n      {!positionAbove && (\n        <OverlayTriangle positionAbove={false} ref={triangle} />\n      )}\n      <InlineOverlayContentWrapper>\n        {props.children}\n      </InlineOverlayContentWrapper>\n      {positionAbove && <OverlayTriangle positionAbove ref={triangle} />}\n    </InlineOverlayWrapper>\n  )\n}\n","/**\n * This file is part of Serlo.org.\n *\n * Copyright (c) 2013-2021 Serlo Education e.V.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\")\n * you may not use this file except in compliance with the License\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * @copyright Copyright (c) 2013-2021 Serlo Education e.V.\n * @license   http://www.apache.org/licenses/LICENSE-2.0 Apache License 2.0\n * @link      https://github.com/serlo-org/serlo.org for the canonical source repository\n */\nimport { faTrashAlt, Icon, styled } from '@edtr-io/ui'\nimport * as React from 'react'\n\nimport { HoveringOverlay, HoverPosition } from './hovering-overlay'\n\nconst InlinePreview = styled.span({\n  padding: '0px 8px',\n})\nconst ChangeButton = styled.div({\n  padding: '5px 5px 5px 10px',\n  display: 'inline-block',\n  borderLeft: '2px solid rgba(51,51,51,0.95)',\n  cursor: 'pointer',\n  margin: '2px',\n  '&:hover': {\n    color: 'rgb(70, 155, 255)',\n  },\n})\n\nexport function InlineSettings({\n  position = 'below',\n  ...props\n}: {\n  children: React.ReactNode\n  onDelete: React.MouseEventHandler\n  position: HoverPosition\n  anchor?: React.RefObject<HTMLElement>\n}) {\n  return (\n    <HoveringOverlay position={position} anchor={props.anchor}>\n      <InlinePreview>{props.children}</InlinePreview>\n      <ChangeButton onClick={props.onDelete}>\n        <Icon icon={faTrashAlt} />\n      </ChangeButton>\n    </HoveringOverlay>\n  )\n}\n","/**\n * This file is part of Serlo.org.\n *\n * Copyright (c) 2013-2021 Serlo Education e.V.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\")\n * you may not use this file except in compliance with the License\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * @copyright Copyright (c) 2013-2021 Serlo Education e.V.\n * @license   http://www.apache.org/licenses/LICENSE-2.0 Apache License 2.0\n * @link      https://github.com/serlo-org/serlo.org for the canonical source repository\n */\nimport { styled } from '@edtr-io/ui'\nimport * as React from 'react'\n\nconst InlineInputInner = styled.input({\n  backgroundColor: 'transparent',\n  border: 'none',\n  borderBottom: '2px solid #ffffff',\n  color: '#ffffff',\n  '&:focus': {\n    outline: 'none',\n    borderBottom: '2px solid rgb(70, 155, 255)',\n  },\n})\n\nconst InlineInputRefForward: React.RefForwardingComponent<\n  HTMLInputElement,\n  InputProps\n> = (props, ref) => {\n  return <InlineInputInner {...props} ref={ref} />\n}\nexport const InlineSettingsInput = React.forwardRef(InlineInputRefForward)\n\nexport interface InputProps\n  extends React.DetailedHTMLProps<\n    React.InputHTMLAttributes<HTMLInputElement>,\n    HTMLInputElement\n  > {\n  label?: string\n  textfieldWidth?: string\n  editorInputWidth?: string\n}\n","/**\n * This file is part of Serlo.org.\n *\n * Copyright (c) 2013-2021 Serlo Education e.V.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\")\n * you may not use this file except in compliance with the License\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * @copyright Copyright (c) 2013-2021 Serlo Education e.V.\n * @license   http://www.apache.org/licenses/LICENSE-2.0 Apache License 2.0\n * @link      https://github.com/serlo-org/serlo.org for the canonical source repository\n */\nimport * as React from 'react'\n// @ts-ignore\nimport Plain from 'slate-plain-serializer'\n// @ts-ignore\nimport { Editor } from 'slate-react'\n\nexport function InlineInput(props: {\n  onChange: (value: string) => void\n  onFocus?: () => void\n  value: string\n  placeholder: string\n}) {\n  const { onChange, value, placeholder } = props\n  const [state, setState] = React.useState(Plain.deserialize(value))\n  React.useEffect(() => {\n    if (Plain.serialize(state) !== value) {\n      setState(Plain.deserialize(value))\n    }\n  }, [value])\n\n  return (\n    <Editor\n      placeholder={placeholder}\n      value={state}\n      onFocus={(event: any, editor: any, next: () => void) => {\n        setTimeout(() => {\n          if (typeof props.onFocus === 'function') {\n            props.onFocus()\n          }\n        })\n        next()\n      }}\n      onChange={({ value }: any) => {\n        setState(value)\n        onChange(Plain.serialize(value))\n      }}\n    />\n  )\n}\n","/**\n * This file is part of Serlo.org.\n *\n * Copyright (c) 2013-2021 Serlo Education e.V.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\")\n * you may not use this file except in compliance with the License\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * @copyright Copyright (c) 2013-2021 Serlo Education e.V.\n * @license   http://www.apache.org/licenses/LICENSE-2.0 Apache License 2.0\n * @link      https://github.com/serlo-org/serlo.org for the canonical source repository\n */\nimport { AddButton } from '@edtr-io/editor-ui/internal'\nimport {\n  child,\n  EditorPlugin,\n  EditorPluginProps,\n  list,\n  object,\n  string,\n} from '@edtr-io/plugin'\nimport * as R from 'ramda'\nimport * as React from 'react'\nimport { DragDropContext, Draggable, Droppable } from 'react-beautiful-dnd'\n\nimport { SemanticSection } from './helpers/semantic-section'\nimport { PluginToolbarButton } from '@edtr-io/core'\nimport {\n  edtrDragHandle,\n  EdtrIcon,\n  faExternalLinkAlt,\n  faTrashAlt,\n  Icon,\n  styled,\n} from '@edtr-io/ui'\nimport { InlineSettings } from './helpers/inline-settings'\nimport { InlineSettingsInput } from './helpers/inline-settings-input'\nimport { InlineInput } from './helpers/inline-input'\nimport { ExpandableBox } from '@edtr-io/renderer-ui'\nimport { ThemeProvider } from 'styled-components'\nimport { useI18n } from '@serlo/i18n'\nimport { faGraduationCap } from '@fortawesome/free-solid-svg-icons/faGraduationCap'\nimport { faNewspaper } from '@fortawesome/free-solid-svg-icons'\nimport { faPlayCircle } from '@fortawesome/free-solid-svg-icons/faPlayCircle'\n\nconst relatedContentItemState = object({ id: string(), title: string() })\n\nconst articleState = object({\n  introduction: child({ plugin: 'articleIntroduction' }),\n  content: child({ plugin: 'rows' }),\n  exercises: list(child({ plugin: 'injection' })),\n  exerciseFolder: relatedContentItemState,\n  relatedContent: object({\n    articles: list(relatedContentItemState),\n    courses: list(relatedContentItemState),\n    videos: list(relatedContentItemState),\n  }),\n  sources: list(\n    object({\n      href: string(),\n      title: string(),\n    })\n  ),\n})\n\nexport type ArticlePluginState = typeof articleState\nexport type ArticleProps = EditorPluginProps<ArticlePluginState>\n\nexport const articlePlugin: EditorPlugin<ArticlePluginState> = {\n  Component: ArticleEditor,\n  state: articleState,\n  config: {},\n}\n\nconst OpenInNewTab = styled.span({ margin: '0 0 0 10px' })\n\nconst BasePluginToolbarButton = styled.button({\n  background: 'none',\n  border: 'none',\n})\n\nconst MinWidthIcon = styled.div({\n  width: '24px',\n})\n\nconst PluginToolbarButtonIcon = styled.div({\n  height: '24px',\n  width: '24px',\n  opacity: 0.8,\n  cursor: 'pointer',\n  color: 'rgba(51, 51, 51, 0.95)',\n\n  '&:hover': {\n    color: '#469bff',\n  },\n})\n\nconst spoilerTheme = {\n  rendererUi: {\n    expandableBox: {\n      toggleBackgroundColor: '#f5f5f5',\n      toggleColor: '#333',\n      containerBorderColor: '#f5f5f5',\n    },\n  },\n}\n\nfunction ArticleEditor(props: ArticleProps) {\n  const { editable, state } = props\n  const {\n    introduction,\n    content,\n    exercises,\n    exerciseFolder,\n    relatedContent,\n    sources,\n  } = state\n\n  const i18n = useI18n()\n  const [focusedInlineSetting, setFocusedInlineSetting] = React.useState<{\n    id: string\n    index?: number\n  } | null>(null)\n\n  function isFocused(id: string, index?: number) {\n    return (\n      focusedInlineSetting &&\n      focusedInlineSetting.id === id &&\n      (focusedInlineSetting.index === undefined ||\n        focusedInlineSetting.index === index)\n    )\n  }\n\n  return (\n    <React.Fragment>\n      <SemanticSection editable={editable}>\n        {introduction.render()}\n      </SemanticSection>\n      <SemanticSection editable={editable}>{content.render()}</SemanticSection>\n      <SemanticSection editable={editable}>{renderExercises()}</SemanticSection>\n      <SemanticSection editable={editable}>\n        {renderRelatedContent()}\n      </SemanticSection>\n      <SemanticSection editable={editable}>{renderSources()}</SemanticSection>\n    </React.Fragment>\n  )\n\n  function renderExercises() {\n    const header = <h2>{i18n.t('article::Exercises')}</h2>\n    const folderHeader = (\n      <p>\n        {i18n.t('article::You can find more exercises in the following folder')}\n        :\n      </p>\n    )\n\n    if (!editable) {\n      if (exercises.length === 0 || !exerciseFolder.id.value) return null\n\n      return (\n        <>\n          {header}\n          {exercises.map((exercise) => {\n            return (\n              <React.Fragment key={exercise.id}>\n                {exercise.render()}\n              </React.Fragment>\n            )\n          })}\n          {exerciseFolder.id.value ? (\n            <>\n              {folderHeader}\n              <div>\n                <a href={`/${exerciseFolder.id.value}`}>\n                  {exerciseFolder.title.value}\n                </a>\n              </div>\n            </>\n          ) : null}\n        </>\n      )\n    }\n\n    return (\n      <>\n        {header}\n        <DragDropContext\n          onDragEnd={(result) => {\n            const { source, destination } = result\n            if (!destination) return\n            exercises.move(source.index, destination.index)\n          }}\n        >\n          <Droppable droppableId=\"default\">\n            {(provided: any) => {\n              return (\n                <div ref={provided.innerRef} {...provided.droppableProps}>\n                  {exercises.map((exercise, index) => {\n                    return (\n                      <Draggable\n                        key={exercise.id}\n                        draggableId={exercise.id}\n                        index={index}\n                      >\n                        {(provided: any) => {\n                          return (\n                            <div\n                              ref={provided.innerRef}\n                              {...provided.draggableProps}\n                            >\n                              {exercise.render({\n                                renderToolbar() {\n                                  return (\n                                    <React.Fragment>\n                                      <div>\n                                        <BasePluginToolbarButton\n                                          icon={<Icon icon={faTrashAlt} />}\n                                          title={i18n.t(\n                                            'article::Drag the exercise'\n                                          )}\n                                          {...provided.dragHandleProps}\n                                        >\n                                          <PluginToolbarButtonIcon>\n                                            <EdtrIcon icon={edtrDragHandle} />\n                                          </PluginToolbarButtonIcon>\n                                        </BasePluginToolbarButton>\n                                      </div>\n                                      <PluginToolbarButton\n                                        icon={\n                                          <MinWidthIcon>\n                                            <Icon icon={faTrashAlt} />\n                                          </MinWidthIcon>\n                                        }\n                                        label={i18n.t(\n                                          'article::Remove exercise'\n                                        )}\n                                        onClick={() => {\n                                          exercises.remove(index)\n                                        }}\n                                      />\n                                    </React.Fragment>\n                                  )\n                                },\n                              })}\n                            </div>\n                          )\n                        }}\n                      </Draggable>\n                    )\n                  })}\n                  {provided.placeholder}\n                </div>\n              )\n            }}\n          </Droppable>\n        </DragDropContext>\n        <AddButton\n          onClick={() => {\n            exercises.insert(exercises.length)\n          }}\n        >\n          {i18n.t('article::Add optional exercise')}\n        </AddButton>\n        {folderHeader}\n        {isFocused('exerciseFolder') ? (\n          <InlineSettings\n            onDelete={() => {\n              exerciseFolder.title.set('')\n              exerciseFolder.id.set('')\n            }}\n            position=\"below\"\n          >\n            <InlineSettingsInput\n              value={\n                exerciseFolder.id.value !== ''\n                  ? `/${exerciseFolder.id.value}`\n                  : ''\n              }\n              placeholder={i18n.t(\n                'article::ID of an exercise folder, e.g. 30560'\n              )}\n              onChange={(event) => {\n                const newValue = event.target.value.replace(/[^0-9]/g, '')\n                exerciseFolder.id.set(newValue)\n              }}\n            />\n            <a\n              target=\"_blank\"\n              href={\n                exerciseFolder.id.value !== ''\n                  ? `/${exerciseFolder.id.value}`\n                  : ''\n              }\n              rel=\"noopener noreferrer\"\n            >\n              <OpenInNewTab\n                title={i18n.t(\n                  'article::Open the exercise folder in a new tab:'\n                )}\n              >\n                <Icon icon={faExternalLinkAlt} />\n              </OpenInNewTab>\n            </a>\n          </InlineSettings>\n        ) : null}\n        <a>\n          <InlineInput\n            value={exerciseFolder.title.value}\n            onFocus={() => {\n              setFocusedInlineSetting({\n                id: 'exerciseFolder',\n              })\n            }}\n            onChange={(value) => {\n              exerciseFolder.title.set(value)\n            }}\n            placeholder={i18n.t('article::Title of the link')}\n          />\n        </a>\n      </>\n    )\n  }\n\n  function renderRelatedContent() {\n    const header = (\n      <React.Fragment>\n        <h2>{i18n.t('article::Still want more?')}</h2>\n        <p>\n          {i18n.t('article::You can find more content on this topic here')}:\n        </p>\n      </React.Fragment>\n    )\n\n    const types: {\n      section: 'articles' | 'courses' | 'videos'\n      label: string\n      addLabel: string\n      idPlaceholder: string\n      openLinkInNewTabPlaceholder: string\n      dragLabel: string\n      icon: React.ReactNode\n    }[] = [\n      {\n        icon: <Icon icon={faNewspaper} fixedWidth />,\n        section: 'articles',\n        label: i18n.t('article::Articles'),\n        addLabel: i18n.t('article::Add article'),\n        idPlaceholder: i18n.t('article::ID of an article, e.g. 1855'),\n        openLinkInNewTabPlaceholder: i18n.t(\n          'article::Open the article in a new tab:'\n        ),\n        dragLabel: i18n.t('article::Drag the article'),\n      },\n      {\n        icon: <Icon icon={faGraduationCap} fixedWidth />,\n        section: 'courses',\n        label: i18n.t('article::Courses'),\n        addLabel: i18n.t('article::Add course'),\n        idPlaceholder: i18n.t('article::ID of a course, e.g. 51979'),\n        openLinkInNewTabPlaceholder: i18n.t(\n          'article::Open the course in a new tab:'\n        ),\n        dragLabel: i18n.t('article::Drag the course'),\n      },\n      {\n        icon: <Icon icon={faPlayCircle} fixedWidth />,\n        section: 'videos',\n        label: i18n.t('article::Videos'),\n        addLabel: i18n.t('article::Add video'),\n        idPlaceholder: i18n.t('article::ID of a video, e.g. 40744'),\n        openLinkInNewTabPlaceholder: i18n.t(\n          'article::Open the video in a new tab:'\n        ),\n        dragLabel: i18n.t('article::Drag the video'),\n      },\n    ]\n\n    const allItems = R.flatten(R.values(relatedContent))\n    if (!editable && allItems.length === 0) return null\n\n    return (\n      <React.Fragment>\n        {header}\n        {types.map((type) => {\n          return (\n            <React.Fragment key={type.section}>\n              {renderRelatedContentSection(type)}\n            </React.Fragment>\n          )\n        })}\n      </React.Fragment>\n    )\n  }\n\n  function renderRelatedContentSection(type: {\n    section: 'articles' | 'courses' | 'videos'\n    label: string\n    addLabel: string\n    idPlaceholder: string\n    openLinkInNewTabPlaceholder: string\n    dragLabel: string\n    icon: React.ReactNode\n  }) {\n    const header = (\n      <>\n        {type.icon} {type.label}\n      </>\n    )\n\n    if (!editable) {\n      if (relatedContent[type.section].length === 0) return null\n\n      return (\n        <>\n          {header}\n          {relatedContent[type.section].map((item, index) => {\n            return (\n              <div key={index}>\n                <a href={`/${item.id.value}`}>{item.title.value}</a>\n              </div>\n            )\n          })}\n        </>\n      )\n    }\n\n    return (\n      <>\n        {header}\n        <DragDropContext\n          onDragEnd={(result) => {\n            const { source, destination } = result\n            if (!destination) return\n            relatedContent[type.section].move(source.index, destination.index)\n          }}\n        >\n          <Droppable droppableId=\"default\">\n            {(provided: any) => {\n              return (\n                <div ref={provided.innerRef} {...provided.droppableProps}>\n                  {relatedContent[type.section].map((item, index) => {\n                    return (\n                      <Draggable\n                        key={index}\n                        draggableId={`${type.section}-${index}`}\n                        index={index}\n                      >\n                        {(provided: any) => {\n                          return (\n                            <div\n                              ref={provided.innerRef}\n                              {...provided.draggableProps}\n                            >\n                              <div\n                                style={{\n                                  display: 'flex',\n                                }}\n                              >\n                                <div\n                                  style={{\n                                    flexGrow: 1,\n                                  }}\n                                >\n                                  {isFocused(type.section, index) ? (\n                                    <InlineSettings\n                                      onDelete={() => {\n                                        relatedContent[type.section].remove(\n                                          index\n                                        )\n                                      }}\n                                      position=\"below\"\n                                    >\n                                      <InlineSettingsInput\n                                        value={\n                                          item.id.value !== ''\n                                            ? `/${item.id.value}`\n                                            : ''\n                                        }\n                                        placeholder={type.idPlaceholder}\n                                        onChange={(event) => {\n                                          const newValue = event.target.value.replace(\n                                            /[^0-9]/g,\n                                            ''\n                                          )\n                                          item.id.set(newValue)\n                                        }}\n                                      />\n                                      <a\n                                        target=\"_blank\"\n                                        href={\n                                          item.id.value !== ''\n                                            ? `/${item.id.value}`\n                                            : ''\n                                        }\n                                        rel=\"noopener noreferrer\"\n                                      >\n                                        <OpenInNewTab\n                                          title={\n                                            type.openLinkInNewTabPlaceholder\n                                          }\n                                        >\n                                          <Icon icon={faExternalLinkAlt} />\n                                        </OpenInNewTab>\n                                      </a>\n                                    </InlineSettings>\n                                  ) : null}\n                                  <a>\n                                    <InlineInput\n                                      value={item.title.value}\n                                      onFocus={() => {\n                                        setFocusedInlineSetting({\n                                          id: type.section,\n                                          index,\n                                        })\n                                      }}\n                                      onChange={(value) => {\n                                        item.title.set(value)\n                                      }}\n                                      placeholder={i18n.t(\n                                        'article::Title of the link'\n                                      )}\n                                    />\n                                  </a>\n                                </div>\n                                <div>\n                                  <BasePluginToolbarButton\n                                    icon={<Icon icon={faTrashAlt} />}\n                                    title={i18n.t('article::Drag the exercise')}\n                                    {...provided.dragHandleProps}\n                                  >\n                                    <PluginToolbarButtonIcon>\n                                      <EdtrIcon icon={edtrDragHandle} />\n                                    </PluginToolbarButtonIcon>\n                                  </BasePluginToolbarButton>\n                                </div>\n                              </div>\n                            </div>\n                          )\n                        }}\n                      </Draggable>\n                    )\n                  })}\n                  {provided.placeholder}\n                  {editable ? (\n                    <AddButton\n                      onClick={() => {\n                        relatedContent[type.section].insert(\n                          relatedContent[type.section].length\n                        )\n                      }}\n                    >\n                      {type.addLabel}\n                    </AddButton>\n                  ) : null}\n                </div>\n              )\n            }}\n          </Droppable>\n        </DragDropContext>\n      </>\n    )\n  }\n\n  function renderSources() {\n    if (!editable) {\n      if (sources.length === 0) return null\n\n      return (\n        <ThemeProvider theme={spoilerTheme}>\n          <ExpandableBox\n            renderTitle={() => i18n.t('article::Sources')}\n            editable={editable}\n            alwaysVisible\n          >\n            <ul>\n              {sources.map((source, index) => {\n                return (\n                  <li key={index}>\n                    <a href={source.href.value}>{source.title.value}</a>\n                  </li>\n                )\n              })}\n            </ul>\n          </ExpandableBox>\n        </ThemeProvider>\n      )\n    }\n\n    return (\n      <ThemeProvider theme={spoilerTheme}>\n        <ExpandableBox\n          renderTitle={() => i18n.t('article::Sources')}\n          editable={editable}\n          alwaysVisible\n        >\n          <DragDropContext\n            onDragEnd={(result) => {\n              const { source, destination } = result\n              if (!destination) return\n              sources.move(source.index, destination.index)\n            }}\n          >\n            <Droppable droppableId=\"default\">\n              {(provided: any) => {\n                return (\n                  <ul ref={provided.innerRef} {...provided.droppableProps}>\n                    {sources.map((source, index) => {\n                      return (\n                        <Draggable\n                          key={index}\n                          draggableId={`${index}`}\n                          index={index}\n                        >\n                          {(provided: any) => {\n                            return (\n                              <li\n                                ref={provided.innerRef}\n                                {...provided.draggableProps}\n                              >\n                                <div\n                                  style={{\n                                    display: 'flex',\n                                  }}\n                                >\n                                  <div\n                                    style={{\n                                      flexGrow: 1,\n                                    }}\n                                  >\n                                    <span>\n                                      {isFocused('source', index) ? (\n                                        <InlineSettings\n                                          onDelete={() => {\n                                            sources.remove(index)\n                                          }}\n                                          position=\"below\"\n                                        >\n                                          <InlineSettingsInput\n                                            value={source.href.value}\n                                            placeholder={i18n.t(\n                                              'article::URL of the link'\n                                            )}\n                                            onChange={(event) => {\n                                              source.href.set(\n                                                event.target.value\n                                              )\n                                            }}\n                                          />\n                                          <a\n                                            target=\"_blank\"\n                                            href={source.href.value}\n                                            rel=\"noopener noreferrer\"\n                                          >\n                                            <OpenInNewTab\n                                              title={i18n.t(\n                                                'article::Open the link in a new tab:'\n                                              )}\n                                            >\n                                              <Icon icon={faExternalLinkAlt} />\n                                            </OpenInNewTab>\n                                          </a>\n                                        </InlineSettings>\n                                      ) : null}\n                                      <a>\n                                        <InlineInput\n                                          value={source.title.value}\n                                          onFocus={() => {\n                                            setFocusedInlineSetting({\n                                              id: 'source',\n                                              index,\n                                            })\n                                          }}\n                                          onChange={(value) => {\n                                            source.title.set(value)\n                                          }}\n                                          placeholder={i18n.t(\n                                            'article::Title of the link'\n                                          )}\n                                        />\n                                      </a>\n                                    </span>\n                                  </div>\n                                  <div>\n                                    <BasePluginToolbarButton\n                                      icon={<Icon icon={faTrashAlt} />}\n                                      title={i18n.t('article::Drag the source')}\n                                      {...provided.dragHandleProps}\n                                    >\n                                      <PluginToolbarButtonIcon>\n                                        <EdtrIcon icon={edtrDragHandle} />\n                                      </PluginToolbarButtonIcon>\n                                    </BasePluginToolbarButton>\n                                  </div>\n                                </div>\n                              </li>\n                            )\n                          }}\n                        </Draggable>\n                      )\n                    })}\n                    {provided.placeholder}\n                  </ul>\n                )\n              }}\n            </Droppable>\n          </DragDropContext>\n          {editable ? (\n            <AddButton\n              onClick={() => {\n                sources.insert(sources.length)\n              }}\n            >\n              {i18n.t('article::Add source')}\n            </AddButton>\n          ) : null}\n        </ExpandableBox>\n      </ThemeProvider>\n    )\n  }\n}\n","/**\n * This file is part of Serlo.org.\n *\n * Copyright (c) 2013-2021 Serlo Education e.V.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\")\n * you may not use this file except in compliance with the License\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * @copyright Copyright (c) 2013-2021 Serlo Education e.V.\n * @license   http://www.apache.org/licenses/LICENSE-2.0 Apache License 2.0\n * @link      https://github.com/serlo-org/serlo.org for the canonical source repository\n */\nimport {\n  EditorPlugin,\n  EditorPluginProps,\n  object,\n  scalar,\n  string,\n} from '@edtr-io/plugin'\nimport { useI18n } from '@serlo/i18n'\nimport * as React from 'react'\n\nexport const errorState = object({\n  plugin: string(),\n  state: scalar<unknown>({}),\n})\n\nexport type ErrorPluginState = typeof errorState\n\nexport const ErrorRenderer: React.FunctionComponent<\n  EditorPluginProps<ErrorPluginState>\n> = (props) => {\n  const i18n = useI18n()\n\n  return (\n    <div className=\"panel panel-danger\">\n      <div className=\"panel-heading\">\n        {i18n.t('error::This part of the document could not be converted.')}\n      </div>\n      <div className=\"panel-body\">\n        <pre>\n          {JSON.stringify(\n            {\n              plugin: props.state.plugin.value,\n              state: props.state.state.value,\n            },\n            undefined,\n            2\n          )}\n        </pre>\n      </div>\n    </div>\n  )\n}\n\nexport const errorPlugin: EditorPlugin<typeof errorState> = {\n  Component: ErrorRenderer,\n  state: errorState,\n  config: {},\n}\n","/**\n * This file is part of Serlo.org.\n *\n * Copyright (c) 2013-2021 Serlo Education e.V.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\")\n * you may not use this file except in compliance with the License\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * @copyright Copyright (c) 2013-2021 Serlo Education e.V.\n * @license   http://www.apache.org/licenses/LICENSE-2.0 Apache License 2.0\n * @link      https://github.com/serlo-org/serlo.org for the canonical source repository\n */\nexport enum Sign {\n  Equals = 'equals',\n  GreaterThan = 'greater-than',\n  GreaterThanOrEqual = 'greater-than-or-equal',\n  LessThan = 'less-than',\n  LessThanOrEqual = 'less-than-or-equal',\n  AlmostEqualTo = 'almost-equal-to',\n  Estimates = 'estimates',\n}\n\nexport function renderSignToString(sign: Sign): string {\n  switch (sign) {\n    case Sign.Equals:\n      return '='\n    case Sign.GreaterThan:\n      return '>'\n    case Sign.GreaterThanOrEqual:\n      return 'â‰¥'\n    case Sign.LessThan:\n      return '<'\n    case Sign.LessThanOrEqual:\n      return 'â‰¤'\n    case Sign.AlmostEqualTo:\n      return 'â‰ˆ'\n    case Sign.Estimates:\n      return 'â‰™'\n  }\n}\n","/**\n * This file is part of Serlo.org.\n *\n * Copyright (c) 2013-2021 Serlo Education e.V.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\")\n * you may not use this file except in compliance with the License\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * @copyright Copyright (c) 2013-2021 Serlo Education e.V.\n * @license   http://www.apache.org/licenses/LICENSE-2.0 Apache License 2.0\n * @link      https://github.com/serlo-org/serlo.org for the canonical source repository\n */\nimport { MathRenderer } from '@edtr-io/math'\nimport { styled } from '@edtr-io/ui'\nimport * as React from 'react'\n\nimport { EquationsProps } from '.'\nimport { renderSignToString, Sign } from './sign'\nimport { useScopedStore } from '@edtr-io/core'\nimport { isEmpty } from '@edtr-io/store'\n\nexport const TableWrapper = styled.div({\n  overflowX: 'scroll',\n  padding: '10px 0',\n})\n\nexport const Table = styled.table({\n  whiteSpace: 'nowrap',\n})\n\nexport const MathTd = styled.td({ verticalAlign: 'baseline' })\n\nexport const LeftTd = styled(MathTd)({\n  textAlign: 'right',\n})\n\nexport const SignTd = styled.td({\n  padding: '0 3px',\n  textAlign: 'center',\n  verticalAlign: 'baseline',\n})\n\nexport const TransformTd = styled(MathTd)({\n  paddingLeft: '5px',\n})\n\nexport const ExplanationTr = styled.tr({\n  color: '#007ec1',\n  div: {\n    margin: 0,\n  },\n})\n\nexport function EquationsRenderer({ state }: EquationsProps) {\n  const store = useScopedStore()\n\n  return (\n    <TableWrapper>\n      <Table>\n        <tbody>\n          {renderFirstExplanation()}\n          {state.steps.map((step, index) => {\n            return (\n              <React.Fragment key={index}>\n                <tr>\n                  <LeftTd>\n                    {step.left.value ? (\n                      <MathRenderer inline state={step.left.value} />\n                    ) : null}\n                  </LeftTd>\n                  <SignTd>\n                    <MathRenderer\n                      inline\n                      state={renderSignToString(step.sign.value as Sign)}\n                    />\n                  </SignTd>\n                  <MathTd>\n                    {step.right.value ? (\n                      <MathRenderer inline state={step.right.value} />\n                    ) : null}\n                  </MathTd>\n                  <TransformTd>\n                    {step.transform.value ? (\n                      <>\n                        |\n                        <MathRenderer inline state={step.transform.value} />\n                      </>\n                    ) : null}\n                  </TransformTd>\n                </tr>\n                {isEmpty(step.explanation.id)(store.getState()) ? null : (\n                  <ExplanationTr>\n                    <td />\n                    {renderDownArrow()}\n                    <td colSpan={2}>{step.explanation.render()}</td>\n                  </ExplanationTr>\n                )}\n              </React.Fragment>\n            )\n          })}\n        </tbody>\n      </Table>\n    </TableWrapper>\n  )\n\n  function renderFirstExplanation() {\n    if (isEmpty(state.firstExplanation.id)(store.getState())) return\n\n    return (\n      <>\n        <ExplanationTr>\n          <td colSpan={3} style={{ textAlign: 'center' }}>\n            {state.firstExplanation.render()}\n          </td>\n        </ExplanationTr>\n        <tr style={{ height: '30px' }}>\n          <td />\n          {renderDownArrow()}\n        </tr>\n      </>\n    )\n  }\n}\n\nexport function renderDownArrow() {\n  const downArrow = `\n    <svg xmlns=\"http://www.w3.org/2000/svg\">\n      <defs>\n        <marker\n          id=\"arrow\"\n          markerWidth=\"10\"\n          markerHeight=\"10\"\n          orient=\"auto\"\n          markerUnits=\"strokeWidth\"\n          refX=\"10\"\n          refY=\"5\"\n          viewBox=\"0 0 20 10\"\n        >\n          <path\n            d=\"M 0,0 l 10,5 l -10,5\"\n            stroke=\"#007ec1\"\n            stroke-width=\"2\"\n            fill=\"none\"\n            vector-effect=\"non-scaling-size\"\n          />\n        </marker>\n      </defs>\n\n      <line\n        x1=\"10\"\n        y1=\"0%\"\n        x2=\"10\"\n        y2=\"99%\"\n        stroke=\"#007ec1\"\n        stroke-width=\"2\"\n        marker-end=\"url(#arrow)\"\n        vector-effect=\"non-scaling-stroke\"\n      />\n    </svg>`\n  const downArrowBase64 = Buffer.from(downArrow).toString('base64')\n\n  return (\n    <td\n      style={{\n        backgroundImage: `url('data:image/svg+xml;base64,${downArrowBase64}')`,\n        backgroundSize: '20px calc(100% - 10px)',\n        backgroundRepeat: 'no-repeat',\n        backgroundPosition: 'center 5px',\n      }}\n    />\n  )\n}\n","/**\n * This file is part of Serlo.org.\n *\n * Copyright (c) 2013-2021 Serlo Education e.V.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\")\n * you may not use this file except in compliance with the License\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * @copyright Copyright (c) 2013-2021 Serlo Education e.V.\n * @license   http://www.apache.org/licenses/LICENSE-2.0 Apache License 2.0\n * @link      https://github.com/serlo-org/serlo.org for the canonical source repository\n */\nimport { HotKeys, useScopedSelector, useScopedStore } from '@edtr-io/core'\nimport { AddButton } from '@edtr-io/editor-ui/internal'\nimport { PreferenceContext, setDefaultPreference } from '@edtr-io/core/beta'\nimport { MathEditor } from '@edtr-io/math'\nimport { StateTypeReturnType, StringStateType } from '@edtr-io/plugin'\nimport { edtrDragHandle, EdtrIcon, faTimes, Icon, styled } from '@edtr-io/ui'\nimport { useI18n } from '@serlo/i18n'\nimport * as R from 'ramda'\nimport * as React from 'react'\nimport { DragDropContext, Draggable, Droppable } from 'react-beautiful-dnd'\n\nimport {\n  EquationsRenderer,\n  ExplanationTr,\n  LeftTd,\n  MathTd,\n  renderDownArrow,\n  SignTd,\n  Table,\n  TableWrapper,\n  TransformTd,\n} from './renderer'\nimport {\n  focus,\n  focusNext,\n  focusPrevious,\n  getFocused,\n  isEmpty,\n} from '@edtr-io/store'\nimport { renderSignToString, Sign } from './sign'\nimport { EquationsProps, stepProps } from '.'\n\nenum StepSegment {\n  Left = 0,\n  Right = 1,\n  Transform = 2,\n  Explanation = 3,\n}\n\nconst preferenceKey = 'katex:usevisualmath'\n\nsetDefaultPreference(preferenceKey, true)\n\nconst RemoveButton = styled.button({\n  outline: 'none',\n  width: '35px',\n  border: 'none',\n  background: 'transparent',\n})\nconst DragButton = styled.span({\n  cursor: 'grab',\n  paddingRight: '5px',\n})\n\nexport function EquationsEditor(props: EquationsProps) {\n  const i18n = useI18n()\n\n  const { focused, state } = props\n\n  const store = useScopedStore()\n  const focusedElement = useScopedSelector(getFocused())\n  const nestedFocus =\n    focused ||\n    R.includes(\n      focusedElement,\n      props.state.steps.map((step) => step.explanation.id)\n    ) ||\n    focusedElement === state.firstExplanation.id\n\n  const gridFocus = useGridFocus({\n    rows: state.steps.length,\n    columns: 4,\n    focusNext: () => store.dispatch(focusNext()),\n    focusPrevious: () => store.dispatch(focusPrevious()),\n    onFocusChanged: (state) => {\n      if (state === 'firstExplanation') {\n        store.dispatch(focus(props.state.firstExplanation.id))\n      } else if (state.column === StepSegment.Explanation) {\n        store.dispatch(focus(props.state.steps[state.row].explanation.id))\n      } else {\n        store.dispatch(focus(props.id))\n      }\n    },\n  })\n\n  React.useEffect(() => {\n    if (nestedFocus) {\n      gridFocus.setFocus({ row: 0, column: 0 })\n      store.dispatch(focus(props.id))\n    }\n  }, [nestedFocus])\n\n  if (!nestedFocus) return <EquationsRenderer {...props} />\n\n  return (\n    <HotKeys\n      allowChanges\n      keyMap={{\n        FOCUS_NEXT_OR_INSERT: 'tab',\n        FOCUS_PREVIOUS: 'shift+tab',\n        INSERT: 'return',\n      }}\n      handlers={{\n        FOCUS_NEXT_OR_INSERT: (e) => {\n          handleKeyDown(e, () => {\n            if (\n              gridFocus.isFocused({\n                row: state.steps.length - 1,\n                column: StepSegment.Transform,\n              })\n            ) {\n              const index = state.steps.length\n              insertNewEquationAt(index)\n              gridFocus.setFocus({\n                row: index - 1,\n                column: StepSegment.Explanation,\n              })\n            } else {\n              gridFocus.moveRight()\n            }\n          })\n        },\n        FOCUS_PREVIOUS: (e) => {\n          handleKeyDown(e, () => gridFocus.moveLeft())\n        },\n        INSERT: (e) => {\n          handleKeyDown(e, () => {\n            if (!gridFocus.focus || gridFocus.focus === 'firstExplanation')\n              return\n            insertNewEquationWithFocus(gridFocus.focus.row + 1)\n          })\n        },\n      }}\n    >\n      <TableWrapper>\n        <DragDropContext\n          onDragEnd={(result) => {\n            const { source, destination } = result\n            if (!destination) return\n            state.steps.move(source.index, destination.index)\n          }}\n        >\n          <Droppable droppableId=\"default\">\n            {(provided: any) => {\n              return (\n                <Table ref={provided.innerRef} {...provided.droppableProps}>\n                  {renderFirstExplanation()}\n                  {state.steps.map((step, row) => {\n                    return (\n                      <Draggable\n                        key={step.explanation.id}\n                        draggableId={step.explanation.id}\n                        index={row}\n                      >\n                        {(provided: any) => {\n                          return (\n                            <tbody\n                              ref={provided.innerRef}\n                              {...provided.draggableProps}\n                            >\n                              <tr>\n                                <td>\n                                  <DragButton\n                                    {...provided.dragHandleProps}\n                                    tabIndex={-1}\n                                  >\n                                    <EdtrIcon icon={edtrDragHandle} />\n                                  </DragButton>\n                                </td>\n                                <StepEditor\n                                  gridFocus={gridFocus}\n                                  row={row}\n                                  state={step}\n                                />\n                                <td>\n                                  <RemoveButton\n                                    tabIndex={-1}\n                                    onClick={() => state.steps.remove(row)}\n                                  >\n                                    <Icon icon={faTimes} />\n                                  </RemoveButton>\n                                </td>\n                              </tr>\n                              {renderExplantionTr()}\n                            </tbody>\n                          )\n                        }}\n                      </Draggable>\n                    )\n\n                    function renderExplantionTr() {\n                      if (row === state.steps.length - 1) return null\n\n                      return (\n                        <ExplanationTr\n                          onFocus={() =>\n                            gridFocus.setFocus({\n                              row,\n                              column: StepSegment.Explanation,\n                            })\n                          }\n                        >\n                          <td />\n                          <td />\n                          {!isEmpty(step.explanation.id)(store.getState()) ? (\n                            renderDownArrow()\n                          ) : (\n                            <td />\n                          )}\n                          <td colSpan={2}>\n                            {step.explanation.render({\n                              config: {\n                                placeholder: i18n.t('equations::explanation'),\n                              },\n                            })}\n                          </td>\n                        </ExplanationTr>\n                      )\n                    }\n                  })}\n                  {provided.placeholder}\n                </Table>\n              )\n            }}\n          </Droppable>\n        </DragDropContext>\n        {renderAddButton()}\n      </TableWrapper>\n    </HotKeys>\n  )\n\n  function renderFirstExplanation() {\n    return (\n      <tbody onFocus={() => gridFocus.setFocus('firstExplanation')}>\n        <ExplanationTr>\n          <td />\n          <td colSpan={3} style={{ textAlign: 'center' }}>\n            {state.firstExplanation.render({\n              config: {\n                placeholder: i18n.t('equations::frist-explanation'),\n              },\n            })}\n          </td>\n        </ExplanationTr>\n        <tr style={{ height: '30px' }}>\n          <td />\n          <td />\n          {!isEmpty(state.firstExplanation.id)(store.getState())\n            ? renderDownArrow()\n            : null}\n        </tr>\n      </tbody>\n    )\n  }\n\n  function handleKeyDown(e: KeyboardEvent | undefined, next: () => void) {\n    e && e.preventDefault()\n    next()\n  }\n\n  function insertNewEquationAt(index: number) {\n    state.steps.insert(index, {\n      left: '',\n      sign: state.steps[index - 1].sign.value,\n      right: '',\n      transform: '',\n      explanation: { plugin: 'text' },\n    })\n  }\n\n  function insertNewEquationWithFocus(index: number) {\n    insertNewEquationAt(index)\n    gridFocus.setFocus({ row: index, column: StepSegment.Left })\n  }\n\n  function renderAddButton() {\n    if (!nestedFocus) return\n\n    return (\n      <AddButton onClick={() => insertNewEquationWithFocus(state.steps.length)}>\n        {i18n.t('equations::add new equation')}\n      </AddButton>\n    )\n  }\n}\n\nconst DropDown = styled.select({\n  height: '30px',\n  width: '35px',\n  marginLeft: '15px',\n  marginRight: '10px',\n  backgroundColor: 'lightgrey',\n  border: '1px solid lightgrey',\n  borderRadius: '5px',\n})\n\ninterface StepEditorProps {\n  gridFocus: GridFocus\n  row: number\n  state: StateTypeReturnType<typeof stepProps>\n}\n\nfunction StepEditor(props: StepEditorProps) {\n  const i18n = useI18n()\n  const { gridFocus, row, state } = props\n\n  return (\n    <>\n      <LeftTd\n        onClick={() => gridFocus.setFocus({ row, column: StepSegment.Left })}\n      >\n        <InlineMath\n          focused={gridFocus.isFocused({ row, column: StepSegment.Left })}\n          placeholder={\n            row === 0 ? '3x+1' : `[${i18n.t('equations::left-hand side')}]`\n          }\n          state={state.left}\n          onChange={(src) => state.left.set(src)}\n          onFocusNext={() => gridFocus.moveRight()}\n          onFocusPrevious={() => gridFocus.moveLeft()}\n        />\n      </LeftTd>\n      <SignTd>\n        <DropDown\n          tabIndex={-1}\n          onChange={(e: React.ChangeEvent<HTMLSelectElement>) => {\n            state.sign.set(e.target.value)\n          }}\n          value={state.sign.value}\n        >\n          {[\n            Sign.Equals,\n            Sign.GreaterThan,\n            Sign.LessThan,\n            Sign.GreaterThanOrEqual,\n            Sign.LessThanOrEqual,\n            Sign.AlmostEqualTo,\n            Sign.Estimates,\n          ].map((sign) => {\n            return (\n              <option key={sign} value={sign}>\n                {renderSignToString(sign)}\n              </option>\n            )\n          })}\n        </DropDown>\n      </SignTd>\n      <MathTd\n        onClick={() => gridFocus.setFocus({ row, column: StepSegment.Right })}\n      >\n        <InlineMath\n          focused={gridFocus.isFocused({ row, column: StepSegment.Right })}\n          placeholder={\n            row === 0 ? '7x' : `[${i18n.t('equations::right-hand side')}]`\n          }\n          state={state.right}\n          onChange={(src) => state.right.set(src)}\n          onFocusNext={() => gridFocus.moveRight()}\n          onFocusPrevious={() => gridFocus.moveLeft()}\n        />\n      </MathTd>\n      <TransformTd\n        onClick={() =>\n          gridFocus.setFocus({ row, column: StepSegment.Transform })\n        }\n      >\n        |{' '}\n        <InlineMath\n          focused={gridFocus.isFocused({ row, column: StepSegment.Transform })}\n          placeholder={\n            row === 0 ? '-3x' : `[${i18n.t('equations::transformation')}]`\n          }\n          state={state.transform}\n          onChange={(src) => state.transform.set(src)}\n          onFocusNext={() => gridFocus.moveRight()}\n          onFocusPrevious={() => gridFocus.moveLeft()}\n        />\n      </TransformTd>\n    </>\n  )\n}\n\ninterface InlineMathProps {\n  state: StateTypeReturnType<StringStateType>\n  placeholder: string\n  onChange: (state: string) => void\n  onFocusNext: () => void\n  onFocusPrevious: () => void\n  focused?: boolean\n  prefix?: string\n  suffix?: string\n}\n\nfunction InlineMath(props: InlineMathProps) {\n  const {\n    focused,\n    onFocusNext,\n    onFocusPrevious,\n    onChange,\n    state,\n    prefix = '',\n    suffix = '',\n  } = props\n\n  const preferences = React.useContext(PreferenceContext)\n\n  return (\n    <MathEditor\n      readOnly={!focused}\n      state={`${prefix}${state.value}${suffix}`}\n      config={{ i18n: { placeholder: props.placeholder } }}\n      inline\n      disableBlock\n      visual={preferences.getKey(preferenceKey) === true}\n      onEditorChange={(visual) => {\n        preferences.setKey(preferenceKey, visual)\n      }}\n      onInlineChange={() => {}}\n      onChange={onChange}\n      onMoveOutRight={onFocusNext}\n      onMoveOutLeft={onFocusPrevious}\n    />\n  )\n}\n\ntype GridFocusState =\n  | {\n      row: number\n      column: number\n    }\n  | 'firstExplanation'\n\ninterface GridFocus {\n  focus: GridFocusState | null\n  isFocused: (cell: GridFocusState) => boolean\n  setFocus: (cell: GridFocusState) => void\n  moveRight: () => void\n  moveLeft: () => void\n}\n\nfunction useGridFocus({\n  rows,\n  columns,\n  focusNext,\n  focusPrevious,\n  onFocusChanged,\n}: {\n  rows: number\n  columns: number\n  focusNext: () => void\n  focusPrevious: () => void\n  onFocusChanged: (args: GridFocusState) => void\n}): GridFocus {\n  const [focus, setFocusState] = React.useState<GridFocusState | null>(null)\n  const setFocus = (state: GridFocusState) => {\n    onFocusChanged(state)\n    setFocusState(state)\n  }\n\n  return {\n    focus,\n    isFocused(state) {\n      if (focus === null) return false\n      if (focus === 'firstExplanation') return state === focus\n\n      return (\n        state !== 'firstExplanation' &&\n        focus.row === state.row &&\n        focus.column === state.column\n      )\n    },\n    setFocus,\n    moveRight() {\n      if (focus === null) return\n      if (focus === 'firstExplanation') {\n        setFocus({ row: 0, column: 0 })\n        return\n      }\n      // Last column\n      if (focus.column === columns - 1) {\n        // Last row\n        if (focus.row === rows - 1) {\n          focusNext()\n        } else {\n          setFocus({ row: focus.row + 1, column: 0 })\n        }\n      } else {\n        setFocus({ row: focus.row, column: focus.column + 1 })\n      }\n    },\n    moveLeft() {\n      if (focus === null) return\n      if (focus === 'firstExplanation') {\n        focusPrevious()\n        return\n      }\n\n      // First column\n      if (focus.column === 0) {\n        // First row\n        if (focus.row === 0) {\n          setFocus('firstExplanation')\n        } else {\n          setFocus({ row: focus.row - 1, column: columns - 1 })\n        }\n      } else {\n        setFocus({ row: focus.row, column: focus.column - 1 })\n      }\n    },\n  }\n}\n","/**\n * This file is part of Serlo.org.\n *\n * Copyright (c) 2013-2021 Serlo Education e.V.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\")\n * you may not use this file except in compliance with the License\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * @copyright Copyright (c) 2013-2021 Serlo Education e.V.\n * @license   http://www.apache.org/licenses/LICENSE-2.0 Apache License 2.0\n * @link      https://github.com/serlo-org/serlo.org for the canonical source repository\n */\nimport {\n  child,\n  list,\n  object,\n  EditorPlugin,\n  EditorPluginProps,\n  string,\n} from '@edtr-io/plugin'\n\nimport { EquationsEditor } from './editor'\nimport { Sign } from './sign'\n\nexport const stepProps = object({\n  left: string(''),\n  sign: string(Sign.Equals),\n  right: string(''),\n  transform: string(''),\n  explanation: child({ plugin: 'text' }),\n})\n\nconst equationsState = object({\n  steps: list(stepProps, 2),\n  firstExplanation: child({ plugin: 'text' }),\n})\n\nexport type EquationsPluginState = typeof equationsState\nexport type EquationsProps = EditorPluginProps<EquationsPluginState>\n\nexport const equationsPlugin: EditorPlugin<EquationsPluginState> = {\n  Component: EquationsEditor,\n  config: {},\n  state: equationsState,\n}\n","/**\n * This file is part of Serlo.org.\n *\n * Copyright (c) 2013-2021 Serlo Education e.V.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\")\n * you may not use this file except in compliance with the License\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * @copyright Copyright (c) 2013-2021 Serlo Education e.V.\n * @license   http://www.apache.org/licenses/LICENSE-2.0 Apache License 2.0\n * @link      https://github.com/serlo-org/serlo.org for the canonical source repository\n */\nimport { PluginToolbarButton, useScopedStore } from '@edtr-io/core'\nimport { styled } from '@edtr-io/editor-ui'\nimport { AddButton } from '@edtr-io/editor-ui/internal'\nimport {\n  EditorPlugin,\n  EditorPluginProps,\n  child,\n  object,\n  optional,\n} from '@edtr-io/plugin'\nimport { getDocument } from '@edtr-io/store'\nimport { Icon, faRandom, faTrashAlt } from '@edtr-io/ui'\nimport { useI18n, I18n } from '@serlo/i18n'\nimport * as React from 'react'\n\nimport { SemanticSection } from './helpers/semantic-section'\n\nconst exerciseState = object({\n  content: child({ plugin: 'rows' }),\n  interactive: optional(\n    child<'scMcExercise' | 'inputExercise'>({ plugin: 'scMcExercise' })\n  ),\n})\n\nexport type ExercisePluginState = typeof exerciseState\nexport type ExerciseProps = EditorPluginProps<ExercisePluginState>\n\nexport const exercisePlugin: EditorPlugin<ExercisePluginState> = {\n  Component: ExerciseEditor,\n  state: exerciseState,\n  config: {},\n}\n\nconst ButtonContainer = styled.div({\n  display: 'flex',\n})\n\nconst interactivePlugins: {\n  name: 'scMcExercise' | 'inputExercise'\n  addLabel: (i18n: I18n) => string\n  title: (i18n: I18n) => string\n}[] = [\n  {\n    name: 'scMcExercise',\n    addLabel(i18n) {\n      return i18n.t('exercise::Add choice exercise')\n    },\n    title(i18n) {\n      return i18n.t('exercise::Choice exercise')\n    },\n  },\n  {\n    name: 'inputExercise',\n    addLabel(i18n) {\n      return i18n.t('exercise::Add input exercise')\n    },\n    title(i18n) {\n      return i18n.t('exercise::Input exercise')\n    },\n  },\n]\n\nconst InlineOptionsWrapper = styled.div({\n  position: 'absolute',\n  top: '-30px',\n  right: '0',\n  padding: '30px',\n  zIndex: 95,\n  whiteSpace: 'nowrap',\n})\n\nconst InlineOptionsContentWrapper = styled.div({\n  boxShadow: '0 2px 4px 0 rgba(0,0,0,0.50)',\n  backgroundColor: 'rgba(255, 255, 255, 0.95)',\n  borderRadius: '4px',\n})\n\nfunction InlineOptions(props: React.PropsWithChildren<{}>) {\n  return (\n    <InlineOptionsWrapper>\n      <InlineOptionsContentWrapper>\n        {props.children}\n      </InlineOptionsContentWrapper>\n    </InlineOptionsWrapper>\n  )\n}\nconst Option = styled.div({\n  padding: '5px 10px',\n  cursor: 'pointer',\n  width: '100%',\n  minWidth: '150px',\n  '&:hover': {\n    color: 'rgb(70, 155, 255)',\n  },\n})\n\nfunction ExerciseEditor({ editable, state }: ExerciseProps) {\n  const i18n = useI18n()\n  const store = useScopedStore()\n  const { content, interactive } = state\n  const [showOptions, setShowOptions] = React.useState(false)\n\n  return (\n    <React.Fragment>\n      <SemanticSection editable={editable}>{content.render()}</SemanticSection>\n      <SemanticSection editable={editable}>\n        {renderInteractive()}\n      </SemanticSection>\n    </React.Fragment>\n  )\n\n  function renderInteractive() {\n    if (interactive.defined) {\n      return interactive.render({\n        renderToolbar(children) {\n          return (\n            <React.Fragment>\n              <div\n                style={{ position: 'relative' }}\n                onMouseLeave={() => {\n                  setShowOptions(false)\n                }}\n              >\n                <PluginToolbarButton\n                  icon={<Icon icon={faRandom} />}\n                  // TODO: i18n\n                  label=\"Interaktives Element Ã¤ndern\"\n                  onClick={() => {\n                    setShowOptions(true)\n                  }}\n                />\n                <PluginToolbarButton\n                  icon={<Icon icon={faTrashAlt} />}\n                  // TODO: i18n\n                  label=\"Interaktives Element entfernen\"\n                  onClick={() => {\n                    interactive.remove()\n                  }}\n                />\n                {showOptions ? (\n                  <InlineOptions>\n                    {interactivePlugins\n                      .filter(\n                        (plugin) =>\n                          !interactive ||\n                          plugin.name !== getCurrentInteractivePlugin()\n                      )\n                      .map((plugin) => {\n                        return (\n                          <Option\n                            key={plugin.name}\n                            onClick={() => {\n                              interactive.replace(plugin.name)\n                              setShowOptions(false)\n                            }}\n                          >\n                            {plugin.title(i18n)}\n                          </Option>\n                        )\n                      })}\n                  </InlineOptions>\n                ) : null}\n              </div>\n              {children}\n            </React.Fragment>\n          )\n        },\n      })\n    }\n\n    if (editable) {\n      return (\n        <React.Fragment>\n          <p>\n            <em>{i18n.t('exercise::Add an optional interactive exercise:')}</em>\n          </p>\n          <ButtonContainer>\n            {interactivePlugins.map((plugin) => {\n              return (\n                <AddButton\n                  key={plugin.name}\n                  onClick={() => {\n                    interactive.create({\n                      plugin: plugin.name,\n                    })\n                  }}\n                >\n                  {plugin.addLabel(i18n)}\n                </AddButton>\n              )\n            })}\n          </ButtonContainer>\n        </React.Fragment>\n      )\n    }\n\n    return null\n  }\n\n  function getCurrentInteractivePlugin() {\n    if (!interactive.defined) return null\n    const doc = getDocument(interactive.id)(store.getState())\n    return doc && doc.plugin\n  }\n}\n","/**\n * This file is part of Serlo.org.\n *\n * Copyright (c) 2013-2021 Serlo Education e.V.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\")\n * you may not use this file except in compliance with the License\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * @copyright Copyright (c) 2013-2021 Serlo Education e.V.\n * @license   http://www.apache.org/licenses/LICENSE-2.0 Apache License 2.0\n * @link      https://github.com/serlo-org/serlo.org for the canonical source repository\n */\nimport { LoadedFile, UploadValidator } from '@edtr-io/plugin'\nimport { createImagePlugin as createCoreImagePlugin } from '@edtr-io/plugin-image'\nimport fetch from 'unfetch'\n\nconst MAX_FILE_SIZE = 2 * 1024 * 1024\nconst ALLOWED_EXTENSIONS = ['gif', 'jpg', 'jpeg', 'png', 'svg']\n\nenum FileErrorCode {\n  TOO_MANY_FILES,\n  NO_FILE_SELECTED,\n  BAD_EXTENSION,\n  FILE_TOO_BIG,\n  UPLOAD_FAILED,\n}\n\nexport interface FileError {\n  errorCode: FileErrorCode\n  message: string\n}\n\nfunction matchesAllowedExtensions(fileName: string) {\n  const extension = fileName.toLowerCase().slice(fileName.lastIndexOf('.') + 1)\n  return ALLOWED_EXTENSIONS.indexOf(extension) >= 0\n}\n\nfunction handleErrors(errors: FileErrorCode[]): FileError[] {\n  return errors.map((error) => ({\n    errorCode: error,\n    message: errorCodeToMessage(error),\n  }))\n}\n\nfunction onError(errors: FileError[]): void {\n  alert(errors.map((error) => error.message).join('\\n'))\n}\n\nfunction errorCodeToMessage(error: FileErrorCode) {\n  switch (error) {\n    case FileErrorCode.TOO_MANY_FILES:\n      return 'You can only upload one file'\n    case FileErrorCode.NO_FILE_SELECTED:\n      return 'No file selected'\n    case FileErrorCode.BAD_EXTENSION:\n      return 'Not an accepted file type'\n    case FileErrorCode.FILE_TOO_BIG:\n      return 'Filesize is too big'\n    case FileErrorCode.UPLOAD_FAILED:\n      return 'Error while uploading'\n  }\n}\n\nexport const validateFile: UploadValidator<FileError[]> = (file) => {\n  let uploadErrors: FileErrorCode[] = []\n\n  if (!file) {\n    uploadErrors = [...uploadErrors, FileErrorCode.NO_FILE_SELECTED]\n  } else if (!matchesAllowedExtensions(file.name)) {\n    uploadErrors = [...uploadErrors, FileErrorCode.BAD_EXTENSION]\n  } else if (file.size > MAX_FILE_SIZE) {\n    uploadErrors = [...uploadErrors, FileErrorCode.FILE_TOO_BIG]\n  } else {\n    return {\n      valid: true,\n    }\n  }\n\n  return {\n    valid: false,\n    errors: handleErrors(uploadErrors),\n  }\n}\n\nexport function createUploadImageHandler(getCsrfToken: () => string) {\n  const readFile = createReadFile(getCsrfToken)\n  return function uploadImageHandler(file: File): Promise<string> {\n    const validation = validateFile(file)\n    if (!validation.valid) {\n      onError(validation.errors)\n      return Promise.reject(validation.errors)\n    }\n\n    return readFile(file).then((loaded) => {\n      return loaded.dataUrl\n    })\n  }\n}\n\nexport function createReadFile(getCsrfToken: () => string) {\n  return function readFile(file: File): Promise<LoadedFile> {\n    return new Promise((resolve, reject) => {\n      const reader = new FileReader()\n\n      reader.onload = function (e: ProgressEvent) {\n        if (!e.target) return\n        const formData = new FormData()\n        formData.append('attachment[file]', file)\n        formData.append('type', 'file')\n        formData.append('csrf', getCsrfToken())\n\n        fetch('/attachment/upload', {\n          method: 'POST',\n          body: formData,\n        })\n          .then((response) => response.json())\n          .then((data) => {\n            if (!data['success']) reject()\n            resolve({\n              file,\n              dataUrl: data.files[0].location,\n            })\n          })\n          .catch(() => {\n            reject()\n          })\n      }\n\n      reader.readAsDataURL(file)\n    })\n  }\n}\n\nexport function createImagePlugin(getCsrfToken: () => string) {\n  return createCoreImagePlugin({\n    upload: createUploadImageHandler(getCsrfToken),\n    validate: validateFile,\n    secondInput: 'description',\n  })\n}\n","/**\n * This file is part of Serlo.org.\n *\n * Copyright (c) 2013-2021 Serlo Education e.V.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\")\n * you may not use this file except in compliance with the License\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * @copyright Copyright (c) 2013-2021 Serlo Education e.V.\n * @license   http://www.apache.org/licenses/LICENSE-2.0 Apache License 2.0\n * @link      https://github.com/serlo-org/serlo.org for the canonical source repository\n */\nimport { child, EditorPlugin, EditorPluginProps } from '@edtr-io/plugin'\nimport { styled } from '@edtr-io/renderer-ui'\nimport * as React from 'react'\n\nexport const importantState = child({ plugin: 'text' })\nexport type ImportantPluginState = typeof importantState\nexport type ImportantProps = EditorPluginProps<ImportantPluginState>\n\nexport function createImportantPlugin(): EditorPlugin<ImportantPluginState> {\n  return {\n    Component: ImportantRenderer,\n    config: {},\n    state: importantState,\n  }\n}\n\nconst Box = styled.div({\n  borderLeft: '#bedfed solid 5px',\n  paddingLeft: '15px',\n})\n\nfunction ImportantRenderer(props: ImportantProps) {\n  return <Box>{props.state.render()}</Box>\n}\n","/**\n * This file is part of Serlo.org.\n *\n * Copyright (c) 2013-2021 Serlo Education e.V.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\")\n * you may not use this file except in compliance with the License\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * @copyright Copyright (c) 2013-2021 Serlo Education e.V.\n * @license   http://www.apache.org/licenses/LICENSE-2.0 Apache License 2.0\n * @link      https://github.com/serlo-org/serlo.org for the canonical source repository\n */\nimport { OverlayInput } from '@edtr-io/core'\nimport { EditorInlineSettings, EditorInput, styled } from '@edtr-io/editor-ui'\nimport { PreviewOverlay } from '@edtr-io/editor-ui/internal'\nimport { EditorPluginProps, string, EditorPlugin } from '@edtr-io/plugin'\nimport { Icon, faNewspaper } from '@edtr-io/ui'\nimport { useI18n } from '@serlo/i18n'\nimport * as React from 'react'\nimport fetch from 'unfetch'\n\n/* global */\ndeclare const Common: {\n  trigger: (type: string, context?: HTMLDivElement | null) => void\n}\n\nexport const injectionState = string()\n\nexport type InjectionPluginState = typeof injectionState\n\nexport const injectionPlugin: EditorPlugin<InjectionPluginState> = {\n  Component: InjectionEditor,\n  state: injectionState,\n  config: {},\n}\n\nexport function InjectionRenderer(props: { src: string }) {\n  const [loaded, setLoaded] = React.useState('')\n  const ref = React.useRef<HTMLDivElement>(null)\n  const i18n = useI18n()\n\n  React.useEffect(() => {\n    const src = createURL(props.src)\n\n    fetch(src, {\n      headers: {\n        'X-Requested-With': 'XMLHttpRequest',\n        'X-From': 'legacy-serlo.org',\n      },\n    })\n      .then((response) => response.json())\n      .then((data: { response: string }) => {\n        setLoaded(data.response)\n        setTimeout(() => {\n          if (ref.current) {\n            Common.trigger('new context', ref.current)\n          }\n        })\n      })\n      .catch(() => {\n        setLoaded(\n          `<div class=\"alert alert-info\">${i18n.t(\n            'injection::Illegal injection found'\n          )}</div>`\n        )\n      })\n  }, [props.src])\n\n  if (loaded) {\n    return (\n      <div className=\"panel panel-default\">\n        <div\n          className=\"panel-body\"\n          ref={ref}\n          dangerouslySetInnerHTML={{ __html: loaded }}\n        />\n      </div>\n    )\n  }\n\n  const src = createURL(props.src)\n  return (\n    <div>\n      <a href={src}>{i18n.t('injection::Serlo entity {{src}}', { src })}</a>\n    </div>\n  )\n}\n\nfunction createURL(id: string) {\n  if (id.startsWith('/') || id.startsWith('\\\\')) {\n    return '/' + id.substring(1, id.length)\n  }\n  const match = id.match(/^https?:\\/\\/[^./]+\\.serlo\\.[^./]+\\/(.+)$/g)\n  if (match) {\n    return '/' + match[1]\n  }\n  return '/' + id\n}\n\nconst PlaceholderWrapper = styled.div({\n  position: 'relative',\n  width: '100%',\n  textAlign: 'center',\n})\n\nfunction InjectionEditor(props: EditorPluginProps<typeof injectionState>) {\n  const [cache, setCache] = React.useState(props.state.value)\n  const [preview, setPreview] = React.useState(false)\n  const i18n = useI18n()\n\n  React.useEffect(() => {\n    const timeout = setTimeout(() => {\n      setCache(props.state.value)\n    }, 2000)\n    return () => {\n      clearTimeout(timeout)\n    }\n  }, [props.focused, props.state.value])\n\n  if (!props.editable) {\n    return <InjectionRenderer src={props.state.value} />\n  }\n\n  return (\n    <React.Fragment>\n      {cache ? (\n        <PreviewOverlay\n          focused={props.focused || false}\n          onChange={(nextActive) => {\n            setPreview(nextActive)\n            if (nextActive) {\n              setCache(props.state.value)\n            }\n          }}\n        >\n          <InjectionRenderer src={cache} />\n        </PreviewOverlay>\n      ) : (\n        <PlaceholderWrapper>\n          <Icon icon={faNewspaper} size=\"5x\" />\n        </PlaceholderWrapper>\n      )}\n      {props.focused && !preview ? (\n        <EditorInlineSettings>\n          <EditorInput\n            label={i18n.t('injection::Serlo ID:')}\n            placeholder=\"123456\"\n            value={props.state.value}\n            onChange={(e) => {\n              props.state.set(e.target.value)\n            }}\n            width=\"30%\"\n            inputWidth=\"100%\"\n            ref={props.autofocusRef}\n          />\n        </EditorInlineSettings>\n      ) : null}\n      {props.renderIntoSettings(\n        <React.Fragment>\n          <OverlayInput\n            label={i18n.t('injection::Serlo ID:')}\n            placeholder=\"123456\"\n            value={props.state.value}\n            onChange={(e) => {\n              props.state.set(e.target.value)\n            }}\n          />\n        </React.Fragment>\n      )}\n    </React.Fragment>\n  )\n}\n","/**\n * This file is part of Serlo.org.\n *\n * Copyright (c) 2013-2021 Serlo Education e.V.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\")\n * you may not use this file except in compliance with the License\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * @copyright Copyright (c) 2013-2021 Serlo Education e.V.\n * @license   http://www.apache.org/licenses/LICENSE-2.0 Apache License 2.0\n * @link      https://github.com/serlo-org/serlo.org for the canonical source repository\n */\nimport { useScopedStore } from '@edtr-io/core'\nimport { EditorPluginProps, StateTypeReturnType } from '@edtr-io/plugin'\nimport { styled } from '@edtr-io/renderer-ui'\nimport { DocumentState, replace, serializeDocument } from '@edtr-io/store'\nimport { RowsPlugin } from '@serlo/legacy-editor-to-editor'\nimport { useI18n } from '@serlo/i18n'\nimport * as React from 'react'\n\nimport { layoutState } from '.'\n\nconst LayoutContainer = styled.div({\n  display: 'flex',\n  flexDirection: 'row',\n  flexWrap: 'wrap',\n  alignItems: 'flex-start',\n})\n\nconst ChildContainer = styled.div<{ width: number }>(({ width }) => {\n  return {\n    width: `${(width / 12) * 100}%`,\n    '@media (max-width: 480px)': {\n      width: '100%',\n    },\n  }\n})\nconst ConvertInfo = styled.div({\n  padding: '5px',\n  backgroundColor: '#f2dede',\n  color: '#a94442',\n  border: '1px solid #ebccd1',\n  textAlign: 'center',\n})\n\nconst ButtonContainer = styled.div({ display: 'flex', flexDirection: 'row' })\n\nconst ConvertButton = styled.button({\n  borderRadius: '5px',\n  margin: '5px',\n  border: 'none',\n  outline: 'none',\n  backgroundColor: 'white',\n  '&:hover': { backgroundColor: '#ebccd1' },\n})\n\nexport const LayoutRenderer: React.FunctionComponent<\n  EditorPluginProps<typeof layoutState> & {\n    insert?: (options?: DocumentState) => void\n    remove?: () => void\n  }\n> = (props) => {\n  const store = useScopedStore()\n  const i18n = useI18n()\n\n  return (\n    <React.Fragment>\n      {props.editable ? (\n        <ConvertInfo>\n          {i18n.t(\n            'layout::To make the content draggable, convert them for the new editor:'\n          )}\n          <ButtonContainer>\n            <ConvertButton onClick={convertToRow}>\n              {i18n.t('layout::One-column layout')}\n            </ConvertButton>\n            {canConvertToMultimediaExplanation() ? (\n              <ConvertButton onClick={convertToMultimediaExplanation}>\n                {i18n.t('layout::Multimedia content associated with text')}\n              </ConvertButton>\n            ) : null}\n          </ButtonContainer>\n        </ConvertInfo>\n      ) : null}\n      <LayoutContainer>\n        {props.state.map((item, index) => {\n          return (\n            <ChildContainer key={index} width={item.width.value}>\n              {item.child.render()}\n            </ChildContainer>\n          )\n        })}\n      </LayoutContainer>\n    </React.Fragment>\n  )\n\n  function convertToRow() {\n    const documents: DocumentState[] = []\n\n    props.state.forEach((item) => {\n      const element = serializeDocument(item.child.id)(store.getState())\n\n      if (!element) return\n      if (element.plugin === 'rows') {\n        ;(element as RowsPlugin).state.forEach((rowsItem) => {\n          documents.push(rowsItem)\n        })\n      } else {\n        documents.push(element)\n      }\n    })\n\n    store.dispatch(\n      replace({\n        id: props.id,\n        plugin: 'rows',\n        state: documents,\n      })\n    )\n  }\n\n  function canConvertToMultimediaExplanation() {\n    const columns = props.state\n    return (\n      columns.length === 2 &&\n      (isMultimediaColumn(columns[0]) || isMultimediaColumn(columns[1]))\n    )\n  }\n\n  function convertToMultimediaExplanation() {\n    if (!canConvertToMultimediaExplanation()) return\n    const columns = props.state\n    if (isMultimediaColumn(columns[0])) {\n      replaceWithMultimediaExplanation({\n        explanationColumn: columns[1],\n        multimediaColumn: columns[0],\n      })\n    } else {\n      replaceWithMultimediaExplanation({\n        explanationColumn: columns[0],\n        multimediaColumn: columns[1],\n      })\n    }\n\n    function replaceWithMultimediaExplanation({\n      explanationColumn,\n      multimediaColumn,\n    }: {\n      explanationColumn: Column\n      multimediaColumn: Column\n    }) {\n      const explanation = serializeDocument(explanationColumn.child.id)(\n        store.getState()\n      )\n      const multimedia = serializeDocument(multimediaColumn.child.id)(\n        store.getState()\n      )\n      if (!explanation || !multimedia) return\n      store.dispatch(\n        replace({\n          id: props.id,\n          plugin: 'multimedia',\n          state: {\n            explanation,\n            multimedia: multimedia.state[0],\n            illustrating: true,\n            width: 50,\n          },\n        })\n      )\n    }\n  }\n\n  function isMultimediaColumn(column: Column) {\n    const columnDocument = serializeDocument(column.child.id)(store.getState())\n    if (!columnDocument) return false\n    const children: string[] = columnDocument.state.map(\n      (child: DocumentState) => child.plugin\n    )\n    return children.length === 1 && isMultimediaPlugin(children[0])\n  }\n\n  function isMultimediaPlugin(plugin: string) {\n    return plugin === 'image' || plugin === 'geogebra' || plugin === 'video'\n  }\n}\n\ntype Column = StateTypeReturnType<typeof layoutState>[0]\n","/**\n * This file is part of Serlo.org.\n *\n * Copyright (c) 2013-2021 Serlo Education e.V.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\")\n * you may not use this file except in compliance with the License\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * @copyright Copyright (c) 2013-2021 Serlo Education e.V.\n * @license   http://www.apache.org/licenses/LICENSE-2.0 Apache License 2.0\n * @link      https://github.com/serlo-org/serlo.org for the canonical source repository\n */\nimport { EditorPlugin, child, list, number, object } from '@edtr-io/plugin'\n\nimport { LayoutRenderer } from './editor'\n\nexport const layoutState = list(\n  object({ child: child({ plugin: 'text' }), width: number() })\n)\n\nexport type LayoutPluginState = typeof layoutState\n\nexport const layoutPlugin: EditorPlugin<LayoutPluginState> = {\n  Component: LayoutRenderer,\n  state: layoutState,\n  config: {},\n}\n","/**\n * This file is part of Serlo.org.\n *\n * Copyright (c) 2013-2021 Serlo Education e.V.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\")\n * you may not use this file except in compliance with the License\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * @copyright Copyright (c) 2013-2021 Serlo Education e.V.\n * @license   http://www.apache.org/licenses/LICENSE-2.0 Apache License 2.0\n * @link      https://github.com/serlo-org/serlo.org for the canonical source repository\n */\nimport { EditorPlugin, EditorPluginProps, scalar } from '@edtr-io/plugin'\nimport * as React from 'react'\nimport styled from 'styled-components'\n\nconst separatorState = scalar(undefined)\n\nexport type SeparatorPluginState = typeof separatorState\nexport type SeparatorProps = EditorPluginProps<SeparatorPluginState>\n\nexport const separatorPlugin: EditorPlugin<SeparatorPluginState> = {\n  Component: SeparatorEditor,\n  state: separatorState,\n  config: {},\n}\n\nconst Container = styled.div({\n  paddingTop: '10px',\n  paddingBottom: '10px',\n})\n\nconst Separator = styled.hr({\n  marginTop: 0,\n  marginBottom: 0,\n})\n\nfunction SeparatorEditor(props: SeparatorProps) {\n  if (!props.editable) return null\n  return (\n    <Container>\n      <Separator />\n    </Container>\n  )\n}\n","/**\n * This file is part of Serlo.org.\n *\n * Copyright (c) 2013-2021 Serlo Education e.V.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\")\n * you may not use this file except in compliance with the License\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * @copyright Copyright (c) 2013-2021 Serlo Education e.V.\n * @license   http://www.apache.org/licenses/LICENSE-2.0 Apache License 2.0\n * @link      https://github.com/serlo-org/serlo.org for the canonical source repository\n */\nimport {\n  EditorPlugin,\n  EditorPluginProps,\n  child,\n  object,\n  string,\n  optional,\n} from '@edtr-io/plugin'\nimport * as React from 'react'\nimport { useScopedSelector } from '@edtr-io/core'\nimport { isEmpty } from '@edtr-io/store'\nimport { Icon, faExternalLinkAlt, styled } from '@edtr-io/ui'\nimport { useI18n } from '@serlo/i18n'\n\nimport { SemanticSection } from './helpers/semantic-section'\nimport { InlineInput } from './helpers/inline-input'\nimport { InlineSettings } from './helpers/inline-settings'\nimport { InlineSettingsInput } from './helpers/inline-settings-input'\n\nconst solutionState = object({\n  prerequisite: optional(\n    object({\n      id: string(),\n      title: string(),\n    })\n  ),\n  strategy: child({\n    plugin: 'text',\n  }),\n  steps: child({ plugin: 'rows' }),\n})\n\nexport type SolutionPluginState = typeof solutionState\nexport type SolutionProps = EditorPluginProps<SolutionPluginState>\n\nexport const solutionPlugin: EditorPlugin<SolutionPluginState> = {\n  Component: SolutionEditor,\n  state: solutionState,\n  config: {},\n}\n\nconst OpenInNewTab = styled.span({ margin: '0 0 0 10px' })\n\nfunction SolutionEditor({ editable, state, focused }: SolutionProps) {\n  const { prerequisite, strategy } = state\n  const i18n = useI18n()\n\n  const hasStrategy = !useScopedSelector(isEmpty(strategy.id))\n\n  return (\n    <React.Fragment>\n      {renderPrerequisite()}\n      {hasStrategy || editable ? (\n        <SemanticSection editable={editable}>\n          {strategy.render({\n            config: {\n              placeholder: i18n.t(\n                'solution::Optionally explain the solution strategy here'\n              ),\n            },\n          })}\n        </SemanticSection>\n      ) : null}\n      <SemanticSection editable={editable}>\n        {state.steps.render()}\n      </SemanticSection>\n    </React.Fragment>\n  )\n\n  function renderPrerequisite() {\n    return (\n      <SemanticSection editable={editable}>{renderContent()}</SemanticSection>\n    )\n\n    function renderContent() {\n      if (editable) {\n        return (\n          <div>\n            {i18n.t(\n              'solution::For this exercise, you need the following fundamentals:'\n            )}{' '}\n            {focused ? (\n              <InlineSettings\n                onDelete={() => {\n                  if (prerequisite.defined) {\n                    prerequisite.remove()\n                  }\n                }}\n                position={'below'}\n              >\n                <InlineSettingsInput\n                  value={\n                    prerequisite.defined && prerequisite.id.value !== ''\n                      ? `/${prerequisite.id.value}`\n                      : ''\n                  }\n                  placeholder={i18n.t('solution::ID of an article, e.g. 1855')}\n                  onChange={(event) => {\n                    const newValue = event.target.value.replace(/[^0-9]/g, '')\n                    if (prerequisite.defined) {\n                      prerequisite.id.set(newValue)\n                    } else {\n                      prerequisite.create({\n                        id: newValue,\n                        title: '',\n                      })\n                    }\n                  }}\n                />\n                <a\n                  target=\"_blank\"\n                  href={\n                    prerequisite.defined && prerequisite.id.value !== ''\n                      ? `/${prerequisite.id.value}`\n                      : ''\n                  }\n                  rel=\"noopener noreferrer\"\n                >\n                  <OpenInNewTab\n                    title={i18n.t('solution::Open the article in a new tab:')}\n                  >\n                    <Icon icon={faExternalLinkAlt} />\n                  </OpenInNewTab>\n                </a>\n              </InlineSettings>\n            ) : null}\n            <a>\n              <InlineInput\n                value={prerequisite.defined ? prerequisite.title.value : ''}\n                onChange={(value) => {\n                  if (prerequisite.defined) {\n                    prerequisite.title.set(value)\n                  } else {\n                    prerequisite.create({ id: '', title: value })\n                  }\n                }}\n                placeholder={i18n.t('solution::Title of the link')}\n              />\n            </a>\n          </div>\n        )\n      }\n\n      if (\n        prerequisite.defined &&\n        prerequisite.id.value &&\n        prerequisite.title.value\n      ) {\n        return (\n          <p>\n            {i18n.t(\n              'solution::For this exercise, you need the following fundamentals:'\n            )}{' '}\n            <a href={`/${prerequisite.id.value}`}>{prerequisite.title.value}</a>\n          </p>\n        )\n      }\n\n      return null\n    }\n  }\n}\n","/**\n * This file is part of Serlo.org.\n *\n * Copyright (c) 2013-2021 Serlo Education e.V.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\")\n * you may not use this file except in compliance with the License\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * @copyright Copyright (c) 2013-2021 Serlo Education e.V.\n * @license   http://www.apache.org/licenses/LICENSE-2.0 Apache License 2.0\n * @link      https://github.com/serlo-org/serlo.org for the canonical source repository\n */\nimport { EditorPlugin, EditorPluginProps } from '@edtr-io/plugin'\nimport {\n  createTablePlugin,\n  TableProps,\n  TablePluginState,\n  TablePluginConfig,\n} from '@edtr-io/plugin-table'\nimport { converter } from '@serlo/markdown'\nimport { initMathJax, typeset } from '@serlo/mathjax'\nimport * as React from 'react'\n\nconst edtrTablePlugin = createTablePlugin({\n  MarkdownRenderer,\n})\n\nfunction MarkdownRenderer(props: { markdown: string }) {\n  const html = converter.makeHtml(props.markdown)\n  return (\n    <div\n      className=\"requires-mathjax\"\n      dangerouslySetInnerHTML={{ __html: html }}\n    />\n  )\n}\n\nexport const tablePlugin: EditorPlugin<TablePluginState, TablePluginConfig> = {\n  ...edtrTablePlugin,\n  Component: TableEditor,\n}\n\nfunction TableEditor(props: TableProps) {\n  const ref = React.useRef<HTMLDivElement>(null)\n  React.useEffect(() => {\n    initMathJax()\n    const timeout = setTimeout(typesetMathjax, 1000)\n    return () => {\n      if (timeout) {\n        clearTimeout(timeout)\n      }\n    }\n  })\n  return (\n    <div ref={ref}>\n      <edtrTablePlugin.Component {...props} />\n    </div>\n  )\n\n  function typesetMathjax() {\n    if (!ref.current) return\n    typeset(ref.current)\n  }\n}\n","/**\n * This file is part of Serlo.org.\n *\n * Copyright (c) 2013-2021 Serlo Education e.V.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\")\n * you may not use this file except in compliance with the License\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * @copyright Copyright (c) 2013-2021 Serlo Education e.V.\n * @license   http://www.apache.org/licenses/LICENSE-2.0 Apache License 2.0\n * @link      https://github.com/serlo-org/serlo.org for the canonical source repository\n */\nimport {\n  EditorPlugin,\n  EditorPluginProps,\n  object,\n  scalar,\n  string,\n} from '@edtr-io/plugin'\nimport { useI18n } from '@serlo/i18n'\nimport * as React from 'react'\n\nexport const deprecatedState = object({\n  plugin: string(),\n  state: scalar<unknown>({}),\n})\n\nexport type DeprecatedPluginState = typeof deprecatedState\n\nexport const DeprecatedRenderer: React.FunctionComponent<\n  EditorPluginProps<DeprecatedPluginState>\n> = (props) => {\n  const i18n = useI18n()\n\n  return (\n    <div className=\"panel panel-danger\">\n      <div className=\"panel-heading\">\n        {i18n.t(\n          'deprecated::This part of the document contains features that are no longer supported.'\n        )}\n      </div>\n      <div className=\"panel-body\">\n        <pre>\n          {JSON.stringify(\n            {\n              plugin: props.state.plugin.value,\n              state: props.state.state.value,\n            },\n            undefined,\n            2\n          )}\n        </pre>\n      </div>\n    </div>\n  )\n}\n\nexport const deprecatedPlugin: EditorPlugin<typeof deprecatedState> = {\n  Component: DeprecatedRenderer,\n  state: deprecatedState,\n  config: {},\n}\n","/**\n * This file is part of Serlo.org.\n *\n * Copyright (c) 2013-2021 Serlo Education e.V.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\")\n * you may not use this file except in compliance with the License\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * @copyright Copyright (c) 2013-2021 Serlo Education e.V.\n * @license   http://www.apache.org/licenses/LICENSE-2.0 Apache License 2.0\n * @link      https://github.com/serlo-org/serlo.org for the canonical source repository\n */\nimport { EditorPlugin } from '@edtr-io/plugin'\nimport { createTextPlugin } from '@edtr-io/plugin-text'\nimport { createAnchorPlugin } from '@edtr-io/plugin-anchor'\nimport { createBlockquotePlugin } from '@edtr-io/plugin-blockquote'\nimport { createGeogebraPlugin } from '@edtr-io/plugin-geogebra'\nimport { createHighlightPlugin } from '@edtr-io/plugin-highlight'\nimport {\n  createInputExercisePlugin,\n  InputExerciseType,\n} from '@edtr-io/plugin-input-exercise'\nimport { createMultimediaExplanationPlugin } from '@edtr-io/plugin-multimedia-explanation'\nimport { createRowsPlugin, RowsConfig } from '@edtr-io/plugin-rows'\nimport { createScMcExercisePlugin } from '@edtr-io/plugin-sc-mc-exercise'\nimport { createSpoilerPlugin } from '@edtr-io/plugin-spoiler'\nimport { createVideoPlugin } from '@edtr-io/plugin-video'\nimport { i18n } from 'i18next'\nimport * as React from 'react'\n\nimport { appletTypePlugin } from './plugins/types/applet'\nimport { articleTypePlugin } from './plugins/types/article'\nimport { courseTypePlugin } from './plugins/types/course'\nimport { coursePageTypePlugin } from './plugins/types/course-page'\nimport { eventTypePlugin } from './plugins/types/event'\nimport { mathPuzzleTypePlugin } from './plugins/types/math-puzzle'\nimport { pageTypePlugin } from './plugins/types/page'\nimport { taxonomyTypePlugin } from './plugins/types/taxonomy'\nimport { textExerciseTypePlugin } from './plugins/types/text-exercise'\nimport { textExerciseGroupTypePlugin } from './plugins/types/text-exercise-group'\nimport { textSolutionTypePlugin } from './plugins/types/text-solution'\nimport { userTypePlugin } from './plugins/types/user'\nimport { videoTypePlugin } from './plugins/types/video'\nimport { articlePlugin } from './plugins/article'\nimport { errorPlugin } from './plugins/error'\nimport { equationsPlugin } from './plugins/equations'\nimport { exercisePlugin } from './plugins/exercise'\nimport { createImagePlugin } from './plugins/image'\nimport { createImportantPlugin } from './plugins/important'\nimport { injectionPlugin } from './plugins/injection'\nimport { layoutPlugin } from './plugins/layout'\nimport { separatorPlugin } from './plugins/separator'\nimport { solutionPlugin } from './plugins/solution'\nimport { tablePlugin } from './plugins/table'\nimport { deprecatedPlugin } from './plugins/deprecated'\nimport { SerializedDocument } from './serialized-document'\n\ntype PluginType =\n  | SerializedDocument['plugin']\n  | 'type-applet'\n  | 'type-article'\n  | 'type-course'\n  | 'type-course-page'\n  | 'type-event'\n  | 'type-math-puzzle'\n  | 'type-page'\n  | 'type-taxonomy'\n  | 'type-text-exercise'\n  | 'type-text-exercise-group'\n  | 'type-text-solution'\n  | 'type-user'\n  | 'type-video'\n\nexport function createPlugins({\n  getCsrfToken,\n  i18n,\n  registry,\n}: {\n  getCsrfToken: () => string\n  i18n: i18n\n  registry: RowsConfig['plugins']\n}): Record<string, EditorPlugin<any, any>> &\n  Record<PluginType, EditorPlugin<any, any>> {\n  return {\n    anchor: createAnchorPlugin({\n      i18n: {\n        label: i18n.t('anchor::Identifier'),\n        placeholder: i18n.t('anchor::ID of the anchor'),\n      },\n    }),\n    article: articlePlugin,\n    articleIntroduction: createMultimediaExplanationPlugin({\n      explanation: {\n        plugin: 'text',\n        config: {\n          placeholder: i18n.t('article::Write a short introduction'),\n        },\n      },\n      plugins: [\n        {\n          name: 'image',\n          title: i18n.t('multimedia::Image'),\n        },\n      ],\n      i18n: {\n        changeMultimediaType: i18n.t('multimedia::Change the multimedia type'),\n        illustrating: {\n          label: i18n.t('multimedia::How important is the multimedia content?'),\n          values: {\n            illustrating: i18n.t('multimedia::It is illustrating'),\n            explaining: i18n.t('multimedia::It is essential'),\n          },\n        },\n      },\n    }),\n    blockquote: createBlockquotePlugin({\n      content: {\n        plugin: 'text',\n      },\n    }),\n    error: errorPlugin,\n    deprecated: deprecatedPlugin,\n    equations: equationsPlugin,\n    exercise: exercisePlugin,\n    geogebra: createGeogebraPlugin({\n      i18n: {\n        label: i18n.t('geogebra::GeoGebra URL or ID'),\n      },\n    }),\n    highlight: createHighlightPlugin({\n      i18n: {\n        code: {\n          label: i18n.t('highlight::Click here and enter your source codeâ€¦'),\n          placeholder: i18n.t('highlight::Enter your source code here'),\n        },\n        language: {\n          label: i18n.t('highlight::Language'),\n          placeholder: i18n.t('highlight::Enter language'),\n        },\n        showLineNumbers: {\n          label: i18n.t('highlight::Show line numbers'),\n        },\n      },\n    }),\n    image: createImagePlugin(getCsrfToken),\n    important: createImportantPlugin(),\n    injection: injectionPlugin,\n    inputExercise: createInputExercisePlugin({\n      feedback: {\n        plugin: 'text',\n      },\n      i18n: {\n        types: {\n          [InputExerciseType.InputStringNormalizedMatchChallenge]: i18n.t(\n            'inputExercise::Text'\n          ),\n          [InputExerciseType.InputNumberExactMatchChallenge]: i18n.t(\n            'inputExercise::Number'\n          ),\n          [InputExerciseType.InputExpressionEqualMatchChallenge]: i18n.t(\n            'inputExercise::Mathematical expression'\n          ),\n        },\n        type: {\n          label: i18n.t('inputExercise::Choose the exercise type'),\n        },\n        unit: {\n          label: i18n.t('inputExercise::Unit'),\n        },\n        answer: {\n          addLabel: i18n.t('inputExercise::Add answer'),\n          value: {\n            placeholder: i18n.t('inputExercise::Enter the value'),\n          },\n        },\n        inputPlaceholder: i18n.t('inputExercise::Your solution'),\n        fallbackFeedback: {\n          correct: i18n.t('inputExercise::Correct'),\n          wrong: i18n.t('inputExercise::Wrong'),\n        },\n      },\n    }),\n    layout: layoutPlugin,\n    multimedia: createMultimediaExplanationPlugin({\n      explanation: { plugin: 'rows' },\n      plugins: [\n        {\n          name: 'image',\n          title: i18n.t('multimedia::Image'),\n        },\n        {\n          name: 'video',\n          title: i18n.t('multimedia::Video'),\n        },\n        {\n          name: 'geogebra',\n          title: i18n.t('multimedia::GeoGebra Applet'),\n        },\n      ],\n      i18n: {\n        changeMultimediaType: i18n.t('multimedia::Change the multimedia type'),\n        illustrating: {\n          label: i18n.t('multimedia::How important is the multimedia content?'),\n          values: {\n            illustrating: i18n.t('multimedia::It is illustrating'),\n            explaining: i18n.t('multimedia::It is essential'),\n          },\n        },\n      },\n    }),\n    rows: createRowsPlugin({\n      content: { plugin: 'text' },\n      plugins: registry,\n      i18n: {\n        menu: {\n          searchPlaceholder: i18n.t('rows::Search for toolsâ€¦'),\n        },\n        settings: {\n          duplicateLabel: i18n.t('rows::Duplicate'),\n          removeLabel: i18n.t('rows::Remove'),\n          closeLabel: i18n.t('rows::Close'),\n        },\n        toolbar: {\n          dragLabel: i18n.t('rows::Drag the element within the document'),\n        },\n        addLabel: i18n.t('rows::Add an element'),\n      },\n    }),\n    scMcExercise: createScMcExercisePlugin({\n      content: { plugin: 'text' },\n      feedback: { plugin: 'text' },\n      i18n: {\n        types: {\n          singleChoice: i18n.t('scMcExercise::Single-choice'),\n          multipleChoice: i18n.t('scMcExercise::Multiple-choice'),\n        },\n        isSingleChoice: {\n          label: i18n.t('scMcExercise::Choose the exercise type'),\n        },\n        answer: {\n          addLabel: i18n.t('scMcExercise::Add answer'),\n          fallbackFeedback: {\n            wrong: i18n.t('scMcExercise::Wrong'),\n          },\n        },\n        globalFeedback: {\n          missingCorrectAnswers: i18n.t(\n            'scMcExercise::Almost! You missed at least one correct answer'\n          ),\n          correct: i18n.t('scMcExercise::Correct'),\n          wrong: i18n.t('scMcExercise::Wrong'),\n        },\n      },\n    }),\n    separator: separatorPlugin,\n    solution: solutionPlugin,\n    spoiler: createSpoilerPlugin({\n      content: { plugin: 'rows' },\n      i18n: {\n        title: {\n          placeholder: i18n.t('spoiler::Enter a title'),\n        },\n      },\n    }),\n    table: tablePlugin,\n    text: createTextPlugin({\n      registry,\n      blockquote: 'blockquote',\n      i18n: {\n        blockquote: {\n          toggleTitle: i18n.t('text::Quote'),\n        },\n        colors: {\n          setColorTitle: i18n.t('text::Set color'),\n          resetColorTitle: i18n.t('text::Reset color'),\n          openMenuTitle: i18n.t('text::Colors'),\n          closeMenuTitle: i18n.t('text::Close sub menu'),\n        },\n        headings: {\n          setHeadingTitle(level: number) {\n            return `${i18n.t('text::Heading')} ${level}`\n          },\n          openMenuTitle: i18n.t('text::Headings'),\n          closeMenuTitle: i18n.t('text::Close sub menu'),\n        },\n        link: {\n          toggleTitle: i18n.t('text::Link (Strg + K)'),\n          placeholder: i18n.t('text::Enter URL'),\n          openInNewTabTitle: i18n.t('text::Open in new tab'),\n        },\n        list: {\n          toggleOrderedList: i18n.t('text::Ordered list'),\n          toggleUnorderedList: i18n.t('text::Unordered list'),\n          openMenuTitle: i18n.t('text::Lists'),\n          closeMenuTitle: i18n.t('text::Close sub menu'),\n        },\n        math: {\n          toggleTitle: i18n.t('text::Math formula (Strg + M)'),\n          displayBlockLabel: i18n.t('text::Display as block'),\n          placeholder: i18n.t('text::[formula]'),\n          editors: {\n            visual: i18n.t('text::visual'),\n            latex: i18n.t('text::LaTeX'),\n            noVisualEditorAvailableMessage: i18n.t(\n              'text::Only LaTeX editor available'\n            ),\n          },\n          helpText(\n            KeySpan: React.ComponentType<{ children: React.ReactNode }>\n          ) {\n            return (\n              <>\n                {i18n.t('text::Shortcuts')}:\n                <br />\n                <br />\n                <p>\n                  {i18n.t('text::Fraction')}: <KeySpan>/</KeySpan>\n                </p>\n                <p>\n                  {i18n.t('text::Superscript')}: <KeySpan>â†‘</KeySpan>{' '}\n                  {i18n.t('text::or')} <KeySpan>^</KeySpan>\n                </p>\n                <p>\n                  {i18n.t('text::Subscript')}: <KeySpan>â†“</KeySpan>{' '}\n                  {i18n.t('text::or')} <KeySpan>_</KeySpan>\n                </p>\n                <p>\n                  Ï€, Î±, Î², Î³: <KeySpan>pi</KeySpan>, <KeySpan>alpha</KeySpan>,{' '}\n                  <KeySpan>beta</KeySpan>,<KeySpan>gamma</KeySpan>\n                </p>\n                <p>\n                  â‰¤, â‰¥: <KeySpan>{'<='}</KeySpan>, <KeySpan>{'>='}</KeySpan>\n                </p>\n                <p>\n                  {i18n.t('text::Root')}: <KeySpan>\\sqrt</KeySpan>,{' '}\n                  <KeySpan>\\nthroot</KeySpan>\n                </p>\n                <p>\n                  {i18n.t('text::Math symbols')}:{' '}\n                  <KeySpan>{'\\\\<NAME>'}</KeySpan>, {i18n.t('text::e.g.')}{' '}\n                  <KeySpan>\\neq</KeySpan> (â‰ ), <KeySpan>\\pm</KeySpan> (Â±), ...\n                </p>\n                <p>\n                  {i18n.t('text::Functions')}: <KeySpan>sin</KeySpan>,{' '}\n                  <KeySpan>cos</KeySpan>, <KeySpan>ln</KeySpan>, ...\n                </p>\n              </>\n            )\n          },\n        },\n        richText: {\n          toggleStrongTitle: i18n.t('text::Bold (Strg + B)'),\n          toggleEmphasizeTitle: i18n.t('text::Italic (Strg + I)'),\n        },\n        suggestions: {\n          noResultsMessage: i18n.t('text::No items found'),\n        },\n      },\n    }),\n    video: createVideoPlugin({\n      i18n: {\n        src: {\n          label: i18n.t('video::Video URL'),\n        },\n        alt: {\n          label: i18n.t('video::Description'),\n        },\n      },\n    }),\n\n    // Internal plugins for our content types\n    'type-applet': appletTypePlugin,\n    'type-article': articleTypePlugin,\n    'type-course': courseTypePlugin,\n    'type-course-page': coursePageTypePlugin,\n    'type-event': eventTypePlugin,\n    'type-math-puzzle': mathPuzzleTypePlugin,\n    'type-page': pageTypePlugin,\n    'type-taxonomy': taxonomyTypePlugin,\n    'type-text-exercise': textExerciseTypePlugin,\n    'type-text-exercise-group': textExerciseGroupTypePlugin,\n    'type-text-solution': textSolutionTypePlugin,\n    'type-user': userTypePlugin,\n    'type-video': videoTypePlugin,\n  }\n}\n","/**\n * This file is part of Serlo.org.\n *\n * Copyright (c) 2013-2021 Serlo Education e.V.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\")\n * you may not use this file except in compliance with the License\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * @copyright Copyright (c) 2013-2021 Serlo Education e.V.\n * @license   http://www.apache.org/licenses/LICENSE-2.0 Apache License 2.0\n * @link      https://github.com/serlo-org/serlo.org for the canonical source repository\n */\nimport { Editor as Core } from '@edtr-io/core/beta'\nimport { createDefaultDocumentEditor } from '@edtr-io/default-document-editor/beta'\nimport { RowsConfig } from '@edtr-io/plugin-rows'\nimport {\n  createIcon,\n  faAnchor,\n  faCaretSquareDown,\n  faCode,\n  faCubes,\n  faFilm,\n  faImages,\n  faNewspaper,\n  faParagraph,\n  faPhotoVideo,\n  faQuoteRight,\n} from '@edtr-io/ui'\nimport { useI18n } from '@serlo/i18n'\nimport * as React from 'react'\n\nimport { CsrfContext } from './csrf-context'\nimport { deserialize, isError } from './deserialize'\nimport { createPlugins } from './plugins'\n\nexport interface EditorProps {\n  getCsrfToken(): string\n\n  children?: React.ReactNode\n  mayCheckout: boolean\n  onSave: (data: unknown) => Promise<void>\n  onError?: (error: Error, context: Record<string, string>) => void\n  initialState: unknown\n  type: string\n}\n\nexport const SaveContext = React.createContext<{\n  onSave: EditorProps['onSave']\n  mayCheckout: boolean\n}>({\n  onSave: () => {\n    return Promise.reject()\n  },\n  mayCheckout: false,\n})\n\nexport function Editor(props: EditorProps) {\n  const i18n = useI18n()\n\n  let result = deserialize(props)\n  const plugins = createPlugins({\n    getCsrfToken: props.getCsrfToken,\n    registry: getRegistry(),\n    i18n,\n  })\n\n  const DocumentEditor = createDefaultDocumentEditor({\n    i18n: {\n      settings: {\n        buttonLabel: i18n.t('edtr-io::Settings'),\n        modalTitle: i18n.t('edtr-io::Extended Settings'),\n        modalCloseLabel: i18n.t('edtr-io::Close'),\n      },\n    },\n  })\n\n  const legacyUrl = window.location.pathname\n    .replace('add-revision', 'add-revision-old')\n    .replace('create', 'create-old')\n  if (isError(result)) {\n    switch (result.error) {\n      case 'type-unsupported':\n        return (\n          <div className=\"alert alert-danger\" role=\"alert\">\n            {i18n.t(\n              \"edtr-io::This content type isn't supported by the new editor, yet.\"\n            )}{' '}\n            <a href={legacyUrl}>\n              {i18n.t('edtr-io::Edit the content in the old editor.')}\n            </a>\n          </div>\n        )\n      case 'failure':\n        return (\n          <div className=\"alert alert-danger\" role=\"alert\">\n            {i18n.t('edtr-io::An error occurred during the conversion.')}{' '}\n            <a href={legacyUrl}>\n              {i18n.t('edtr-io::Edit the content in the old editor.')}\n            </a>\n          </div>\n        )\n    }\n  }\n  const stored = getStored()\n  if (\n    stored &&\n    confirm(\n      i18n.t(\n        'edtr-io::We found an old revision created by you. Do you want to restore it?'\n      )\n    )\n  ) {\n    result = {\n      success: true,\n      initialState: stored,\n      converted: false,\n    }\n  }\n\n  return (\n    <CsrfContext.Provider value={props.getCsrfToken}>\n      <SaveContext.Provider\n        value={{ onSave: props.onSave, mayCheckout: props.mayCheckout }}\n      >\n        {result.converted ? (\n          <div className=\"alert alert-warning\" role=\"alert\">\n            {i18n.t(\n              \"edtr-io::This entity hasn't been converted to the new editor, yet.\"\n            )}{' '}\n            <a href={legacyUrl}>\n              {i18n.t('edtr-io::Edit the content in the old editor.')}\n            </a>\n          </div>\n        ) : null}\n        <Core\n          DocumentEditor={DocumentEditor}\n          onError={props.onError}\n          plugins={plugins}\n          initialState={result.initialState}\n          editable\n        >\n          {props.children}\n        </Core>\n      </SaveContext.Provider>\n    </CsrfContext.Provider>\n  )\n\n  function getRegistry(): RowsConfig['plugins'] {\n    const isExercise = [\n      'grouped-text-exercise',\n      'text-exercise',\n      'text-exercise-group',\n    ].includes(props.type)\n    return [\n      {\n        name: 'text',\n        title: i18n.t('edtr-io::Text'),\n        description: i18n.t(\n          'edtr-io::Compose content using rich text and math formulas.'\n        ),\n        icon: createIcon(faParagraph),\n      },\n      {\n        name: 'blockquote',\n        title: i18n.t('edtr-io::Quotation'),\n        description: i18n.t('edtr-io::Create indented text for quotations.'),\n        icon: createIcon(faQuoteRight),\n      },\n      {\n        name: 'geogebra',\n        title: i18n.t('edtr-io::GeoGebra Applet'),\n        description: i18n.t(\n          'edtr-io::Embed GeoGebra Materials applets via URL or ID.'\n        ),\n        icon: createIcon(faCubes),\n      },\n      {\n        name: 'highlight',\n        title: i18n.t('edtr-io::Source Code'),\n        description: i18n.t('edtr-io::Highlight the syntax of source code.'),\n        icon: createIcon(faCode),\n      },\n      {\n        name: 'anchor',\n        title: i18n.t('edtr-io::Anchor'),\n        description: i18n.t('edtr-io::Insert an anchor.'),\n        icon: createIcon(faAnchor),\n      },\n      {\n        name: 'equations',\n        title: i18n.t('edtr-io::Equations'),\n        description: i18n.t(\n          'edtr-io::Create mathematical equations and terms.'\n        ),\n      },\n      {\n        name: 'image',\n        title: i18n.t('edtr-io::Image'),\n        description: i18n.t('edtr-io::Upload images.'),\n        icon: createIcon(faImages),\n      },\n      {\n        name: 'important',\n        title: i18n.t('edtr-io::Important Statement'),\n        description: i18n.t(\n          'edtr-io::A box to highlight important statements.'\n        ),\n      },\n      {\n        name: 'injection',\n        title: i18n.t('edtr-io::serlo.org Content'),\n        description: i18n.t('edtr-io::Embed serlo.org content via their ID.'),\n        icon: createIcon(faNewspaper),\n      },\n      {\n        name: 'multimedia',\n        title: i18n.t('edtr-io::Multimedia content associated with text'),\n        description: i18n.t(\n          'edtr-io::Create an illustrating or explaining multimedia content associated with text.'\n        ),\n        icon: createIcon(faPhotoVideo),\n      },\n      {\n        name: 'spoiler',\n        title: i18n.t('edtr-io::Spoiler'),\n        description: i18n.t('edtr-io::A collapsible box.'),\n        icon: createIcon(faCaretSquareDown),\n      },\n      {\n        name: 'table',\n        title: i18n.t('edtr-io::Table'),\n        description: i18n.t('edtr-io::Create tables using Markdown.'),\n      },\n      {\n        name: 'video',\n        title: i18n.t('edtr-io::Video'),\n        description: i18n.t(\n          'edtr-io::Embed YouTube, Vimeo, Wikimedia Commons or BR videos.'\n        ),\n        icon: createIcon(faFilm),\n      },\n      ...(isExercise\n        ? [\n            {\n              name: 'separator',\n              title: i18n.t('edtr-io::Solution Separator'),\n              description: i18n.t(\n                'edtr-io::Divide the solution into individual steps.'\n              ),\n            },\n          ]\n        : []),\n    ]\n  }\n}\n\nfunction getStored(): { plugin: string; state?: unknown } | undefined {\n  const edtr = localStorage.getItem('edtr')\n  if (!edtr) return\n\n  const state = JSON.parse(edtr)\n  return state[window.location.pathname]\n}\n\nexport function storeState(state: unknown) {\n  const currentValue = localStorage.getItem('edtr')\n  const edtr = currentValue ? JSON.parse(currentValue) : {}\n\n  edtr[window.location.pathname] = state\n\n  localStorage.setItem('edtr', JSON.stringify(edtr))\n}\n","/**\n * This file is part of Serlo.org.\n *\n * Copyright (c) 2013-2021 Serlo Education e.V.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\")\n * you may not use this file except in compliance with the License\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * @copyright Copyright (c) 2013-2021 Serlo Education e.V.\n * @license   http://www.apache.org/licenses/LICENSE-2.0 Apache License 2.0\n * @link      https://github.com/serlo-org/serlo.org for the canonical source repository\n */\nimport { useI18n } from '@serlo/i18n'\nimport { Renderer as Core, RendererProps } from '@edtr-io/renderer'\nimport * as React from 'react'\n\nimport { createPlugins } from './plugins'\n\nexport function Renderer({ state }: { state: RendererProps['state'] }) {\n  const i18n = useI18n()\n  const plugins = createPlugins({\n    getCsrfToken: () => '',\n    registry: [],\n    i18n: i18n,\n  })\n  return <Core plugins={plugins} state={state || { plugin: 'text' }} />\n}\n","/**\n * This file is part of Serlo.org.\n *\n * Copyright (c) 2013-2021 Serlo Education e.V.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\")\n * you may not use this file except in compliance with the License\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * @copyright Copyright (c) 2013-2021 Serlo Education e.V.\n * @license   http://www.apache.org/licenses/LICENSE-2.0 Apache License 2.0\n * @link      https://github.com/serlo-org/serlo.org for the canonical source repository\n */\nimport { serializer, slateValueToHtml } from '@edtr-io/plugin-text/internal'\nimport { Edtr } from '@serlo/legacy-editor-to-editor'\nimport * as R from 'ramda'\nimport { Value } from 'slate'\n\nexport function cleanEdtrState(state: Edtr) {\n  return cleanJson(state)\n\n  /* eslint-disable @typescript-eslint/no-explicit-any */\n  function cleanJson(jsonObj: any): any {\n    if (jsonObj !== null && typeof jsonObj === 'object') {\n      return R.map((value: any) => {\n        if (value.plugin === 'text' && value.state) {\n          const slateValue = Value.fromJSON(serializer.deserialize(value.state))\n          return {\n            ...value,\n            state: slateValueToHtml(slateValue),\n          }\n        }\n        return cleanJson(value)\n      }, jsonObj)\n    } else {\n      // jsonObj is a number or string\n      return jsonObj\n    }\n  }\n  /* eslint-enable @typescript-eslint/no-explicit-any */\n}\n"],"names":["CsrfContext","React","createContext","empty","plugin","state","deserialize","initialState","type","onError","stack","config","applet","deserializeApplet","article","deserializeArticle","course","deserializeCourse","deserializeCoursePage","event","deserializeEvent","deserializeMathPuzzle","page","deserializePage","deserializeTextExercise","deserializeTextExerciseGroup","deserializeTextSolution","user","deserializeUser","video","deserializeVideo","taxonomy","deserializeTaxonomy","undefined","error","succeed","e","JSON","stringify","deserialized","success","push","id","changes","title","url","content","serializeEditorState","toEdtr","deserializeEditorState","reasoning","meta_title","meta_description","converted","isEdtr","getContent","deserializedContent","convertedContent","introduction","exercises","exerciseFolder","relatedContent","articles","courses","videos","sources","description","map","s","icon","source","term","textSolution","singleChoiceRightAnswer","singleChoiceWrongAnswer","multipleChoiceRightAnswer","multipleChoiceWrongAnswer","inputExpressionEqualMatchChallenge","inputNumberExactMatchChallenge","inputStringNormalizedMatchChallenge","scMcExercise","deserializeScMcExercise","inputExercise","deserializeInputExercise","interactive","convertedSCRightAnswers","extractChildFromRows","convert","isCorrect","feedback","convertedSCWrongAnswers","filter","answer","convertedMCRightAnswers","convertedMCWrongAnswers","isSingleChoice","length","answers","inputExercises","filterDefined","extractInputAnswers","unit","exercise","value","solution","children","R","array","el","cohesive","prerequisite","strategy","steps","isError","result","parse","licenseState","object","number","string","agreement","iconHref","uuid","license","entity","revision","HeaderInput","styled","input","border","width","borderBottom","outline","borderColor","Controls","props","i18n","useI18n","store","useScopedStore","dispatch","useScopedDispatch","undoable","useScopedSelector","hasUndoActions","redoable","hasRedoActions","pendingChanges","getPendingChanges","hasPendingChanges","getCsrfToken","visible","setVisibility","pending","setPending","hasError","setHasError","savedToLocalstorage","setSavedToLocalstorage","SaveContext","onSave","mayCheckout","setAgreement","emailSubscription","setEmailSubscription","notificationSubscription","setNotificationSubscription","autoCheckout","setAutoCheckout","window","onbeforeunload","createPortal","className","onClick","undo","disabled","redo","renderSaveButton","document","getElementsByClassName","BSModal","show","onHide","Header","closeButton","Title","t","Body","renderAlert","renderChanges","renderLicense","renderSubscription","renderCheckout","Footer","BSButton","handleSave","bsStyle","maySave","getSaveHint","useOverlay","subscriptions","buttonProps","licenseAccepted","changesFilledIn","serializedRoot","serializeRootDocument","getState","serialized","String","csrf","controls","subscription","subscribe","mailman","checkout","then","storeState","BSAlert","onDismiss","BSFormGroup","controlId","BSControlLabel","BSFormControl","componentClass","onChange","target","set","BSCheckbox","checked","dangerouslySetInnerHTML","__html","entityType","ownTypes","getFocusableChildren","objectType","init","initialisedObject","replaceOwnState","newValue","previousState","helpers","_value","key","editorContent","originalChild","child","serialize","serializedChild","skipControls","optionalSerializedChild","updater","oldId","create","_oldId","createInitialState","remove","OptionalChild","expectedStateType","getDocument","render","renderToolbar","PluginToolbarButton","Icon","faTrashAlt","label","removeLabel","onRemove","StyledTR","tr","selected","cursor","RevisionHistory","availableRevisions","setAvailableRevisions","showRevisions","setShowRevisions","fetch","response","json","data","faHistory","size","bsSize","BSTable","striped","hover","revisionData","currentRevision","active","dateTime","moment","utc","timestamp","local","alert","onSwitchRevision","faCheck","author","format","fromNow","Settings","Textarea","SettingsTextarea","Select","SettingsSelect","options","placeholder","option","appletTypeState","appletTypePlugin","Component","AppletTypeEditor","renderIntoToolbar","renderIntoSettings","editable","itemProp","articleTypeState","articleTypePlugin","ArticleTypeEditor","courseTypeState","list","courseTypePlugin","CourseTypeEditor","index","AddButton","insert","coursePageTypeState","coursePageTypePlugin","CoursePageTypeEditor","includes","eventTypeState","eventTypePlugin","EventTypeEditor","mathPuzzleTypeState","mathPuzzleTypePlugin","MathPuzzleTypeEditor","pageTypeState","pageTypePlugin","PageTypeEditor","taxonomyTypeState","name","parent","position","taxonomyTypePlugin","TaxonomyTypeEditor","textExerciseTypeState","textExerciseTypePlugin","TextExerciseTypeEditor","Container","div","boxShadow","marginTop","padding","minHeight","SemanticSection","textExerciseGroupTypeState","boolean","textExerciseGroupTypePlugin","TextExerciseGroupTypeEditor","isCohesive","virtualParent","virtualizer","useVirtual","parentRef","estimateSize","contentRendered","renderSettings","getSettings","ref","style","height","overflow","totalSize","virtualItems","virtualRow","measureRef","top","left","transform","start","getExerciseIndex","htmlFor","fromCharCode","textSolutionTypeState","textSolutionTypePlugin","TextSolutionTypeEditor","solutionTheme","rendererUi","expandableBox","toggleBackgroundColor","containerBorderColor","renderTitle","collapsed","ThemeProvider","theme","ExpandableBox","userTypeState","userTypePlugin","UserTypeEditor","videoTypeState","videoPlugin","createVideoPlugin","videoTypePlugin","VideoTypeEditor","src","alt","OverlayTriangle","borderPosition","positionAbove","borderLeft","borderRight","InlineOverlayWrapper","opacity","transition","zIndex","whiteSpace","InlineOverlayContentWrapper","backgroundColor","color","borderRadius","HoveringOverlay","overlay","triangle","setPositionAbove","current","menu","rect","anchor","getBoundingClientRect","native","getSelection","rangeCount","range","getRangeAt","offsetParent","parentRect","aboveValue","offsetHeight","bottom","Math","min","max","offsetWidth","offsetLeft","allowSelectionOverflow","InlinePreview","span","ChangeButton","display","margin","InlineSettings","onDelete","InlineInputInner","InlineInputRefForward","InlineSettingsInput","InlineInput","Plain","setState","Editor","onFocus","editor","next","setTimeout","relatedContentItemState","articleState","href","articlePlugin","ArticleEditor","OpenInNewTab","BasePluginToolbarButton","button","background","MinWidthIcon","PluginToolbarButtonIcon","spoilerTheme","toggleColor","focusedInlineSetting","setFocusedInlineSetting","isFocused","renderExercises","renderRelatedContent","renderSources","header","folderHeader","DragDropContext","onDragEnd","destination","move","Droppable","droppableId","provided","innerRef","droppableProps","Draggable","draggableId","draggableProps","dragHandleProps","EdtrIcon","edtrDragHandle","replace","rel","faExternalLinkAlt","types","faNewspaper","fixedWidth","section","addLabel","idPlaceholder","openLinkInNewTabPlaceholder","dragLabel","faGraduationCap","faPlayCircle","allItems","renderRelatedContentSection","item","flexGrow","alwaysVisible","errorState","scalar","ErrorRenderer","errorPlugin","Sign","renderSignToString","sign","Equals","GreaterThan","GreaterThanOrEqual","LessThan","LessThanOrEqual","AlmostEqualTo","Estimates","TableWrapper","overflowX","Table","table","MathTd","td","verticalAlign","LeftTd","textAlign","SignTd","TransformTd","paddingLeft","ExplanationTr","EquationsRenderer","renderFirstExplanation","step","MathRenderer","inline","right","isEmpty","explanation","renderDownArrow","colSpan","firstExplanation","downArrow","downArrowBase64","Buffer","from","toString","backgroundImage","backgroundSize","backgroundRepeat","backgroundPosition","StepSegment","preferenceKey","setDefaultPreference","RemoveButton","DragButton","paddingRight","EquationsEditor","focused","focusedElement","getFocused","nestedFocus","gridFocus","useGridFocus","rows","columns","focusNext","focusPrevious","onFocusChanged","focus","column","Explanation","row","setFocus","HotKeys","allowChanges","keyMap","FOCUS_NEXT_OR_INSERT","FOCUS_PREVIOUS","INSERT","handlers","handleKeyDown","Transform","insertNewEquationAt","moveRight","moveLeft","insertNewEquationWithFocus","tabIndex","StepEditor","faTimes","renderExplantionTr","renderAddButton","preventDefault","Left","DropDown","select","marginLeft","marginRight","InlineMath","onFocusNext","onFocusPrevious","Right","prefix","suffix","preferences","PreferenceContext","MathEditor","readOnly","disableBlock","visual","getKey","onEditorChange","setKey","onInlineChange","onMoveOutRight","onMoveOutLeft","setFocusState","stepProps","equationsState","equationsPlugin","exerciseState","optional","exercisePlugin","ExerciseEditor","ButtonContainer","interactivePlugins","InlineOptionsWrapper","InlineOptionsContentWrapper","InlineOptions","Option","minWidth","showOptions","setShowOptions","renderInteractive","defined","onMouseLeave","faRandom","getCurrentInteractivePlugin","doc","MAX_FILE_SIZE","ALLOWED_EXTENSIONS","FileErrorCode","matchesAllowedExtensions","fileName","extension","toLowerCase","slice","lastIndexOf","indexOf","handleErrors","errors","errorCode","message","errorCodeToMessage","join","TOO_MANY_FILES","NO_FILE_SELECTED","BAD_EXTENSION","FILE_TOO_BIG","UPLOAD_FAILED","validateFile","file","uploadErrors","valid","createUploadImageHandler","readFile","createReadFile","uploadImageHandler","validation","Promise","reject","loaded","dataUrl","resolve","reader","FileReader","onload","formData","FormData","append","method","body","files","location","readAsDataURL","createImagePlugin","createCoreImagePlugin","upload","validate","secondInput","importantState","createImportantPlugin","ImportantRenderer","Box","injectionState","injectionPlugin","InjectionEditor","InjectionRenderer","setLoaded","createURL","headers","Common","trigger","startsWith","substring","match","PlaceholderWrapper","cache","setCache","preview","setPreview","timeout","clearTimeout","PreviewOverlay","nextActive","EditorInlineSettings","EditorInput","inputWidth","autofocusRef","OverlayInput","LayoutContainer","flexDirection","flexWrap","alignItems","ChildContainer","ConvertInfo","ConvertButton","LayoutRenderer","convertToRow","canConvertToMultimediaExplanation","convertToMultimediaExplanation","documents","forEach","element","serializeDocument","rowsItem","isMultimediaColumn","replaceWithMultimediaExplanation","explanationColumn","multimediaColumn","multimedia","illustrating","columnDocument","isMultimediaPlugin","layoutState","layoutPlugin","separatorState","separatorPlugin","SeparatorEditor","paddingTop","paddingBottom","Separator","hr","marginBottom","solutionState","solutionPlugin","SolutionEditor","hasStrategy","renderPrerequisite","renderContent","edtrTablePlugin","createTablePlugin","MarkdownRenderer","html","converter","makeHtml","markdown","tablePlugin","TableEditor","initMathJax","typesetMathjax","typeset","deprecatedState","DeprecatedRenderer","deprecatedPlugin","createPlugins","registry","createAnchorPlugin","articleIntroduction","createMultimediaExplanationPlugin","plugins","changeMultimediaType","values","explaining","blockquote","createBlockquotePlugin","deprecated","equations","geogebra","createGeogebraPlugin","highlight","createHighlightPlugin","code","language","showLineNumbers","image","important","injection","createInputExercisePlugin","InputExerciseType","InputStringNormalizedMatchChallenge","InputNumberExactMatchChallenge","InputExpressionEqualMatchChallenge","inputPlaceholder","fallbackFeedback","correct","wrong","layout","createRowsPlugin","searchPlaceholder","settings","duplicateLabel","closeLabel","toolbar","createScMcExercisePlugin","singleChoice","multipleChoice","globalFeedback","missingCorrectAnswers","separator","spoiler","createSpoilerPlugin","text","createTextPlugin","toggleTitle","colors","setColorTitle","resetColorTitle","openMenuTitle","closeMenuTitle","headings","setHeadingTitle","level","link","openInNewTabTitle","toggleOrderedList","toggleUnorderedList","math","displayBlockLabel","editors","latex","noVisualEditorAvailableMessage","helpText","KeySpan","richText","toggleStrongTitle","toggleEmphasizeTitle","suggestions","noResultsMessage","getRegistry","DocumentEditor","createDefaultDocumentEditor","buttonLabel","modalTitle","modalCloseLabel","legacyUrl","pathname","role","stored","getStored","confirm","Provider","Core","isExercise","createIcon","faParagraph","faQuoteRight","faCubes","faCode","faAnchor","faImages","faPhotoVideo","faCaretSquareDown","faFilm","edtr","localStorage","getItem","currentValue","setItem","Renderer","cleanEdtrState","cleanJson","jsonObj","slateValue","Value","fromJSON","serializer","slateValueToHtml"],"mappings":"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"}
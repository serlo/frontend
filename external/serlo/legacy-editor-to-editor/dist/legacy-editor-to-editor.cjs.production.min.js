"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e,t,n=require("uuid"),r=require("@serlo/markdown"),i=require("ramda"),o=require("@edtr-io/plugin-text"),l=require("react"),s=(e=require("slate-html-serializer"))&&"object"==typeof e&&"default"in e?e.default:e,a=require("parse5"),c=require("slate");function u(){return(u=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function p(e){return void 0!==e.cells}!function(e){e.AlphabetSort="@serlo-org/alphabet-sort",e.Anchor="@serlo-org/anchor",e.Blockquote="@serlo-org/blockquote",e.Equations="@serlo-org/equations",e.Geogebra="@serlo-org/geogebra",e.H5p="@serlo-org/h5p",e.Highlight="@serlo-org/highlight",e.Hint="@serlo-org/hint",e.Image="@splish-me/image",e.Injection="@serlo-org/injection",e.InputExercise="@serlo-org/input-exercise",e.License="@serlo-org/license",e.MatchingExercise="@serlo-org/matching-exercise",e.ScMcExercise="@serlo-org/sc-mc-exercise",e.Solution="@serlo-org/solution",e.Spoiler="@serlo-org/spoiler",e.StepByStep="@serlo-org/step-by-step",e.Table="@serlo-org/table",e.Text="@splish-me/slate"}(t||(t={}));var d=function(e){var t=r.converter.makeHtml(e);return(t=t.replace(/"/gm,'"')).replace(/<span class="mathInline">%%(.*?)%%<\/span>/gm,"<katexinline>$1</katexinline>").replace(/<span class="math">\$\$(.*?)\$\$<\/span>/gm,"<katexblock>$1</katexblock>").replace(/\r?\n/gm,"")},m=function(e){return{content:{plugin:{name:t.Text,version:"0.0.0"},state:{importFromHtml:d(e)}}}},g=function(e){var t=e.elements,n=e.normalized.split(/(§\d+§)/).map((function(e){return e.trim()})).filter((function(e){return""!==e}));return n.length?n.map((function(e){var n=/§(\d+)§/.exec(e);if(null!==n){var r=parseInt(n[1]);return{cells:[f(t[r])]}}return{cells:[m(e)]}})):[{cells:[m("")]}]},f=function(e){switch(e.name){case"table":return{content:{plugin:{name:t.Table,version:"0.0.0"},state:{src:e.src}}};case"spoiler":return{content:{plugin:{name:t.Spoiler,version:"0.0.0"},state:{title:e.title,content:{type:"@splish-me/editor-core/editable",state:{id:n.v4(),cells:[{id:n.v4(),rows:g(e.content)}]}}}}};case"blockquote":return{content:{plugin:{name:t.Blockquote,version:"0.0.0"},state:{child:{type:"@splish-me/editor-core/editable",state:{id:n.v4(),cells:[{id:n.v4(),rows:g(e.content)}]}}}}};case"injection":return{content:{plugin:{name:t.Injection,version:"0.0.0"},state:{description:e.description,src:e.src}}};case"geogebra":return{content:{plugin:{name:t.Geogebra,version:"0.0.0"},state:{description:e.description,src:e.src}}};case"image":return{content:{plugin:{name:t.Image,version:"0.0.0"},state:{description:e.description,title:e.title,src:e.src,href:e.href?e.href:void 0}}};case"code":return{content:{plugin:{name:"code"},state:{language:e.language,src:e.src}}}}},h=new RegExp(/(\A|\n)```(\S*)\n([\s\S]*?)\r?\n?```/m),b=new RegExp(/^\/\/\/ (.*)\n([\s\S]*?)(\n|\r)+\/\/\//m),v=new RegExp(/>\[(.*)\]\(((?!ggt\/).*)\)/),x=new RegExp(/>\[(.*)\]\(ggt\/(.*)\)/),w=new RegExp(/!\[(.*?)\]\((.*?)( "(.*)?")?\)/),k=new RegExp(/\[!\[(.*?)\]\((.*?)( "(.*)?")?\)\]\((.*?)\)/),j=new RegExp(/(^|\n)(((\|[^|\r\n]*)+\|( |\t)*(\r?\n|\r)?)+)/),y=new RegExp(/((((\A|\n+)(?!>\[.*?\]\(.*?\))>[\s\S]+?)(?=(\r?\n\r?\n\w)|$|(>\[.*?\]\(.*?\))))+)/m),z=function(e){var t={normalized:e,elements:[]};return function(e){return N(w,(function(e){return{name:"image",description:e[1],src:e[2],title:e[4]}}),e)}(t=function(e){return N(k,(function(e){return{name:"image",description:e[1],src:e[2],title:e[4],href:e[5]}}),e)}(t=function(e){return N(x,(function(e){return{name:"geogebra",description:e[1],src:e[2]}}),e)}(t=function(e){return N(v,(function(e){return{name:"injection",description:e[1],src:e[2]}}),e)}(t=function(e){return N(y,(function(e){return{name:"blockquote",content:z(e[1].replace(/(^|\n)>/g,"$1"))}}),e)}(t=function(e){return N(j,(function(e){return{name:"table",src:e[0]}}),e)}(t=function(e){return N(b,(function(e){return{name:"spoiler",title:e[1],content:z(e[2])}}),e)}(t=function(e){return N(h,(function(e){return{name:"code",language:e[2].trim(),src:e[3]}}),e)}(t))))))))},N=function(e,t,n){for(var r=n.normalized,i=n.elements,o=e.exec(r);null!==o;)r=r.replace(e,"§"+i.length+"§"),i=[].concat(i,[t(o)]),o=e.exec(r);return{normalized:r,elements:i}},E=function(e){return g(z(e))};function S(e){if(function(e){return void 0!==e.raw}(e))return{size:e.size,rows:E(e.raw)};var t=e.rows;return u({},e,{rows:(void 0===t?[]:t).map(q)})}function q(e){return u({},e,{cells:e.cells.map(S)})}var I=function(e){return e.map((function(e){return{size:Math.floor(e.col/2),raw:e.content}}))};function L(e){var t,n,r,o;return T(e)?null!=e&&null!=(t=e.nodes)&&t.some(H)&&null!=e&&null!=(n=e.nodes)&&n.some(T)?i.chain(L,function(e){if(void 0===e.nodes)return[e];for(var t=[],n=e.nodes;n.length>0;){var r=i.splitWhen(T,n),o=r[0],l=r[1];o.length>0&&t.push(u({},e,{nodes:o})),l.length>0&&t.push(l[0]),n=l.slice(1)}return t}(e)):[u({},e,{nodes:i.chain(L,null!=(r=e.nodes)?r:[])})]:function(e){return"document"===(null==e?void 0:e.object)}(e)?[u({},e,{nodes:i.chain(L,null!=(o=e.nodes)?o:[])})]:[e]}function T(e){return"block"===(null==e?void 0:e.object)}function H(e){return"inline"===(null==e?void 0:e.object)||"text"===(null==e?void 0:e.object)}var R=function(e){return"@splish-me/h"+e};function $(e){var t;return u({},t=new s({rules:[C,O,B,A,F,M,{deserialize:function(e){if(e.tagName&&"br"===e.tagName.toLowerCase())return{object:"text",text:"\n"};if("#text"===e.nodeName){if(e.value&&e.value.match(/<!--.*?-->/))return;return{object:"text",text:e.value}}}}],defaultBlock:{type:"paragraph"},parseHtml:function(e){return a.parseFragment(e)}}).deserialize(e,{toJSON:!0}),{document:t.document?L(t.document)[0]:void 0})}var C={deserialize:function(e,t){var n=e.tagName.toLowerCase().match(/h([1-6])/);if(n){var r=parseInt(n[1],10);return{object:"block",type:R(r),nodes:t(e.childNodes)}}}},O={deserialize:function(e,t){if("a"===e.tagName.toLowerCase()){var n=e.attrs.find((function(e){return"href"===e.name}));return{object:"inline",type:"@splish-me/a",nodes:t(e.childNodes),data:{href:n?n.value:""}}}}},B={deserialize:function(e,t){switch(e.tagName.toLowerCase()){case"ol":return{object:"block",type:"ordered-list",nodes:t(e.childNodes)};case"ul":return{object:"block",type:"unordered-list",nodes:t(e.childNodes)};case"li":return{object:"block",type:"list-item",nodes:[{object:"block",type:"list-item-child",nodes:t(e.childNodes)}]}}}},A={deserialize:function(e,t){if("p"===e.tagName.toLowerCase())return{object:"block",type:"paragraph",nodes:t(e.childNodes)}}},F={deserialize:function(e,t){switch(e.tagName.toLowerCase()){case"strong":case"b":return{object:"mark",type:"@splish-me/strong",nodes:t(e.childNodes)};case"em":case"i":return{object:"mark",type:"@splish-me/em",nodes:t(e.childNodes)}}}},M={deserialize:function(e,t){switch(e.tagName.toLowerCase()){case"katexblock":return{object:"block",type:"@splish-me/katex-block",data:{formula:e.childNodes[0].value,inline:!1},nodes:t(e.childNodes)};case"katexinline":return{object:"inline",type:"@splish-me/katex-inline",data:{formula:e.childNodes[0].value,inline:!0},nodes:t(e.childNodes)};default:return}}},G={serialize:function(e,t){if("block"===e.object){var n=e.type.match(/@splish-me\/h([1-6])/);if(n){var r=parseInt(n[1],10);return l.createElement("h"+r,{node:e},t)}}}},J={serialize:function(e,t){if("inline"===e.object&&"@splish-me/a"===e.type){var n=e.data.get("href");return l.createElement("a",{href:n},t)}}},P={serialize:function(e,t){switch(e.type){case"@splish-me/ul":return l.createElement("ul",null,t);case"@splish-me/ol":return l.createElement("ol",null,t);case"@splish-me/li":return l.createElement("li",null,t)}}},W={serialize:function(e,t){if("paragraph"===e.type||"@splish-me/p"===e.type)return l.createElement("p",null,t)}},_={serialize:function(e,t){if("mark"===e.object)switch(e.type){case"@splish-me/strong":return l.createElement("strong",null,t);case"@splish-me/em":return l.createElement("em",null,t)}}},V={serialize:function(e,t){var n=e;if("block"===e.object&&"@splish-me/katex-block"===e.type){var r=e.data.get("formula");return l.createElement("katexblock",null,r)}if("inline"===n.object&&"@splish-me/katex-inline"===n.type){var i=e.data.get("formula");return l.createElement("katexinline",null,i)}}};function D(e){var n,r=e.content,i=r.plugin,l=r.state;switch(i.name){case t.Blockquote:return{plugin:"important",state:X(l.child.state)};case t.Image:return{plugin:"image",state:{alt:l.description,link:l.href?{href:l.href,openInNewTab:!1}:void 0,src:l.src,maxWidth:void 0}};case t.Injection:return{plugin:"injection",state:l.src};case t.Spoiler:return{plugin:"spoiler",state:{title:l.title,content:X(l.content.state)}};case t.Text:var u=l;return u.editorState?{plugin:"text",state:o.serializer.serialize((n=u.editorState,$(new s({rules:[G,J,P,W,_,V],defaultBlock:{type:"paragraph"},parseHtml:function(e){return a.parseFragment(e)}}).serialize(c.Value.fromJSON(n),{render:!0}))))}:{plugin:"text",state:o.serializer.serialize($(u.importFromHtml||""))};case t.Table:return{plugin:"table",state:l.src};case t.Geogebra:return{plugin:"geogebra",state:l.src};case"code":return{plugin:"highlight",state:{language:l.language,code:l.src,showLineNumbers:!1}};default:return{plugin:"error",state:{plugin:i.name,state:l}}}}function K(e){return e.cells.length?e.cells.length>1?[{plugin:"layout",state:e.cells.map((function(e){return{width:e.size||12,child:{plugin:"rows",state:Q(e)}}}))}]:Q(e.cells[0]):[]}function Q(e){return function(e){return void 0!==e.content}(e)?[D(e)]:i.reduce((function(e,t){return i.concat(e,K(t))}),[],e.rows)}function U(e,t){var n,r=function(e){return u({},e,{cells:e.cells.map(S)})}("string"==typeof(n=e)?{cells:[{rows:[{cells:[{size:12,raw:n}]}]}]}:{cells:[{rows:n.map((function(e){return{cells:I(e)}}))}]});return u({},r,{id:t})}function X(e){return{plugin:"rows",state:K(e)}}exports.convert=function(e){return e?X(p(e)?e:U(e,"")):{plugin:"rows",state:[]}},exports.convertLegacyToSplish=U,exports.convertSplishToEdtrIO=X,exports.isEdtr=function(e){return void 0!==e.plugin},exports.isSplish=p;
//# sourceMappingURL=legacy-editor-to-editor.cjs.production.min.js.map

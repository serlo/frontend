{"version":3,"file":"markdown.esm.js","sources":["../src/extensions/serlo_code_prepare.js","../src/extensions/injections.js","../src/extensions/table.js","../src/extensions/html_strip.js","../src/extensions/latex.js","../src/extensions/at_username.js","../src/extensions/strike_through.js","../src/extensions/spoiler.js","../src/extensions/spoiler_prepare.js","../src/extensions/latex_output.js","../src/extensions/serlo_code_output.js","../src/index.ts"],"sourcesContent":["/**\n * This file is part of Serlo.org.\n *\n * Copyright (c) 2013-2021 Serlo Education e.V.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\")\n * you may not use this file except in compliance with the License\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * @copyright Copyright (c) 2013-2021 Serlo Education e.V.\n * @license   http://www.apache.org/licenses/LICENSE-2.0 Apache License 2.0\n * @link      https://github.com/serlo-org/serlo.org for the canonical source repository\n */\n/* global define */\n/* Prepares Github Style Code */\nvar codeprepare = function () {\n  return [\n    {\n      type: 'lang',\n      filter: (function () {\n        var replacements = {}\n        var replacementRegexp = ''\n        var codeRegexp = /(?:^|\\n)```(.*)\\n([\\s\\S]*?)\\n```/gm\n        var charsToDecode = ['~D', '%', '\\\\|', '/']\n        var i\n        var l\n\n        for (i = 0, l = charsToDecode.length; i < l; i++) {\n          // replacementRegexp += '\\\\' + charsToDecode[i];\n          // charsToDecode[i] = '\\\\' + charsToDecode[i];\n          replacements[charsToDecode[i].replace(/\\\\/g, '')] = '§SC' + i\n        }\n\n        // (~D|\\$|/|%)\n        // (~D|%|\\||\\/)/gm\n        replacementRegexp = new RegExp(\n          '(' + charsToDecode.join('|') + ')',\n          'gm'\n        )\n\n        function replace(whole, language, code) {\n          // escape all chars in code\n          code = code.replace(replacementRegexp, function (match) {\n            return replacements[match] || match\n          })\n\n          return '\\n```' + language + '\\n' + code + '\\n```'\n        }\n\n        return function (text) {\n          return text.replace(codeRegexp, replace)\n        }\n      })(),\n    },\n  ]\n}\n\nexport default codeprepare\n","/**\n * This file is part of Serlo.org.\n *\n * Copyright (c) 2013-2021 Serlo Education e.V.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\")\n * you may not use this file except in compliance with the License\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * @copyright Copyright (c) 2013-2021 Serlo Education e.V.\n * @license   http://www.apache.org/licenses/LICENSE-2.0 Apache License 2.0\n * @link      https://github.com/serlo-org/serlo.org for the canonical source repository\n */\n/* global define */\n/**\n * Serlo Flavored Markdown\n * Injections:\n * Transforms >[Title](injectionUrl)\n * into <div class=\"injection\"><a href=\"injectionUrl\" class=\"injection-link\">Title</a></div>\n **/\nvar injections = function () {\n  var filter\n  var findInjections = new RegExp(/>\\[(.*)\\]\\((.*)\\)/g)\n\n  // Corrects relative urls with missing leading slash\n  function correctUrl(url) {\n    url = url.split('/')\n    // Url does start with http\n    if (url[0] === 'http:' || url[0] === 'https:') {\n      // is invalid for injections, but do nothing\n      return url.join('/')\n    }\n\n    // first item is empty, means there already is a leading slash\n    if (url[0] === '') {\n      url.shift()\n    }\n\n    // Url does not start with / or http\n    return '/' + url.join('/')\n  }\n\n  filter = function (text) {\n    return text.replace(findInjections, function (original, title, url) {\n      const href = correctUrl(url)\n\n      if (/assets\\.serlo\\.org\\/legacy\\/.*\\.xml/.test(href)) {\n        return `<div class=\"legacy-injection\">Legacy GeoGebra applets aren't supported anymore. Please upload the applet to GeoGebra instead.</div>`\n      }\n      if (/assets\\.serlo\\.org\\/legacy\\//.test(href)) {\n        return `<div>\n            <div class=\"injection\"><a href=\"${href}\" class=\"injection-link\">${title}</a></div>\n            <div class=\"legacy-injection\">Please don't use injections for images. Change <code>>[...](...)</code> to <code>![...](...)</code></div>\n          </div>`\n      }\n\n      return `<div class=\"injection\"><a href=\"${href}\" class=\"injection-link\">${title}</a></div>`\n    })\n  }\n\n  return [\n    {\n      type: 'lang',\n      filter: filter,\n    },\n  ]\n}\n\nexport default injections\n","/**\n * This file is part of Serlo.org.\n *\n * Copyright (c) 2013-2021 Serlo Education e.V.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\")\n * you may not use this file except in compliance with the License\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * @copyright Copyright (c) 2013-2021 Serlo Education e.V.\n * @license   http://www.apache.org/licenses/LICENSE-2.0 Apache License 2.0\n * @link      https://github.com/serlo-org/serlo.org for the canonical source repository\n */\n/* global define */\n/*\n * Basic table support with re-entrant parsing, where cell content\n * can also specify markdown.\n *\n * Tables\n * ======\n *\n * | Col 1   | Col 2                                              |\n * |======== |====================================================|\n * |**bold** | ![Valid XHTML] (http://w3.org/Icons/valid-xhtml10) |\n * | Plain   | Value                                              |\n *\n */\nvar table = function () {\n  var tables = {}\n  var style = 'text-align:left;'\n  var filter\n  var callbackConverter\n\n  tables.th = function (header) {\n    return (\n      '<th style=\"' +\n      style +\n      '\">' +\n      callbackConverter.makeHtml(header) +\n      '</th>'\n    )\n  }\n  tables.td = function (cell) {\n    return (\n      '<td style=\"' + style + '\">' + callbackConverter.makeHtml(cell) + '</td>'\n    )\n  }\n  tables.ths = function () {\n    var out = ''\n    var i = 0\n    var hs = [].slice.apply(arguments)\n\n    for (i; i < hs.length; i += 1) {\n      out += tables.th(hs[i]) + '\\n'\n    }\n    return out\n  }\n  tables.tds = function () {\n    var out = ''\n    var i = 0\n    var ds = [].slice.apply(arguments)\n    for (i; i < ds.length; i += 1) {\n      out += tables.td(ds[i]) + '\\n'\n    }\n    return out\n  }\n  tables.thead = function () {\n    var out\n    var hs = [].slice.apply(arguments)\n    out = '<thead>\\n'\n    out += '<tr>\\n'\n    out += tables.ths.apply(this, hs)\n    out += '</tr>\\n'\n    out += '</thead>\\n'\n    return out\n  }\n  tables.tr = function () {\n    var out\n    var cs = [].slice.apply(arguments)\n    out = '<tr>\\n'\n    out += tables.tds.apply(this, cs)\n    out += '</tr>\\n'\n    return out\n  }\n  filter = function (text, converter) {\n    var i = 0\n    var lines = text.split('\\n')\n    var tbl = []\n    var line\n    var hs\n    var out = []\n    callbackConverter = converter\n\n    for (i; i < lines.length; i += 1) {\n      line = lines[i]\n      // looks like a table heading\n      if (line.trim().match(/^[|]{1}.*[|]{1}$/)) {\n        line = line.trim()\n        tbl.push('<div class=\"table-responsive\">')\n        tbl.push('<table class=\"table table-striped\">')\n        hs = line.substring(1, line.length - 1).split('|')\n        tbl.push(tables.thead.apply(this, hs))\n        line = lines[++i]\n        if (!line.trim().match(/^[|]{1}[-=| ]+[|]{1}$/)) {\n          // not a table rolling back\n          line = lines[--i]\n        } else {\n          line = lines[++i]\n          tbl.push('<tbody>')\n          while (line.trim().match(/^[|]{1}.*[|]{1}$/)) {\n            line = line.trim()\n            tbl.push(\n              tables.tr.apply(\n                this,\n                line.substring(1, line.length - 1).split('|')\n              )\n            )\n            line = lines[++i]\n          }\n          tbl.push('</tbody>')\n          tbl.push('</table>')\n          tbl.push('</div>')\n          // we are done with this table and we move along\n          out.push(tbl.join('\\n'))\n          tbl = []\n          continue\n        }\n      }\n      out.push(line)\n    }\n    return out.join('\\n')\n  }\n  return [\n    {\n      type: 'lang',\n      filter: filter,\n    },\n  ]\n}\n\nexport default table\n","/**\n * This file is part of Serlo.org.\n *\n * Copyright (c) 2013-2021 Serlo Education e.V.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\")\n * you may not use this file except in compliance with the License\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * @copyright Copyright (c) 2013-2021 Serlo Education e.V.\n * @license   http://www.apache.org/licenses/LICENSE-2.0 Apache License 2.0\n * @link      https://github.com/serlo-org/serlo.org for the canonical source repository\n */\n/* global define */\nvar allowedTags =\n  'a|b|blockquote|code|del|dd|dl|dt|em|h1|h2|h3|h4|h5|h6|' +\n  'i|img|li|ol|p|pre|sup|sub|strong|strike|ul|br|hr|span|' +\n  'table|th|tr|td|tbody|thead|tfoot|div'\nvar allowedAttributes = {\n  img: 'src|width|height|alt',\n  a: 'href|name',\n  '*': 'title',\n  span: 'class',\n  table: 'class',\n  tr: 'rowspan',\n  td: 'colspan|align',\n  th: 'rowspan|align',\n  div: 'class',\n  b: 'class',\n  h1: 'id',\n  h2: 'id',\n  h3: 'id',\n  h4: 'id',\n  h5: 'id',\n  h6: 'id',\n}\nvar forceProtocol = false\nvar testAllowed = new RegExp('^(' + allowedTags.toLowerCase() + ')$')\nvar findTags = /<(\\/?)\\s*([\\w:-]+)([^>]*)>/g\nvar findAttribs = /(\\s*)([\\w:-]+)\\s*=\\s*(?:(?:([\"'])([^\\3]+?)(?:\\3))|([^\\s]+))/g\n\nvar htmlstrip = function () {\n  var filter\n\n  filter = function (text) {\n    return stripUnwantedHTML(text)\n  }\n\n  return [\n    {\n      type: 'output',\n      filter: filter,\n    },\n  ]\n}\n\nfunction stripUnwantedHTML(html) {\n  // convert all strings patterns into regexp objects (if not already converted)\n  for (var i in allowedAttributes) {\n    if (\n      allowedAttributes.hasOwnProperty(i) &&\n      typeof allowedAttributes[i] === 'string'\n    ) {\n      allowedAttributes[i] = new RegExp(\n        '^(' + allowedAttributes[i].toLowerCase() + ')$'\n      )\n    }\n  }\n\n  // find and match html tags\n  return html.replace(findTags, function (original, lslash, tag, params) {\n    var tagAttr\n    var wildcardAttr\n    var rslash = (params.substr(-1) === '/' && '/') || ''\n\n    tag = tag.toLowerCase()\n\n    // tag is not allowed, return empty string\n    if (!tag.match(testAllowed)) return ''\n    else {\n      // tag is allowed\n      // regexp objects for a particular tag\n      tagAttr = tag in allowedAttributes && allowedAttributes[tag]\n      wildcardAttr = '*' in allowedAttributes && allowedAttributes['*']\n\n      // if no attribs are allowed\n      if (!tagAttr && !wildcardAttr) return '<' + lslash + tag + rslash + '>'\n\n      // remove trailing slash if any\n      params = params.trim()\n      if (rslash) {\n        params = params.substr(0, params.length - 1)\n      }\n\n      // find and remove unwanted attributes\n      params = params.replace(\n        findAttribs,\n        function (original, space, name, quot, value) {\n          name = name.toLowerCase()\n\n          if (!value && !quot) {\n            value = ''\n            quot = '\"'\n          } else if (!value) {\n            value = quot\n            quot = '\"'\n          }\n\n          // force data: and javascript: links and images to #\n          if (\n            (name === 'href' || name === 'src') &&\n            (value.trim().substr(0, 'javascript:'.length) === 'javascript:' ||\n              value.trim().substr(0, 'data:'.length) === 'data:')\n          ) {\n            value = '#'\n          }\n\n          // scope links and sources to http protocol\n          if (\n            forceProtocol &&\n            (name === 'href' || name === 'src') &&\n            !/^[a-zA-Z]{3,5}:\\/\\//.test(value)\n          ) {\n            value = 'http://' + value\n          }\n\n          if (\n            (wildcardAttr && name.match(wildcardAttr)) ||\n            (tagAttr && name.match(tagAttr))\n          ) {\n            return space + name + '=' + quot + value + quot\n          } else return ''\n        }\n      )\n\n      return '<' + lslash + tag + (params ? ' ' + params : '') + rslash + '>'\n    }\n  })\n}\n\nexport default htmlstrip\n","/**\n * This file is part of Serlo.org.\n *\n * Copyright (c) 2013-2021 Serlo Education e.V.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\")\n * you may not use this file except in compliance with the License\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * @copyright Copyright (c) 2013-2021 Serlo Education e.V.\n * @license   http://www.apache.org/licenses/LICENSE-2.0 Apache License 2.0\n * @link      https://github.com/serlo-org/serlo.org for the canonical source repository\n */\n/* global define */\nvar _EncodeCode\nvar serloSpecificCharsToEscape\nvar latex = function () {\n  var filter\n\n  filter = function (text) {\n    // text = text.replace(/(^|[^\\\\])(%%)([^\\r]*?[^%])\\2(?!%)/gm,\n    text = text.replace(\n      /(^|[^\\\\])(%%)([^\\r]*?[^%])(%%?%)/gm,\n      function (wholeMatch, m1, m2, m3, m4) {\n        var c = m3\n        c = c.replace(/^([ \\t]*)/g, '') // leading whitespace\n        c = c.replace(/[ \\t]*$/g, '') // trailing whitespace\n        // Solves an issue where the formula would end with %%% and therefore the last %\n        // isn't added to c. However, this is a regex issue and should be solved there instead of here\n        if (m4 === '%%%') {\n          c += '% '\n        }\n        // Escape latex environment thingies\n        text = text.replace(/\\$/g, '\\\\$')\n        text = text.replace(/%/g, '\\\\%')\n\n        c = _EncodeCode(c)\n\n        return m1 + '<span class=\"mathInline\">%%' + c + '%%</span>'\n      }\n    )\n\n    text = text.replace(\n      /(^|[^\\\\])(¨D¨D)([^\\r]*?[^~])\\2(?!¨D)/gm,\n      function (wholeMatch, m1, m2, m3) {\n        var c = m3\n        c = c.replace(/^([ \\t]*)/g, '') // leading whitespace\n        c = c.replace(/[ \\t]*$/g, '') // trailing whitespace\n        c = _EncodeCode(c)\n        // Escape already transliterated $\n        // However, do not escape already escaped $s\n        text = text.replace(/[^\\\\]¨D/g, '\\\\¨D')\n        return m1 + '<span class=\"math\">¨D¨D' + c + '¨D¨D</span>'\n      }\n    )\n\n    return text\n  }\n\n  return [\n    {\n      type: 'lang',\n      filter: filter,\n    },\n  ]\n}\n\n// FROM shodown.js\n_EncodeCode = function (text) {\n  //\n  // Encode/escape certain characters inside Markdown code runs.\n  // The point is that in code, these characters are literals,\n  // and lose their special Markdown meanings.\n  //\n  // Encode all ampersands; HTML entities are not\n  // entities within a Markdown code span.\n  // text = text.replace(/&/g, \"&amp;\");\n\n  // Do the angle bracket song and dance:\n  // text = text.replace(/</g, \"&lt;\");\n\n  text = escapeSerloSpecificCharacters(text)\n\n  return text\n}\n\nserloSpecificCharsToEscape = (function () {\n  var regexp = ''\n  var chars = ['*', '`', '_', '{', '}', '[', ']', '<', '\\\\']\n  var replacements = {}\n  var l = chars.length\n  var i = 0\n\n  for (; i < l; i++) {\n    regexp += '\\\\' + chars[i]\n    replacements[chars[i]] = '§LT' + i\n  }\n\n  regexp = new RegExp('([' + regexp + '])', 'gm')\n\n  function replace(match) {\n    return replacements[match] || match\n  }\n\n  return {\n    regexp: regexp,\n    replace: replace,\n  }\n})()\n\nfunction escapeSerloSpecificCharacters(text) {\n  return text.replace(\n    serloSpecificCharsToEscape.regexp,\n    serloSpecificCharsToEscape.replace\n  )\n}\n\nexport default latex\n","/**\n * This file is part of Serlo.org.\n *\n * Copyright (c) 2013-2021 Serlo Education e.V.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\")\n * you may not use this file except in compliance with the License\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * @copyright Copyright (c) 2013-2021 Serlo Education e.V.\n * @license   http://www.apache.org/licenses/LICENSE-2.0 Apache License 2.0\n * @link      https://github.com/serlo-org/serlo.org for the canonical source repository\n */\n/* global define */\nvar atusername = function () {\n  return [\n    // @username syntax\n    {\n      type: 'lang',\n      regex: '\\\\B(\\\\\\\\)?@([\\\\S]+)\\\\b',\n      replace: function (match, leadingSlash, username) {\n        // Check if we matched the leading \\ and return nothing changed if so\n        if (leadingSlash === '\\\\') {\n          return match\n        } else {\n          return (\n            '<a class=\"user-mention\" href=\"/user/profile/' +\n            username +\n            '\">@' +\n            username +\n            '</a>'\n          )\n        }\n      },\n    },\n\n    // Escaped @'s so we don't get into trouble\n    //\n    { type: 'lang', regex: '\\\\\\\\@', replace: '@' },\n  ]\n}\n\nexport default atusername\n","/**\n * This file is part of Serlo.org.\n *\n * Copyright (c) 2013-2021 Serlo Education e.V.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\")\n * you may not use this file except in compliance with the License\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * @copyright Copyright (c) 2013-2021 Serlo Education e.V.\n * @license   http://www.apache.org/licenses/LICENSE-2.0 Apache License 2.0\n * @link      https://github.com/serlo-org/serlo.org for the canonical source repository\n */\n/* global define */\nvar strikethrough = function () {\n  return [\n    {\n      // strike-through\n      // NOTE: showdown already replaced \"~\" with \"~T\", so we need to adjust accordingly.\n      type: 'lang',\n      regex: '(~T){2}([^~]+)(~T){2}',\n      replace: function (match, prefix, content, suffix) {\n        return '<del>' + content + '</del>'\n      },\n    },\n  ]\n}\n\nexport default strikethrough\n","/**\n * This file is part of Serlo.org.\n *\n * Copyright (c) 2013-2021 Serlo Education e.V.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\")\n * you may not use this file except in compliance with the License\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * @copyright Copyright (c) 2013-2021 Serlo Education e.V.\n * @license   http://www.apache.org/licenses/LICENSE-2.0 Apache License 2.0\n * @link      https://github.com/serlo-org/serlo.org for the canonical source repository\n */\n/* global define */\n/**\n * Serlo Flavored Markdown\n * Spoilers:\n * Transforms ///.../// blocks into spoilers\n **/\nvar spoiler = function () {\n  var filter\n  var findSpoilers = new RegExp(/^<p>=,sp. (.*)<\\/p>([\\s\\S]*?)<p>=,sp.<\\/p>/gm)\n\n  filter = function (text) {\n    return text.replace(findSpoilers, function (original, title, content) {\n      return (\n        '<div class=\"spoiler panel panel-default\"><div class=\"spoiler-teaser panel-heading\"><span class=\"fa fa-caret-square-o-down\"></span>' +\n        title +\n        '</div><div class=\"spoiler-content panel-body\">' +\n        content +\n        '</div></div>'\n      )\n    })\n  }\n\n  return [\n    {\n      type: 'output',\n      filter: filter,\n    },\n  ]\n}\n\nexport default spoiler\n","/**\n * This file is part of Serlo.org.\n *\n * Copyright (c) 2013-2021 Serlo Education e.V.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\")\n * you may not use this file except in compliance with the License\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * @copyright Copyright (c) 2013-2021 Serlo Education e.V.\n * @license   http://www.apache.org/licenses/LICENSE-2.0 Apache License 2.0\n * @link      https://github.com/serlo-org/serlo.org for the canonical source repository\n */\n/* global define */\n/**\n * Serlo Flavored Markdown\n * Spoilers:\n * Transforms ///.../// blocks into spoilers\n **/\nvar spoilerprepare = function () {\n  var filter\n  var findSpoilers = new RegExp(/^\\/\\/\\/ (.*)\\n([\\s\\S]*?)(\\n|\\r)+\\/\\/\\//gm)\n\n  filter = function (text) {\n    // convert all \"///\"s into \"=,sp.\"s\n    return text.replace(findSpoilers, function (original, title, content) {\n      return '<p>=,sp. ' + title + '</p>\\n' + content + '<p>=,sp.</p>'\n    })\n  }\n\n  return [\n    {\n      type: 'lang',\n      filter: filter,\n    },\n  ]\n}\n\nexport default spoilerprepare\n","/**\n * This file is part of Serlo.org.\n *\n * Copyright (c) 2013-2021 Serlo Education e.V.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\")\n * you may not use this file except in compliance with the License\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * @copyright Copyright (c) 2013-2021 Serlo Education e.V.\n * @license   http://www.apache.org/licenses/LICENSE-2.0 Apache License 2.0\n * @link      https://github.com/serlo-org/serlo.org for the canonical source repository\n */\n/* global define */\nvar serloSpecificCharsToEncode\nvar latexoutput = function () {\n  return [\n    {\n      type: 'output',\n      filter: function (text) {\n        return encodeSerloSpecificChars(text)\n      },\n    },\n  ]\n}\n\nserloSpecificCharsToEncode = (function () {\n  var regexp\n  var chars = ['*', '`', '_', '{', '}', '[', ']', '&lt;', '\\\\']\n  var replacements = {}\n  var l = chars.length\n  var i = 0\n\n  for (; i < l; i++) {\n    replacements['' + i] = chars[i]\n  }\n\n  regexp = new RegExp('§LT([0-9])', 'gm')\n\n  function replace(whole, match) {\n    return replacements[parseInt(match)] || match\n  }\n\n  return {\n    regexp: regexp,\n    replace: replace,\n  }\n})()\n\nfunction encodeSerloSpecificChars(text) {\n  return text.replace(\n    serloSpecificCharsToEncode.regexp,\n    serloSpecificCharsToEncode.replace\n  )\n}\n\nexport default latexoutput\n","/**\n * This file is part of Serlo.org.\n *\n * Copyright (c) 2013-2021 Serlo Education e.V.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\")\n * you may not use this file except in compliance with the License\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * @copyright Copyright (c) 2013-2021 Serlo Education e.V.\n * @license   http://www.apache.org/licenses/LICENSE-2.0 Apache License 2.0\n * @link      https://github.com/serlo-org/serlo.org for the canonical source repository\n */\n/* global define */\n/* Prepares Github Style Code */\nvar codeoutput = function () {\n  return [\n    {\n      type: 'lang',\n      filter: (function () {\n        var charsToEncode = ['~D', '%', '|', '/']\n        var replacements = {}\n        var regexp\n        var i\n        var l\n\n        for (i = 0, l = charsToEncode.length; i < l; i++) {\n          replacements['' + i] = charsToEncode[i]\n        }\n\n        regexp = new RegExp('§SC([0-9])', 'gm')\n\n        function replace(whole, match) {\n          return replacements[parseInt(match)] || match\n        }\n\n        return function (text) {\n          return text.replace(regexp, replace)\n        }\n      })(),\n    },\n  ]\n}\n\nexport default codeoutput\n","/**\n * This file is part of Serlo.org.\n *\n * Copyright (c) 2013-2021 Serlo Education e.V.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\")\n * you may not use this file except in compliance with the License\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * @copyright Copyright (c) 2013-2021 Serlo Education e.V.\n * @license   http://www.apache.org/licenses/LICENSE-2.0 Apache License 2.0\n * @link      https://github.com/serlo-org/serlo.org for the canonical source repository\n */\n// @ts-ignore\nimport Showdown from 'showdown'\n\n// @ts-ignore\nimport codePrepare from './extensions/serlo_code_prepare'\n// @ts-ignore\nimport injections from './extensions/injections'\n// @ts-ignore\nimport table from './extensions/table'\n// @ts-ignore\nimport htmlStrip from './extensions/html_strip'\n// @ts-ignore\nimport latex from './extensions/latex'\n// @ts-ignore\nimport atUsername from './extensions/at_username'\n// @ts-ignore\nimport strikeThrough from './extensions/strike_through'\n// @ts-ignore\nimport spoiler from './extensions/spoiler'\n// @ts-ignore\nimport spoilerPrepare from './extensions/spoiler_prepare'\n// @ts-ignore\nimport latexOutput from './extensions/latex_output'\n// @ts-ignore\nimport codeOutput from './extensions/serlo_code_output'\n\nexport const converter: {\n  makeHtml(source: string): string\n} = new Showdown.Converter({\n  extensions: [\n    codePrepare,\n    injections,\n    table,\n    htmlStrip,\n    latex,\n    atUsername,\n    strikeThrough,\n    spoiler,\n    spoilerPrepare,\n    latexOutput,\n    codeOutput,\n  ],\n})\n"],"names":["codeprepare","type","filter","replacements","replacementRegexp","codeRegexp","charsToDecode","i","l","length","replace","RegExp","join","whole","language","code","match","text","injections","findInjections","correctUrl","url","split","shift","original","title","href","test","table","tables","style","callbackConverter","th","header","makeHtml","td","cell","ths","out","hs","slice","apply","arguments","tds","ds","thead","tr","cs","converter","lines","tbl","line","trim","push","substring","allowedTags","allowedAttributes","img","a","span","div","b","h1","h2","h3","h4","h5","h6","testAllowed","toLowerCase","findTags","findAttribs","htmlstrip","stripUnwantedHTML","html","hasOwnProperty","lslash","tag","params","tagAttr","wildcardAttr","rslash","substr","space","name","quot","value","_EncodeCode","serloSpecificCharsToEscape","latex","wholeMatch","m1","m2","m3","m4","c","escapeSerloSpecificCharacters","regexp","chars","atusername","regex","leadingSlash","username","strikethrough","prefix","content","suffix","spoiler","findSpoilers","spoilerprepare","serloSpecificCharsToEncode","latexoutput","encodeSerloSpecificChars","parseInt","codeoutput","charsToEncode","Showdown","Converter","extensions","codePrepare","htmlStrip","atUsername","strikeThrough","spoilerPrepare","latexOutput","codeOutput"],"mappings":"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"}
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e,t,n=require("@edtr-io/plugin"),r=require("@edtr-io/core"),o=require("@edtr-io/core/beta"),a=require("@edtr-io/editor-ui/internal"),i=require("@edtr-io/math"),l=require("@edtr-io/store"),s=require("@edtr-io/ui"),u=require("@fortawesome/free-solid-svg-icons"),c=require("ramda"),m=require("react"),f=(e=m)&&"object"==typeof e&&"default"in e?e.default:e,d=require("react-beautiful-dnd");function g(e){switch(e){case exports.Sign.AlmostEqualTo:return"≈";case exports.Sign.Equals:return"=";case exports.Sign.Estimates:return"≙";case exports.Sign.GreaterThan:return">";case exports.Sign.GreaterThanOrEqual:return"≥";case exports.Sign.LessThan:return"<";case exports.Sign.LessThanOrEqual:return"≤";case exports.Sign.NotEqualTo:return"≠"}}(t=exports.Sign||(exports.Sign={})).AlmostEqualTo="almost-equal-to",t.Equals="equals",t.Estimates="estimates",t.GreaterThan="greater-than",t.GreaterThanOrEqual="greater-than-or-equal",t.LessThan="less-than",t.LessThanOrEqual="less-than-or-equal",t.NotEqualTo="not-equal-to";var p,E,x=s.styled.div({padding:"10px 0"}),h=s.styled.table({whiteSpace:"nowrap"}),v=s.styled.td({verticalAlign:"baseline"}),w=s.styled(v)({textAlign:"right"}),S=s.styled.td({padding:"0 3px",textAlign:"center",verticalAlign:"baseline"}),T=s.styled(v)({paddingLeft:"5px"}),b=s.styled.tr({div:{margin:0}}),q=s.styled(b)({textAlign:"center",div:{margin:0}});function F(e){var t=e.state,n=r.useScopedStore(),o=R(t.transformationTarget.value),a="px-1 pt-1 pb-3";return f.createElement(x,null,f.createElement(h,null,f.createElement("tbody",null,function(){if(!l.isEmpty(t.firstExplanation.id)(n.getState()))return f.createElement(f.Fragment,null,f.createElement(q,null,f.createElement("td",{colSpan:3,className:a},t.firstExplanation.render())),f.createElement("tr",{style:{height:"30px"}},f.createElement("td",null),y()))}(),t.steps.map((function(e,t){return f.createElement(m.Fragment,{key:t},f.createElement("tr",null,f.createElement(w,{className:a},e.left.value?f.createElement(i.MathRenderer,{inline:!0,state:e.left.value}):null),f.createElement(S,{className:a},(0!==t||o!==p.Term)&&f.createElement(i.MathRenderer,{inline:!0,state:g(e.sign.value)})),f.createElement(v,{className:a},e.right.value?f.createElement(i.MathRenderer,{inline:!0,state:e.right.value}):null),f.createElement(T,null,e.transform.value?f.createElement(f.Fragment,null,"|",f.createElement(i.MathRenderer,{inline:!0,state:e.transform.value})):null)),l.isEmpty(e.explanation.id)(n.getState())?null:f.createElement(b,null,f.createElement("td",null),y(),f.createElement("td",{colSpan:2,className:a},e.explanation.render())))})))))}function y(){var e=Buffer.from('\n    <svg xmlns="http://www.w3.org/2000/svg">\n      <defs>\n        <marker\n          id="arrow"\n          markerWidth="10"\n          markerHeight="10"\n          orient="auto"\n          markerUnits="strokeWidth"\n          refX="10"\n          refY="5"\n          viewBox="0 0 20 10"\n        >\n          <path\n            d="M 0,0 l 10,5 l -10,5"\n            stroke="#000"\n            stroke-width="2"\n            fill="none"\n            vector-effect="non-scaling-size"\n          />\n        </marker>\n      </defs>\n\n      <line\n        x1="10"\n        y1="0%"\n        x2="10"\n        y2="99%"\n        stroke="#000"\n        stroke-width="2"\n        marker-end="url(#arrow)"\n        vector-effect="non-scaling-stroke"\n      />\n    </svg>').toString("base64");return f.createElement("td",{style:{backgroundImage:"url('data:image/svg+xml;base64,"+e+"')",backgroundSize:"20px calc(100% - 10px)",backgroundRepeat:"no-repeat",backgroundPosition:"center 5px"}})}function R(e){return function(e){return Object.values(p).includes(e)}(e)?e:p.Equation}!function(e){e.Equation="equation",e.Term="term"}(p||(p={})),function(e){e[e.Left=0]="Left",e[e.Right=1]="Right",e[e.Transform=2]="Transform",e[e.Explanation=3]="Explanation"}(E||(E={})),o.setDefaultPreference("katex:usevisualmath",!0);var k=s.styled.button({outline:"none",width:"35px",border:"none",background:"transparent"}),C=s.styled.span({cursor:"grab",paddingRight:"5px"});function O(e){var t=e.focused,n=e.state,o=e.config,i=r.useScopedStore(),g=r.useScopedSelector(l.getFocused()),v=t||c.includes(g,e.state.steps.map((function(e){return e.explanation.id})))||g===n.firstExplanation.id,w=R(n.transformationTarget.value),S=function(e){var t=e.rows,n=e.columns,r=e.focusNext,o=e.focusPrevious,a=e.onFocusChanged,i=e.transformationTarget,l=m.useState(null),s=l[0],u=l[1],c=function(e){a(e),u(e)},f=function(e){return null!==s&&("firstExplanation"===s?e===s:"firstExplanation"!==e&&s.row===e.row&&s.column===e.column)};return{focus:s,isFocused:f,setFocus:function(e){f(e)||c(e)},moveRight:function(){null!==s&&("firstExplanation"!==s?s.row===t-1&&s.column===M(i)?r():c(i===p.Term?s.column===E.Right?{row:s.row,column:E.Explanation}:{row:s.row+1,column:I(i)}:s.column===n-1?{row:s.row+1,column:E.Left}:{row:s.row,column:s.column+1}):c({row:0,column:I(i)}))},moveLeft:function(){null!==s&&("firstExplanation"!==s?i===p.Term?0===s.row&&s.column===E.Right?o():c(s.column===E.Right?{row:s.row-1,column:E.Explanation}:{row:s.row,column:E.Right}):c(0===s.column?0===s.row?"firstExplanation":{row:s.row-1,column:n-1}:{row:s.row,column:s.column-1}):o())}}}({rows:n.steps.length,columns:4,focusNext:function(){return i.dispatch(l.focusNext())},focusPrevious:function(){return i.dispatch(l.focusPrevious())},transformationTarget:w,onFocusChanged:function(t){i.dispatch(l.focus("firstExplanation"===t?e.state.firstExplanation.id:t.column===E.Explanation?e.state.steps[t.row].explanation.id:e.id))}});return m.useEffect((function(){v&&(S.setFocus({row:0,column:I(w)}),i.dispatch(l.focus(e.id)))}),[v]),v?f.createElement(r.HotKeys,{allowChanges:!0,keyMap:{FOCUS_NEXT_OR_INSERT:"tab",FOCUS_PREVIOUS:"shift+tab",INSERT:"return"},handlers:{FOCUS_NEXT_OR_INSERT:function(e){T(e,(function(){if(S.isFocused({row:n.steps.length-1,column:M(w)})){var e=n.steps.length;O(e),S.setFocus({row:e-1,column:E.Explanation})}else S.moveRight()}))},FOCUS_PREVIOUS:function(e){T(e,(function(){return S.moveLeft()}))},INSERT:function(e){T(e,(function(){S.focus&&"firstExplanation"!==S.focus&&N(S.focus.row+1)}))}}},f.createElement(f.Fragment,null,e.renderIntoSettings(f.createElement("div",null,f.createElement("label",{htmlFor:"transformationTarget"},o.i18n.mode,":")," ",f.createElement("select",{id:"transformationTarget",value:w,onChange:function(e){return n.transformationTarget.set(e.target.value)}},f.createElement("option",{value:p.Equation},o.i18n.transformationOfEquations),f.createElement("option",{value:p.Term},o.i18n.transformationOfTerms)))),f.createElement(x,null,f.createElement(d.DragDropContext,{onDragEnd:function(e){var t=e.destination;t&&n.steps.move(e.source.index,t.index)}},f.createElement(d.Droppable,{droppableId:"default"},(function(e){return f.createElement(h,Object.assign({ref:e.innerRef},e.droppableProps),function(){var e;if(w!==p.Term)return f.createElement("tbody",{onFocus:function(){return S.setFocus("firstExplanation")}},f.createElement(q,null,f.createElement("td",null),f.createElement("td",{colSpan:3},n.firstExplanation.render({config:{placeholder:null==(e=o.i18n)?void 0:e.firstExplanation}}))),f.createElement("tr",{style:{height:"30px"}},f.createElement("td",null),f.createElement("td",null),l.isEmpty(n.firstExplanation.id)(i.getState())?null:y()))}(),n.steps.map((function(e,t){return f.createElement(d.Draggable,{key:e.explanation.id,draggableId:e.explanation.id,index:t},(function(r){return f.createElement("tbody",Object.assign({ref:r.innerRef},r.draggableProps),f.createElement("tr",null,f.createElement("td",null,f.createElement(C,Object.assign({},r.dragHandleProps,{tabIndex:-1}),f.createElement(s.EdtrIcon,{icon:s.edtrDragHandle}))),f.createElement(L,{gridFocus:S,row:t,state:e,transformationTarget:w,config:o}),f.createElement("td",null,f.createElement(k,{tabIndex:-1,onClick:function(){return n.steps.remove(t)}},f.createElement(s.Icon,{icon:u.faXmark})))),t===n.steps.length-1?null:f.createElement(b,{onFocus:function(){return S.setFocus({row:t,column:E.Explanation})}},w===p.Equation&&f.createElement("td",null),f.createElement("td",null),l.isEmpty(e.explanation.id)(i.getState())?f.createElement("td",null):y(),f.createElement("td",{colSpan:2},e.explanation.render({config:{placeholder:0===t&&w===p.Term?o.i18n.combineLikeTerms:o.i18n.explanation}}))))}))})),e.placeholder)}))),function(){if(v)return f.createElement(a.AddButton,{onClick:function(){return N(n.steps.length)}},o.i18n.addNew)}()))):f.createElement(F,Object.assign({},e));function T(e,t){e&&e.preventDefault(),t()}function O(e){n.steps.insert(e,{left:"",sign:n.steps[e-1].sign.value,right:"",transform:"",explanation:{plugin:"text"}})}function N(e){O(e),S.setFocus({row:e,column:I(w)})}}var N=s.styled.select({height:"30px",width:"35px",marginLeft:"15px",marginRight:"10px",backgroundColor:"lightgrey",border:"1px solid lightgrey",borderRadius:"5px"});function L(e){var t=e.gridFocus,n=e.row,r=e.state,o=e.transformationTarget,a=e.config;return f.createElement(f.Fragment,null,o===p.Equation&&f.createElement(w,{onClick:function(){return t.setFocus({row:n,column:E.Left})}},f.createElement(P,{focused:t.isFocused({row:n,column:E.Left}),placeholder:0===n?"3x+1":"["+a.i18n.leftHandSide+"]",state:r.left,onChange:function(e){return r.left.set(e)},onFocusNext:function(){return t.moveRight()},onFocusPrevious:function(){return t.moveLeft()}})),f.createElement(S,null,("equation"===o||0!==n)&&f.createElement(N,{tabIndex:-1,onChange:function(e){r.sign.set(e.target.value)},value:r.sign.value},[exports.Sign.Equals,exports.Sign.GreaterThan,exports.Sign.LessThan,exports.Sign.GreaterThanOrEqual,exports.Sign.LessThanOrEqual,exports.Sign.NotEqualTo,exports.Sign.AlmostEqualTo,exports.Sign.Estimates].map((function(e){return f.createElement("option",{key:e,value:e},g(e))})))),f.createElement(v,{onClick:function(){return t.setFocus({row:n,column:E.Right})}},f.createElement(P,{focused:t.isFocused({row:n,column:E.Right}),placeholder:0===n?"4x+3x":o===p.Term?"["+a.i18n.term+"]":"["+a.i18n.rightHandSide+"]",state:r.right,onChange:function(e){return r.right.set(e)},onFocusNext:function(){return t.moveRight()},onFocusPrevious:function(){return t.moveLeft()}})),o===p.Equation&&f.createElement(T,{onClick:function(){return t.setFocus({row:n,column:E.Transform})}},"|"," ",f.createElement(P,{focused:t.isFocused({row:n,column:E.Transform}),placeholder:0===n?a.i18n.transformationExample:"["+a.i18n.transformation+"]",state:r.transform,onChange:function(e){return r.transform.set(e)},onFocusNext:function(){return t.moveRight()},onFocusPrevious:function(){return t.moveLeft()}})))}function P(e){var t=e.focused,n=e.onFocusNext,r=e.onFocusPrevious,a=e.onChange,l=e.state,s=e.prefix,u=void 0===s?"":s,c=e.suffix,d=void 0===c?"":c,g=m.useContext(o.PreferenceContext);return f.createElement(i.MathEditor,{readOnly:!t,state:""+u+l.value+d,config:{i18n:{placeholder:e.placeholder}},inline:!0,disableBlock:!0,visual:!0===g.getKey("katex:usevisualmath"),onEditorChange:function(e){g.setKey("katex:usevisualmath",e)},onInlineChange:function(){},onChange:a,onMoveOutRight:n,onMoveOutLeft:r})}function I(e){return e===p.Term?E.Right:E.Left}function M(e){return e===p.Term?E.Right:E.Transform}var _=n.object({left:n.string(""),sign:n.string(exports.Sign.Equals),right:n.string(""),transform:n.string(""),explanation:n.child({plugin:"text",config:{registry:[]}})}),j=n.object({steps:n.list(_,2),firstExplanation:n.child({plugin:"text",config:{registry:[]}}),transformationTarget:n.string("equation")});exports.createEquationsPlugin=function(e){return{Component:O,config:e,state:j}},exports.renderSignToString=g,exports.stepProps=_;
//# sourceMappingURL=plugin-equations.cjs.production.min.js.map

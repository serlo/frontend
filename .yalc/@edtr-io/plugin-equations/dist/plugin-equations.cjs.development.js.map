{"version":3,"file":"plugin-equations.cjs.development.js","sources":["../src/sign.tsx","../src/renderer.tsx","../src/editor.tsx","../src/index.ts"],"sourcesContent":["export enum Sign {\n  AlmostEqualTo = 'almost-equal-to',\n  Equals = 'equals',\n  Estimates = 'estimates',\n  GreaterThan = 'greater-than',\n  GreaterThanOrEqual = 'greater-than-or-equal',\n  LessThan = 'less-than',\n  LessThanOrEqual = 'less-than-or-equal',\n  NotEqualTo = 'not-equal-to',\n}\n\nexport function renderSignToString(sign: Sign): string {\n  switch (sign) {\n    case Sign.AlmostEqualTo:\n      return '≈'\n    case Sign.Equals:\n      return '='\n    case Sign.Estimates:\n      return '≙'\n    case Sign.GreaterThan:\n      return '>'\n    case Sign.GreaterThanOrEqual:\n      return '≥'\n    case Sign.LessThan:\n      return '<'\n    case Sign.LessThanOrEqual:\n      return '≤'\n    case Sign.NotEqualTo:\n      return '≠'\n  }\n}\n","import { useScopedStore } from '@edtr-io/core'\nimport { MathRenderer } from '@edtr-io/math'\nimport { isEmpty } from '@edtr-io/store'\nimport { styled } from '@edtr-io/ui'\nimport { Fragment } from 'react'\nimport React from 'react'\n\nimport { EquationsProps } from '.'\nimport { renderSignToString, Sign } from './sign'\n\nexport const TableWrapper = styled.div({\n  padding: '10px 0',\n})\n\nexport const Table = styled.table({\n  whiteSpace: 'nowrap',\n})\n\nexport const MathTd = styled.td({ verticalAlign: 'baseline' })\n\nexport const LeftTd = styled(MathTd)({\n  textAlign: 'right',\n})\n\nexport const SignTd = styled.td({\n  padding: '0 3px',\n  textAlign: 'center',\n  verticalAlign: 'baseline',\n})\n\nexport const TransformTd = styled(MathTd)({\n  paddingLeft: '5px',\n})\n\nexport const ExplanationTr = styled.tr({ div: { margin: 0 } })\nexport const FirstExplanationTr = styled(ExplanationTr)({\n  textAlign: 'center',\n  div: { margin: 0 },\n})\n\nexport enum TransformationTarget {\n  Equation = 'equation',\n  Term = 'term',\n}\n\nexport function EquationsRenderer({ state }: EquationsProps) {\n  const store = useScopedStore()\n  const transformationTarget = toTransformationTarget(\n    state.transformationTarget.value\n  )\n\n  const tdPadding = 'px-1 pt-1 pb-3'\n\n  return (\n    <TableWrapper>\n      <Table>\n        <tbody>\n          {renderFirstExplanation()}\n          {state.steps.map((step, row) => {\n            return (\n              <Fragment key={row}>\n                <tr>\n                  <LeftTd className={tdPadding}>\n                    {step.left.value ? (\n                      <MathRenderer inline state={step.left.value} />\n                    ) : null}\n                  </LeftTd>\n                  <SignTd className={tdPadding}>\n                    {(row !== 0 ||\n                      transformationTarget !== TransformationTarget.Term) && (\n                      <MathRenderer\n                        inline\n                        state={renderSignToString(step.sign.value as Sign)}\n                      />\n                    )}\n                  </SignTd>\n                  <MathTd className={tdPadding}>\n                    {step.right.value ? (\n                      <MathRenderer inline state={step.right.value} />\n                    ) : null}\n                  </MathTd>\n                  <TransformTd>\n                    {step.transform.value ? (\n                      <>\n                        |\n                        <MathRenderer inline state={step.transform.value} />\n                      </>\n                    ) : null}\n                  </TransformTd>\n                </tr>\n                {isEmpty(step.explanation.id)(store.getState()) ? null : (\n                  <ExplanationTr>\n                    <td />\n                    {renderDownArrow()}\n                    <td colSpan={2} className={tdPadding}>\n                      {step.explanation.render()}\n                    </td>\n                  </ExplanationTr>\n                )}\n              </Fragment>\n            )\n          })}\n        </tbody>\n      </Table>\n    </TableWrapper>\n  )\n\n  function renderFirstExplanation() {\n    if (isEmpty(state.firstExplanation.id)(store.getState())) return\n\n    return (\n      <>\n        <FirstExplanationTr>\n          <td colSpan={3} className={tdPadding}>\n            {state.firstExplanation.render()}\n          </td>\n        </FirstExplanationTr>\n        <tr style={{ height: '30px' }}>\n          <td />\n          {renderDownArrow()}\n        </tr>\n      </>\n    )\n  }\n}\n\nexport function renderDownArrow() {\n  const downArrow = `\n    <svg xmlns=\"http://www.w3.org/2000/svg\">\n      <defs>\n        <marker\n          id=\"arrow\"\n          markerWidth=\"10\"\n          markerHeight=\"10\"\n          orient=\"auto\"\n          markerUnits=\"strokeWidth\"\n          refX=\"10\"\n          refY=\"5\"\n          viewBox=\"0 0 20 10\"\n        >\n          <path\n            d=\"M 0,0 l 10,5 l -10,5\"\n            stroke=\"#000\"\n            stroke-width=\"2\"\n            fill=\"none\"\n            vector-effect=\"non-scaling-size\"\n          />\n        </marker>\n      </defs>\n\n      <line\n        x1=\"10\"\n        y1=\"0%\"\n        x2=\"10\"\n        y2=\"99%\"\n        stroke=\"#000\"\n        stroke-width=\"2\"\n        marker-end=\"url(#arrow)\"\n        vector-effect=\"non-scaling-stroke\"\n      />\n    </svg>`\n  const downArrowBase64 = Buffer.from(downArrow).toString('base64')\n\n  return (\n    <td\n      style={{\n        backgroundImage: `url('data:image/svg+xml;base64,${downArrowBase64}')`,\n        backgroundSize: '20px calc(100% - 10px)',\n        backgroundRepeat: 'no-repeat',\n        backgroundPosition: 'center 5px',\n      }}\n    />\n  )\n}\n\nexport function toTransformationTarget(text: string): TransformationTarget {\n  return isTransformationTarget(text) ? text : TransformationTarget.Equation\n}\n\nfunction isTransformationTarget(text: string): text is TransformationTarget {\n  return Object.values<string>(TransformationTarget).includes(text)\n}\n","import { HotKeys, useScopedSelector, useScopedStore } from '@edtr-io/core'\n// eslint-disable-next-line import/no-internal-modules\nimport { PreferenceContext, setDefaultPreference } from '@edtr-io/core/beta'\n// eslint-disable-next-line import/no-internal-modules\nimport { AddButton } from '@edtr-io/editor-ui/internal'\nimport { MathEditor } from '@edtr-io/math'\nimport { StateTypeReturnType, StringStateType } from '@edtr-io/plugin'\nimport {\n  focus,\n  focusNext,\n  focusPrevious,\n  getFocused,\n  isEmpty,\n} from '@edtr-io/store'\nimport { edtrDragHandle, EdtrIcon, Icon, styled } from '@edtr-io/ui'\nimport { faXmark } from '@fortawesome/free-solid-svg-icons'\nimport { includes } from 'ramda'\nimport { useContext, useEffect, useState } from 'react'\nimport React from 'react'\nimport { DragDropContext, Draggable, Droppable } from 'react-beautiful-dnd'\n\nimport { EquationsProps, EquationsConfig, stepProps } from '.'\nimport {\n  EquationsRenderer,\n  FirstExplanationTr,\n  ExplanationTr,\n  LeftTd,\n  MathTd,\n  renderDownArrow,\n  SignTd,\n  Table,\n  TableWrapper,\n  toTransformationTarget,\n  TransformationTarget,\n  TransformTd,\n} from './renderer'\nimport { renderSignToString, Sign } from './sign'\n\nenum StepSegment {\n  Left = 0,\n  Right = 1,\n  Transform = 2,\n  Explanation = 3,\n}\n\nconst preferenceKey = 'katex:usevisualmath'\n\nsetDefaultPreference(preferenceKey, true)\n\nconst RemoveButton = styled.button({\n  outline: 'none',\n  width: '35px',\n  border: 'none',\n  background: 'transparent',\n})\nconst DragButton = styled.span({\n  cursor: 'grab',\n  paddingRight: '5px',\n})\n\nexport function EquationsEditor(props: EquationsProps) {\n  const { focused, state, config } = props\n\n  const store = useScopedStore()\n  const focusedElement = useScopedSelector(getFocused())\n  const nestedFocus =\n    focused ||\n    includes(\n      focusedElement,\n      props.state.steps.map((step) => step.explanation.id)\n    ) ||\n    focusedElement === state.firstExplanation.id\n\n  const transformationTarget = toTransformationTarget(\n    state.transformationTarget.value\n  )\n\n  const gridFocus = useGridFocus({\n    rows: state.steps.length,\n    columns: 4,\n    focusNext: () => store.dispatch(focusNext()),\n    focusPrevious: () => store.dispatch(focusPrevious()),\n    transformationTarget,\n    onFocusChanged: (state) => {\n      if (state === 'firstExplanation') {\n        store.dispatch(focus(props.state.firstExplanation.id))\n      } else if (state.column === StepSegment.Explanation) {\n        store.dispatch(focus(props.state.steps[state.row].explanation.id))\n      } else {\n        store.dispatch(focus(props.id))\n      }\n    },\n  })\n\n  useEffect(() => {\n    if (nestedFocus) {\n      gridFocus.setFocus({\n        row: 0,\n        column: firstColumn(transformationTarget),\n      })\n      store.dispatch(focus(props.id))\n    }\n    //prevents loop\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [nestedFocus])\n\n  if (!nestedFocus) return <EquationsRenderer {...props} />\n\n  return (\n    <HotKeys\n      allowChanges\n      keyMap={{\n        FOCUS_NEXT_OR_INSERT: 'tab',\n        FOCUS_PREVIOUS: 'shift+tab',\n        INSERT: 'return',\n      }}\n      handlers={{\n        FOCUS_NEXT_OR_INSERT: (e) => {\n          handleKeyDown(e, () => {\n            if (\n              gridFocus.isFocused({\n                row: state.steps.length - 1,\n                column: lastColumn(transformationTarget),\n              })\n            ) {\n              const index = state.steps.length\n              insertNewEquationAt(index)\n              gridFocus.setFocus({\n                row: index - 1,\n                column: StepSegment.Explanation,\n              })\n            } else {\n              gridFocus.moveRight()\n            }\n          })\n        },\n        FOCUS_PREVIOUS: (e) => {\n          handleKeyDown(e, () => gridFocus.moveLeft())\n        },\n        INSERT: (e) => {\n          handleKeyDown(e, () => {\n            if (!gridFocus.focus || gridFocus.focus === 'firstExplanation')\n              return\n            insertNewEquationWithFocus(gridFocus.focus.row + 1)\n          })\n        },\n      }}\n    >\n      <>\n        {props.renderIntoSettings(\n          <div>\n            <label htmlFor=\"transformationTarget\">{config.i18n.mode}:</label>{' '}\n            <select\n              id=\"transformationTarget\"\n              value={transformationTarget}\n              onChange={(e) => state.transformationTarget.set(e.target.value)}\n            >\n              <option value={TransformationTarget.Equation}>\n                {config.i18n.transformationOfEquations}\n              </option>\n              <option value={TransformationTarget.Term}>\n                {config.i18n.transformationOfTerms}\n              </option>\n            </select>\n          </div>\n        )}\n        <TableWrapper>\n          <DragDropContext\n            onDragEnd={(result) => {\n              const { source, destination } = result\n              if (!destination) return\n              state.steps.move(source.index, destination.index)\n            }}\n          >\n            <Droppable droppableId=\"default\">\n              {(provided) => {\n                return (\n                  <Table ref={provided.innerRef} {...provided.droppableProps}>\n                    {renderFirstExplanation()}\n                    {state.steps.map((step, row) => {\n                      return (\n                        <Draggable\n                          key={step.explanation.id}\n                          draggableId={step.explanation.id}\n                          index={row}\n                        >\n                          {(provided) => {\n                            return (\n                              <tbody\n                                ref={provided.innerRef}\n                                {...provided.draggableProps}\n                              >\n                                <tr>\n                                  <td>\n                                    <DragButton\n                                      {...provided.dragHandleProps}\n                                      tabIndex={-1}\n                                    >\n                                      <EdtrIcon icon={edtrDragHandle} />\n                                    </DragButton>\n                                  </td>\n                                  <StepEditor\n                                    gridFocus={gridFocus}\n                                    row={row}\n                                    state={step}\n                                    transformationTarget={transformationTarget}\n                                    config={config}\n                                  />\n                                  <td>\n                                    <RemoveButton\n                                      tabIndex={-1}\n                                      onClick={() => state.steps.remove(row)}\n                                    >\n                                      <Icon icon={faXmark} />\n                                    </RemoveButton>\n                                  </td>\n                                </tr>\n                                {renderExplantionTr()}\n                              </tbody>\n                            )\n                          }}\n                        </Draggable>\n                      )\n\n                      function renderExplantionTr() {\n                        if (row === state.steps.length - 1) return null\n\n                        return (\n                          <ExplanationTr\n                            onFocus={() =>\n                              gridFocus.setFocus({\n                                row,\n                                column: StepSegment.Explanation,\n                              })\n                            }\n                          >\n                            {transformationTarget ===\n                              TransformationTarget.Equation && <td />}\n                            <td />\n                            {!isEmpty(step.explanation.id)(store.getState()) ? (\n                              renderDownArrow()\n                            ) : (\n                              <td />\n                            )}\n                            <td colSpan={2}>\n                              {step.explanation.render({\n                                config: {\n                                  placeholder:\n                                    row === 0 &&\n                                    transformationTarget ===\n                                      TransformationTarget.Term\n                                      ? config.i18n.combineLikeTerms\n                                      : config.i18n.explanation,\n                                },\n                              })}\n                            </td>\n                          </ExplanationTr>\n                        )\n                      }\n                    })}\n                    {provided.placeholder}\n                  </Table>\n                )\n              }}\n            </Droppable>\n          </DragDropContext>\n          {renderAddButton()}\n        </TableWrapper>\n      </>\n    </HotKeys>\n  )\n\n  function renderFirstExplanation() {\n    if (transformationTarget === TransformationTarget.Term) return\n\n    return (\n      <tbody onFocus={() => gridFocus.setFocus('firstExplanation')}>\n        <FirstExplanationTr>\n          <td />\n          <td colSpan={3}>\n            {state.firstExplanation.render({\n              config: {\n                placeholder: config.i18n?.firstExplanation,\n              },\n            })}\n          </td>\n        </FirstExplanationTr>\n        <tr style={{ height: '30px' }}>\n          <td />\n          <td />\n          {!isEmpty(state.firstExplanation.id)(store.getState())\n            ? renderDownArrow()\n            : null}\n        </tr>\n      </tbody>\n    )\n  }\n\n  function handleKeyDown(e: KeyboardEvent | undefined, next: () => void) {\n    e && e.preventDefault()\n    next()\n  }\n\n  function insertNewEquationAt(index: number) {\n    state.steps.insert(index, {\n      left: '',\n      sign: state.steps[index - 1].sign.value,\n      right: '',\n      transform: '',\n      explanation: { plugin: 'text' },\n    })\n  }\n\n  function insertNewEquationWithFocus(index: number) {\n    insertNewEquationAt(index)\n    gridFocus.setFocus({\n      row: index,\n      column: firstColumn(transformationTarget),\n    })\n  }\n\n  function renderAddButton() {\n    if (!nestedFocus) return\n\n    return (\n      <AddButton onClick={() => insertNewEquationWithFocus(state.steps.length)}>\n        {config.i18n.addNew}\n      </AddButton>\n    )\n  }\n}\n\nconst DropDown = styled.select({\n  height: '30px',\n  width: '35px',\n  marginLeft: '15px',\n  marginRight: '10px',\n  backgroundColor: 'lightgrey',\n  border: '1px solid lightgrey',\n  borderRadius: '5px',\n})\n\ninterface StepEditorProps {\n  gridFocus: GridFocus\n  row: number\n  state: StateTypeReturnType<typeof stepProps>\n  transformationTarget: TransformationTarget\n  config: EquationsConfig\n}\n\nfunction StepEditor(props: StepEditorProps) {\n  const { gridFocus, row, state, transformationTarget, config } = props\n\n  return (\n    <>\n      {transformationTarget === TransformationTarget.Equation && (\n        <LeftTd\n          onClick={() => gridFocus.setFocus({ row, column: StepSegment.Left })}\n        >\n          <InlineMath\n            focused={gridFocus.isFocused({ row, column: StepSegment.Left })}\n            placeholder={row === 0 ? '3x+1' : `[${config.i18n.leftHandSide}]`}\n            state={state.left}\n            onChange={(src) => state.left.set(src)}\n            onFocusNext={() => gridFocus.moveRight()}\n            onFocusPrevious={() => gridFocus.moveLeft()}\n          />\n        </LeftTd>\n      )}\n      <SignTd>\n        {(transformationTarget === 'equation' || row !== 0) && (\n          <DropDown\n            tabIndex={-1}\n            onChange={(e: React.ChangeEvent<HTMLSelectElement>) => {\n              state.sign.set(e.target.value)\n            }}\n            value={state.sign.value}\n          >\n            {[\n              Sign.Equals,\n              Sign.GreaterThan,\n              Sign.LessThan,\n              Sign.GreaterThanOrEqual,\n              Sign.LessThanOrEqual,\n              Sign.NotEqualTo,\n              Sign.AlmostEqualTo,\n              Sign.Estimates,\n            ].map((sign) => {\n              return (\n                <option key={sign} value={sign}>\n                  {renderSignToString(sign)}\n                </option>\n              )\n            })}\n          </DropDown>\n        )}\n      </SignTd>\n      <MathTd\n        onClick={() => gridFocus.setFocus({ row, column: StepSegment.Right })}\n      >\n        <InlineMath\n          focused={gridFocus.isFocused({ row, column: StepSegment.Right })}\n          placeholder={\n            row === 0\n              ? '4x+3x'\n              : transformationTarget === TransformationTarget.Term\n              ? `[${config.i18n.term}]`\n              : `[${config.i18n.rightHandSide}]`\n          }\n          state={state.right}\n          onChange={(src) => state.right.set(src)}\n          onFocusNext={() => gridFocus.moveRight()}\n          onFocusPrevious={() => gridFocus.moveLeft()}\n        />\n      </MathTd>\n      {transformationTarget === TransformationTarget.Equation && (\n        <TransformTd\n          onClick={() =>\n            gridFocus.setFocus({ row, column: StepSegment.Transform })\n          }\n        >\n          |{' '}\n          <InlineMath\n            focused={gridFocus.isFocused({\n              row,\n              column: StepSegment.Transform,\n            })}\n            placeholder={\n              row === 0\n                ? config.i18n.transformationExample\n                : `[${config.i18n.transformation}]`\n            }\n            state={state.transform}\n            onChange={(src) => state.transform.set(src)}\n            onFocusNext={() => gridFocus.moveRight()}\n            onFocusPrevious={() => gridFocus.moveLeft()}\n          />\n        </TransformTd>\n      )}\n    </>\n  )\n}\n\ninterface InlineMathProps {\n  state: StateTypeReturnType<StringStateType>\n  placeholder: string\n  onChange: (state: string) => void\n  onFocusNext: () => void\n  onFocusPrevious: () => void\n  focused?: boolean\n  prefix?: string\n  suffix?: string\n}\n\nfunction InlineMath(props: InlineMathProps) {\n  const {\n    focused,\n    onFocusNext,\n    onFocusPrevious,\n    onChange,\n    state,\n    prefix = '',\n    suffix = '',\n  } = props\n\n  const preferences = useContext(PreferenceContext)\n\n  return (\n    <MathEditor\n      readOnly={!focused}\n      state={`${prefix}${state.value}${suffix}`}\n      config={{ i18n: { placeholder: props.placeholder } }}\n      inline\n      disableBlock\n      visual={preferences.getKey(preferenceKey) === true}\n      onEditorChange={(visual) => {\n        preferences.setKey(preferenceKey, visual)\n      }}\n      onInlineChange={() => {}}\n      onChange={onChange}\n      onMoveOutRight={onFocusNext}\n      onMoveOutLeft={onFocusPrevious}\n    />\n  )\n}\n\ntype GridFocusState =\n  | {\n      row: number\n      column: number\n    }\n  | 'firstExplanation'\n\ninterface GridFocus {\n  focus: GridFocusState | null\n  isFocused: (cell: GridFocusState) => boolean\n  setFocus: (cell: GridFocusState) => void\n  moveRight: () => void\n  moveLeft: () => void\n}\n\nfunction useGridFocus({\n  rows,\n  columns,\n  focusNext,\n  focusPrevious,\n  onFocusChanged,\n  transformationTarget,\n}: {\n  rows: number\n  columns: number\n  focusNext: () => void\n  focusPrevious: () => void\n  onFocusChanged: (args: GridFocusState) => void\n  transformationTarget: TransformationTarget\n}): GridFocus {\n  const [focus, setFocusState] = useState<GridFocusState | null>(null)\n  const setFocus = (state: GridFocusState) => {\n    onFocusChanged(state)\n    setFocusState(state)\n  }\n  const isFocused = (state: GridFocusState) => {\n    if (focus === null) return false\n    if (focus === 'firstExplanation') return state === focus\n\n    return (\n      state !== 'firstExplanation' &&\n      focus.row === state.row &&\n      focus.column === state.column\n    )\n  }\n\n  return {\n    focus,\n    isFocused,\n    setFocus(state) {\n      if (!isFocused(state)) setFocus(state)\n    },\n    moveRight() {\n      if (focus === null) return\n      if (focus === 'firstExplanation') {\n        setFocus({ row: 0, column: firstColumn(transformationTarget) })\n        return\n      }\n\n      if (\n        focus.row === rows - 1 &&\n        focus.column === lastColumn(transformationTarget)\n      ) {\n        focusNext()\n      } else if (transformationTarget === TransformationTarget.Term) {\n        if (focus.column === StepSegment.Right) {\n          setFocus({ row: focus.row, column: StepSegment.Explanation })\n        } else {\n          setFocus({\n            row: focus.row + 1,\n            column: firstColumn(transformationTarget),\n          })\n        }\n      } else if (focus.column === columns - 1) {\n        setFocus({ row: focus.row + 1, column: StepSegment.Left })\n      } else {\n        setFocus({ row: focus.row, column: focus.column + 1 })\n      }\n    },\n    moveLeft() {\n      if (focus === null) return\n      if (focus === 'firstExplanation') {\n        focusPrevious()\n        return\n      }\n\n      if (transformationTarget === TransformationTarget.Term) {\n        if (focus.row === 0 && focus.column === StepSegment.Right) {\n          focusPrevious()\n        } else if (focus.column === StepSegment.Right) {\n          setFocus({ row: focus.row - 1, column: StepSegment.Explanation })\n        } else {\n          setFocus({ row: focus.row, column: StepSegment.Right })\n        }\n      } else {\n        if (focus.column === 0) {\n          if (focus.row === 0) {\n            setFocus('firstExplanation')\n          } else {\n            setFocus({ row: focus.row - 1, column: columns - 1 })\n          }\n        } else {\n          setFocus({ row: focus.row, column: focus.column - 1 })\n        }\n      }\n    },\n  }\n}\n\nfunction firstColumn(transformationTarget: TransformationTarget) {\n  return transformationTarget === TransformationTarget.Term\n    ? StepSegment.Right\n    : StepSegment.Left\n}\n\nfunction lastColumn(transformationTarget: TransformationTarget) {\n  return transformationTarget === TransformationTarget.Term\n    ? StepSegment.Right\n    : StepSegment.Transform\n}\n","import {\n  child,\n  list,\n  object,\n  EditorPlugin,\n  EditorPluginProps,\n  string,\n  ObjectStateType,\n  StringStateType,\n  ChildStateType,\n  ListStateType\n} from '@edtr-io/plugin'\n\nimport { EquationsEditor } from './editor'\nimport { Sign, renderSignToString } from './sign'\n\n/** @public */\nexport { Sign, renderSignToString }\n\ntype StepPropsType = ObjectStateType<{ left: StringStateType, sign: StringStateType, right: StringStateType, transform: StringStateType, explanation: ChildStateType<string, unknown>}>\n\nexport const stepProps: StepPropsType = object({\n  left: string(''),\n  sign: string(Sign.Equals),\n  right: string(''),\n  transform: string(''),\n  explanation: child({ plugin: 'text', config: { registry: [] } }),\n})\n\nconst equationsState: ObjectStateType<{ steps: ListStateType<StepPropsType>, firstExplanation: ChildStateType<string, unknown>, transformationTarget: StringStateType }>= object({\n  steps: list(stepProps, 2),\n  firstExplanation: child({ plugin: 'text', config: { registry: [] } }),\n  transformationTarget: string('equation'),\n})\n\nexport type EquationsPluginState = typeof equationsState\n/** @public */\nexport type EquationsProps = EditorPluginProps<\n  EquationsPluginState,\n  EquationsConfig\n>\n\n/**\n * @param config - {@link EquationsConfig | Plugin configuration}\n * @public\n */\nexport function createEquationsPlugin(\n  config: EquationsConfig\n): EditorPlugin<EquationsPluginState, EquationsConfig> {\n  return {\n    Component: EquationsEditor,\n    config: config,\n    state: equationsState,\n  }\n}\n\n/** @public */\nexport interface EquationsConfig {\n  i18n: {\n    leftHandSide: string\n    transformation: string\n    mode: string\n    transformationExample: string\n    transformationOfEquations: string\n    transformationOfTerms: string\n    addNewRow: string\n    explanation: string\n    term: string\n    rightHandSide: string\n    combineLikeTerms: string\n    setEqual: string\n    firstExplanation: string\n    addNew: string\n  }\n}"],"names":["Sign","renderSignToString","sign","AlmostEqualTo","Equals","Estimates","GreaterThan","GreaterThanOrEqual","LessThan","LessThanOrEqual","NotEqualTo","TableWrapper","styled","div","padding","Table","table","whiteSpace","MathTd","td","verticalAlign","LeftTd","textAlign","SignTd","TransformTd","paddingLeft","ExplanationTr","tr","margin","FirstExplanationTr","TransformationTarget","EquationsRenderer","_ref","state","store","useScopedStore","transformationTarget","toTransformationTarget","value","tdPadding","React","renderFirstExplanation","steps","map","step","row","Fragment","key","className","left","MathRenderer","inline","Term","right","transform","isEmpty","explanation","id","getState","renderDownArrow","colSpan","render","firstExplanation","style","height","downArrow","downArrowBase64","Buffer","from","toString","backgroundImage","backgroundSize","backgroundRepeat","backgroundPosition","text","isTransformationTarget","Equation","Object","values","includes","StepSegment","preferenceKey","setDefaultPreference","RemoveButton","button","outline","width","border","background","DragButton","span","cursor","paddingRight","EquationsEditor","props","focused","config","focusedElement","useScopedSelector","getFocused","nestedFocus","gridFocus","useGridFocus","rows","length","columns","focusNext","dispatch","focusPrevious","onFocusChanged","focus","column","Explanation","useEffect","setFocus","firstColumn","HotKeys","allowChanges","keyMap","FOCUS_NEXT_OR_INSERT","FOCUS_PREVIOUS","INSERT","handlers","e","handleKeyDown","isFocused","lastColumn","index","insertNewEquationAt","moveRight","moveLeft","insertNewEquationWithFocus","renderIntoSettings","htmlFor","i18n","mode","onChange","set","target","transformationOfEquations","transformationOfTerms","DragDropContext","onDragEnd","result","source","destination","move","Droppable","droppableId","provided","ref","innerRef","droppableProps","Draggable","draggableId","draggableProps","dragHandleProps","tabIndex","EdtrIcon","icon","edtrDragHandle","StepEditor","onClick","remove","Icon","faXmark","renderExplantionTr","onFocus","placeholder","combineLikeTerms","renderAddButton","_config$i18n","next","preventDefault","insert","plugin","AddButton","addNew","DropDown","select","marginLeft","marginRight","backgroundColor","borderRadius","Left","InlineMath","leftHandSide","src","onFocusNext","onFocusPrevious","Right","term","rightHandSide","Transform","transformationExample","transformation","_props$prefix","prefix","_props$suffix","suffix","preferences","useContext","PreferenceContext","MathEditor","readOnly","disableBlock","visual","getKey","onEditorChange","setKey","onInlineChange","onMoveOutRight","onMoveOutLeft","_useState","useState","setFocusState","stepProps","object","string","child","registry","equationsState","list","createEquationsPlugin","Component"],"mappings":"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"}
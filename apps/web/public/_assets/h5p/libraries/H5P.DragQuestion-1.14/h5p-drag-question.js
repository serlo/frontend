(()=>{"use strict";const e=function(e){const t=e.length;return function n(){const i=Array.prototype.slice.call(arguments,0);return i.length>=t?e.apply(null,i):function(){const e=Array.prototype.slice.call(arguments,0);return n.apply(null,i.concat(e))}}},t=(...e)=>e.reduce(((e,t)=>(...n)=>e(t(...n)))),n=e((function(e,t){t.forEach(e)})),i=(e((function(e,t){return t.map(e)})),e((function(e,t){return t.filter(e)}))),o=e((function(e,t){return t.some(e)})),r=e((function(e,t){return-1!=t.indexOf(e)})),s=e((function(e,t){return i((t=>!r(t,e)),t)})),a=e(((e,t)=>t.getAttribute(e))),l=e(((e,t,n)=>n.setAttribute(e,t))),c=e(((e,t)=>t.removeAttribute(e))),h=e(((e,t)=>t.hasAttribute(e))),d=e(((e,t,n)=>n.getAttribute(e)===t)),p=(e(((e,t)=>{const n=a(e,t);l(e,("true"!==n).toString(),t)})),e(((e,t)=>e.appendChild(t))),e(((e,t)=>t.querySelector(e))),e(((e,t)=>{return n=t.querySelectorAll(e),Array.prototype.slice.call(n);var n})),e(((e,t)=>e.removeChild(t))),e(((e,t)=>t.classList.contains(e))),e(((e,t)=>t.classList.add(e)))),u=e(((e,t)=>t.classList.remove(e))),g=p("hidden"),f=u("hidden"),b=(e(((e,t)=>(e?f:g)(t))),e(((e,t,n)=>{n.classList[t?"add":"remove"](e)})),c("tabindex")),v=(n(b),l("tabindex","0")),m=l("tabindex","-1"),y=h("tabindex");class w{constructor(e){Object.assign(this,{listeners:{},on:function(e,t,n){const i={listener:t,scope:n};return this.listeners[e]=this.listeners[e]||[],this.listeners[e].push(i),this},fire:function(e,t){return(this.listeners[e]||[]).every((function(e){return!1!==e.listener.call(e.scope||this,t)}))},propagate:function(e,t){let n=this;e.forEach((e=>t.on(e,(t=>n.fire(e,t)))))}}),this.plugins=e||[],this.elements=[],this.negativeTabIndexAllowed=!1,this.on("nextElement",this.nextElement,this),this.on("previousElement",this.previousElement,this),this.on("firstElement",this.firstElement,this),this.on("lastElement",this.lastElement,this),this.initPlugins()}addElement(e){this.elements.push(e),this.firesEvent("addElement",e),1===this.elements.length&&this.setTabbable(e)}insertElementAt(e,t){this.elements.splice(t,0,e),this.firesEvent("addElement",e),1===this.elements.length&&this.setTabbable(e)}removeElement(e){this.elements=s([e],this.elements),y(e)&&(this.setUntabbable(e),this.elements[0]&&this.setTabbable(this.elements[0])),this.firesEvent("removeElement",e)}count(){return this.elements.length}firesEvent(e,t){const n=this.elements.indexOf(t);return this.fire(e,{element:t,index:n,elements:this.elements,oldElement:this.tabbableElement})}nextElement({index:e}){const t=e===this.elements.length-1,n=this.elements[t?0:e+1];this.setTabbable(n),n.focus()}firstElement(){const e=this.elements[0];this.setTabbable(e),e.focus()}lastElement(){const e=this.elements[this.elements.length-1];this.setTabbable(e),e.focus()}setTabbableByIndex(e){const t=this.elements[e];t&&this.setTabbable(t)}setTabbable(e){n(this.setUntabbable.bind(this),this.elements),v(e),this.tabbableElement=e}setUntabbable(e){e!==document.activeElement&&(this.negativeTabIndexAllowed?m(e):b(e))}previousElement({index:e}){const t=0===e,n=this.elements[t?this.elements.length-1:e-1];this.setTabbable(n),n.focus()}useNegativeTabIndex(){this.negativeTabIndexAllowed=!0,this.elements.forEach((e=>{e.hasAttribute("tabindex")||m(e)}))}initPlugins(){this.plugins.forEach((function(e){void 0!==e.init&&e.init(this)}),this)}}const E="aria-grabbed",k=l(E),x=d(E,"true"),Z=i(h(E)),P=t(n(l(E,"false")),Z),$=t(o(x),Z);class O{init(e){this.controls=e,this.controls.on("select",this.select,this)}addElement(e){k("false",e),this.controls.addElement(e)}setAllGrabbedToFalse(){P(this.controls.elements)}hasAnyGrabbed(){return $(this.controls.elements)}select({element:e}){const t=x(e);this.setAllGrabbedToFalse(),t||k("true",e)}}const T="aria-dropeffect",A=l(T,"none"),D=l(T,"move"),S=i(h(T)),C=t(n(D),S),I=t(n(A),S);class B{init(e){this.controls=e}setAllToMove(){C(this.controls.elements)}setAllToNone(){I(this.controls.elements)}}B.DropEffect={COPY:"copy",MOVE:"move",EXECUTE:"execute",POPUP:"popup",NONE:"none"};class z{constructor(){this.selectability=!0}init(e){this.boundHandleKeyDown=this.handleKeyDown.bind(this),this.controls=e,this.controls.on("addElement",this.listenForKeyDown,this),this.controls.on("removeElement",this.removeKeyDownListener,this)}listenForKeyDown({element:e}){e.addEventListener("keydown",this.boundHandleKeyDown)}removeKeyDownListener({element:e}){e.removeEventListener("keydown",this.boundHandleKeyDown)}handleKeyDown(e){switch(e.which){case 27:this.close(e.target),e.preventDefault(),e.stopPropagation();break;case 35:this.lastElement(e.target),e.preventDefault(),e.stopPropagation();break;case 36:this.firstElement(e.target),e.preventDefault(),e.stopPropagation();break;case 13:case 32:this.select(e.target),e.preventDefault(),e.stopPropagation();break;case 37:case 38:this.hasChromevoxModifiers(e)||(this.previousElement(e.target),e.preventDefault(),e.stopPropagation());break;case 39:case 40:this.hasChromevoxModifiers(e)||(this.nextElement(e.target),e.preventDefault(),e.stopPropagation())}}hasChromevoxModifiers(e){return e.shiftKey||e.ctrlKey}previousElement(e){!1!==this.controls.firesEvent("beforePreviousElement",e)&&(this.controls.firesEvent("previousElement",e),this.controls.firesEvent("afterPreviousElement",e))}nextElement(e){!1!==this.controls.firesEvent("beforeNextElement",e)&&(this.controls.firesEvent("nextElement",e),this.controls.firesEvent("afterNextElement",e))}select(e){this.selectability&&!1!==this.controls.firesEvent("before-select",e)&&(this.controls.firesEvent("select",e),this.controls.firesEvent("after-select",e))}firstElement(e){!1!==this.controls.firesEvent("beforeFirstElement",e)&&(this.controls.firesEvent("firstElement",e),this.controls.firesEvent("afterFirstElement",e))}lastElement(e){!1!==this.controls.firesEvent("beforeLastElement",e)&&(this.controls.firesEvent("lastElement",e),this.controls.firesEvent("afterLastElement",e))}disableSelectability(){this.selectability=!1}enableSelectability(){this.selectability=!0}close(e){!1!==this.controls.firesEvent("before-close",e)&&(this.controls.firesEvent("close",e),this.controls.firesEvent("after-close",e))}}class q{constructor(){this.selectability=!0,this.handleClickBound=this.handleClick.bind(this),this.handleDragBound=this.handleDrag.bind(this)}init(e){this.controls=e,this.controls.on("addElement",this.listenForKeyDown,this),this.controls.on("removeElement",this.unlistenForKeyDown,this)}listenForKeyDown({element:e}){e.addEventListener("click",this.handleClickBound),e.addEventListener("drag",this.handleClickBound)}unlistenForKeyDown({element:e}){e.removeEventListener("click",this.handleClickBound),e.removeEventListener("drag",this.handleDragBound)}handleClick(e){this.controls.firesEvent("select",e.currentTarget)}handleDrag(e){this.controls.firesEvent("drag",e.currentTarget)}disableSelectability(){this.selectability=!1}enableSelectability(){this.selectability=!0}}function H(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var F=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n;return t=e,n=[{key:"setElementOpacity",value:function(t,n){e.setOpacity(t,"borderColor",n),e.setOpacity(t,"boxShadow",n),e.setOpacity(t,"background",n)}},{key:"setOpacity",value:function(t,n,i){if("background"===n)return e.setOpacity(t,"backgroundColor",i),void e.setOpacity(t,"backgroundImage",i);function o(e,t){if("borderColor"===e)return{borderTopColor:t,borderRightColor:t,borderBottomColor:t,borderLeftColor:t};var n={};return n[e]=t,n}i=void 0===i?1:i/100;var r=t.css(n),s=o(n,"");for(var a in t.css(s),s)break;var l=t.css(a);""!==l&&"none"!==l||(l=r),l=e.setAlphas(l,"rgba(",i),l=e.setAlphas(l,"rgb(",i),t.css(o(n,l))}},{key:"setAlphas",value:function(e,t,n){if(e){for(var i=e.indexOf(t);-1!==i;){var o=e.indexOf(")",i),r=e.substring(i+t.length,o).split(",");r[3]=void 0!==r[3]?parseFloat(r[3])*n:n,i=(e=e.substring(0,i)+"rgba("+r.join(",")+e.substring(o,e.length)).indexOf(t,o)}return e}}},{key:"elementToDraggable",value:function(e,t){for(var n=0;n<e.length;n++)if(e[n]){var i=e[n].findElement(t);if(i)return i.draggable=e[n],i}}},{key:"elementToDropZone",value:function(e,t){for(var n=0;n<e.length;n++)if(e[n].$dropZone.is(t))return e[n]}},{key:"positionToPercentage",value:function(e,t){return{top:100*parseInt(t.css("top"))/e.innerHeight()+"%",left:100*parseInt(t.css("left"))/e.innerWidth()+"%"}}},{key:"addHover",value:function(t,n){t.hover((function(){t.addClass("h5p-draggable-hover"),t.parent().hasClass("h5p-dragging")||e.setElementOpacity(t,n)}),(function(){t.parent().hasClass("h5p-dragging")||setTimeout((function(){t.removeClass("h5p-draggable-hover"),e.setElementOpacity(t,n)}),1)})),e.setElementOpacity(t,n)}},{key:"strip",value:function(e){var t=document.createElement("div");return t.innerHTML=e,t.textContent||t.innerText||""}}],null&&H(t.prototype,null),n&&H(t,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function R(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var L=H5P.jQuery,j=function(){function e(t,n,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var o=this;H5P.EventDispatcher.call(o),o.id=n,o.showLabel=t.showLabel,o.label=t.label,o.x=t.x,o.y=t.y,o.width=t.width,o.height=t.height,o.backgroundOpacity=t.backgroundOpacity,o.tip=t.tipsAndFeedback.tip||"",o.single=t.single,o.autoAlignable=t.autoAlign,o.alignables=[],o.l10n=i}var t,n;return t=e,(n=[{key:"appendTo",value:function(e,t){var n=this,i='<div class="h5p-inner"></div>',o="";n.showLabel&&(i='<div class="h5p-label">'+n.label+'<span class="h5p-hidden-read"></span></div>'+i,o=" h5p-has-label"),i='<span class="h5p-hidden-read">'+n.l10n.prefix.replace("{num}",n.id+1)+"</span>"+i,n.$dropZone=L("<div/>",{class:"h5p-dropzone"+o,tabindex:"-1",role:"button","aria-disabled":!0,css:{left:n.x+"%",top:n.y+"%",width:n.width+"em",height:n.height+"em"},html:i}).appendTo(e).children(".h5p-inner").droppable({activeClass:"h5p-active",tolerance:"intersect",accept:function(e){var i=F.elementToDraggable(t,e);return!!i&&n.accepts(i.draggable,t)},drop:function(e,t){var i=L(this);F.setOpacity(i.removeClass("h5p-over"),"background",n.backgroundOpacity),t.draggable.data("addToZone",n.id),-1===n.getIndexOf(t.draggable)&&n.alignables.push(t.draggable),n.autoAlignable.enabled&&n.autoAlign()},over:function(){F.setOpacity(L(this).addClass("h5p-over"),"background",n.backgroundOpacity)},out:function(){F.setOpacity(L(this).removeClass("h5p-over"),"background",n.backgroundOpacity)}}).end().focus((function(){r instanceof H5P.jQuery&&r.attr("tabindex","0")})).blur((function(){r instanceof H5P.jQuery&&r.attr("tabindex","-1")}));var r=H5P.JoubelUI.createTip(n.tip,{tipLabel:n.l10n.tipLabel,tabcontrol:!0});r instanceof H5P.jQuery&&L("<span/>",{class:"h5p-dq-tipwrap","aria-label":n.l10n.tipAvailable,append:r,appendTo:n.$dropZone}),t.forEach((function(e){var t=e.element.$;e.isInDropZone(n.id)&&-1===n.getIndexOf(t)&&n.alignables.push(t)})),n.autoAlignable.enabled&&n.autoAlign(),setTimeout((function(){n.updateBackgroundOpacity()}),0)}},{key:"updateBackgroundOpacity",value:function(){F.setOpacity(this.$dropZone.children(".h5p-label"),"background",this.backgroundOpacity),F.setOpacity(this.$dropZone.children(".h5p-inner"),"background",this.backgroundOpacity)}},{key:"accepts",value:function(e,t){var n=this;if(!e.hasDropZone(n.id))return!1;if(n.single)for(var i=0;i<t.length;i++)if(t[i]&&t[i].isInDropZone(n.id))return!1;return!0}},{key:"getIndexOf",value:function(e){for(var t=0;t<this.alignables.length;t++)if(this.alignables[t][0]===e[0])return t;return-1}},{key:"removeAlignable",value:function(e){var t=this,n=t.getIndexOf(e);-1!==n&&(t.alignables.splice(n,1),void 0===t.autoAlignTimer&&t.autoAlignable.enabled&&(t.autoAlignTimer=setTimeout((function(){delete t.autoAlignTimer,t.autoAlign()}),1)))}},{key:"autoAlign",value:function(){for(var e,t,n=this,i=n.$dropZone.parent()[0].getBoundingClientRect(),o=n.autoAlignable.spacing/n.autoAlignable.size.width*100,r=n.autoAlignable.spacing/n.autoAlignable.size.height*100,s={x:n.x+o,y:n.y+r},a=n.$dropZone[0].getBoundingClientRect(),l={x:a.width-2*o,y:a.height-2*r},c={x:l.x,y:l.y},h=0,d=function(){e.css({left:s.x+"%",top:s.y+"%"}),n.trigger("elementaligned",e);var o=t.width+n.autoAlignable.spacing;c.x-=o,s.x+=o/i.width*100;var r=t.height+n.autoAlignable.spacing;r>h&&(h=r)},p=0;p<n.alignables.length;p++)if(e=n.alignables[p],t=e[0].getBoundingClientRect(),c.x>=t.width)d();else{if(c.x=l.x,s.x=n.x+o,h&&(c.y-=h,s.y+=h/i.height*100,h=0),c.y<=0)return;d()}}},{key:"highlight",value:function(){this.$dropZone.attr("aria-disabled","false").children(".h5p-inner").addClass("h5p-active")}},{key:"dehighlight",value:function(){this.$dropZone.attr("aria-disabled","true").children(".h5p-inner").removeClass("h5p-active")}},{key:"reset",value:function(){this.alignables=[]}}])&&R(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function Q(e){return Q="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Q(e)}function K(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function X(e,t){return X=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},X(e,t)}function M(e,t){if(t&&("object"===Q(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return N(e)}function N(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function U(e){return U=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},U(e)}var _=H5P.jQuery,G=function(e){return e.stopPropagation()},W=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&X(e,t)}(s,H5P.EventDispatcher);var t,n,i,o,r=(i=s,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=U(i);if(o){var n=U(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return M(this,e)});function s(e,t,n,i,o,a){var l;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s);var c=N(l=r.call(this));if(c.$=_(c),c.id=t,c.elements=[],c.x=e.x,c.y=e.y,c.width=e.width,c.height=e.height,c.backgroundOpacity=e.backgroundOpacity,c.dropZones=e.dropZones,c.type=e.type,c.multiple=e.multiple,c.l10n=i,c.allDropzones=o,c.draggableNum=a,n){c.multiple&&c.elements.push({});for(var h=0;h<n.length;h++)c.elements.push({dropZone:n[h].dz,position:{left:n[h].x+"%",top:n[h].y+"%"}})}return l}return t=s,(n=[{key:"appendTo",value:function(e,t){var n=this;if(n.elements.length)for(var i=0;i<n.elements.length;i++)n.attachElement(i,e,t);else n.attachElement(null,e,t)}},{key:"attachElement",value:function(e,t,n){var i,o=this;null===e?(i={},o.elements.push(i),e=o.elements.length-1):i=o.elements[e],_.extend(i,{clone:function(){o.attachElement(null,t,n)},reset:function(){void 0!==i.dropZone&&(o.trigger("leavingDropZone",i),delete i.dropZone),o.multiple&&(i.$.remove(),delete o.elements[e],o.trigger("elementremove",i.$[0])),delete i.position}}),i.$=_("<div/>",{class:"h5p-draggable",tabindex:"-1",role:"button",css:{left:o.x+"%",top:o.y+"%",width:o.width+"em",height:o.height+"em"},appendTo:t,title:o.type.params.title}).on("click",(function(){o.trigger("focus",this)})).on("touchmove",G).on("touchstart",G).on("touchend",G).draggable({revert:function(e){t.removeClass("h5p-dragging");var n=_(this);return n.data("uiDraggable").originalPosition={top:o.y+"%",left:o.x+"%"},o.updatePlacement(i),n[0].setAttribute("aria-grabbed","false"),o.trigger("dragend"),!e},start:function(){var e=_(this),n=o.mustCopyElement(i);n&&i.clone(),e.removeClass("h5p-wrong").detach().appendTo(t),t.addClass("h5p-dragging"),F.setElementOpacity(e,o.backgroundOpacity),this.setAttribute("aria-grabbed","true"),o.trigger("focus",this),o.trigger("dragstart",{element:this,effect:n?"copy":"move"})},stop:function(){var n=_(this);i.position=F.positionToPercentage(t,n),n.css(i.position);var r=n.data("addToZone");void 0!==r?(n.removeData("addToZone"),o.addToDropZone(e,i,r)):i.reset()}}).css("position",""),o.element=i,i.position&&(i.$.css(i.position),o.updatePlacement(i)),F.addHover(i.$,o.backgroundOpacity),H5P.newRunnable(o.type,n,i.$),_('<span class="h5p-hidden-read">'+o.l10n.prefix.replace("{num}",o.draggableNum)+"</span>").prependTo(i.$),_('<span class="h5p-hidden-read"></span>').appendTo(i.$),setTimeout((function(){F.setElementOpacity(i.$,o.backgroundOpacity)}),0),o.trigger("elementadd",i.$[0])}},{key:"setFeedback",value:function(e,t){this.elements.forEach((function(n){n.dropZone===t&&(void 0===n.$feedback&&(n.$feedback=_("<span>",{class:"h5p-hidden-read",appendTo:n.$})),n.$feedback.html(e))}))}},{key:"mustCopyElement",value:function(e){return this.multiple&&void 0===e.dropZone}},{key:"hasDropZone",value:function(e){for(var t=0;t<this.dropZones.length;t++)if(parseInt(this.dropZones[t])===e)return!0;return!1}},{key:"addToDropZone",value:function(e,t,n){var i=this;if(i.multiple)for(var o=0;o<i.elements.length;o++)if(o!==e&&void 0!==i.elements[o]&&i.elements[o].dropZone===n)return void 0!==i.elements[e].dropZone&&i.elements[e].dropZone!==n&&i.trigger("leavingDropZone",t),t.$.remove(),delete i.elements[e],void i.trigger("elementremove",this.element.$[0]);void 0!==t.dropZone&&t.dropZone!==n&&i.trigger("leavingDropZone",t),t.dropZone=n,i.updatePlacement(t),i.trigger("interacted")}},{key:"updatePlacement",value:function(e){if(e.$suffix&&e.$suffix.remove(),void 0!==e.dropZone){e.$.addClass("h5p-dropped"),F.setElementOpacity(e.$,self.backgroundOpacity);var t=this.allDropzones[e.dropZone].label;if(t){var n=document.createElement("div");n.innerHTML=t,t=n.innerText}else t=e.dropZone+1;e.$suffix=_('<span class="h5p-hidden-read">'+this.l10n.suffix.replace("{num}",t)+"</span>").appendTo(e.$)}else e.$.removeClass("h5p-dropped").removeClass("h5p-wrong").removeClass("h5p-correct").css({border:"",background:""}),F.setElementOpacity(e.$,this.backgroundOpacity)}},{key:"resetPosition",value:function(){var e=this;this.elements.forEach((function(t){if(t.$feedback&&(t.$feedback.remove(),delete t.$feedback),void 0!==t.dropZone){var n=t.$;n.animate({left:e.x+"%",top:e.y+"%"},(function(){e.multiple&&(void 0!==n.dropZone&&e.trigger("leavingDropZone",n),n.remove(),e.elements.indexOf(t)>=0&&delete e.elements[e.elements.indexOf(t)],e.trigger("elementremove",n[0]))})),e.updatePlacement(t)}})),e.element&&(void 0!==e.element.dropZone&&(e.trigger("leavingDropZone",e.element),delete e.element.dropZone),e.updatePlacement(e.element))}},{key:"findElement",value:function(e){for(var t=this,n=0;n<t.elements.length;n++)if(void 0!==t.elements[n]&&t.elements[n].$.is(e))return{element:t.elements[n],index:n}}},{key:"isInDropZone",value:function(e){for(var t=this,n=0;n<t.elements.length;n++)if(void 0!==t.elements[n]&&t.elements[n].dropZone===e)return!0;return!1}},{key:"disable",value:function(){for(var e=this,t=0;t<e.elements.length;t++){var n=e.elements[t];n&&(n.$.draggable("disable"),e.trigger("elementremove",n.$[0]))}}},{key:"enable",value:function(){for(var e=this,t=0;t<e.elements.length;t++){var n=e.elements[t];n&&(n.$.draggable("enable"),e.trigger("elementadd",n.$[0]))}}},{key:"results",value:function(e,t,n){var i,o,r,s,a=this,l=0;if(a.rawPoints=0,void 0===t){for(i=0;i<a.elements.length;i++)void 0!==(r=a.elements[i])&&void 0!==r.dropZone&&(!0!==e&&a.markElement(r,"wrong",n),l--);return l}for(i=0;i<a.elements.length;i++)if(void 0!==(r=a.elements[i])&&void 0!==r.dropZone){for(s=!1,o=0;o<t.length;o++)if(r.dropZone===t[o]){!0!==e&&a.markElement(r,"correct",n),s=!0,a.rawPoints++,l++;break}s||(!0!==e&&a.markElement(r,"wrong",n),l--)}return l}},{key:"markElement",value:function(e,t,n){var i=_("<span/>",{class:"h5p-hidden-read",html:this.l10n[t+"Answer"]+". "});n&&(i=i.add(n.getElement("correct"===t))),e.$suffix=e.$suffix.add(i),e.$.addClass("h5p-"+t).append(i),F.setElementOpacity(e.$,this.backgroundOpacity)}}])&&K(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),s}(),V=H5P.jQuery,Y=0;function J(e,t,n){var i,o,r=this;Y++,this.id=this.contentId=t,this.contentData=n,H5P.Question.call(r,"dragquestion"),this.options=V.extend(!0,{},{scoreShow:"Check",tryAgain:"Retry",grabbablePrefix:"Grabbable {num} of {total}.",grabbableSuffix:"Placed in dropzone {num}.",dropzonePrefix:"Dropzone {num} of {total}.",noDropzone:"No dropzone",tipLabel:"Show tip.",tipAvailable:"Tip available",correctAnswer:"Correct answer",wrongAnswer:"Wrong answer",feedbackHeader:"Feedback",scoreBarLabel:"You got :num out of :total points",scoreExplanationButtonLabel:"Show score explanation",question:{settings:{questionTitle:this.contentData&&this.contentData.metadata&&this.contentData.metadata.title?this.contentData.metadata.title:"Drag and drop",size:{width:620,height:310}},task:{elements:[],dropZones:[]}},overallFeedback:[],behaviour:{enableRetry:!0,enableCheckButton:!0,preventResize:!1,singlePoint:!1,applyPenalties:!0,enableScoreExplanation:!0,dropZoneHighlighting:"dragging",autoAlignSpacing:2,showScorePoints:!0,showTitle:!1},a11yCheck:"Check the answers. The responses will be marked as correct, incorrect, or unanswered.",a11yRetry:"Retry the task. Reset all responses and start the task over again.",submit:"Submit"},e),this.options.behaviour.singlePoint&&(this.options.behaviour.enableScoreExplanation=!1),this.draggables=[],this.dropZones=[],this.answered=n&&void 0!==n.previousState&&void 0!==n.previousState.answers&&n.previousState.answers.length,this.blankIsCorrect=!0,this.backgroundOpacity=void 0===this.options.behaviour.backgroundOpacity||""===this.options.behaviour.backgroundOpacity.trim()?void 0:this.options.behaviour.backgroundOpacity,r.$noDropZone=V('<div class="h5p-dq-no-dz" role="button" style="display:none;"><span class="h5p-hidden-read">'+r.options.noDropzone+"</span></div>");var s=ee(r.draggables,r.dropZones,r.$noDropZone[0]),a=function(e){for(var t=0;t<s.drop.elements.length;t++)s.drop.elements[t].setAttribute("aria-dropeffect",e)},l=[],c=this.options.question.task;for(this.correctDZs=[],i=0;i<c.dropZones.length;i++){l.push(!0);var h=c.dropZones[i].correctElements;for(o=0;o<h.length;o++){var d=h[o];void 0===this.correctDZs[d]&&(this.correctDZs[d]=[]),this.correctDZs[d].push(i)}}this.weight=1;var p=function(e){return!(void 0===e.dropZones||!e.dropZones.length)},u={prefix:r.options.grabbablePrefix.replace("{total}",c.elements.filter(p).length),suffix:r.options.grabbableSuffix,correctAnswer:r.options.correctAnswer,wrongAnswer:r.options.wrongAnswer},g=1;for(i=0;i<c.elements.length;i++){var f=c.elements[i];if(p(f)){void 0!==this.backgroundOpacity&&(f.backgroundOpacity=this.backgroundOpacity);var b=null;n&&void 0!==n.previousState&&void 0!==n.previousState.answers&&void 0!==n.previousState.answers[i]&&(b=n.previousState.answers[i]);var v=new W(f,i,b,u,c.dropZones,g++),m="dragging"===r.options.behaviour.dropZoneHighlighting;for(v.on("elementadd",(function(e){s.drag.addElement(e.data)})),v.on("elementremove",(function(e){s.drag.removeElement(e.data),"true"===e.data.getAttribute("aria-grabbed")&&(s.drag.firesEvent("select",e.data),e.data.removeAttribute("aria-grabbed"))})),v.on("focus",(function(e){s.drag.setTabbable(e.data),e.data.focus()})),v.on("dragstart",(function(e){m&&r.$container.addClass("h5p-dq-highlight-dz"),a(e.data)})),v.on("dragend",(function(){m&&r.$container.removeClass("h5p-dq-highlight-dz"),a("none")})),v.on("interacted",(function(){r.answered=!0,r.triggerXAPI("interacted")})),v.on("leavingDropZone",(function(e){r.dropZones[e.data.dropZone].removeAlignable(e.data.$)})),this.draggables[i]=v,o=0;o<f.dropZones.length;o++)l[f.dropZones[o]]=!1}}this.numDropZonesWithoutElements=0;var y={prefix:r.options.dropzonePrefix.replace("{total}",c.dropZones.length),tipLabel:r.options.tipLabel,tipAvailable:r.options.tipAvailable};for(i=0;i<c.dropZones.length;i++){var w=c.dropZones[i];!0===l[i]&&(this.numDropZonesWithoutElements+=1),this.blankIsCorrect&&w.correctElements.length&&(this.blankIsCorrect=!1),w.autoAlign={enabled:w.autoAlign,spacing:r.options.behaviour.autoAlignSpacing,size:r.options.question.settings.size},this.dropZones[i]=new j(w,i,y),this.dropZones[i].on("elementaligned",(function(e){for(var t=e.data,n=0;n<r.draggables.length;n++){var i=r.draggables[n];if(i&&i.elements&&i.elements.length)for(var o=0;o<i.elements.length;o++){var s=i.elements[o];if(s&&s.$[0]===t[0])return void(s.position=F.positionToPercentage(r.$container,s.$))}}}))}this.on("resize",r.resize,r),this.on("domChanged",(function(e){r.contentId===e.data.contentId&&r.trigger("resize")})),this.on("enterFullScreen",(function(){r.$container&&(r.$container.parents(".h5p-content").css("height","100%"),r.trigger("resize"))})),this.on("exitFullScreen",(function(){r.$container&&(r.$container.parents(".h5p-content").css("height","auto"),r.trigger("resize"))}))}J.prototype=Object.create(H5P.Question.prototype),J.prototype.constructor=J,J.prototype.registerDomElements=function(){var e=this;e.options.behaviour.showTitle&&(e.$introduction=V('<p class="h5p-dragquestion-introduction" id="dq-intro-'+Y+'">'+e.options.question.settings.questionTitle+"</p>"),e.setIntroduction(e.$introduction));var t="";if(void 0!==this.options.question.settings.background&&(t+="h5p-dragquestion-has-no-background"),"always"===e.options.behaviour.dropZoneHighlighting&&(t&&(t+=" "),t+="h5p-dq-highlight-dz-always"),e.setContent(e.createQuestionContent(),{class:t}),!1!==H5P.canHasFullScreen&&this.options.behaviour.enableFullScreen){var n=function(){H5P.isFullscreen?H5P.exitFullScreen(e.$container):H5P.fullScreen(e.$container.parent().parent(),e)},i=V("<div/>",{class:"h5p-my-fullscreen-button-enter",title:this.options.localize.fullscreen,role:"button",tabindex:0,on:{click:n,keypress:function(e){13!==e.which&&32!==e.which||(n(),e.preventDefault())}},prependTo:this.$container.parent()});this.on("enterFullScreen",(function(){i.attr("class","h5p-my-fullscreen-button-exit"),i.attr("title",this.options.localize.exitFullscreen)})),this.on("exitFullScreen",(function(){i.attr("class","h5p-my-fullscreen-button-enter"),i.attr("title",this.options.localize.fullscreen)}))}e.registerButtons(),setTimeout((function(){e.trigger("resize")}),200)},J.prototype.getXAPIData=function(){var e=this.createXAPIEventTemplate("answered");return this.addQuestionToXAPI(e),this.addResponseToXAPI(e),{statement:e.data.statement}},J.prototype.addQuestionToXAPI=function(e){var t=e.getVerifiedStatementValue(["object","definition"]);V.extend(t,this.getXAPIDefinition())},J.prototype.getXAPIDefinition=function(){var e={};e.description={"en-US":V("<div>"+this.options.question.settings.questionTitle+"</div>").text()},e.type="http://adlnet.gov/expapi/activities/cmi.interaction",e.interactionType="matching",e.source=[];for(var t=0;t<this.options.question.task.elements.length;t++){var n=this.options.question.task.elements[t];if(n.dropZones&&n.dropZones.length){var i=n.type.params.alt?n.type.params.alt:n.type.params.text;e.source.push({id:""+t,description:{"en-US":V("<div>"+i+"</div>").text()}})}}e.correctResponsesPattern=[""],e.target=[];var o=!0;for(t=0;t<this.options.question.task.dropZones.length;t++)if(e.target.push({id:""+t,description:{"en-US":V("<div>"+this.options.question.task.dropZones[t].label+"</div>").text()}}),this.options.question.task.dropZones[t].correctElements)for(var r=0;r<this.options.question.task.dropZones[t].correctElements.length;r++){var s=this.options.question.task,a=s.elements[s.dropZones[t].correctElements[r]];!a||a.dropZones.indexOf(t.toString())<0||(o||(e.correctResponsesPattern[0]+="[,]"),e.correctResponsesPattern[0]+=t+"[.]"+s.dropZones[t].correctElements[r],o=!1)}return e},J.prototype.addResponseToXAPI=function(e){var t=this.getMaxScore(),n=this.getScore(),i=n==t;e.setScoredResult(n,t,this,!0,i),e.data.statement.result.response=this.getUserXAPIResponse()},J.prototype.getUserXAPIResponse=function(){var e=this.getUserAnswers();return e?e.filter((function(e){return e.elements.length})).map((function(e){return e.elements.filter((function(e){return void 0!==e.dropZone})).map((function(t){return t.dropZone+"[.]"+e.index})).join("[,]")})).filter((function(e){return void 0!==e&&""!==e})).join("[,]"):""},J.prototype.getUserAnswers=function(){return this.draggables.map((function(e,t){return{index:t,draggable:e}})).filter((function(e){return void 0!==e.draggable&&e.draggable.elements})).map((function(e){return{index:e.index,elements:e.draggable.elements}}))},J.prototype.createQuestionContent=function(){var e;this.$container=V('<div class="h5p-inner" role="application" aria-labelledby="dq-intro-'+Y+'"></div>'),void 0!==this.options.question.settings.background&&this.$container.css("backgroundImage",'url("'+H5P.getPath(this.options.question.settings.background.path,this.id)+'")');var t=this.options.question.task;for(e=0;e<t.elements.length;e++){var n=t.elements[e];if(void 0!==n.dropZones&&0!==n.dropZones.length)this.draggables[e].appendTo(this.$container,this.id);else{var i=this.addElement(n,"static",e);H5P.newRunnable(n.type,this.id,i),function(e,t){setTimeout((function(){F.setOpacity(e,"background",t.backgroundOpacity)}),0)}(i,n)}}for(this.$noDropZone.appendTo(this.$container),e=0;e<this.dropZones.length;e++)this.dropZones[e].appendTo(this.$container,this.draggables);return this.$container},J.prototype.registerButtons=function(){this.options.behaviour.enableCheckButton&&this.addSolutionButton(),this.addRetryButton()},J.prototype.addSolutionButton=function(){var e=this;this.addButton("check-answer",this.options.scoreShow,(function(){e.answered=!0,e.showAllSolutions(),e.showScore(),e.addExplanation();var t=e.createXAPIEventTemplate("answered");e.addQuestionToXAPI(t),e.addResponseToXAPI(t),e.trigger(t),(e.$introduction?e.$introduction:e.$container.children().first()).focus()}),!0,{"aria-label":this.options.a11yCheck},{contentData:this.contentData,textIfSubmitting:this.options.submit})},J.prototype.addExplanation=function(){var e=this,t=this.options.question.task,n=[];t.dropZones.forEach((function(t,i){var o={correct:t.tipsAndFeedback.feedbackOnCorrect,incorrect:t.tipsAndFeedback.feedbackOnIncorrect};if(void 0!==o.correct||void 0!==o.incorrect){var r=t.correctElements,s={};e.draggables.forEach((function(e){e.elements.forEach((function(t){t.dropZone==i&&(s[e.id]={instance:e,correct:-1!==r.indexOf(""+e.id)})}))})),Object.keys(s).forEach((function(e){var r=s[e],a=F.strip(r.instance.type.params.alt||r.instance.type.params.text)||"?",l=F.strip(t.label);r.correct&&o.correct?(n.push({correct:l+" + "+a,text:o.correct}),r.instance.setFeedback(o.correct,i)):!r.correct&&o.incorrect&&(n.push({correct:l+" + ",wrong:a,text:o.incorrect}),r.instance.setFeedback(o.incorrect,i))}))}})),0!==n.length&&this.setExplanation(n,this.options.feedbackHeader)},J.prototype.addRetryButton=function(){var e=this;this.addButton("try-again",this.options.tryAgain,(function(){e.resetTask(),e.showButton("check-answer"),e.hideButton("try-again")}),!1,{"aria-label":this.options.a11yRetry})},J.prototype.addElement=function(e,t,n){return V('<div class="h5p-'+t+'" style="left:'+e.x+"%;top:"+e.y+"%;width:"+e.width+"em;height:"+e.height+'em"></div>').appendTo(this.$container).data("id",n)},J.prototype.resize=function(e){var t=this;if(void 0!==this.$container&&this.$container.is(":visible")){t.dropZones.forEach((function(e){e.updateBackgroundOpacity()}));var n=e&&e.data&&e.data.decreaseSize;n||(this.$container.css("height","99999px"),t.$container.parents(".h5p-standalone.h5p-dragquestion").css("width",""));var i=this.options.question.settings.size,o=i.width/i.height,r=this.$container.parent(),s=r.width()-parseFloat(r.css("margin-left"))-parseFloat(r.css("margin-right")),a=t.$container.parents(".h5p-standalone.h5p-dragquestion.h5p-semi-fullscreen");if(a.length){a.css("width",""),n||(t.$container.css("width","10px"),a.css("width",""),setTimeout((function(){t.trigger("resize",{decreaseSize:!0})}),200));var l=V(window.frameElement);l&&(s=l.parent().width(),a.css("width",s+"px"))}var c=s/o;s<=0&&(s=i.width,c=i.height),this.$container.css({width:s+"px",height:c+"px",fontSize:s/i.width*16+"px"})}},J.prototype.disableDraggables=function(){this.draggables.forEach((function(e){e.disable()}))},J.prototype.enableDraggables=function(){this.draggables.forEach((function(e){e.enable()}))},J.prototype.showAllSolutions=function(e){var t;this.points=0,this.rawPoints=0,this.blankIsCorrect&&(this.points=1,this.rawPoints=1),!e&&this.options.behaviour.showScorePoints&&!this.options.behaviour.singlePoint&&this.options.behaviour.applyPenalties&&(t=new H5P.Question.ScorePoints);for(var n=0;n<this.draggables.length;n++){var i=this.draggables[n];void 0!==i&&(e||i.disable(),this.points+=i.results(e,this.correctDZs[n],t),this.rawPoints+=i.rawPoints)}this.points<0&&(this.points=0),!this.answered&&this.blankIsCorrect&&(this.points=this.weight),this.options.behaviour.singlePoint&&(this.points=this.points===this.calculateMaxScore()?1:0),e||this.hideButton("check-answer"),this.options.behaviour.enableRetry&&!e&&this.showButton("try-again"),!this.hasButton("check-answer")||!1!==this.options.behaviour.enableRetry&&this.points!==this.getMaxScore()||this.hideButton("try-again")},J.prototype.showSolutions=function(){this.showAllSolutions(),this.showScore(),this.hideButton("check-answer"),this.hideButton("try-again"),this.disableDraggables()},J.prototype.resetTask=function(){if(this.points=0,this.rawPoints=0,this.answered=!1,this.$container)this.dropZones.forEach((function(e){e.reset()})),this.enableDraggables(),this.draggables.forEach((function(e){e.resetPosition()}));else for(var e=0;e<this.draggables.length;e++)if(void 0!==this.draggables[e])for(var t=0;t<this.draggables[e].elements.length;t++)void 0!==this.draggables[e].elements[t]&&(this.draggables[e].elements[t].dropZone=void 0,this.draggables[e].elements[t].position=void 0);this.showButton("check-answer"),this.hideButton("try-again"),this.removeFeedback(),this.setExplanation()},J.prototype.calculateMaxScore=function(){var e=0;if(this.blankIsCorrect)return 1;for(var t=this.options.question.task.elements,n=0;n<t.length;n++){var i=this.correctDZs[n];void 0!==i&&i.length&&(t[n].multiple?e+=i.length:e++)}return e},J.prototype.getMaxScore=function(){return this.options.behaviour.singlePoint?this.weight:this.calculateMaxScore()},J.prototype.getScore=function(){this.showAllSolutions(!0);var e=this.options.behaviour.applyPenalties||this.options.behaviour.singlePoint?this.points:this.rawPoints;return delete this.points,delete this.rawPoints,e},J.prototype.getAnswerGiven=function(){return this.answered||this.blankIsCorrect},J.prototype.showScore=function(){var e=this.calculateMaxScore();this.options.behaviour.singlePoint&&(e=1);var t=this.options.behaviour.applyPenalties||this.options.behaviour.singlePoint?this.points:this.rawPoints,n=H5P.Question.determineOverallFeedback(this.options.overallFeedback,t/e).replace("@score",t).replace("@total",e),i=!(!this.options.behaviour.enableScoreExplanation||!this.options.behaviour.applyPenalties)&&this.options.scoreExplanation;this.setFeedback(n,t,e,this.options.scoreBarLabel,i,void 0,this.options.scoreExplanationButtonLabel)},J.prototype.getCurrentState=function(){for(var e={answers:[]},t=0;t<this.draggables.length;t++){var n=this.draggables[t];if(void 0!==n){for(var i=[],o=0;o<n.elements.length;o++){var r=n.elements[o];void 0!==r&&void 0!==r.dropZone&&i.push({x:Number(r.position.left.replace("%","")),y:Number(r.position.top.replace("%","")),dz:r.dropZone})}i.length&&(e.answers[t]=i)}}return e},J.prototype.getTitle=function(){return H5P.createTitle(this.contentData&&this.contentData.metadata&&this.contentData.metadata.title?this.contentData.metadata.title:"Drag and drop")};var ee=function(e,t,n){var i,o={drag:new w([new z,new q,new O]),drop:new w([new z,new q,new B])};o.drag.useNegativeTabIndex(),o.drop.useNegativeTabIndex();var r=function(){i.draggable.trigger("dragend"),i.element.$.removeClass("h5p-draggable-hover"),F.setElementOpacity(i.element.$,i.draggable.backgroundOpacity),-1!==o.drop.elements.indexOf(n)&&(o.drop.removeElement(n),n.style.display="none");for(var e=0;e<t.length;e++){var r=t[e];r.dehighlight(),-1!==o.drop.elements.indexOf(r.$dropZone[0])&&o.drop.removeElement(r.$dropZone[0])}if(i.element.$.is(":visible"))i.element.$.focus();else{var s=i.draggable.elements[i.draggable.elements.length-1].$;o.drag.setTabbable(s[0]),s.focus()}i=void 0};return o.drag.on("select",(function(s){var a=F.elementToDraggable(e,s.element);if(i)r();else{var l;(i=a).element.$.addClass("h5p-draggable-hover"),F.setElementOpacity(i.element.$,i.draggable.backgroundOpacity),i.draggable.trigger("dragstart",i.draggable.mustCopyElement(i.element)?"copy":"move"),o.drop.addElement(n),n.style.display="block",n.style.left=i.draggable.x+"%",n.style.top=i.draggable.y+"%",n.style.width=i.draggable.width+"em",n.style.height=i.draggable.height+"em";for(var c=0;c<t.length;c++){var h=t[c];h.accepts(i.draggable,e)&&(h.highlight(),o.drop.addElement(h.$dropZone[0]),l&&i.element.dropZone!==h.id||(l=h.$dropZone))}l&&(o.drop.setTabbable(l[0]),l.focus())}})),o.drop.on("select",(function(e){if(i){if(e.element===n)return void 0!==i.element.dropZone&&i.element.reset(),void(void 0!==i&&(i.element.$.css({left:i.draggable.x+"%",top:i.draggable.y+"%",width:i.draggable.width+"em",height:i.draggable.height+"em"}),i.draggable.updatePlacement(i.element),i.element.$[0].setAttribute("aria-grabbed","false"),r()));var o=F.elementToDropZone(t,e.element);i.draggable.mustCopyElement(i.element)&&i.element.clone(),i.draggable.addToDropZone(i.index,i.element,o.id),i.element.$.css({left:o.x+"%",top:o.y+"%"}),-1===o.getIndexOf(i.element.$)&&o.alignables.push(i.element.$),o.autoAlign(),i.element.$[0].setAttribute("aria-grabbed","false"),r()}})),o};H5P.DragQuestion=J})();